# Comparing `tmp/nucliadb_models-3.1.0.post500-py3-none-any.whl.zip` & `tmp/nucliadb_models-3.1.0.post501-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 46282 bytes, number of entries: 31
--rw-r--r--  2.0 unx     1379 b- defN 24-May-14 11:08 nucliadb_models/__init__.py
--rw-r--r--  2.0 unx     7653 b- defN 24-May-14 11:08 nucliadb_models/common.py
--rw-r--r--  2.0 unx     1786 b- defN 24-May-14 11:08 nucliadb_models/configuration.py
--rw-r--r--  2.0 unx     4242 b- defN 24-May-14 11:08 nucliadb_models/conversation.py
--rw-r--r--  2.0 unx     1682 b- defN 24-May-14 11:08 nucliadb_models/datetime.py
--rw-r--r--  2.0 unx     3952 b- defN 24-May-14 11:08 nucliadb_models/entities.py
--rw-r--r--  2.0 unx     1255 b- defN 24-May-14 11:08 nucliadb_models/export_import.py
--rw-r--r--  2.0 unx     8924 b- defN 24-May-14 11:08 nucliadb_models/extracted.py
--rw-r--r--  2.0 unx     2191 b- defN 24-May-14 11:08 nucliadb_models/file.py
--rw-r--r--  2.0 unx     1735 b- defN 24-May-14 11:08 nucliadb_models/keywordset.py
--rw-r--r--  2.0 unx     3539 b- defN 24-May-14 11:08 nucliadb_models/labels.py
--rw-r--r--  2.0 unx     3147 b- defN 24-May-14 11:08 nucliadb_models/layout.py
--rw-r--r--  2.0 unx     2581 b- defN 24-May-14 11:08 nucliadb_models/link.py
--rw-r--r--  2.0 unx    12517 b- defN 24-May-14 11:08 nucliadb_models/metadata.py
--rw-r--r--  2.0 unx     4355 b- defN 24-May-14 11:08 nucliadb_models/notifications.py
--rw-r--r--  2.0 unx      998 b- defN 24-May-14 11:08 nucliadb_models/processing.py
--rw-r--r--  2.0 unx        0 b- defN 24-May-14 11:08 nucliadb_models/py.typed
--rw-r--r--  2.0 unx     9610 b- defN 24-May-14 11:08 nucliadb_models/resource.py
--rw-r--r--  2.0 unx    44309 b- defN 24-May-14 11:08 nucliadb_models/search.py
--rw-r--r--  2.0 unx     1402 b- defN 24-May-14 11:08 nucliadb_models/security.py
--rw-r--r--  2.0 unx     1904 b- defN 24-May-14 11:08 nucliadb_models/synonyms.py
--rw-r--r--  2.0 unx     2832 b- defN 24-May-14 11:08 nucliadb_models/text.py
--rw-r--r--  2.0 unx      933 b- defN 24-May-14 11:08 nucliadb_models/trainset.py
--rw-r--r--  2.0 unx     2181 b- defN 24-May-14 11:08 nucliadb_models/utils.py
--rw-r--r--  2.0 unx     1838 b- defN 24-May-14 11:08 nucliadb_models/vectors.py
--rw-r--r--  2.0 unx     7766 b- defN 24-May-14 11:08 nucliadb_models/writer.py
--rw-r--r--  2.0 unx      607 b- defN 24-May-14 11:10 nucliadb_models-3.1.0.post500.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-May-14 11:10 nucliadb_models-3.1.0.post500.dist-info/WHEEL
--rw-r--r--  2.0 unx       16 b- defN 24-May-14 11:10 nucliadb_models-3.1.0.post500.dist-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 24-May-14 11:09 nucliadb_models-3.1.0.post500.dist-info/zip-safe
--rw-rw-r--  2.0 unx     2639 b- defN 24-May-14 11:10 nucliadb_models-3.1.0.post500.dist-info/RECORD
-31 files, 138066 bytes uncompressed, 42030 bytes compressed:  69.6%
+Zip file size: 47125 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     1379 b- defN 24-May-14 23:18 nucliadb_models/__init__.py
+-rw-r--r--  2.0 unx     7653 b- defN 24-May-14 23:18 nucliadb_models/common.py
+-rw-r--r--  2.0 unx     1786 b- defN 24-May-14 23:18 nucliadb_models/configuration.py
+-rw-r--r--  2.0 unx     4242 b- defN 24-May-14 23:18 nucliadb_models/conversation.py
+-rw-r--r--  2.0 unx     1682 b- defN 24-May-14 23:18 nucliadb_models/datetime.py
+-rw-r--r--  2.0 unx     3952 b- defN 24-May-14 23:18 nucliadb_models/entities.py
+-rw-r--r--  2.0 unx     1255 b- defN 24-May-14 23:18 nucliadb_models/export_import.py
+-rw-r--r--  2.0 unx     8924 b- defN 24-May-14 23:18 nucliadb_models/extracted.py
+-rw-r--r--  2.0 unx     2191 b- defN 24-May-14 23:18 nucliadb_models/file.py
+-rw-r--r--  2.0 unx     1735 b- defN 24-May-14 23:18 nucliadb_models/keywordset.py
+-rw-r--r--  2.0 unx     3539 b- defN 24-May-14 23:18 nucliadb_models/labels.py
+-rw-r--r--  2.0 unx     3147 b- defN 24-May-14 23:18 nucliadb_models/layout.py
+-rw-r--r--  2.0 unx     2581 b- defN 24-May-14 23:18 nucliadb_models/link.py
+-rw-r--r--  2.0 unx    12517 b- defN 24-May-14 23:18 nucliadb_models/metadata.py
+-rw-r--r--  2.0 unx     4355 b- defN 24-May-14 23:18 nucliadb_models/notifications.py
+-rw-r--r--  2.0 unx      998 b- defN 24-May-14 23:18 nucliadb_models/processing.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-14 23:18 nucliadb_models/py.typed
+-rw-r--r--  2.0 unx     9610 b- defN 24-May-14 23:18 nucliadb_models/resource.py
+-rw-r--r--  2.0 unx    48720 b- defN 24-May-14 23:18 nucliadb_models/search.py
+-rw-r--r--  2.0 unx     1402 b- defN 24-May-14 23:18 nucliadb_models/security.py
+-rw-r--r--  2.0 unx     1904 b- defN 24-May-14 23:18 nucliadb_models/synonyms.py
+-rw-r--r--  2.0 unx     2832 b- defN 24-May-14 23:18 nucliadb_models/text.py
+-rw-r--r--  2.0 unx      933 b- defN 24-May-14 23:18 nucliadb_models/trainset.py
+-rw-r--r--  2.0 unx     2181 b- defN 24-May-14 23:18 nucliadb_models/utils.py
+-rw-r--r--  2.0 unx     1838 b- defN 24-May-14 23:18 nucliadb_models/vectors.py
+-rw-r--r--  2.0 unx     7766 b- defN 24-May-14 23:18 nucliadb_models/writer.py
+-rw-r--r--  2.0 unx      607 b- defN 24-May-14 23:19 nucliadb_models-3.1.0.post501.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-May-14 23:19 nucliadb_models-3.1.0.post501.dist-info/WHEEL
+-rw-r--r--  2.0 unx       16 b- defN 24-May-14 23:19 nucliadb_models-3.1.0.post501.dist-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 24-May-14 23:18 nucliadb_models-3.1.0.post501.dist-info/zip-safe
+-rw-rw-r--  2.0 unx     2639 b- defN 24-May-14 23:19 nucliadb_models-3.1.0.post501.dist-info/RECORD
+31 files, 142477 bytes uncompressed, 42873 bytes compressed:  69.9%
```

## zipnote {}

```diff
@@ -72,23 +72,23 @@
 
 Filename: nucliadb_models/vectors.py
 Comment: 
 
 Filename: nucliadb_models/writer.py
 Comment: 
 
-Filename: nucliadb_models-3.1.0.post500.dist-info/METADATA
+Filename: nucliadb_models-3.1.0.post501.dist-info/METADATA
 Comment: 
 
-Filename: nucliadb_models-3.1.0.post500.dist-info/WHEEL
+Filename: nucliadb_models-3.1.0.post501.dist-info/WHEEL
 Comment: 
 
-Filename: nucliadb_models-3.1.0.post500.dist-info/top_level.txt
+Filename: nucliadb_models-3.1.0.post501.dist-info/top_level.txt
 Comment: 
 
-Filename: nucliadb_models-3.1.0.post500.dist-info/zip-safe
+Filename: nucliadb_models-3.1.0.post501.dist-info/zip-safe
 Comment: 
 
-Filename: nucliadb_models-3.1.0.post500.dist-info/RECORD
+Filename: nucliadb_models-3.1.0.post501.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## nucliadb_models/search.py

```diff
@@ -764,14 +764,25 @@
     answer: Optional[int] = Field(
         default=None,
         title="Maximum answer tokens",
         description="Use to limit the amount of tokens used in the LLM answer",
     )
 
 
+def parse_max_tokens(
+    max_tokens: Optional[Union[int, MaxTokens]]
+) -> Optional[MaxTokens]:
+    if isinstance(max_tokens, int):
+        # If the max_tokens is an integer, it is interpreted as the max_tokens value for the generated answer.
+        # The max tokens for the context is set to None to use the default value for the model (comes in the
+        # NUA's query endpoint response).
+        return MaxTokens(answer=max_tokens, context=None)
+    return max_tokens
+
+
 class ChatModel(BaseModel):
     """
     This is the model for the predict request payload on the chat endpoint
     """
 
     question: str = Field(description="Question to ask the generative model")
     user_id: str
@@ -1246,14 +1257,15 @@
     shards: Optional[List[str]] = Field(
         default=None,
         title="Shards",
         description="The list of shard replica ids used for the search.",
     )
     autofilters: List[str] = ModelParamDefaults.applied_autofilters.to_pydantic_field()
     min_score: Optional[Union[float, MinScore]] = Field(
+        default=MinScore(),
         title="Minimum result score",
         description="The minimum scores that have been used for the search operation.",
     )
     best_matches: List[str] = Field(
         default=[],
         title="Best matches",
         description="List of ids of best matching paragraphs. The list is sorted by decreasing relevance (most relevant first).",  # noqa
@@ -1303,7 +1315,144 @@
                 raise ValueError(
                     "Nested facets are not allowed: {child} is a child of {parent}".format(
                         child=next_facet, parent=facet
                     )
                 )
         facet = next_facet
     return facets
+
+
+class AskRequest(ChatRequest): ...
+
+
+class AskTokens(BaseModel):
+    input: int = Field(
+        title="Input tokens",
+        description="Number of LLM tokens used for the context in the query",
+    )
+    output: int = Field(
+        title="Output tokens",
+        description="Number of LLM tokens used for the answer",
+    )
+
+
+class AskTimings(BaseModel):
+    generative_first_chunk: Optional[float] = Field(
+        title="Generative first chunk",
+        description="Time the LLM took to generate the first chunk of the answer",
+    )
+    generative_total: Optional[float] = Field(
+        title="Generative total",
+        description="Total time the LLM took to generate the answer",
+    )
+
+
+class SyncAskMetadata(BaseModel):
+    tokens: Optional[AskTokens] = Field(
+        default=None,
+        title="Tokens",
+        description="Number of tokens used in the LLM context and answer",
+    )
+    timings: Optional[AskTimings] = Field(
+        default=None,
+        title="Timings",
+        description="Timings of the generative model",
+    )
+
+
+class SyncAskResponse(BaseModel):
+    answer: str = Field(
+        title="Answer",
+        description="The generative answer to the query",
+    )
+    status: str = Field(
+        title="Status",
+        description="The status of the query execution. It can be 'success', 'error' or 'no_context'",  # noqa
+    )
+    retrieval_results: KnowledgeboxFindResults = Field(
+        title="Retrieval results",
+        description="The retrieval results of the query",
+    )
+    learning_id: str = Field(
+        default="",
+        title="Learning id",
+        description="The id of the learning request. This id can be used to provide feedback on the learning process.",  # noqa
+    )
+    relations: Optional[Relations] = Field(
+        default=None,
+        title="Relations",
+        description="The detected relations of the answer",
+    )
+    citations: dict[str, Any] = Field(
+        default={},
+        title="Citations",
+        description="The citations of the answer. List of references to the resources used to generate the answer.",
+    )
+    prompt_context: Optional[list[str]] = Field(
+        default=None,
+        title="Prompt context",
+        description="The prompt context used to generate the answer. Returned only if the debug flag is set to true",
+    )
+    metadata: Optional[SyncAskMetadata] = Field(
+        default=None,
+        title="Metadata",
+        description="Metadata of the query execution. This includes the number of tokens used in the LLM context and answer, and the timings of the generative model.",  # noqa
+    )
+
+
+class RetrievalAskResponseItem(BaseModel):
+    type: Literal["retrieval"] = "retrieval"
+    results: KnowledgeboxFindResults
+
+
+class AnswerAskResponseItem(BaseModel):
+    type: Literal["answer"] = "answer"
+    text: str
+
+
+class MetadataAskResponseItem(BaseModel):
+    type: Literal["metadata"] = "metadata"
+    tokens: AskTokens
+    timings: AskTimings
+
+
+class CitationsAskResponseItem(BaseModel):
+    type: Literal["citations"] = "citations"
+    citations: dict[str, Any]
+
+
+class StatusAskResponseItem(BaseModel):
+    type: Literal["status"] = "status"
+    code: str
+    status: str
+    details: Optional[str] = None
+
+
+class ErrorAskResponseItem(BaseModel):
+    type: Literal["error"] = "error"
+    error: str
+
+
+class RelationsAskResponseItem(BaseModel):
+    type: Literal["relations"] = "relations"
+    relations: Relations
+
+
+class DebugAskResponseItem(BaseModel):
+    type: Literal["debug"] = "debug"
+    metadata: dict[str, Any]
+
+
+AskResponseItemType = Union[
+    AnswerAskResponseItem,
+    MetadataAskResponseItem,
+    CitationsAskResponseItem,
+    StatusAskResponseItem,
+    ErrorAskResponseItem,
+    RetrievalAskResponseItem,
+    RelationsAskResponseItem,
+    DebugAskResponseItem,
+]
+
+
+class AskResponseItem(BaseModel):
+    item: AskResponseItemType = Field(..., discriminator="type")
```

## Comparing `nucliadb_models-3.1.0.post500.dist-info/METADATA` & `nucliadb_models-3.1.0.post501.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,17 +1,17 @@
 Metadata-Version: 2.1
 Name: nucliadb-models
-Version: 3.1.0.post500
+Version: 3.1.0.post501
 Home-page: https://nuclia.com
 License: BSD
 Classifier: Development Status :: 4 - Beta
 Classifier: Programming Language :: Python
 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
 Classifier: Programming Language :: Python :: 3 :: Only
 Classifier: Topic :: Software Development :: Libraries :: Python Modules
 Requires-Python: >=3.9, <4
 Requires-Dist: pydantic <2.0,>=1.8.2
-Requires-Dist: nucliadb-protos >=3.1.0.post500
+Requires-Dist: nucliadb-protos >=3.1.0.post501
 
 # NucliaDB models
```

## Comparing `nucliadb_models-3.1.0.post500.dist-info/RECORD` & `nucliadb_models-3.1.0.post501.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -12,20 +12,20 @@
 nucliadb_models/layout.py,sha256=3H5XP4gNlO9AphlbpEDrVc-M0i_yMhwmzIybYzhcI44,3147
 nucliadb_models/link.py,sha256=X82foCo1ikYMnugdEGPoEBng4jokO8J5kfPaBa_yyEY,2581
 nucliadb_models/metadata.py,sha256=zvJJ5ZdvPrqvzF-0dJfwIcseFZcJpZfj1X1Asxuh7PA,12517
 nucliadb_models/notifications.py,sha256=43ZdEPRG85icakpYZEHLrEo_GMi93KRyBQdwcFwVEBI,4355
 nucliadb_models/processing.py,sha256=9bSD2fYnUiDThxgzpeq3DiK0AgfDu31F7YmxE3J5Qak,998
 nucliadb_models/py.typed,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 nucliadb_models/resource.py,sha256=MqE2vNvC07rI8n755b3f1S33aBY06HyrCFgvXgXtB3k,9610
-nucliadb_models/search.py,sha256=Q2OJKG2Q0aWuVuKP7tjeWwx3F6YG7Jnh0HLlF1jqTmY,44309
+nucliadb_models/search.py,sha256=2pR6G_gR-rkM9XV17u8W9iWP4tDBRY7qzFK-n-9krOU,48720
 nucliadb_models/security.py,sha256=RewdzQ55nPZ9V7B0NX9KHeWg6B4Hg_RkeiFv2TQyrjs,1402
 nucliadb_models/synonyms.py,sha256=nvC2dmmFahhyK0cDHzDy-THQ07_LySbIPQphRDpn_7w,1904
 nucliadb_models/text.py,sha256=ZBInfxcIMVoGIssdibW0B3GYoz8oLCicaezRk5b7VfE,2832
 nucliadb_models/trainset.py,sha256=bJMnL9vvbVqicERRsrogPXYjMmqelBSAWdTEWPW_xME,933
 nucliadb_models/utils.py,sha256=5wq_gqX71h8JZap-1ugnPuQXP3AnyRWv6fC66S8JCsU,2181
 nucliadb_models/vectors.py,sha256=dWP8iKsNFw90hBG5wsNymq4SfFC72dWnBLkf3fHXoD4,1838
 nucliadb_models/writer.py,sha256=3JZDb150iJWI95jtGVi8GQ0nt4u50OJMUD_Usw1fwd4,7766
-nucliadb_models-3.1.0.post500.dist-info/METADATA,sha256=XiUU7dIMyonxelr3l_TV347ISDK1entBsnzFYHDnyaA,607
-nucliadb_models-3.1.0.post500.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-nucliadb_models-3.1.0.post500.dist-info/top_level.txt,sha256=UrY1I8oeovIRwkXLYplssTrxQdUjhSEFDFbnwaIV3tA,16
-nucliadb_models-3.1.0.post500.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-nucliadb_models-3.1.0.post500.dist-info/RECORD,,
+nucliadb_models-3.1.0.post501.dist-info/METADATA,sha256=1gg7Iu9RDhXlQzyJvxtRY76gGn-DEho6ufUh3rkwEiI,607
+nucliadb_models-3.1.0.post501.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+nucliadb_models-3.1.0.post501.dist-info/top_level.txt,sha256=UrY1I8oeovIRwkXLYplssTrxQdUjhSEFDFbnwaIV3tA,16
+nucliadb_models-3.1.0.post501.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+nucliadb_models-3.1.0.post501.dist-info/RECORD,,
```


# Comparing `tmp/mlcbase-1.2.0a1.tar.gz` & `tmp/mlcbase-1.2.0a2.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "mlcbase-1.2.0a1.tar", last modified: Mon May 13 14:17:51 2024, max compression
+gzip compressed data, was "mlcbase-1.2.0a2.tar", last modified: Wed May 15 07:28:15 2024, max compression
```

## Comparing `mlcbase-1.2.0a1.tar` & `mlcbase-1.2.0a2.tar`

### file list

```diff
@@ -1,31 +1,32 @@
-drwxrwxrwx   0        0        0        0 2024-05-13 14:17:51.089435 mlcbase-1.2.0a1/
--rw-rw-rw-   0        0        0    11558 2024-04-20 07:09:17.000000 mlcbase-1.2.0a1/LICENSE
--rw-rw-rw-   0        0        0       41 2024-04-29 12:08:22.000000 mlcbase-1.2.0a1/MANIFEST.in
--rw-rw-rw-   0        0        0    19305 2024-05-13 14:17:51.087447 mlcbase-1.2.0a1/PKG-INFO
--rw-rw-rw-   0        0        0     5184 2024-05-13 14:15:59.000000 mlcbase-1.2.0a1/README.md
--rw-rw-rw-   0        0        0     1042 2024-05-13 14:16:23.000000 mlcbase-1.2.0a1/pyproject.toml
--rw-rw-rw-   0        0        0       42 2024-05-13 14:17:51.090434 mlcbase-1.2.0a1/setup.cfg
-drwxrwxrwx   0        0        0        0 2024-05-13 14:17:50.923011 mlcbase-1.2.0a1/src/
-drwxrwxrwx   0        0        0        0 2024-05-13 14:17:51.066834 mlcbase-1.2.0a1/src/mlcbase/
--rw-rw-rw-   0        0        0     3550 2024-05-13 13:55:42.000000 mlcbase-1.2.0a1/src/mlcbase/__init__.py
--rw-rw-rw-   0        0        0     1752 2024-04-20 07:06:20.000000 mlcbase-1.2.0a1/src/mlcbase/conifg.py
--rw-rw-rw-   0        0        0    43359 2024-05-02 12:58:59.000000 mlcbase-1.2.0a1/src/mlcbase/database.py
--rw-rw-rw-   0        0        0    12331 2024-05-06 12:05:35.000000 mlcbase-1.2.0a1/src/mlcbase/email.py
--rw-rw-rw-   0        0        0     2420 2024-04-20 07:07:58.000000 mlcbase-1.2.0a1/src/mlcbase/encrypt_password.py
--rw-rw-rw-   0        0        0     7376 2024-05-04 14:09:41.000000 mlcbase-1.2.0a1/src/mlcbase/entrypt_aes.py
--rw-rw-rw-   0        0        0    22460 2024-05-04 14:15:41.000000 mlcbase-1.2.0a1/src/mlcbase/entrypt_rsa.py
--rw-rw-rw-   0        0        0    12943 2024-05-03 12:38:06.000000 mlcbase-1.2.0a1/src/mlcbase/file.py
--rw-rw-rw-   0        0        0     6854 2024-05-06 13:08:38.000000 mlcbase-1.2.0a1/src/mlcbase/image_io.py
--rw-rw-rw-   0        0        0    12081 2024-05-12 13:37:00.000000 mlcbase-1.2.0a1/src/mlcbase/loading.py
--rw-rw-rw-   0        0        0    10177 2024-05-08 11:36:12.000000 mlcbase-1.2.0a1/src/mlcbase/logger.py
--rw-rw-rw-   0        0        0     6507 2024-05-13 13:55:14.000000 mlcbase-1.2.0a1/src/mlcbase/misc.py
--rw-rw-rw-   0        0        0    13433 2024-05-05 09:46:56.000000 mlcbase-1.2.0a1/src/mlcbase/otp.py
--rw-rw-rw-   0        0        0    23510 2024-05-06 08:58:30.000000 mlcbase-1.2.0a1/src/mlcbase/remote_connect.py
--rw-rw-rw-   0        0        0     6392 2024-05-02 15:04:32.000000 mlcbase-1.2.0a1/src/mlcbase/timer.py
--rw-rw-rw-   0        0        0   179912 2024-05-13 12:03:42.000000 mlcbase-1.2.0a1/src/mlcbase/vault.py
-drwxrwxrwx   0        0        0        0 2024-05-13 14:17:51.084403 mlcbase-1.2.0a1/src/mlcbase.egg-info/
--rw-rw-rw-   0        0        0    19305 2024-05-13 14:17:50.000000 mlcbase-1.2.0a1/src/mlcbase.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      595 2024-05-13 14:17:50.000000 mlcbase-1.2.0a1/src/mlcbase.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2024-05-13 14:17:50.000000 mlcbase-1.2.0a1/src/mlcbase.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0      126 2024-05-13 14:17:50.000000 mlcbase-1.2.0a1/src/mlcbase.egg-info/requires.txt
--rw-rw-rw-   0        0        0        8 2024-05-13 14:17:50.000000 mlcbase-1.2.0a1/src/mlcbase.egg-info/top_level.txt
+drwxrwxrwx   0        0        0        0 2024-05-15 07:28:15.485004 mlcbase-1.2.0a2/
+-rw-rw-rw-   0        0        0    11558 2024-04-20 07:09:17.000000 mlcbase-1.2.0a2/LICENSE
+-rw-rw-rw-   0        0        0       41 2024-05-13 14:46:22.000000 mlcbase-1.2.0a2/MANIFEST.in
+-rw-rw-rw-   0        0        0    19168 2024-05-15 07:28:15.482906 mlcbase-1.2.0a2/PKG-INFO
+-rw-rw-rw-   0        0        0     5042 2024-05-15 07:27:18.000000 mlcbase-1.2.0a2/README.md
+-rw-rw-rw-   0        0        0     1047 2024-05-15 07:27:31.000000 mlcbase-1.2.0a2/pyproject.toml
+-rw-rw-rw-   0        0        0       42 2024-05-15 07:28:15.485004 mlcbase-1.2.0a2/setup.cfg
+drwxrwxrwx   0        0        0        0 2024-05-15 07:28:15.423405 mlcbase-1.2.0a2/src/
+drwxrwxrwx   0        0        0        0 2024-05-15 07:28:15.466844 mlcbase-1.2.0a2/src/mlcbase/
+-rw-rw-rw-   0        0        0     3709 2024-05-15 07:19:57.000000 mlcbase-1.2.0a2/src/mlcbase/__init__.py
+-rw-rw-rw-   0        0        0     1752 2024-04-20 07:06:20.000000 mlcbase-1.2.0a2/src/mlcbase/conifg.py
+-rw-rw-rw-   0        0        0    43449 2024-05-15 07:00:02.000000 mlcbase-1.2.0a2/src/mlcbase/database.py
+-rw-rw-rw-   0        0        0    12386 2024-05-15 07:00:05.000000 mlcbase-1.2.0a2/src/mlcbase/email.py
+-rw-rw-rw-   0        0        0     2504 2024-05-15 07:01:49.000000 mlcbase-1.2.0a2/src/mlcbase/encrypt_password.py
+-rw-rw-rw-   0        0        0     7514 2024-05-15 07:02:11.000000 mlcbase-1.2.0a2/src/mlcbase/entrypt_aes.py
+-rw-rw-rw-   0        0        0    22679 2024-05-15 07:02:47.000000 mlcbase-1.2.0a2/src/mlcbase/entrypt_rsa.py
+-rw-rw-rw-   0        0        0    13142 2024-05-15 07:04:34.000000 mlcbase-1.2.0a2/src/mlcbase/file.py
+-rw-rw-rw-   0        0        0     6969 2024-05-15 07:05:32.000000 mlcbase-1.2.0a2/src/mlcbase/image_io.py
+-rw-rw-rw-   0        0        0    12280 2024-05-15 07:06:21.000000 mlcbase-1.2.0a2/src/mlcbase/loading.py
+-rw-rw-rw-   0        0        0    10177 2024-05-15 07:14:59.000000 mlcbase-1.2.0a2/src/mlcbase/logger.py
+-rw-rw-rw-   0        0        0     6507 2024-05-13 14:41:07.000000 mlcbase-1.2.0a2/src/mlcbase/misc.py
+-rw-rw-rw-   0        0        0    13544 2024-05-15 07:08:16.000000 mlcbase-1.2.0a2/src/mlcbase/otp.py
+-rw-rw-rw-   0        0        0     3148 2024-05-15 07:16:32.000000 mlcbase-1.2.0a2/src/mlcbase/register.py
+-rw-rw-rw-   0        0        0    23594 2024-05-15 07:10:39.000000 mlcbase-1.2.0a2/src/mlcbase/remote_connect.py
+-rw-rw-rw-   0        0        0     6392 2024-05-15 07:14:32.000000 mlcbase-1.2.0a2/src/mlcbase/timer.py
+-rw-rw-rw-   0        0        0   179948 2024-05-15 07:09:43.000000 mlcbase-1.2.0a2/src/mlcbase/vault.py
+drwxrwxrwx   0        0        0        0 2024-05-15 07:28:15.480799 mlcbase-1.2.0a2/src/mlcbase.egg-info/
+-rw-rw-rw-   0        0        0    19168 2024-05-15 07:28:15.000000 mlcbase-1.2.0a2/src/mlcbase.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      619 2024-05-15 07:28:15.000000 mlcbase-1.2.0a2/src/mlcbase.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2024-05-15 07:28:15.000000 mlcbase-1.2.0a2/src/mlcbase.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0      126 2024-05-15 07:28:15.000000 mlcbase-1.2.0a2/src/mlcbase.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        8 2024-05-15 07:28:15.000000 mlcbase-1.2.0a2/src/mlcbase.egg-info/top_level.txt
```

### Comparing `mlcbase-1.2.0a1/LICENSE` & `mlcbase-1.2.0a2/LICENSE`

 * *Files identical despite different names*

### Comparing `mlcbase-1.2.0a1/PKG-INFO` & `mlcbase-1.2.0a2/PKG-INFO`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mlcbase
-Version: 1.2.0a1
+Version: 1.2.0a2
 Summary: The base module of all MuLingCloud modules and applications.
 Author-email: Weiming Chen <wm_chen@yeah.net>, Yuanshuang Sun <sunsun5544@126.com>
 License:                                  Apache License
                                    Version 2.0, January 2004
                                 https://www.apache.org/licenses/
         
            TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
@@ -201,15 +201,15 @@
         
            Unless required by applicable law or agreed to in writing, software
            distributed under the License is distributed on an "AS IS" BASIS,
            WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
            See the License for the specific language governing permissions and
            limitations under the License.
 Project-URL: Homepage, https://www.mulingcloud.com
-Project-URL: Repository, https://github.com/wmchen/mlcbase.git
+Project-URL: Repository, https://github.com/mulingcloud/mlcbase.git
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: POSIX :: Linux
 Classifier: Operating System :: MacOS
 Classifier: Programming Language :: Python
 Requires-Python: >=3.7
 Description-Content-Type: text/markdown
 License-File: LICENSE
@@ -249,57 +249,61 @@
 Supported platforms:
 
 - ðŸ˜„ Windows (Python 3.6+)
 - ðŸ˜„ Linux (Python 3.7+)
 - MacOS (untested, maybe. I don't have a MacOS machineðŸ˜«. Anyone can help me?)
 
 <details open>
-<summary>Features (v1.2.0a1)</summary>
+<summary>Features (v1.2.0a2)</summary>
+
+- $\color{red}{\textbf{new }}$ **Register**
+
+    We define a `Registry` to register modules, which allow you to use the module by a config file.
 
 - **Config Dictionary**
 
     We define a `ConfigDict` for more convenience usage. It is a type of dictionary inherited from `dict`. It has all the features of `dict` while including other more convenient features.
 
-- $\color{blue}{\textbf{update }}$ **Logger**
+- **Logger**
 
     We build a `Logger` for more convenience logging management. Actually, this is a slightly improvement based on [loguru](https://github.com/Delgan/loguru). Refer to [pylog](https://github.com/wmchen/pylog) for more information.
 
-- $\color{blue}{\textbf{update }}$ **Runtime Analysis**
+- **Runtime Analysis**
 
     We offer a simple way to evaluate functions in the Python project. All you need is to wrap the target function by a decorator.
 
-- $\color{blue}{\textbf{update }}$ **File Operations**
+- **File Operations**
 
     We offer various features to make file operations easier. Besides, we offer a simple way to load and save JSON, YAML, and XML files.
 
-- $\color{red}{\textbf{new }}$ **Image IO**
+- **Image IO**
 
     We offer a simple way to load and save images.
 
-- $\color{red}{\textbf{new }}$ **One-Time Password**
+- **One-Time Password**
 
     We support two methods for OTP: Time-based One-Time Password (TOTP) and HMAC-based One-Time Password (HOTP).
 
-- $\color{blue}{\textbf{update }}$ **Encryption and Decryption**
+- **Encryption and Decryption**
 
     We offer various methods to encrypt and decrypt or verify text, files and passwords including RSA, AES and Hash.
 
-- $\color{blue}{\textbf{update }}$ **Database**
+- **Database**
 
     We offer a simple way to operate the database. Supported database backend: MySQL, SQLite.
 
 - **Remote Connection**
 
     We support SSH and SFTP for remote connection.
 
-- $\color{blue}{\textbf{update }}$ **Email**
+- **Email**
 
     We offer a simple API to send email. Currently only supports SMTP (with SSL) server.
 
-- $\color{red}{\textbf{BREAKING CHANGE }}$ **HashiCorp Vault**
+- **HashiCorp Vault**
 
     We offer several APIs to operate [HashiCorp/Vault](https://developer.hashicorp.com/vault) through HTTP requests. Supported authorization methods: token, username & password. Supported secret engines: KV v1, KV v2, TOTP, Transit.
 
 </details>
 
 ## Installation
 
@@ -341,10 +345,10 @@
 
 ## License
 
 This project is released under the [Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0).
 
 ## Repository
 
-- Github Repository: https://github.com/wmchen/mlcbase
+- Github Repository: https://github.com/mulingcloud/mlcbase
 - GitLab Repository: https://gitlab.com/wm-chen/mlcbase
 - Gitee Repository: https://gitee.com/wm-chen/mlcbase
```

### Comparing `mlcbase-1.2.0a1/README.md` & `mlcbase-1.2.0a2/README.md`

 * *Files 13% similar despite different names*

```diff
@@ -19,57 +19,61 @@
 Supported platforms:
 
 - ðŸ˜„ Windows (Python 3.6+)
 - ðŸ˜„ Linux (Python 3.7+)
 - MacOS (untested, maybe. I don't have a MacOS machineðŸ˜«. Anyone can help me?)
 
 <details open>
-<summary>Features (v1.2.0a1)</summary>
+<summary>Features (v1.2.0a2)</summary>
+
+- $\color{red}{\textbf{new }}$ **Register**
+
+    We define a `Registry` to register modules, which allow you to use the module by a config file.
 
 - **Config Dictionary**
 
     We define a `ConfigDict` for more convenience usage. It is a type of dictionary inherited from `dict`. It has all the features of `dict` while including other more convenient features.
 
-- $\color{blue}{\textbf{update }}$ **Logger**
+- **Logger**
 
     We build a `Logger` for more convenience logging management. Actually, this is a slightly improvement based on [loguru](https://github.com/Delgan/loguru). Refer to [pylog](https://github.com/wmchen/pylog) for more information.
 
-- $\color{blue}{\textbf{update }}$ **Runtime Analysis**
+- **Runtime Analysis**
 
     We offer a simple way to evaluate functions in the Python project. All you need is to wrap the target function by a decorator.
 
-- $\color{blue}{\textbf{update }}$ **File Operations**
+- **File Operations**
 
     We offer various features to make file operations easier. Besides, we offer a simple way to load and save JSON, YAML, and XML files.
 
-- $\color{red}{\textbf{new }}$ **Image IO**
+- **Image IO**
 
     We offer a simple way to load and save images.
 
-- $\color{red}{\textbf{new }}$ **One-Time Password**
+- **One-Time Password**
 
     We support two methods for OTP: Time-based One-Time Password (TOTP) and HMAC-based One-Time Password (HOTP).
 
-- $\color{blue}{\textbf{update }}$ **Encryption and Decryption**
+- **Encryption and Decryption**
 
     We offer various methods to encrypt and decrypt or verify text, files and passwords including RSA, AES and Hash.
 
-- $\color{blue}{\textbf{update }}$ **Database**
+- **Database**
 
     We offer a simple way to operate the database. Supported database backend: MySQL, SQLite.
 
 - **Remote Connection**
 
     We support SSH and SFTP for remote connection.
 
-- $\color{blue}{\textbf{update }}$ **Email**
+- **Email**
 
     We offer a simple API to send email. Currently only supports SMTP (with SSL) server.
 
-- $\color{red}{\textbf{BREAKING CHANGE }}$ **HashiCorp Vault**
+- **HashiCorp Vault**
 
     We offer several APIs to operate [HashiCorp/Vault](https://developer.hashicorp.com/vault) through HTTP requests. Supported authorization methods: token, username & password. Supported secret engines: KV v1, KV v2, TOTP, Transit.
 
 </details>
 
 ## Installation
 
@@ -111,10 +115,10 @@
 
 ## License
 
 This project is released under the [Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0).
 
 ## Repository
 
-- Github Repository: https://github.com/wmchen/mlcbase
+- Github Repository: https://github.com/mulingcloud/mlcbase
 - GitLab Repository: https://gitlab.com/wm-chen/mlcbase
 - Gitee Repository: https://gitee.com/wm-chen/mlcbase
```

#### html2text {}

```diff
@@ -5,46 +5,44 @@
 mlcbase.svg)](https://www.apache.org/licenses/LICENSE-2.0) [![All Contributors]
   (https://img.shields.io/github/all-contributors/wmchen/mlcbase?color=blue)]
                                 (#contributors)
 ## Introduction Welcome to use MuLingCloud. We aim to let everything easier.
 MLCBase is an open source Python library for multiple uses. It is the base
 module of all MuLingCloud modules and applications. Supported platforms: - Ã°ÂŸÂ˜Â„
 Windows (Python 3.6+) - Ã°ÂŸÂ˜Â„ Linux (Python 3.7+) - MacOS (untested, maybe. I
-don't have a MacOS machineÃ°ÂŸÂ˜Â«. Anyone can help me?) Features (v1.2.0a1) -
-**Config Dictionary** We define a `ConfigDict` for more convenience usage. It
-is a type of dictionary inherited from `dict`. It has all the features of
-`dict` while including other more convenient features. - $\color{blue}{\textbf
-{update }}$ **Logger** We build a `Logger` for more convenience logging
-management. Actually, this is a slightly improvement based on [loguru](https://
-github.com/Delgan/loguru). Refer to [pylog](https://github.com/wmchen/pylog)
-for more information. - $\color{blue}{\textbf{update }}$ **Runtime Analysis**
-We offer a simple way to evaluate functions in the Python project. All you need
-is to wrap the target function by a decorator. - $\color{blue}{\textbf{update
-}}$ **File Operations** We offer various features to make file operations
-easier. Besides, we offer a simple way to load and save JSON, YAML, and XML
-files. - $\color{red}{\textbf{new }}$ **Image IO** We offer a simple way to
-load and save images. - $\color{red}{\textbf{new }}$ **One-Time Password** We
-support two methods for OTP: Time-based One-Time Password (TOTP) and HMAC-based
-One-Time Password (HOTP). - $\color{blue}{\textbf{update }}$ **Encryption and
-Decryption** We offer various methods to encrypt and decrypt or verify text,
-files and passwords including RSA, AES and Hash. - $\color{blue}{\textbf{update
-}}$ **Database** We offer a simple way to operate the database. Supported
-database backend: MySQL, SQLite. - **Remote Connection** We support SSH and
-SFTP for remote connection. - $\color{blue}{\textbf{update }}$ **Email** We
-offer a simple API to send email. Currently only supports SMTP (with SSL)
-server. - $\color{red}{\textbf{BREAKING CHANGE }}$ **HashiCorp Vault** We offer
-several APIs to operate [HashiCorp/Vault](https://developer.hashicorp.com/
-vault) through HTTP requests. Supported authorization methods: token, username
-& password. Supported secret engines: KV v1, KV v2, TOTP, Transit. ##
-Installation ```bash pip install mlcbase ``` ## Getting Started Please refer to
-[tutorial.ipynb](./tutorial.ipynb) for more intuitive instructions. ##
-Changelogs See all changes in [CHANGELOG](./CHANGELOG.md). ## Contributors We
-appreciate all the contributors who add new features or fix bugs, as well as
-the users who offer valuable feedback. We welcome all contributors, feel free
-to create an issue or file a pull request and join us! Ã¢ÂÂ¤Ã¯Â¸Â
+don't have a MacOS machineÃ°ÂŸÂ˜Â«. Anyone can help me?) Features (v1.2.0a2) -
+$\color{red}{\textbf{new }}$ **Register** We define a `Registry` to register
+modules, which allow you to use the module by a config file. - **Config
+Dictionary** We define a `ConfigDict` for more convenience usage. It is a type
+of dictionary inherited from `dict`. It has all the features of `dict` while
+including other more convenient features. - **Logger** We build a `Logger` for
+more convenience logging management. Actually, this is a slightly improvement
+based on [loguru](https://github.com/Delgan/loguru). Refer to [pylog](https://
+github.com/wmchen/pylog) for more information. - **Runtime Analysis** We offer
+a simple way to evaluate functions in the Python project. All you need is to
+wrap the target function by a decorator. - **File Operations** We offer various
+features to make file operations easier. Besides, we offer a simple way to load
+and save JSON, YAML, and XML files. - **Image IO** We offer a simple way to
+load and save images. - **One-Time Password** We support two methods for OTP:
+Time-based One-Time Password (TOTP) and HMAC-based One-Time Password (HOTP). -
+**Encryption and Decryption** We offer various methods to encrypt and decrypt
+or verify text, files and passwords including RSA, AES and Hash. - **Database**
+We offer a simple way to operate the database. Supported database backend:
+MySQL, SQLite. - **Remote Connection** We support SSH and SFTP for remote
+connection. - **Email** We offer a simple API to send email. Currently only
+supports SMTP (with SSL) server. - **HashiCorp Vault** We offer several APIs to
+operate [HashiCorp/Vault](https://developer.hashicorp.com/vault) through HTTP
+requests. Supported authorization methods: token, username & password.
+Supported secret engines: KV v1, KV v2, TOTP, Transit. ## Installation ```bash
+pip install mlcbase ``` ## Getting Started Please refer to [tutorial.ipynb](./
+tutorial.ipynb) for more intuitive instructions. ## Changelogs See all changes
+in [CHANGELOG](./CHANGELOG.md). ## Contributors We appreciate all the
+contributors who add new features or fix bugs, as well as the users who offer
+valuable feedback. We welcome all contributors, feel free to create an issue or
+file a pull request and join us! Ã¢ÂÂ¤Ã¯Â¸Â
      _[_W_e_i_m_i_n_g_ _C_h_e_n_]       _[_Y_u_a_n_s_h_u_a_n_g_ _S_u_n_]
       _WW_ee_ii_mm_ii_nn_gg_ _CC_hh_ee_nn         _YY_uu_aa_nn_ss_hh_uu_aa_nn_gg_ _SS_uu_nn
 _Ã°_ÂŸ_Â’_Â» _Ã°_ÂŸ_Â¤_Â” _Ã°_ÂŸ_Â“_Â† _Ã¢_Âš_Â _Ã¯_Â¸_Â _Ã¢_Âœ_Â… _Ã°_ÂŸ_Â¤_Â” _Ã¢_Âš_Â _Ã¯_Â¸_Â _Ã¢_Âœ_Â…
 ## License This project is released under the [Apache 2.0 license](https://
 www.apache.org/licenses/LICENSE-2.0). ## Repository - Github Repository: https:
-//github.com/wmchen/mlcbase - GitLab Repository: https://gitlab.com/wm-chen/
-mlcbase - Gitee Repository: https://gitee.com/wm-chen/mlcbase
+//github.com/mulingcloud/mlcbase - GitLab Repository: https://gitlab.com/wm-
+chen/mlcbase - Gitee Repository: https://gitee.com/wm-chen/mlcbase
```

### Comparing `mlcbase-1.2.0a1/pyproject.toml` & `mlcbase-1.2.0a2/pyproject.toml`

 * *Files 3% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 [build-system]
 requires = ["setuptools >= 61.0"]
 build-backend = "setuptools.build_meta"
 
 [project]
 name = "mlcbase"
-version = "1.2.0a1"
+version = "1.2.0a2"
 authors = [
     {name = "Weiming Chen", email = "wm_chen@yeah.net"},
     {name = "Yuanshuang Sun", email = "sunsun5544@126.com"}
 ]
 description = "The base module of all MuLingCloud modules and applications."
 readme = {"file" = "README.md", content-type = "text/markdown"}
 requires-python = ">=3.7"
@@ -35,8 +35,8 @@
     "Operating System :: MacOS",
     
     "Programming Language :: Python"
 ]
 
 [project.urls]
 Homepage = "https://www.mulingcloud.com"
-Repository = "https://github.com/wmchen/mlcbase.git"
+Repository = "https://github.com/mulingcloud/mlcbase.git"
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/__init__.py` & `mlcbase-1.2.0a2/src/mlcbase/__init__.py`

 * *Files 3% similar despite different names*

```diff
@@ -24,34 +24,35 @@
                           rsa_verify_signature, rsa_encrypt_file, rsa_decrypt_file)
 from .otp import generate_otp_secret, generate_otp_code, verify_otp_code
 from .vault import (VaultDuration, VaultSecretEngineKV1, VaultSecretEngineKV2, VaultSecretEngineTOTP, 
                     VaultSecretEngineTransit)
 from .database import MySQLAPI, SQLiteAPI
 from .remote_connect import SSH, SFTP
 from .email import SMTPAPI
+from .register import Registry, DATABASE, EMAIL, SECRET, FILEOPT, IMAGEIO, REMOTE
 from .misc import (is_type, is_bytes, is_str, is_int, is_float, is_bool, is_list, is_dict,
                    is_tuple, is_path, is_url, is_base64, random_hex, random_otp_secret, get_mac_address,
                    is_canonical_version, parse_version)
 
 __all__ = [
     "Version", "ConfigDict", "is_config_dict", "Logger", "wrap_module_timer", "delete_register_modules", 
     "runtime_analysis", "show_register_modules", "create", "remove", "listdir", "get_file_size", "get_dir_size", 
     "get_meta_info", "load_json", "save_json", "load_yaml", "save_yaml", "load_xml", "save_xml", 
     "get_image_from_url", "load_image", "save_image", "encrypt_password", "verify_password", "aes_encrypt_text", 
     "aes_decrypt_text", "aes_entrypt_file", "aes_decrypt_file", "create_rsa_keys", "rsa_encrypt_text", 
     "rsa_decrypt_text", "rsa_sign_text", "rsa_verify_signature", "rsa_encrypt_file", "rsa_decrypt_file", 
     "generate_otp_secret", "generate_otp_code", "verify_otp_code", "VaultDuration", "VaultSecretEngineKV1", 
     "VaultSecretEngineKV2", "VaultSecretEngineTOTP", "VaultSecretEngineTransit", "MySQLAPI", "SQLiteAPI", 
-    "SSH", "SFTP", "SMTPAPI", "is_type", "is_bytes", "is_str", "is_int", "is_float", "is_bool", "is_list", 
-    "is_dict", "is_tuple", "is_path", "is_url", "is_base64", "random_hex", "random_otp_secret", "get_mac_address",
-    "is_canonical_version", "parse_version"
+    "SSH", "SFTP", "SMTPAPI", "Registry", "DATABASE", "EMAIL", "SECRET", "FILEOPT", "IMAGEIO", "REMOTE", "is_type", 
+    "is_bytes", "is_str", "is_int", "is_float", "is_bool", "is_list", "is_dict", "is_tuple", "is_path", "is_url", 
+    "is_base64", "random_hex", "random_otp_secret", "get_mac_address", "is_canonical_version", "parse_version"
 ]
 
 
-__version__ = "1.2.0a1"
+__version__ = "1.2.0a2"
 TYPE_NAME = "module"
 NAME = "mlcbase"
 DESCRIPTION = "The base module of all MuLingCloud modules and applications."
 
 
 if not hasattr(__import__(NAME), NAME):
     from colorama import Fore
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/conifg.py` & `mlcbase-1.2.0a2/src/mlcbase/conifg.py`

 * *Files identical despite different names*

### Comparing `mlcbase-1.2.0a1/src/mlcbase/database.py` & `mlcbase-1.2.0a2/src/mlcbase/database.py`

 * *Files 0% similar despite different names*

```diff
@@ -28,19 +28,21 @@
 from typing import Optional, Union, List
 
 import pymysql
 from prettytable import PrettyTable
 
 from .logger import Logger
 from .conifg import ConfigDict
+from .register import DATABASE
 from .misc import is_int, is_float, is_str, is_list
 
 PathLikeType = Union[str, Path]
 
 
+@DATABASE.register_module()
 class MySQLAPI:
     def __init__(self, 
                  host: str, 
                  port: int,
                  user: str,
                  database: str,
                  password: str,
@@ -613,14 +615,15 @@
         if quiet:
             logger.set_quiet()
         else:
             logger.set_activate()
         return logger
 
 
+@DATABASE.register_module()
 class SQLiteAPI:
     def __init__(self,
                  db_path: Optional[str] = None,
                  in_memory: bool = False,
                  work_dir: Optional[PathLikeType] = None, 
                  logger: Optional[Logger] = None,
                  quiet: bool = False):
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/email.py` & `mlcbase-1.2.0a2/src/mlcbase/email.py`

 * *Files 1% similar despite different names*

```diff
@@ -33,19 +33,21 @@
 from email.utils import formataddr
 from email import encoders
 
 from .logger import Logger
 from .file import get_file_size
 from .conifg import ConfigDict
 from .remote_connect import SFTP
+from .register import EMAIL
 from .misc import is_str, is_dict, FileTooLargeError, FileUploadError
 
 PathLikeType = Union[str, Path]
 
 
+@EMAIL.register_module()
 class SMTPAPI:
     def __init__(self, 
                  host: str,
                  port: int,
                  name: str,
                  address: str,
                  password: str,
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/encrypt_password.py` & `mlcbase-1.2.0a2/src/mlcbase/encrypt_password.py`

 * *Files 5% similar despite different names*

```diff
@@ -17,24 +17,26 @@
 
 Author: Weiming Chen
 Tester: Weiming Chen
 """
 import hashlib
 from typing import List, Union
 
+from .register import SECRET
 from .misc import is_str, is_list
 
 support_methods = {'MD5': hashlib.md5,
                    'SHA-1': hashlib.sha1,
                    'SHA-224': hashlib.sha224,
                    'SHA-256': hashlib.sha256,
                    'SHA-384': hashlib.sha384,
                    'SHA-512': hashlib.sha512}
 
 
+@SECRET.register_module()
 def encrypt_password(password: str, 
                      methods: Union[str, List[str]], 
                      encoding: str = "utf-8"):
     """encrypt password following the order of __encrypt_method
 
     Args:
         password (str)
@@ -53,14 +55,15 @@
     cipher = password
     for method in methods:
         cipher = support_methods[method](cipher.encode(encoding)).hexdigest()
 
     return cipher
 
 
+@SECRET.register_module()
 def verify_password(password: str, 
                     cipher: str, 
                     methods: Union[str, List[str]], 
                     encoding: str = "utf-8"):
     """verify if the password match with the cipher
 
     Args:
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/entrypt_aes.py` & `mlcbase-1.2.0a2/src/mlcbase/entrypt_aes.py`

 * *Files 7% similar despite different names*

```diff
@@ -19,14 +19,15 @@
 Tester: Weiming Chen, Yuanshaung Sun
 """
 from pathlib import Path
 from typing import Union, Optional
 from Crypto.Cipher import AES
 
 from .logger import Logger
+from .register import SECRET
 from .misc import is_str, is_bytes
 
 PathLikeType = Union[str, Path]
 
 
 def __completion(conent: Union[str, bytes], encoding: str = "utf-8"):
     assert is_str(conent) or is_bytes(conent), 'conent must be str or bytes'
@@ -36,14 +37,15 @@
     
     while len(conent) % 16 != 0:
         conent += b'\x00'
     
     return conent
 
 
+@SECRET.register_module()
 def aes_encrypt_text(plain_text: str,
                      key: Union[str, bytes],
                      iv: Optional[Union[str, bytes]] = None,
                      mode: int = AES.MODE_CBC,
                      encoding: str = "utf-8"):
     """encrypt plain text with aes
 
@@ -75,14 +77,15 @@
 
     if mode == AES.MODE_ECB:
         cipher_text = AES.new(key, mode).encrypt(plain_text)
 
     return cipher_text
 
 
+@SECRET.register_module()
 def aes_decrypt_text(cipher_text: bytes,
                      key: Union[str, bytes],
                      iv: Optional[Union[str, bytes]] = None,
                      mode: int = AES.MODE_CBC,
                      return_str: bool = True,
                      encoding: str = "utf-8"):
     """decrypt cipher text with aes
@@ -119,14 +122,15 @@
     plain_text = plain_text.strip(b'\x00')
     if return_str:
         plain_text = plain_text.decode(encoding)
 
     return plain_text
 
 
+@SECRET.register_module()
 def aes_entrypt_file(plain_file_path: PathLikeType,
                      crypto_save_path: PathLikeType,
                      key: Union[str, bytes],
                      iv: Optional[Union[str, bytes]] = None,
                      mode: int = AES.MODE_CBC,
                      encoding: str = "utf-8",
                      logger: Optional[Logger] = None):
@@ -155,14 +159,15 @@
         return True
     except OSError as e:
         if logger is not None:
             logger.error(f'aes encrypt file error: {str(e)}')
         return False
 
 
+@SECRET.register_module()
 def aes_decrypt_file(crypto_file_path: PathLikeType, 
                      plain_save_path: PathLikeType,
                      key: Union[str, bytes],
                      iv: Optional[Union[str, bytes]] = None,
                      mode: int = AES.MODE_CBC,
                      encoding: str = "utf-8",
                      logger: Optional[Logger] = None):
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/entrypt_rsa.py` & `mlcbase-1.2.0a2/src/mlcbase/entrypt_rsa.py`

 * *Files 4% similar despite different names*

```diff
@@ -23,14 +23,15 @@
 from threading import Thread
 from typing import Optional, Union, List
 
 import rsa
 
 from .logger import Logger
 from .file import get_file_size
+from .register import SECRET
 from .misc import is_list, is_bytes, is_str, is_path, is_int
 
 PathLikeType = Union[str, Path]
 
 
 class _EncryptTextThread(Thread):
     def __init__(self, plain_text, public_key, key_length):
@@ -106,14 +107,15 @@
                     plain_text = rsa.decrypt(self.cipher_text, self.private_key).decode(self.encoding)
                 else:
                     plain_text = rsa.decrypt(self.cipher_text, self.private_key)
         
         self.plain_text = plain_text
 
 
+@SECRET.register_module()
 def create_rsa_keys(public_path: Optional[PathLikeType] = None, 
                     private_path: Optional[PathLikeType] = None, 
                     key_length: int = 2048,
                     return_keys: bool = False):
     """create a pair of rsa keys
 
     Args:
@@ -145,14 +147,15 @@
     
     if return_keys:
         return (public_key, private_key)
     else:
         return None
 
 
+@SECRET.register_module()
 def rsa_encrypt_text(plain_text: Union[str, bytes], 
                      public_key: Union[bytes, PathLikeType], 
                      key_length: int = 2048,
                      num_threads: int = 1,
                      encoding: str = "utf-8"):
     """encrypt plain text with rsa public key
 
@@ -214,14 +217,15 @@
                 else:
                     cipher_text.append(rsa.encrypt(plain_text[offset:], key))
                 offset += default_length
     
     return cipher_text
 
 
+@SECRET.register_module()
 def rsa_decrypt_text(cipher_text: Union[List[bytes], bytes],
                      private_key: Union[bytes, PathLikeType],
                      key_length: int = 2048,
                      num_threads: int = 1,
                      return_str: bool = True,
                      encoding: str = "utf-8",):
     """decrypt cipher text with rsa private key
@@ -311,14 +315,15 @@
                     plain_text = rsa.decrypt(cipher_text, key).decode(encoding)
                 else:
                     plain_text = rsa.decrypt(cipher_text, key)
         
     return plain_text
 
 
+@SECRET.register_module()
 def rsa_sign_text(plain_text: str,
                   private_key: Union[bytes, PathLikeType],
                   hash_method: str = "SHA-512",
                   encoding: str = "utf-8"):
     """sign plain text with rsa private key
 
     Args:
@@ -342,14 +347,15 @@
         key = rsa.PrivateKey.load_pkcs1(private_key)
     
     signed_cipher_text = rsa.sign(plain_text.encode(encoding), key, hash_method)
 
     return signed_cipher_text
 
 
+@SECRET.register_module()
 def rsa_verify_signature(plain_text: str,
                          signature: bytes,
                          public_key: Union[bytes, PathLikeType],
                          encoding: str = "utf-8"):
     """verify signature with rsa public key
 
     Args:
@@ -373,14 +379,15 @@
     try:
         rsa.verify(plain_text.encode(encoding), signature, key)
         return True
     except:
         return False
 
 
+@SECRET.register_module()
 def rsa_encrypt_file(plain_file_path: PathLikeType, 
                      crypto_save_path: PathLikeType, 
                      public_key: Union[bytes, PathLikeType], 
                      key_length: int = 2048,
                      num_process: int = 1,
                      num_threads: int = 1,
                      encoding: str = "utf-8",
@@ -461,14 +468,15 @@
         return True
     except OSError as e:
         if logger is not None:
             logger.error(f'rsa encrypt file error: {str(e)}')
         return False
 
 
+@SECRET.register_module()
 def rsa_decrypt_file(crypto_file_path: PathLikeType,
                      plain_save_path: PathLikeType,
                      private_key: Union[bytes, PathLikeType],
                      key_length: int = 2048,
                      num_process: int = 1,
                      num_threads: int = 1,
                      encoding: str = "utf-8",
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/file.py` & `mlcbase-1.2.0a2/src/mlcbase/file.py`

 * *Files 3% similar despite different names*

```diff
@@ -22,21 +22,23 @@
 import shutil
 from pathlib import Path
 from datetime import datetime
 from typing import Optional, Union
 
 from .conifg import ConfigDict
 from .logger import Logger
+from .register import FILEOPT
 from .misc import is_str, is_int
 
 PathLikeType = Union[str, Path]
 
 __all__ = ["create", "remove", "listdir", "get_file_size", "get_dir_size", "get_meta_info"]
 
 
+@FILEOPT.register_module()
 def create(path: PathLikeType,
            ftype: str = "auto",
            src: Optional[PathLikeType] = None,
            exist_ok: bool = True,
            overwrite: bool = False,
            logger: Optional[Logger] = None,
            **kwargs):
@@ -132,14 +134,15 @@
             return True
         except OSError as e:
             if logger is not None:
                 logger.error(f'create symbolic link error: {str(e)}')
             return False
         
 
+@FILEOPT.register_module()
 def remove(path: PathLikeType, logger: Optional[Logger] = None):
     path = str(path)
     assert os.path.lexists(path), f'{path} is not exist'
     
     try:
         is_remove = False
 
@@ -161,14 +164,15 @@
         return is_remove
     except OSError as e:
         if logger is not None:
             logger.error(f'remove error: {str(e)}')
         return False
 
 
+@FILEOPT.register_module()
 def listdir(path: PathLikeType, 
             sort_func: Optional[callable] = None,
             reverse: bool = False,
             return_path: bool = True,
             logger: Optional[Logger] = None):
     """list directory
 
@@ -192,14 +196,15 @@
             return [str(p.name) for p in generator]
     except OSError as e:
         if logger is not None:
             logger.error(f'list directory error: {str(e)}')
         return None
 
 
+@FILEOPT.register_module()
 def get_file_size(path: PathLikeType, 
                   return_unit: Optional[str] = None,
                   auto_unit: bool = True,
                   truncate_place: Optional[int] = 2):
     """get the size of file
 
     Args:
@@ -253,14 +258,15 @@
             return (truncated_size, unit)
         else:
             return (precise_size, unit)
     
     return (size, 'B')
 
 
+@FILEOPT.register_module()
 def get_dir_size(path: PathLikeType,
                  return_unit: Optional[str] = None,
                  auto_unit: bool = True,
                  truncate_place: Optional[int] = 2):
     """get the size of directory
 
     Args:
@@ -320,14 +326,15 @@
             return (truncated_size, unit)
         else:
             return (precise_size, unit)
     
     return (total_size, 'B')
     
 
+@FILEOPT.register_module()
 def get_meta_info(path: PathLikeType):
     """get the meta information of file or directory
 
     Args:
         path (PathLikeType)
 
     Meta information includes: path, directory, filename, suffix, size, create time,
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/image_io.py` & `mlcbase-1.2.0a2/src/mlcbase/image_io.py`

 * *Files 2% similar despite different names*

```diff
@@ -26,19 +26,21 @@
 import numpy as np
 import cv2
 import matplotlib.pyplot as plt
 from PIL import Image
 
 from .logger import Logger
 from .conifg import ConfigDict
+from .register import IMAGEIO
 from .misc import is_url, is_base64
 
 PathLikeType = Union[str, Path]
 
 
+@IMAGEIO.register_module()
 def get_image_from_url(url: str, 
                        save_path: Optional[PathLikeType] = None,
                        return_base64: bool = False,
                        return_image: bool = False,
                        backend: str = "cv2",
                        logger: Optional[Logger] = None):
     """get image from url
@@ -102,14 +104,15 @@
         return image_dict
     else:
         if logger is not None:
             logger.error(f"Failed to get image from url: {url}")
         raise ValueError(f"Failed to get image from url: {url}")
 
 
+@IMAGEIO.register_module()
 def load_image(path: PathLikeType, 
                backend: str = "cv2", 
                logger: Optional[Logger] = None,
                **kwargs):
     """load an image
 
     Args:
@@ -152,14 +155,15 @@
             img = get_image_from_url(path, return_bs64=True, logger=logger).base64
         else:
             img = get_image_from_url(path, return_image=True, backend=backend, logger=logger).image
 
     return img
 
 
+@IMAGEIO.register_module()
 def save_image(img: Any, 
                path: PathLikeType, 
                backend: str = "cv2", 
                logger: Optional[Logger] = None,
                **kwargs):
     """save an image to local device
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/loading.py` & `mlcbase-1.2.0a2/src/mlcbase/loading.py`

 * *Files 3% similar despite different names*

```diff
@@ -26,19 +26,21 @@
 import xml.etree.ElementTree as ET
 import xml.dom.minidom as minidom
 
 import yaml
 
 from .logger import Logger
 from .conifg import ConfigDict
+from .register import FILEOPT
 from .misc import is_dict, is_list, is_int
 
 PathLikeType = Union[str, Path]
 
 
+@FILEOPT.register_module()
 def load_json(path: PathLikeType, logger: Optional[Logger] = None):
     """load json file to a dict
 
     Args:
         path (PathLikeType)
         logger (Optional[Logger], optional): Defaults to None.
 
@@ -57,14 +59,15 @@
             return ConfigDict(data)
     except OSError as e:
         if logger is not None:
             logger.error(f'json load error: {str(e)}')
         return None
     
 
+@FILEOPT.register_module()
 def save_json(data: Union[list, dict],
               path: PathLikeType,
               ensure_ascii: bool = True,
               indent: Optional[int] = 4,
               logger: Optional[Logger] = None,):
     """save data to a json file
 
@@ -90,14 +93,15 @@
         return True
     except OSError as e:
         if logger is not None:
             logger.error(f'json save error: {str(e)}')
         return False
     
 
+@FILEOPT.register_module()
 def load_yaml(path: PathLikeType, logger: Optional[Logger] = None):
     """load yaml file to a dict
 
     Args:
         path (PathLikeType)
         logger (Optional[Logger], optional): Defaults to None.
 
@@ -116,14 +120,15 @@
             return ConfigDict(data)
     except OSError as e:
         if logger is not None:
             logger.error(f'yaml load error: {str(e)}')
         return None
     
 
+@FILEOPT.register_module()
 def save_yaml(data: Union[dict, list], 
               path: PathLikeType, 
               allow_unicode: bool = False,
               logger: Optional[Logger] = None):
     """save data to a yaml file
 
     Args:
@@ -145,14 +150,15 @@
         return True
     except OSError as e:
         if logger is not None:
             logger.error(f'yaml save error: {str(e)}')
         return False
 
 
+@FILEOPT.register_module()
 def load_xml(path: PathLikeType, logger: Optional[Logger] = None):
     """load xml file to a dict
 
     Args:
         path (PathLikeType)
         logger (Optional[Logger], optional): Defaults to None.
 
@@ -224,14 +230,15 @@
         return ConfigDict(xml_data)
     except OSError as e:
         if logger is not None:
             logger.error(f'xml load error: {str(e)}')
         return None
     
 
+@FILEOPT.register_module()
 def save_xml(data: dict, 
              path: PathLikeType, 
              encoding: str = 'utf-8',
              pretty: bool = True,
              indent: str = '\t',
              logger: Optional[Logger] = None,):
     """save data to a xml file
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/logger.py` & `mlcbase-1.2.0a2/src/mlcbase/logger.py`

 * *Files identical despite different names*

### Comparing `mlcbase-1.2.0a1/src/mlcbase/misc.py` & `mlcbase-1.2.0a2/src/mlcbase/misc.py`

 * *Files identical despite different names*

### Comparing `mlcbase-1.2.0a1/src/mlcbase/otp.py` & `mlcbase-1.2.0a2/src/mlcbase/otp.py`

 * *Files 2% similar despite different names*

```diff
@@ -32,23 +32,25 @@
 from PIL import Image
 from qrcode.main import QRCode
 from qrcode.constants import ERROR_CORRECT_L, ERROR_CORRECT_M, ERROR_CORRECT_Q, ERROR_CORRECT_H
 
 from .image_io import load_image
 from .conifg import ConfigDict
 from .logger import Logger
+from .register import SECRET
 from .misc import random_otp_secret, is_int, is_url
 
 _OTP_HMAC = {'SHA1': hashlib.sha1,
               'SHA256': hashlib.sha256,
               'SHA512': hashlib.sha512}
 
 PathLikeType = Union[str, Path]
 
 
+@SECRET.register_module()
 def generate_otp_secret(account_name: str, 
                         method: str = "TOTP",
                         issuer: str = "MuLingCloud",
                         algorithm: str = "SHA1",
                         period: int = 30,
                         initial_count: int = 0,
                         digits: int = 6,
@@ -182,14 +184,15 @@
             byte_data = buffer.getvalue()
             qr_base64 = base64.b64encode(byte_data)
             result.qr_code = qr_base64
         
     return result
 
 
+@SECRET.register_module()
 def generate_otp_code(secret_key: str, 
                       count: Optional[int] = None,
                       method: str = "TOTP",
                       algorithm: str = "SHA1",
                       period: int = 30,
                       initial_count: int = 0,
                       digits: int = 6,
@@ -230,14 +233,15 @@
                          digits=digits,
                          digest=_OTP_HMAC[algorithm],
                          initial_count=initial_count)
         code = otp.at(count)
     return code
 
 
+@SECRET.register_module()
 def verify_otp_code(code: str,
                     secret_key: str,
                     count: Optional[int] = None,
                     method: str = "TOTP",
                     algorithm: str = "SHA1",
                     period: int = 30,
                     initial_count: int = 0,
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/remote_connect.py` & `mlcbase-1.2.0a2/src/mlcbase/remote_connect.py`

 * *Files 2% similar despite different names*

```diff
@@ -29,19 +29,21 @@
 from datetime import datetime
 from typing import Optional, Union, Callable
 
 import paramiko
 
 from .logger import Logger
 from .file import listdir, create
+from .register import REMOTE
 from .misc import PlatformNotSupportError
 
 PathLikeType = Union[str, Path]
 
 
+@REMOTE.register_module()
 class SSH:
     def __init__(self,
                  host: str, 
                  port: int,
                  user: str,
                  password: str,
                  timeout: int = 30,
@@ -120,14 +122,15 @@
         if quiet:
             logger.set_quiet()
         else:
             logger.set_activate()
         return logger
 
 
+@REMOTE.register_module()
 class SFTP:
     def __init__(self,
                  host: str, 
                  port: int,
                  user: str,
                  password: str,
                  timeout: int = 30,
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase/timer.py` & `mlcbase-1.2.0a2/src/mlcbase/timer.py`

 * *Files identical despite different names*

### Comparing `mlcbase-1.2.0a1/src/mlcbase/vault.py` & `mlcbase-1.2.0a2/src/mlcbase/vault.py`

 * *Files 0% similar despite different names*

```diff
@@ -66,11180 +66,11182 @@
 00000410: 6572 2069 6d70 6f72 7420 4c6f 6767 6572  er import Logger
 00000420: 0d0a 6672 6f6d 202e 636f 6e69 6667 2069  ..from .conifg i
 00000430: 6d70 6f72 7420 436f 6e66 6967 4469 6374  mport ConfigDict
 00000440: 0d0a 6672 6f6d 202e 656e 7472 7970 745f  ..from .entrypt_
 00000450: 6165 7320 696d 706f 7274 2061 6573 5f65  aes import aes_e
 00000460: 6e63 7279 7074 5f74 6578 742c 2061 6573  ncrypt_text, aes
 00000470: 5f64 6563 7279 7074 5f74 6578 740d 0a66  _decrypt_text..f
-00000480: 726f 6d20 2e6d 6973 6320 696d 706f 7274  rom .misc import
-00000490: 2072 616e 646f 6d5f 6865 782c 2069 735f   random_hex, is_
-000004a0: 6469 6374 2c20 6973 5f73 7472 2c20 6973  dict, is_str, is
-000004b0: 5f6c 6973 742c 2069 735f 696e 742c 2069  _list, is_int, i
-000004c0: 735f 6261 7365 3634 0d0a 0d0a 5061 7468  s_base64....Path
-000004d0: 4c69 6b65 5479 7065 203d 2055 6e69 6f6e  LikeType = Union
-000004e0: 5b73 7472 2c20 5061 7468 5d0d 0a0d 0a0d  [str, Path].....
-000004f0: 0a63 6c61 7373 2056 6175 6c74 4475 7261  .class VaultDura
-00000500: 7469 6f6e 3a0d 0a20 2020 2022 2222 5468  tion:..    """Th
-00000510: 6973 2063 6c61 7373 2069 7320 7573 6564  is class is used
-00000520: 2074 6f20 7061 7273 6520 5661 756c 7420   to parse Vault 
-00000530: 6475 7261 7469 6f6e 2073 7472 696e 6720  duration string 
-00000540: 666f 726d 6174 0d0a 0d0a 2020 2020 5265  format....    Re
-00000550: 6665 7220 746f 2068 7474 7073 3a2f 2f64  fer to https://d
-00000560: 6576 656c 6f70 6572 2e68 6173 6869 636f  eveloper.hashico
-00000570: 7270 2e63 6f6d 2f76 6175 6c74 2f64 6f63  rp.com/vault/doc
-00000580: 732f 636f 6e63 6570 7473 2f64 7572 6174  s/concepts/durat
-00000590: 696f 6e2d 666f 726d 6174 2066 6f72 206d  ion-format for m
-000005a0: 6f72 6520 6465 7461 696c 732e 0d0a 2020  ore details...  
-000005b0: 2020 2222 220d 0a20 2020 2064 7572 6174    """..    durat
-000005c0: 696f 6e5f 7061 7474 6572 6e20 3d20 7222  ion_pattern = r"
-000005d0: 5e28 3f50 3c69 6e74 6567 6572 3e5c 642b  ^(?P<integer>\d+
-000005e0: 2928 5c2e 293f 283f 503c 6672 6163 7469  )(\.)?(?P<fracti
-000005f0: 6f6e 3e5c 642b 293f 283f 503c 756e 6974  on>\d+)?(?P<unit
-00000600: 3e5b 612d 7a5d 2b29 3f24 220d 0a20 2020  >[a-z]+)?$"..   
-00000610: 2073 7570 706f 7274 5f75 6e69 7473 203d   support_units =
-00000620: 205b 226e 7322 2c20 2275 7322 2c20 226d   ["ns", "us", "m
-00000630: 7322 2c20 2273 222c 2022 6d22 2c20 2268  s", "s", "m", "h
-00000640: 222c 2022 6422 5d0d 0a0d 0a20 2020 2064  ", "d"]....    d
-00000650: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00000660: 2c20 6475 7261 7469 6f6e 3a20 7374 7229  , duration: str)
-00000670: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-00000680: 5f5f 7061 7474 6572 6e20 3d20 7265 2e63  __pattern = re.c
-00000690: 6f6d 7069 6c65 2873 656c 662e 6475 7261  ompile(self.dura
-000006a0: 7469 6f6e 5f70 6174 7465 726e 290d 0a20  tion_pattern).. 
-000006b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000006c0: 2069 6620 6e6f 7420 7365 6c66 2e5f 5f70   if not self.__p
-000006d0: 6174 7465 726e 2e6d 6174 6368 2864 7572  attern.match(dur
-000006e0: 6174 696f 6e29 3a0d 0a20 2020 2020 2020  ation):..       
-000006f0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00000700: 4572 726f 7228 6622 496e 7661 6c69 6420  Error(f"Invalid 
-00000710: 5661 756c 7420 6475 7261 7469 6f6e 2066  Vault duration f
-00000720: 6f72 6d61 743a 207b 6475 7261 7469 6f6e  ormat: {duration
-00000730: 7d22 290d 0a20 2020 2020 2020 200d 0a20  }")..        .. 
-00000740: 2020 2020 2020 2073 656c 662e 5f5f 6d61         self.__ma
-00000750: 7463 6820 3d20 7365 6c66 2e5f 5f70 6174  tch = self.__pat
-00000760: 7465 726e 2e6d 6174 6368 2864 7572 6174  tern.match(durat
-00000770: 696f 6e29 0d0a 0d0a 2020 2020 2020 2020  ion)....        
-00000780: 6966 2073 656c 662e 756e 6974 206e 6f74  if self.unit not
-00000790: 2069 6e20 7365 6c66 2e73 7570 706f 7274   in self.support
-000007a0: 5f75 6e69 7473 3a0d 0a20 2020 2020 2020  _units:..       
-000007b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000007c0: 4572 726f 7228 6622 496e 7661 6c69 6420  Error(f"Invalid 
-000007d0: 5661 756c 7420 6475 7261 7469 6f6e 2075  Vault duration u
-000007e0: 6e69 743a 207b 7365 6c66 2e75 6e69 747d  nit: {self.unit}
-000007f0: 2229 0d0a 2020 2020 2020 2020 0d0a 2020  ")..        ..  
-00000800: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-00000810: 2064 6566 2069 6e74 6567 6572 2873 656c   def integer(sel
-00000820: 6629 202d 3e20 696e 743a 0d0a 2020 2020  f) -> int:..    
-00000830: 2020 2020 7265 7475 726e 2069 6e74 2873      return int(s
-00000840: 656c 662e 5f5f 6d61 7463 682e 6772 6f75  elf.__match.grou
-00000850: 7028 2269 6e74 6567 6572 2229 290d 0a20  p("integer")).. 
-00000860: 2020 200d 0a20 2020 2040 7072 6f70 6572     ..    @proper
-00000870: 7479 0d0a 2020 2020 6465 6620 6672 6163  ty..    def frac
-00000880: 7469 6f6e 2873 656c 6629 202d 3e20 666c  tion(self) -> fl
-00000890: 6f61 743a 0d0a 2020 2020 2020 2020 6672  oat:..        fr
-000008a0: 6163 7469 6f6e 203d 2073 656c 662e 5f5f  action = self.__
-000008b0: 6d61 7463 682e 6772 6f75 7028 2266 7261  match.group("fra
-000008c0: 6374 696f 6e22 290d 0a20 2020 2020 2020  ction")..       
-000008d0: 2069 6620 6672 6163 7469 6f6e 2069 7320   if fraction is 
-000008e0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-000008f0: 2020 2020 2020 2066 7261 6374 696f 6e20         fraction 
-00000900: 3d20 666c 6f61 7428 6622 302e 7b66 7261  = float(f"0.{fra
-00000910: 6374 696f 6e7d 2229 0d0a 2020 2020 2020  ction}")..      
-00000920: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00000930: 2020 2020 2066 7261 6374 696f 6e20 3d20       fraction = 
-00000940: 302e 300d 0a20 2020 2020 2020 2072 6574  0.0..        ret
-00000950: 7572 6e20 6672 6163 7469 6f6e 0d0a 2020  urn fraction..  
-00000960: 2020 0d0a 2020 2020 4070 726f 7065 7274    ..    @propert
-00000970: 790d 0a20 2020 2064 6566 2076 616c 7565  y..    def value
-00000980: 2873 656c 6629 202d 3e20 666c 6f61 743a  (self) -> float:
-00000990: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000009a0: 2073 656c 662e 696e 7465 6765 7220 2b20   self.integer + 
-000009b0: 7365 6c66 2e66 7261 6374 696f 6e0d 0a20  self.fraction.. 
-000009c0: 2020 200d 0a20 2020 2040 7072 6f70 6572     ..    @proper
-000009d0: 7479 0d0a 2020 2020 6465 6620 756e 6974  ty..    def unit
-000009e0: 2873 656c 6629 202d 3e20 7374 723a 0d0a  (self) -> str:..
-000009f0: 2020 2020 2020 2020 756e 6974 203d 2073          unit = s
-00000a00: 656c 662e 5f5f 6d61 7463 682e 6772 6f75  elf.__match.grou
-00000a10: 7028 2275 6e69 7422 290d 0a20 2020 2020  p("unit")..     
-00000a20: 2020 2069 6620 756e 6974 2069 7320 4e6f     if unit is No
-00000a30: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00000a40: 2075 6e69 7420 3d20 2273 220d 0a20 2020   unit = "s"..   
-00000a50: 2020 2020 2072 6574 7572 6e20 756e 6974       return unit
-00000a60: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
-00000a70: 746f 5f73 6563 6f6e 6473 2873 656c 6629  to_seconds(self)
-00000a80: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
-00000a90: 6c66 2e75 6e69 7420 3d3d 2022 6e73 223a  lf.unit == "ns":
-00000aa0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00000ab0: 7475 726e 2073 656c 662e 7661 6c75 6520  turn self.value 
-00000ac0: 2f20 3165 390d 0a0d 0a20 2020 2020 2020  / 1e9....       
-00000ad0: 2069 6620 7365 6c66 2e75 6e69 7420 3d3d   if self.unit ==
-00000ae0: 2022 7573 223a 0d0a 2020 2020 2020 2020   "us":..        
-00000af0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00000b00: 7661 6c75 6520 2f20 3165 360d 0a0d 0a20  value / 1e6.... 
-00000b10: 2020 2020 2020 2069 6620 7365 6c66 2e75         if self.u
-00000b20: 6e69 7420 3d3d 2022 6d73 223a 0d0a 2020  nit == "ms":..  
-00000b30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00000b40: 2073 656c 662e 7661 6c75 6520 2f20 3165   self.value / 1e
-00000b50: 330d 0a0d 0a20 2020 2020 2020 2069 6620  3....        if 
-00000b60: 7365 6c66 2e75 6e69 7420 3d3d 2022 7322  self.unit == "s"
-00000b70: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00000b80: 6574 7572 6e20 7365 6c66 2e76 616c 7565  eturn self.value
-00000b90: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
-00000ba0: 656c 662e 756e 6974 203d 3d20 226d 223a  elf.unit == "m":
-00000bb0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00000bc0: 7475 726e 2073 656c 662e 7661 6c75 6520  turn self.value 
-00000bd0: 2a20 3630 0d0a 2020 2020 2020 2020 0d0a  * 60..        ..
-00000be0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00000bf0: 756e 6974 203d 3d20 2268 223a 0d0a 2020  unit == "h":..  
-00000c00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00000c10: 2073 656c 662e 7661 6c75 6520 2a20 3630   self.value * 60
-00000c20: 202a 2036 300d 0a20 2020 2020 2020 200d   * 60..        .
-00000c30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00000c40: 2e75 6e69 7420 3d3d 2022 6422 3a0d 0a20  .unit == "d":.. 
-00000c50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00000c60: 6e20 7365 6c66 2e76 616c 7565 202a 2036  n self.value * 6
-00000c70: 3020 2a20 3630 202a 2032 340d 0a20 2020  0 * 60 * 24..   
-00000c80: 2020 2020 200d 0a20 2020 2064 6566 205f       ..    def _
-00000c90: 5f65 715f 5f28 7365 6c66 2c20 6f74 6865  _eq__(self, othe
-00000ca0: 723a 2022 5661 756c 7444 7572 6174 696f  r: "VaultDuratio
-00000cb0: 6e22 2920 2d3e 2062 6f6f 6c3a 0d0a 2020  n") -> bool:..  
-00000cc0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00000cd0: 6e73 7461 6e63 6528 6f74 6865 722c 2056  nstance(other, V
-00000ce0: 6175 6c74 4475 7261 7469 6f6e 293a 0d0a  aultDuration):..
-00000cf0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00000d00: 6520 5479 7065 4572 726f 7228 6622 556e  e TypeError(f"Un
-00000d10: 7375 7070 6f72 7465 6420 6f70 6572 616e  supported operan
-00000d20: 6420 7479 7065 2873 2920 666f 7220 3d3d  d type(s) for ==
-00000d30: 3a20 277b 7479 7065 2873 656c 6629 2e5f  : '{type(self)._
-00000d40: 5f6e 616d 655f 5f7d 2720 616e 6420 277b  _name__}' and '{
-00000d50: 7479 7065 286f 7468 6572 292e 5f5f 6e61  type(other).__na
-00000d60: 6d65 5f5f 7d27 2229 0d0a 2020 2020 2020  me__}'")..      
-00000d70: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
-00000d80: 726e 2073 656c 662e 746f 5f73 6563 6f6e  rn self.to_secon
-00000d90: 6473 2829 203d 3d20 6f74 6865 722e 746f  ds() == other.to
-00000da0: 5f73 6563 6f6e 6473 2829 0d0a 2020 2020  _seconds()..    
-00000db0: 0d0a 2020 2020 6465 6620 5f5f 6e65 5f5f  ..    def __ne__
-00000dc0: 2873 656c 662c 206f 7468 6572 3a20 2256  (self, other: "V
-00000dd0: 6175 6c74 4475 7261 7469 6f6e 2229 202d  aultDuration") -
-00000de0: 3e20 626f 6f6c 3a0d 0a20 2020 2020 2020  > bool:..       
-00000df0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00000e00: 6365 286f 7468 6572 2c20 5661 756c 7444  ce(other, VaultD
-00000e10: 7572 6174 696f 6e29 3a0d 0a20 2020 2020  uration):..     
-00000e20: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00000e30: 6545 7272 6f72 2866 2255 6e73 7570 706f  eError(f"Unsuppo
-00000e40: 7274 6564 206f 7065 7261 6e64 2074 7970  rted operand typ
-00000e50: 6528 7329 2066 6f72 2021 3d3a 2027 7b74  e(s) for !=: '{t
-00000e60: 7970 6528 7365 6c66 292e 5f5f 6e61 6d65  ype(self).__name
-00000e70: 5f5f 7d27 2061 6e64 2027 7b74 7970 6528  __}' and '{type(
-00000e80: 6f74 6865 7229 2e5f 5f6e 616d 655f 5f7d  other).__name__}
-00000e90: 2722 290d 0a20 2020 2020 2020 200d 0a20  '")..        .. 
-00000ea0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00000eb0: 6c66 2e74 6f5f 7365 636f 6e64 7328 2920  lf.to_seconds() 
-00000ec0: 213d 206f 7468 6572 2e74 6f5f 7365 636f  != other.to_seco
-00000ed0: 6e64 7328 290d 0a20 2020 200d 0a20 2020  nds()..    ..   
-00000ee0: 2064 6566 205f 5f6c 745f 5f28 7365 6c66   def __lt__(self
-00000ef0: 2c20 6f74 6865 723a 2022 5661 756c 7444  , other: "VaultD
-00000f00: 7572 6174 696f 6e22 2920 2d3e 2062 6f6f  uration") -> boo
-00000f10: 6c3a 0d0a 2020 2020 2020 2020 6966 206e  l:..        if n
-00000f20: 6f74 2069 7369 6e73 7461 6e63 6528 6f74  ot isinstance(ot
-00000f30: 6865 722c 2056 6175 6c74 4475 7261 7469  her, VaultDurati
-00000f40: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
-00000f50: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00000f60: 7228 6622 556e 7375 7070 6f72 7465 6420  r(f"Unsupported 
-00000f70: 6f70 6572 616e 6420 7479 7065 2873 2920  operand type(s) 
-00000f80: 666f 7220 3c3a 2027 7b74 7970 6528 7365  for <: '{type(se
-00000f90: 6c66 292e 5f5f 6e61 6d65 5f5f 7d27 2061  lf).__name__}' a
-00000fa0: 6e64 2027 7b74 7970 6528 6f74 6865 7229  nd '{type(other)
-00000fb0: 2e5f 5f6e 616d 655f 5f7d 2722 290d 0a20  .__name__}'").. 
-00000fc0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00000fd0: 2072 6574 7572 6e20 7365 6c66 2e74 6f5f   return self.to_
-00000fe0: 7365 636f 6e64 7328 2920 3c20 6f74 6865  seconds() < othe
-00000ff0: 722e 746f 5f73 6563 6f6e 6473 2829 0d0a  r.to_seconds()..
-00001000: 2020 2020 0d0a 2020 2020 6465 6620 5f5f      ..    def __
-00001010: 6c65 5f5f 2873 656c 662c 206f 7468 6572  le__(self, other
-00001020: 3a20 2256 6175 6c74 4475 7261 7469 6f6e  : "VaultDuration
-00001030: 2229 202d 3e20 626f 6f6c 3a0d 0a20 2020  ") -> bool:..   
-00001040: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00001050: 7374 616e 6365 286f 7468 6572 2c20 5661  stance(other, Va
-00001060: 756c 7444 7572 6174 696f 6e29 3a0d 0a20  ultDuration):.. 
-00001070: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00001080: 2054 7970 6545 7272 6f72 2866 2255 6e73   TypeError(f"Uns
-00001090: 7570 706f 7274 6564 206f 7065 7261 6e64  upported operand
-000010a0: 2074 7970 6528 7329 2066 6f72 203c 3d3a   type(s) for <=:
-000010b0: 2027 7b74 7970 6528 7365 6c66 292e 5f5f   '{type(self).__
-000010c0: 6e61 6d65 5f5f 7d27 2061 6e64 2027 7b74  name__}' and '{t
-000010d0: 7970 6528 6f74 6865 7229 2e5f 5f6e 616d  ype(other).__nam
-000010e0: 655f 5f7d 2722 290d 0a20 2020 2020 2020  e__}'")..       
-000010f0: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
-00001100: 6e20 7365 6c66 2e74 6f5f 7365 636f 6e64  n self.to_second
-00001110: 7328 2920 3c3d 206f 7468 6572 2e74 6f5f  s() <= other.to_
-00001120: 7365 636f 6e64 7328 290d 0a20 2020 200d  seconds()..    .
-00001130: 0a20 2020 2064 6566 205f 5f67 745f 5f28  .    def __gt__(
-00001140: 7365 6c66 2c20 6f74 6865 723a 2022 5661  self, other: "Va
-00001150: 756c 7444 7572 6174 696f 6e22 2920 2d3e  ultDuration") ->
-00001160: 2062 6f6f 6c3a 0d0a 2020 2020 2020 2020   bool:..        
-00001170: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00001180: 6528 6f74 6865 722c 2056 6175 6c74 4475  e(other, VaultDu
-00001190: 7261 7469 6f6e 293a 0d0a 2020 2020 2020  ration):..      
-000011a0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-000011b0: 4572 726f 7228 6622 556e 7375 7070 6f72  Error(f"Unsuppor
-000011c0: 7465 6420 6f70 6572 616e 6420 7479 7065  ted operand type
-000011d0: 2873 2920 666f 7220 3e3a 2027 7b74 7970  (s) for >: '{typ
-000011e0: 6528 7365 6c66 292e 5f5f 6e61 6d65 5f5f  e(self).__name__
-000011f0: 7d27 2061 6e64 2027 7b74 7970 6528 6f74  }' and '{type(ot
-00001200: 6865 7229 2e5f 5f6e 616d 655f 5f7d 2722  her).__name__}'"
-00001210: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-00001220: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00001230: 2e74 6f5f 7365 636f 6e64 7328 2920 3e20  .to_seconds() > 
-00001240: 6f74 6865 722e 746f 5f73 6563 6f6e 6473  other.to_seconds
-00001250: 2829 0d0a 2020 2020 0d0a 2020 2020 6465  ()..    ..    de
-00001260: 6620 5f5f 6765 5f5f 2873 656c 662c 206f  f __ge__(self, o
-00001270: 7468 6572 3a20 2256 6175 6c74 4475 7261  ther: "VaultDura
-00001280: 7469 6f6e 2229 202d 3e20 626f 6f6c 3a0d  tion") -> bool:.
-00001290: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000012a0: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
-000012b0: 2c20 5661 756c 7444 7572 6174 696f 6e29  , VaultDuration)
-000012c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000012d0: 6169 7365 2054 7970 6545 7272 6f72 2866  aise TypeError(f
-000012e0: 2255 6e73 7570 706f 7274 6564 206f 7065  "Unsupported ope
-000012f0: 7261 6e64 2074 7970 6528 7329 2066 6f72  rand type(s) for
-00001300: 203e 3d3a 2027 7b74 7970 6528 7365 6c66   >=: '{type(self
-00001310: 292e 5f5f 6e61 6d65 5f5f 7d27 2061 6e64  ).__name__}' and
-00001320: 2027 7b74 7970 6528 6f74 6865 7229 2e5f   '{type(other)._
-00001330: 5f6e 616d 655f 5f7d 2722 290d 0a20 2020  _name__}'")..   
-00001340: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
-00001350: 6574 7572 6e20 7365 6c66 2e74 6f5f 7365  eturn self.to_se
-00001360: 636f 6e64 7328 2920 3e3d 206f 7468 6572  conds() >= other
-00001370: 2e74 6f5f 7365 636f 6e64 7328 290d 0a20  .to_seconds().. 
-00001380: 2020 200d 0a20 2020 2064 6566 205f 5f73     ..    def __s
-00001390: 7472 5f5f 2873 656c 6629 202d 3e20 7374  tr__(self) -> st
-000013a0: 723a 0d0a 2020 2020 2020 2020 7265 7475  r:..        retu
-000013b0: 726e 2066 227b 7365 6c66 2e76 616c 7565  rn f"{self.value
-000013c0: 7d7b 7365 6c66 2e75 6e69 747d 220d 0a0d  }{self.unit}"...
-000013d0: 0a0d 0a63 6c61 7373 205f 5661 756c 7448  ...class _VaultH
-000013e0: 5454 5041 5049 3a0d 0a20 2020 2064 6566  TTPAPI:..    def
-000013f0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00001400: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001410: 2020 2075 726c 3a20 7374 722c 200d 0a20     url: str, .. 
-00001420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001430: 6175 7468 5f63 6667 3a20 556e 696f 6e5b  auth_cfg: Union[
-00001440: 6469 6374 2c20 436f 6e66 6967 4469 6374  dict, ConfigDict
-00001450: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00001460: 2020 2020 2070 7265 6669 783a 2073 7472       prefix: str
-00001470: 203d 2022 2f76 312f 222c 0d0a 2020 2020   = "/v1/",..    
-00001480: 2020 2020 2020 2020 2020 2020 2077 6f72               wor
-00001490: 6b5f 6469 723a 204f 7074 696f 6e61 6c5b  k_dir: Optional[
-000014a0: 5061 7468 4c69 6b65 5479 7065 5d20 3d20  PathLikeType] = 
-000014b0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-000014c0: 2020 2020 2020 2020 6c6f 6767 6572 3a20          logger: 
-000014d0: 4f70 7469 6f6e 616c 5b4c 6f67 6765 725d  Optional[Logger]
-000014e0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
-000014f0: 2020 2020 2020 2020 2020 2071 7569 6574             quiet
-00001500: 3a20 626f 6f6c 203d 2046 616c 7365 293a  : bool = False):
-00001510: 0d0a 2020 2020 2020 2020 2222 2256 6175  ..        """Vau
-00001520: 6c74 2048 5454 5020 4150 490d 0a20 2020  lt HTTP API..   
-00001530: 2020 2020 2052 6566 6572 2074 6f20 6874       Refer to ht
-00001540: 7470 733a 2f2f 6465 7665 6c6f 7065 722e  tps://developer.
-00001550: 6861 7368 6963 6f72 702e 636f 6d2f 7661  hashicorp.com/va
-00001560: 756c 742f 6170 692d 646f 6373 2066 6f72  ult/api-docs for
-00001570: 206d 6f72 6520 6465 7461 696c 732e 0d0a   more details...
-00001580: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
-00001590: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
-000015a0: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
-000015b0: 2020 2020 6175 7468 5f63 6667 2028 556e      auth_cfg (Un
-000015c0: 696f 6e5b 436f 6e66 6967 4469 6374 2c20  ion[ConfigDict, 
-000015d0: 6469 6374 5d29 3a20 6175 7468 6f72 697a  dict]): authoriz
-000015e0: 6174 696f 6e20 636f 6e66 6967 2e0d 0a20  ation config... 
-000015f0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00001600: 7820 2873 7472 2c20 6f70 7469 6f6e 616c  x (str, optional
-00001610: 293a 2063 7572 7265 6e74 6c79 2061 6c6c  ): currently all
-00001620: 2041 5049 2072 6f75 7465 7320 7072 6566   API routes pref
-00001630: 6978 6564 2077 6974 6820 2f76 312f 2e20  ixed with /v1/. 
-00001640: 4465 6661 756c 7473 2074 6f20 222f 7631  Defaults to "/v1
-00001650: 2f22 2e0d 0a20 2020 2020 2020 2020 2020  /"...           
-00001660: 2077 6f72 6b5f 6469 7220 284f 7074 696f   work_dir (Optio
-00001670: 6e61 6c5b 5061 7468 4c69 6b65 5479 7065  nal[PathLikeType
-00001680: 5d2c 206f 7074 696f 6e61 6c29 3a20 7769  ], optional): wi
-00001690: 6c6c 2073 6176 6520 7468 6520 6c6f 6720  ll save the log 
-000016a0: 6669 6c65 2074 6f20 2277 6f72 6b5f 6469  file to "work_di
-000016b0: 722f 6c6f 672f 2220 6966 200d 0a20 2020  r/log/" if ..   
-000016c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016f0: 2020 2020 2020 776f 726b 5f64 6972 2069        work_dir i
-00001700: 7320 7370 6563 6966 6965 642e 2044 6566  s specified. Def
-00001710: 6175 6c74 7320 746f 204e 6f6e 652e 0d0a  aults to None...
-00001720: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00001730: 6572 2028 4f70 7469 6f6e 616c 5b4c 6f67  er (Optional[Log
-00001740: 6765 725d 2c20 6f70 7469 6f6e 616c 293a  ger], optional):
-00001750: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00001760: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
-00001770: 7175 6965 7420 2862 6f6f 6c2c 206f 7074  quiet (bool, opt
-00001780: 696f 6e61 6c29 3a20 7768 6574 6865 7220  ional): whether 
-00001790: 7468 6520 6c6f 6767 6572 2074 6f20 7275  the logger to ru
-000017a0: 6e20 696e 2071 7569 6574 206d 6f64 652e  n in quiet mode.
-000017b0: 2044 6566 6175 6c74 7320 746f 2046 616c   Defaults to Fal
-000017c0: 7365 2e0d 0a20 2020 2020 2020 2022 2222  se...        """
-000017d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
-000017e0: 6f72 6b5f 6469 7220 3d20 5061 7468 2877  ork_dir = Path(w
-000017f0: 6f72 6b5f 6469 7229 2069 6620 776f 726b  ork_dir) if work
-00001800: 5f64 6972 2069 7320 6e6f 7420 4e6f 6e65  _dir is not None
-00001810: 2065 6c73 6520 4e6f 6e65 0d0a 2020 2020   else None..    
-00001820: 2020 2020 7365 6c66 2e6c 6f67 6765 7220      self.logger 
-00001830: 3d20 7365 6c66 2e5f 7365 745f 6c6f 6767  = self._set_logg
-00001840: 6572 286c 6f67 6765 722c 2071 7569 6574  er(logger, quiet
-00001850: 290d 0a0d 0a20 2020 2020 2020 2061 7373  )....        ass
-00001860: 6572 7420 7072 6566 6978 203d 3d20 222f  ert prefix == "/
-00001870: 7631 2f22 2c20 2276 3120 6973 2063 7572  v1/", "v1 is cur
-00001880: 7265 6e74 6c79 2074 6865 206f 6e6c 7920  rently the only 
-00001890: 4150 4920 7665 7273 696f 6e20 666f 7220  API version for 
-000018a0: 4861 7368 6943 6f72 7020 5661 756c 742e  HashiCorp Vault.
-000018b0: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-000018c0: 7375 7070 6f72 745f 6175 7468 5f6d 6574  support_auth_met
-000018d0: 686f 6473 203d 205b 2274 6f6b 656e 222c  hods = ["token",
-000018e0: 2022 7573 6572 7061 7373 225d 0d0a 2020   "userpass"]..  
-000018f0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00001900: 7572 6c20 3d20 7572 6c2e 7273 7472 6970  url = url.rstrip
-00001910: 2827 2f27 2920 2b20 7072 6566 6978 0d0a  ('/') + prefix..
-00001920: 2020 2020 2020 2020 7365 6c66 2e5f 6b65          self._ke
-00001930: 795f 6c65 6e20 3d20 3234 0d0a 2020 2020  y_len = 24..    
-00001940: 2020 2020 7365 6c66 2e5f 7365 6564 203d      self._seed =
-00001950: 2072 616e 646f 6d2e 7261 6e64 696e 7428   random.randint(
-00001960: 302c 2031 6531 3029 0d0a 2020 2020 2020  0, 1e10)..      
-00001970: 2020 7365 6c66 2e69 735f 6175 7468 2c20    self.is_auth, 
-00001980: 7365 6c66 2e75 726c 2c20 7365 6c66 2e74  self.url, self.t
-00001990: 6f6b 656e 203d 2073 656c 662e 5f5f 6175  oken = self.__au
-000019a0: 7468 6f72 697a 6528 7572 6c2c 2061 7574  thorize(url, aut
-000019b0: 685f 6366 6729 0d0a 0d0a 2020 2020 6465  h_cfg)....    de
-000019c0: 6620 5f5f 6175 7468 6f72 697a 6528 7365  f __authorize(se
-000019d0: 6c66 2c20 7572 6c3a 2073 7472 2c20 6175  lf, url: str, au
-000019e0: 7468 5f63 6667 3a20 556e 696f 6e5b 436f  th_cfg: Union[Co
-000019f0: 6e66 6967 4469 6374 2c20 6469 6374 5d29  nfigDict, dict])
-00001a00: 3a0d 0a20 2020 2020 2020 2061 7574 685f  :..        auth_
-00001a10: 6366 6720 3d20 436f 6e66 6967 4469 6374  cfg = ConfigDict
-00001a20: 2861 7574 685f 6366 6729 0d0a 2020 2020  (auth_cfg)..    
-00001a30: 2020 2020 6175 7468 5f6d 6574 686f 6420      auth_method 
-00001a40: 3d20 6175 7468 5f63 6667 2e70 6f70 2822  = auth_cfg.pop("
-00001a50: 6d65 7468 6f64 222c 2022 746f 6b65 6e22  method", "token"
-00001a60: 290d 0a20 2020 2020 2020 2061 7373 6572  )..        asser
-00001a70: 7420 6175 7468 5f6d 6574 686f 6420 696e  t auth_method in
-00001a80: 2073 656c 662e 7375 7070 6f72 745f 6175   self.support_au
-00001a90: 7468 5f6d 6574 686f 6473 2c20 6622 756e  th_methods, f"un
-00001aa0: 7375 7070 6f72 7465 6420 6175 7468 206d  supported auth m
-00001ab0: 6574 686f 643a 207b 6175 7468 5f6d 6574  ethod: {auth_met
-00001ac0: 686f 647d 220d 0a0d 0a20 2020 2020 2020  hod}"....       
-00001ad0: 2069 6620 6175 7468 5f6d 6574 686f 6420   if auth_method 
-00001ae0: 3d3d 2022 746f 6b65 6e22 3a0d 0a20 2020  == "token":..   
-00001af0: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
-00001b00: 2061 7574 685f 6366 672e 746f 6b65 6e0d   auth_cfg.token.
-00001b10: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00001b20: 203d 2072 6571 7565 7374 732e 6765 7428   = requests.get(
-00001b30: 7572 6c2b 2261 7574 682f 746f 6b65 6e2f  url+"auth/token/
-00001b40: 6c6f 6f6b 7570 2d73 656c 6622 2c20 6865  lookup-self", he
-00001b50: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
-00001b60: 546f 6b65 6e22 3a20 746f 6b65 6e7d 290d  Token": token}).
-00001b70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00001b80: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-00001b90: 3d3d 2032 3030 3a0d 0a20 2020 2020 2020  == 200:..       
-00001ba0: 2020 2020 2020 2020 2069 735f 6175 7468           is_auth
-00001bb0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00001bc0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00001bd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00001be0: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
-00001bf0: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
-00001c00: 5f6e 616d 655f 5f2c 2072 6573 2c20 2276  _name__, res, "v
-00001c10: 6175 6c74 2063 6f6e 6e65 6374 2066 6169  ault connect fai
-00001c20: 6c65 6422 290d 0a20 2020 2020 2020 2020  led")..         
-00001c30: 2020 2020 2020 2069 735f 6175 7468 203d         is_auth =
-00001c40: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00001c50: 0d0a 2020 2020 2020 2020 6966 2061 7574  ..        if aut
-00001c60: 685f 6d65 7468 6f64 203d 3d20 2275 7365  h_method == "use
-00001c70: 7270 6173 7322 3a0d 0a20 2020 2020 2020  rpass":..       
-00001c80: 2020 2020 2075 7365 726e 616d 6520 3d20       username = 
-00001c90: 6175 7468 5f63 6667 2e75 7365 726e 616d  auth_cfg.usernam
-00001ca0: 650d 0a20 2020 2020 2020 2020 2020 2070  e..            p
-00001cb0: 6173 7377 6f72 6420 3d20 6175 7468 5f63  assword = auth_c
-00001cc0: 6667 2e70 6173 7377 6f72 640d 0a20 2020  fg.password..   
-00001cd0: 2020 2020 2020 2020 2072 6573 203d 2072           res = r
-00001ce0: 6571 7565 7374 732e 706f 7374 2875 726c  equests.post(url
-00001cf0: 2b66 2261 7574 682f 7573 6572 7061 7373  +f"auth/userpass
-00001d00: 2f6c 6f67 696e 2f7b 7573 6572 6e61 6d65  /login/{username
-00001d10: 7d22 2c20 6461 7461 3d7b 2270 6173 7377  }", data={"passw
-00001d20: 6f72 6422 3a20 7061 7373 776f 7264 7d29  ord": password})
-00001d30: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00001d40: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-00001d50: 203d 3d20 3230 303a 0d0a 2020 2020 2020   == 200:..      
-00001d60: 2020 2020 2020 2020 2020 6973 5f61 7574            is_aut
-00001d70: 6820 3d20 5472 7565 0d0a 2020 2020 2020  h = True..      
-00001d80: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
-00001d90: 3d20 7265 732e 6a73 6f6e 2829 5b22 6175  = res.json()["au
-00001da0: 7468 225d 5b22 636c 6965 6e74 5f74 6f6b  th"]["client_tok
-00001db0: 656e 225d 0d0a 2020 2020 2020 2020 2020  en"]..          
-00001dc0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00001dd0: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-00001de0: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
-00001df0: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
-00001e00: 6d65 5f5f 2c20 7265 732c 2022 7661 756c  me__, res, "vaul
-00001e10: 7420 636f 6e6e 6563 7420 6661 696c 6564  t connect failed
-00001e20: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00001e30: 2020 2020 6973 5f61 7574 6820 3d20 4661      is_auth = Fa
-00001e40: 6c73 650d 0a0d 0a20 2020 2020 2020 2069  lse....        i
-00001e50: 6620 6e6f 7420 6973 5f61 7574 683a 0d0a  f not is_auth:..
-00001e60: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-00001e70: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00001e80: 2020 2020 746f 6b65 6e20 3d20 4e6f 6e65      token = None
-00001e90: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00001ea0: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
-00001eb0: 203d 2061 6573 5f65 6e63 7279 7074 5f74   = aes_encrypt_t
-00001ec0: 6578 7428 7572 6c2c 206b 6579 3d72 616e  ext(url, key=ran
-00001ed0: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-00001ee0: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-00001ef0: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-00001f00: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-00001f10: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-00001f20: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
-00001f30: 656e 6372 7970 745f 7465 7874 2874 6f6b  encrypt_text(tok
-00001f40: 656e 2c20 6b65 793d 7261 6e64 6f6d 5f68  en, key=random_h
-00001f50: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
-00001f60: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
-00001f70: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
-00001f80: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
-00001f90: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
-00001fa0: 7572 6e20 6973 5f61 7574 682c 2075 726c  urn is_auth, url
-00001fb0: 2c20 746f 6b65 6e0d 0a20 2020 200d 0a20  , token..    .. 
-00001fc0: 2020 2064 6566 205f 6c6f 675f 6572 726f     def _log_erro
-00001fd0: 725f 7265 7370 6f6e 7365 2873 656c 662c  r_response(self,
-00001fe0: 206d 6f64 756c 655f 6e61 6d65 3a20 7374   module_name: st
-00001ff0: 722c 2072 6573 706f 6e73 653a 2072 6571  r, response: req
-00002000: 7565 7374 732e 5265 7370 6f6e 7365 2c20  uests.Response, 
-00002010: 6c6f 675f 7465 7874 3a20 7374 7229 3a0d  log_text: str):.
-00002020: 0a20 2020 2020 2020 2072 6573 5f64 6963  .        res_dic
-00002030: 7420 3d20 436f 6e66 6967 4469 6374 2872  t = ConfigDict(r
-00002040: 6573 706f 6e73 652e 6a73 6f6e 2829 290d  esponse.json()).
-00002050: 0a20 2020 2020 2020 2065 7272 6f72 7320  .        errors 
-00002060: 3d20 7265 735f 6469 6374 2e65 7272 6f72  = res_dict.error
-00002070: 730d 0a20 2020 2020 2020 2077 6172 6e69  s..        warni
-00002080: 6e67 7320 3d20 7265 735f 6469 6374 2e77  ngs = res_dict.w
-00002090: 6172 6e69 6e67 730d 0a20 2020 2020 2020  arnings..       
-000020a0: 2069 6620 6572 726f 7273 2069 7320 6e6f   if errors is no
-000020b0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-000020c0: 2020 2020 2065 7272 6f72 5f74 6578 7420       error_text 
-000020d0: 3d20 2222 2e6a 6f69 6e28 6572 726f 7273  = "".join(errors
-000020e0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000020f0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-00002100: 2866 227b 6d6f 6475 6c65 5f6e 616d 657d  (f"{module_name}
-00002110: 202d 207b 6c6f 675f 7465 7874 7d20 5b7b   - {log_text} [{
-00002120: 7265 7370 6f6e 7365 2e73 7461 7475 735f  response.status_
-00002130: 636f 6465 7d5d 3a20 7b65 7272 6f72 5f74  code}]: {error_t
-00002140: 6578 747d 2229 0d0a 2020 2020 2020 2020  ext}")..        
-00002150: 6966 2077 6172 6e69 6e67 7320 6973 206e  if warnings is n
-00002160: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00002170: 2020 2020 2020 7761 726e 696e 675f 7465        warning_te
-00002180: 7874 203d 2022 222e 6a6f 696e 2877 6172  xt = "".join(war
-00002190: 6e69 6e67 7329 0d0a 2020 2020 2020 2020  nings)..        
-000021a0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-000021b0: 6572 726f 7228 6622 7b6d 6f64 756c 655f  error(f"{module_
-000021c0: 6e61 6d65 7d20 2d20 7b6c 6f67 5f74 6578  name} - {log_tex
-000021d0: 747d 205b 7b72 6573 706f 6e73 652e 7374  t} [{response.st
-000021e0: 6174 7573 5f63 6f64 657d 5d3a 207b 7761  atus_code}]: {wa
-000021f0: 726e 696e 675f 7465 7874 7d22 290d 0a20  rning_text}").. 
-00002200: 2020 2020 2020 200d 0a20 2020 2064 6566         ..    def
-00002210: 205f 7365 745f 6c6f 6767 6572 2873 656c   _set_logger(sel
-00002220: 662c 206c 6f67 6765 723a 204f 7074 696f  f, logger: Optio
-00002230: 6e61 6c5b 4c6f 6767 6572 5d2c 2071 7569  nal[Logger], qui
-00002240: 6574 3a20 626f 6f6c 293a 0d0a 2020 2020  et: bool):..    
-00002250: 2020 2020 6966 206c 6f67 6765 7220 6973      if logger is
-00002260: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00002270: 2020 2020 6e6f 775f 7469 6d65 203d 2064      now_time = d
-00002280: 6174 6574 696d 652e 6e6f 7728 292e 7374  atetime.now().st
-00002290: 7266 7469 6d65 2827 2559 256d 2564 2d25  rftime('%Y%m%d-%
-000022a0: 4825 4d25 5327 290d 0a20 2020 2020 2020  H%M%S')..       
-000022b0: 2020 2020 206c 6f67 6765 7220 3d20 4c6f       logger = Lo
-000022c0: 6767 6572 2829 0d0a 2020 2020 2020 2020  gger()..        
-000022d0: 2020 2020 6966 2073 656c 662e 776f 726b      if self.work
-000022e0: 5f64 6972 2069 7320 6e6f 7420 4e6f 6e65  _dir is not None
-000022f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00002300: 2020 206c 6f67 6765 722e 696e 6974 5f6c     logger.init_l
-00002310: 6f67 6765 7228 7361 7665 5f70 6174 683d  ogger(save_path=
-00002320: 7365 6c66 2e77 6f72 6b5f 6469 722f 276c  self.work_dir/'l
-00002330: 6f67 272f 6627 7b6e 6f77 5f74 696d 657d  og'/f'{now_time}
-00002340: 2e6c 6f67 2729 0d0a 2020 2020 2020 2020  .log')..        
-00002350: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00002360: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00002370: 722e 696e 6974 5f6c 6f67 6765 7228 290d  r.init_logger().
-00002380: 0a20 2020 2020 2020 2069 6620 7175 6965  .        if quie
-00002390: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-000023a0: 6c6f 6767 6572 2e73 6574 5f71 7569 6574  logger.set_quiet
-000023b0: 2829 0d0a 2020 2020 2020 2020 656c 7365  ()..        else
-000023c0: 3a0d 0a20 2020 2020 2020 2020 2020 206c  :..            l
-000023d0: 6f67 6765 722e 7365 745f 6163 7469 7661  ogger.set_activa
-000023e0: 7465 2829 0d0a 2020 2020 2020 2020 7265  te()..        re
-000023f0: 7475 726e 206c 6f67 6765 720d 0a20 2020  turn logger..   
-00002400: 200d 0a0d 0a63 6c61 7373 2056 6175 6c74   ....class Vault
-00002410: 5365 6372 6574 456e 6769 6e65 4b56 3128  SecretEngineKV1(
-00002420: 5f56 6175 6c74 4854 5450 4150 4929 3a0d  _VaultHTTPAPI):.
-00002430: 0a20 2020 2022 2222 4b56 2053 6563 7265  .    """KV Secre
-00002440: 7420 456e 6769 6e65 2028 7665 7273 696f  t Engine (versio
-00002450: 6e20 3129 0d0a 2020 2020 5265 6665 7220  n 1)..    Refer 
-00002460: 746f 2068 7474 7073 3a2f 2f64 6576 656c  to https://devel
-00002470: 6f70 6572 2e68 6173 6869 636f 7270 2e63  oper.hashicorp.c
-00002480: 6f6d 2f76 6175 6c74 2f61 7069 2d64 6f63  om/vault/api-doc
-00002490: 732f 7365 6372 6574 2f6b 762f 6b76 2d76  s/secret/kv/kv-v
-000024a0: 3120 666f 7220 6d6f 7265 2064 6574 6169  1 for more detai
-000024b0: 6c73 2e0d 0a0d 0a20 2020 2049 6e69 743a  ls.....    Init:
-000024c0: 0d0a 2020 2020 2020 2020 636f 6e6e 6563  ..        connec
-000024d0: 7469 6e67 2077 6974 6820 746f 6b65 6e3a  ting with token:
-000024e0: 0d0a 2020 2020 2020 2020 3e3e 3e20 6b76  ..        >>> kv
-000024f0: 315f 656e 6769 6e65 203d 2056 6175 6c74  1_engine = Vault
-00002500: 5365 6372 6574 456e 6769 6e65 4b56 3128  SecretEngineKV1(
-00002510: 0d0a 2020 2020 2020 2020 3e3e 3e20 2020  ..        >>>   
-00002520: 2020 7572 6c3d 2268 7474 703a 2f2f 3132    url="http://12
-00002530: 372e 302e 302e 313a 3832 3030 222c 200d  7.0.0.1:8200", .
-00002540: 0a20 2020 2020 2020 203e 3e3e 2020 2020  .        >>>    
-00002550: 2061 7574 685f 6366 673d 6469 6374 286d   auth_cfg=dict(m
-00002560: 6574 686f 643d 2274 6f6b 656e 222c 2074  ethod="token", t
-00002570: 6f6b 656e 3d22 6876 732e 534d 4630 6e46  oken="hvs.SMF0nF
-00002580: 306e 6474 3264 5a33 6452 4366 6536 6f48  0ndt2dZ3dRCfe6oH
-00002590: 5636 2229 0d0a 2020 2020 2020 2020 3e3e  V6")..        >>
-000025a0: 3e20 290d 0a0d 0a20 2020 2020 2020 2063  > )....        c
-000025b0: 6f6e 6e65 6374 696e 6720 7769 7468 2075  onnecting with u
-000025c0: 7365 726e 616d 6520 2620 7061 7373 776f  sername & passwo
-000025d0: 7264 3a0d 0a20 2020 2020 2020 203e 3e3e  rd:..        >>>
-000025e0: 206b 7631 5f65 6e67 696e 6520 3d20 5661   kv1_engine = Va
-000025f0: 756c 7453 6563 7265 7445 6e67 696e 654b  ultSecretEngineK
-00002600: 5631 280d 0a20 2020 2020 2020 203e 3e3e  V1(..        >>>
-00002610: 2020 2020 2075 726c 3d22 6874 7470 3a2f       url="http:/
-00002620: 2f31 3237 2e30 2e30 2e31 3a38 3230 3022  /127.0.0.1:8200"
-00002630: 2c0d 0a20 2020 2020 2020 203e 3e3e 2020  ,..        >>>  
-00002640: 2020 2061 7574 685f 6366 673d 6469 6374     auth_cfg=dict
-00002650: 286d 6574 686f 643d 2275 7365 7270 6173  (method="userpas
-00002660: 7322 2c20 7573 6572 6e61 6d65 3d22 7573  s", username="us
-00002670: 6572 6e61 6d65 222c 2070 6173 7377 6f72  ername", passwor
-00002680: 643d 2270 6173 7377 6f72 6422 290d 0a20  d="password").. 
-00002690: 2020 2020 2020 203e 3e3e 2029 0d0a 2020         >>> )..  
-000026a0: 2020 2222 220d 0a0d 0a20 2020 2064 6566    """....    def
-000026b0: 2072 6561 645f 7365 6372 6574 2873 656c   read_secret(sel
-000026c0: 662c 206d 6f75 6e74 5f70 6174 683a 2073  f, mount_path: s
-000026d0: 7472 2c20 7061 7468 3a20 7374 722c 206b  tr, path: str, k
-000026e0: 6579 3a20 4f70 7469 6f6e 616c 5b73 7472  ey: Optional[str
-000026f0: 5d20 3d20 4e6f 6e65 293a 0d0a 2020 2020  ] = None):..    
-00002700: 2020 2020 2222 2272 6561 6420 6120 7365      """read a se
-00002710: 6372 6574 2066 726f 6d20 226d 6f75 6e74  cret from "mount
-00002720: 5f70 6174 682f 7061 7468 220d 0a0d 0a20  _path/path".... 
-00002730: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-00002740: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
-00002750: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
-00002760: 2020 2020 2020 2020 7061 7468 2028 7374          path (st
-00002770: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-00002780: 6b65 7920 284f 7074 696f 6e61 6c5b 7374  key (Optional[st
-00002790: 725d 2c20 6f70 7469 6f6e 616c 293a 2069  r], optional): i
-000027a0: 6620 6b65 7920 6973 204e 6f6e 652c 2072  f key is None, r
-000027b0: 6574 7572 6e73 2061 6c6c 2073 6563 7265  eturns all secre
-000027c0: 7473 2069 6e20 6469 6374 2066 726f 6d20  ts in dict from 
-000027d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000027e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027f0: 2020 2020 2020 2020 2020 2020 2022 6d6f               "mo
-00002800: 756e 745f 7061 7468 2f70 6174 6822 2c20  unt_path/path", 
-00002810: 7768 6963 6820 6973 2074 6865 2073 616d  which is the sam
-00002820: 6520 6173 206c 6973 745f 7365 6372 6574  e as list_secret
-00002830: 2829 2e20 0d0a 2020 2020 2020 2020 2020  (). ..          
-00002840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002860: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00002870: 652e 0d0a 0d0a 2020 2020 2020 2020 5265  e.....        Re
-00002880: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-00002890: 2020 2020 6469 6374 3a20 7265 7475 726e      dict: return
-000028a0: 2061 2064 6963 7420 6966 206b 6579 2069   a dict if key i
-000028b0: 7320 6e6f 7420 7370 6563 6966 6965 640d  s not specified.
-000028c0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-000028d0: 206f 7220 696e 743a 2072 6574 7572 6e20   or int: return 
-000028e0: 6120 7374 7220 6f72 2069 6e74 2069 6620  a str or int if 
-000028f0: 6b65 7920 6973 2073 7065 6369 6669 6564  key is specified
-00002900: 0d0a 2020 2020 2020 2020 2020 2020 4e6f  ..            No
-00002910: 6e65 3a20 7265 7475 726e 204e 6f6e 6520  ne: return None 
-00002920: 6966 2061 6e20 6572 726f 7220 6f63 6375  if an error occu
-00002930: 7265 640d 0a20 2020 2020 2020 2022 2222  red..        """
-00002940: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00002950: 662e 6973 5f61 7574 683a 0d0a 2020 2020  f.is_auth:..    
-00002960: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
-00002970: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-00002980: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
-00002990: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-000029a0: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-000029b0: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-000029c0: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-000029d0: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-000029e0: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
-000029f0: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
-00002a00: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
-00002a10: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-00002a20: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-00002a30: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-00002a40: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-00002a50: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-00002a60: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
-00002a70: 7473 2e67 6574 2875 726c 2b66 227b 6d6f  ts.get(url+f"{mo
-00002a80: 756e 745f 7061 7468 7d2f 7b70 6174 687d  unt_path}/{path}
-00002a90: 222c 2068 6561 6465 7273 3d7b 2258 2d56  ", headers={"X-V
-00002aa0: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
-00002ab0: 656e 7d29 0d0a 2020 2020 2020 2020 2020  en})..          
-00002ac0: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
-00002ad0: 636f 6465 203d 3d20 3230 303a 0d0a 2020  code == 200:..  
-00002ae0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00002af0: 7461 203d 2072 6573 2e6a 736f 6e28 295b  ta = res.json()[
-00002b00: 2264 6174 6122 5d0d 0a20 2020 2020 2020  "data"]..       
-00002b10: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-00002b20: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00002b30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00002b40: 7475 726e 2064 6174 610d 0a20 2020 2020  turn data..     
-00002b50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00002b60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002b70: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
-00002b80: 6461 7461 2e6b 6579 7328 293a 0d0a 2020  data.keys():..  
-00002b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ba0: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
-00002bb0: 612e 6b65 790d 0a20 2020 2020 2020 2020  a.key..         
-00002bc0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00002bd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002be0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00002bf0: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
-00002c00: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00002c10: 5f7d 202d 2072 6561 6420 7365 6372 6574  _} - read secret
-00002c20: 2065 7272 6f72 3a20 6b65 7920 277b 6b65   error: key '{ke
-00002c30: 797d 2720 6e6f 7420 666f 756e 6422 290d  y}' not found").
-00002c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002c50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00002c60: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00002c70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00002c80: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-00002c90: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
-00002ca0: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
-00002cb0: 6d65 5f5f 2c20 7265 732c 2022 7265 6164  me__, res, "read
-00002cc0: 2073 6563 7265 7420 6572 726f 7222 290d   secret error").
-00002cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ce0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-00002cf0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00002d00: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-00002d10: 0a20 2020 2020 2020 200d 0a20 2020 2064  .        ..    d
-00002d20: 6566 206c 6973 745f 7365 6372 6574 2873  ef list_secret(s
-00002d30: 656c 662c 206d 6f75 6e74 5f70 6174 683a  elf, mount_path:
-00002d40: 2073 7472 2c20 7061 7468 3a20 7374 7229   str, path: str)
-00002d50: 3a0d 0a20 2020 2020 2020 2022 2222 6c69  :..        """li
-00002d60: 7374 2061 6c6c 2073 6365 7265 7473 2066  st all scerets f
-00002d70: 726f 6d20 226d 6f75 6e74 5f70 6174 682f  rom "mount_path/
-00002d80: 7061 7468 220d 0a0d 0a20 2020 2020 2020  path"....       
-00002d90: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00002da0: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-00002db0: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-00002dc0: 2020 7061 7468 2028 7374 7229 0d0a 0d0a    path (str)....
-00002dd0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00002de0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-00002df0: 6374 206f 7220 4e6f 6e65 3a20 7265 7475  ct or None: retu
-00002e00: 726e 2061 2064 6963 7420 6966 2073 7563  rn a dict if suc
-00002e10: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
-00002e20: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-00002e30: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00002e40: 2020 6966 2073 656c 662e 6973 5f61 7574    if self.is_aut
-00002e50: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-00002e60: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-00002e70: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-00002e80: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-00002e90: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-00002ea0: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-00002eb0: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-00002ec0: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-00002ed0: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-00002ee0: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
-00002ef0: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
-00002f00: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-00002f10: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-00002f20: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-00002f30: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-00002f40: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-00002f50: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-00002f60: 3d20 7265 7175 6573 7473 2e67 6574 2875  = requests.get(u
-00002f70: 726c 2b66 227b 6d6f 756e 745f 7061 7468  rl+f"{mount_path
-00002f80: 7d2f 7b70 6174 687d 222c 2068 6561 6465  }/{path}", heade
-00002f90: 7273 3d7b 2258 2d56 6175 6c74 2d54 6f6b  rs={"X-Vault-Tok
-00002fa0: 656e 223a 2074 6f6b 656e 2c20 226c 6973  en": token, "lis
-00002fb0: 7422 3a20 2274 7275 6522 7d29 0d0a 2020  t": "true"})..  
-00002fc0: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-00002fd0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-00002fe0: 3230 303a 0d0a 2020 2020 2020 2020 2020  200:..          
-00002ff0: 2020 2020 2020 6461 7461 203d 2072 6573        data = res
-00003000: 2e6a 736f 6e28 295b 2264 6174 6122 5d0d  .json()["data"].
-00003010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003020: 2072 6574 7572 6e20 6461 7461 0d0a 2020   return data..  
-00003030: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00003040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003050: 2073 656c 662e 5f6c 6f67 5f65 7272 6f72   self._log_error
-00003060: 5f72 6573 706f 6e73 6528 5f5f 636c 6173  _response(__clas
-00003070: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265  s__.__name__, re
-00003080: 732c 2022 6c69 7374 2073 6563 7265 7420  s, "list secret 
-00003090: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
-000030a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000030b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 0d0a  None..        ..
-000030c0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000030d0: 6f6e 650d 0a20 2020 200d 0a20 2020 2064  one..    ..    d
-000030e0: 6566 2061 6464 5f73 6563 7265 7428 7365  ef add_secret(se
-000030f0: 6c66 2c20 6d6f 756e 745f 7061 7468 3a20  lf, mount_path: 
-00003100: 7374 722c 2070 6174 683a 2073 7472 2c20  str, path: str, 
-00003110: 7365 6372 6574 733a 2055 6e69 6f6e 5b64  secrets: Union[d
-00003120: 6963 742c 2043 6f6e 6669 6744 6963 745d  ict, ConfigDict]
-00003130: 293a 0d0a 2020 2020 2020 2020 2222 2261  ):..        """a
-00003140: 6464 2073 6563 7265 7473 2074 6f20 226d  dd secrets to "m
-00003150: 6f75 6e74 5f70 6174 682f 7061 7468 220d  ount_path/path".
-00003160: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00003170: 2020 2059 6f75 2064 6f20 6e6f 7420 6e65     You do not ne
-00003180: 6564 2074 6f20 7370 6563 6966 7920 616c  ed to specify al
-00003190: 6c20 7468 6520 7375 626b 6579 7320 6f66  l the subkeys of
-000031a0: 2073 6563 7265 7473 2c20 6f6e 6c79 2074   secrets, only t
-000031b0: 6865 2073 7562 6b65 7973 2074 6861 7420  he subkeys that 
-000031c0: 6e65 6564 2074 6f20 6265 2061 6464 6564  need to be added
-000031d0: 2c20 7768 6963 6820 6973 2063 6f6e 7665  , which is conve
-000031e0: 6e69 656e 742e 0d0a 0d0a 2020 2020 2020  nient.....      
-000031f0: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-00003200: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
-00003210: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
-00003220: 2020 2070 6174 6820 2873 7472 290d 0a20     path (str).. 
-00003230: 2020 2020 2020 2020 2020 2073 6563 7265             secre
-00003240: 7473 2028 556e 696f 6e5b 6469 6374 2c20  ts (Union[dict, 
-00003250: 436f 6e66 6967 4469 6374 5d29 0d0a 0d0a  ConfigDict])....
-00003260: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00003270: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-00003280: 6f6c 3a20 7265 7475 726e 2054 7275 6520  ol: return True 
-00003290: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-000032a0: 7277 6973 6520 7265 7475 726e 2046 616c  rwise return Fal
-000032b0: 7365 0d0a 2020 2020 2020 2020 2222 220d  se..        """.
-000032c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000032d0: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-000032e0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-000032f0: 5f64 6963 7428 7365 6372 6574 7329 3a0d  _dict(secrets):.
-00003300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003310: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-00003320: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-00003330: 5f5f 6e61 6d65 5f5f 7d20 2d20 6164 6420  __name__} - add 
-00003340: 7365 6372 6574 2065 7272 6f72 3a20 7365  secret error: se
-00003350: 6372 6574 7320 6d75 7374 2062 6520 6120  crets must be a 
-00003360: 6469 6374 206f 7220 436f 6e66 6967 4469  dict or ConfigDi
-00003370: 6374 2229 0d0a 2020 2020 2020 2020 2020  ct")..          
-00003380: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00003390: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-000033a0: 6966 206c 656e 286c 6973 7428 7365 6372  if len(list(secr
-000033b0: 6574 732e 6b65 7973 2829 2929 203d 3d20  ets.keys())) == 
-000033c0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000033d0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-000033e0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
-000033f0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2061  __.__name__} - a
-00003400: 6464 2073 6563 7265 7420 6572 726f 723a  dd secret error:
-00003410: 2073 6563 7265 7473 206d 7573 7420 6e6f   secrets must no
-00003420: 7420 6265 2065 6d70 7479 2229 0d0a 2020  t be empty")..  
-00003430: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00003440: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-00003450: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00003460: 2020 2020 2020 6578 6973 7473 5f73 6563        exists_sec
-00003470: 7265 7473 203d 2073 656c 662e 6c69 7374  rets = self.list
-00003480: 5f73 6563 7265 7428 6d6f 756e 745f 7061  _secret(mount_pa
-00003490: 7468 2c20 7061 7468 290d 0a20 2020 2020  th, path)..     
-000034a0: 2020 2020 2020 2069 6620 6578 6973 7473         if exists
-000034b0: 5f73 6563 7265 7473 2069 7320 6e6f 7420  _secrets is not 
-000034c0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000034d0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-000034e0: 6e20 6578 6973 7473 5f73 6563 7265 7473  n exists_secrets
-000034f0: 2e6b 6579 7328 293a 0d0a 2020 2020 2020  .keys():..      
-00003500: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003510: 206b 6579 2069 6e20 7365 6372 6574 732e   key in secrets.
-00003520: 6b65 7973 2829 3a0d 0a20 2020 2020 2020  keys():..       
-00003530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003540: 2073 656c 662e 6c6f 6767 6572 2e77 6172   self.logger.war
-00003550: 6e69 6e67 2866 227b 5f5f 636c 6173 735f  ning(f"{__class_
-00003560: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6164  _.__name__} - ad
-00003570: 6420 7365 6372 6574 2065 7272 6f72 3a20  d secret error: 
-00003580: 6b65 7920 277b 6b65 797d 2720 616c 7265  key '{key}' alre
-00003590: 6164 7920 6578 6973 7473 2229 0d0a 2020  ady exists")..  
-000035a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035b0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000035c0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-000035d0: 2020 2020 2020 2020 7365 6372 6574 735b          secrets[
-000035e0: 6b65 795d 203d 2065 7869 7374 735f 7365  key] = exists_se
-000035f0: 6372 6574 735b 6b65 795d 0d0a 2020 2020  crets[key]..    
-00003600: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00003610: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00003620: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-00003630: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
-00003640: 2020 2020 2020 2020 2020 2075 726c 203d             url =
-00003650: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
-00003660: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
-00003670: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-00003680: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-00003690: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-000036a0: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-000036b0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-000036c0: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
-000036d0: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
-000036e0: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
-000036f0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-00003700: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-00003710: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-00003720: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-00003730: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-00003740: 2020 2020 2020 2073 6563 7265 7473 2e75         secrets.u
-00003750: 7064 6174 6528 6578 6973 7473 5f73 6563  pdate(exists_sec
-00003760: 7265 7473 290d 0a20 2020 2020 2020 2020  rets)..         
-00003770: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-00003780: 732e 706f 7374 2875 726c 2b66 227b 6d6f  s.post(url+f"{mo
-00003790: 756e 745f 7061 7468 7d2f 7b70 6174 687d  unt_path}/{path}
-000037a0: 222c 2068 6561 6465 7273 3d7b 2258 2d56  ", headers={"X-V
-000037b0: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
-000037c0: 656e 7d2c 2064 6174 613d 7365 6372 6574  en}, data=secret
-000037d0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-000037e0: 6966 2072 6573 2e73 7461 7475 735f 636f  if res.status_co
-000037f0: 6465 203d 3d20 3230 3020 6f72 2072 6573  de == 200 or res
-00003800: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-00003810: 3230 343a 0d0a 2020 2020 2020 2020 2020  204:..          
-00003820: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00003830: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
-00003840: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00003850: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-00003860: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
-00003870: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00003880: 5f2c 2072 6573 2c20 2261 6464 2073 6563  _, res, "add sec
-00003890: 7265 7420 6572 726f 7222 290d 0a20 2020  ret error")..   
-000038a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000038b0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-000038c0: 2020 200d 0a20 2020 2020 2020 2072 6574     ..        ret
-000038d0: 7572 6e20 4661 6c73 650d 0a20 2020 200d  urn False..    .
-000038e0: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-000038f0: 7365 6372 6574 2873 656c 662c 206d 6f75  secret(self, mou
-00003900: 6e74 5f70 6174 683a 2073 7472 2c20 7061  nt_path: str, pa
-00003910: 7468 3a20 7374 722c 2073 6563 7265 7473  th: str, secrets
-00003920: 3a20 556e 696f 6e5b 6469 6374 2c20 436f  : Union[dict, Co
-00003930: 6e66 6967 4469 6374 5d29 3a0d 0a20 2020  nfigDict]):..   
-00003940: 2020 2020 2022 2222 7570 6461 7465 2074       """update t
-00003950: 6865 2065 7869 7374 696e 6720 7365 6372  he existing secr
-00003960: 6574 2069 6e20 226d 6f75 6e74 5f70 6174  et in "mount_pat
-00003970: 682f 7061 7468 220d 0a20 2020 2020 2020  h/path"..       
-00003980: 200d 0a20 2020 2020 2020 2059 6f75 2064   ..        You d
-00003990: 6f20 6e6f 7420 6e65 6564 2074 6f20 7370  o not need to sp
-000039a0: 6563 6966 7920 616c 6c20 7468 6520 7375  ecify all the su
-000039b0: 626b 6579 7320 6f66 2073 6563 7265 7473  bkeys of secrets
-000039c0: 2c20 6f6e 6c79 2074 6865 2073 7562 6b65  , only the subke
-000039d0: 7973 2074 6861 7420 6e65 6564 2074 6f20  ys that need to 
-000039e0: 6265 2075 7064 6174 6564 2c20 7768 6963  be updated, whic
-000039f0: 6820 6973 2063 6f6e 7665 6e69 656e 742e  h is convenient.
-00003a00: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
-00003a10: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-00003a20: 6f75 6e74 5f70 6174 6820 2873 7472 290d  ount_path (str).
-00003a30: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00003a40: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
-00003a50: 2020 2020 2073 6563 7265 7473 2028 556e       secrets (Un
-00003a60: 696f 6e5b 6469 6374 2c20 436f 6e66 6967  ion[dict, Config
-00003a70: 4469 6374 5d29 0d0a 0d0a 2020 2020 2020  Dict])....      
-00003a80: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
-00003a90: 2020 2020 2020 2020 626f 6f6c 3a20 7265          bool: re
-00003aa0: 7475 726e 2054 7275 6520 6966 2073 7563  turn True if suc
-00003ab0: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
-00003ac0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00003ad0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00003ae0: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
-00003af0: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
-00003b00: 2069 6620 6e6f 7420 6973 5f64 6963 7428   if not is_dict(
-00003b10: 7365 6372 6574 7329 3a0d 0a20 2020 2020  secrets):..     
-00003b20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003b30: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-00003b40: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00003b50: 5f5f 7d20 2d20 7570 6461 7465 2073 6563  __} - update sec
-00003b60: 7265 7420 6572 726f 723a 2073 6563 7265  ret error: secre
-00003b70: 7473 206d 7573 7420 6265 2061 2064 6963  ts must be a dic
-00003b80: 7420 6f72 2043 6f6e 6669 6744 6963 7422  t or ConfigDict"
-00003b90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00003ba0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-00003bb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00003bc0: 6c65 6e28 6c69 7374 2873 6563 7265 7473  len(list(secrets
-00003bd0: 2e6b 6579 7328 2929 2920 3d3d 2030 3a0d  .keys())) == 0:.
-00003be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003bf0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-00003c00: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-00003c10: 5f5f 6e61 6d65 5f5f 7d20 2d20 7570 6461  __name__} - upda
-00003c20: 7465 2073 6563 7265 7420 6572 726f 723a  te secret error:
-00003c30: 2073 6563 7265 7473 206d 7573 7420 6e6f   secrets must no
-00003c40: 7420 6265 2065 6d70 7479 2229 0d0a 2020  t be empty")..  
-00003c50: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00003c60: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-00003c70: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00003c80: 2020 2020 2020 6578 6973 7473 5f73 6563        exists_sec
-00003c90: 7265 7473 203d 2073 656c 662e 6c69 7374  rets = self.list
-00003ca0: 5f73 6563 7265 7428 6d6f 756e 745f 7061  _secret(mount_pa
-00003cb0: 7468 2c20 7061 7468 290d 0a20 2020 2020  th, path)..     
-00003cc0: 2020 2020 2020 2069 6620 6578 6973 7473         if exists
-00003cd0: 5f73 6563 7265 7473 2069 7320 6e6f 7420  _secrets is not 
-00003ce0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00003cf0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-00003d00: 6e20 7365 6372 6574 732e 6b65 7973 2829  n secrets.keys()
-00003d10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00003d20: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-00003d30: 7420 696e 2065 7869 7374 735f 7365 6372  t in exists_secr
-00003d40: 6574 732e 6b65 7973 2829 3a0d 0a20 2020  ets.keys():..   
+00000480: 726f 6d20 2e72 6567 6973 7465 7220 696d  rom .register im
+00000490: 706f 7274 2053 4543 5245 540d 0a66 726f  port SECRET..fro
+000004a0: 6d20 2e6d 6973 6320 696d 706f 7274 2072  m .misc import r
+000004b0: 616e 646f 6d5f 6865 782c 2069 735f 6469  andom_hex, is_di
+000004c0: 6374 2c20 6973 5f73 7472 2c20 6973 5f6c  ct, is_str, is_l
+000004d0: 6973 742c 2069 735f 696e 742c 2069 735f  ist, is_int, is_
+000004e0: 6261 7365 3634 0d0a 0d0a 5061 7468 4c69  base64....PathLi
+000004f0: 6b65 5479 7065 203d 2055 6e69 6f6e 5b73  keType = Union[s
+00000500: 7472 2c20 5061 7468 5d0d 0a0d 0a0d 0a40  tr, Path]......@
+00000510: 5345 4352 4554 2e72 6567 6973 7465 725f  SECRET.register_
+00000520: 6d6f 6475 6c65 2829 0d0a 636c 6173 7320  module()..class 
+00000530: 5661 756c 7444 7572 6174 696f 6e3a 0d0a  VaultDuration:..
+00000540: 2020 2020 2222 2254 6869 7320 636c 6173      """This clas
+00000550: 7320 6973 2075 7365 6420 746f 2070 6172  s is used to par
+00000560: 7365 2056 6175 6c74 2064 7572 6174 696f  se Vault duratio
+00000570: 6e20 7374 7269 6e67 2066 6f72 6d61 740d  n string format.
+00000580: 0a0d 0a20 2020 2052 6566 6572 2074 6f20  ...    Refer to 
+00000590: 6874 7470 733a 2f2f 6465 7665 6c6f 7065  https://develope
+000005a0: 722e 6861 7368 6963 6f72 702e 636f 6d2f  r.hashicorp.com/
+000005b0: 7661 756c 742f 646f 6373 2f63 6f6e 6365  vault/docs/conce
+000005c0: 7074 732f 6475 7261 7469 6f6e 2d66 6f72  pts/duration-for
+000005d0: 6d61 7420 666f 7220 6d6f 7265 2064 6574  mat for more det
+000005e0: 6169 6c73 2e0d 0a20 2020 2022 2222 0d0a  ails...    """..
+000005f0: 2020 2020 6475 7261 7469 6f6e 5f70 6174      duration_pat
+00000600: 7465 726e 203d 2072 225e 283f 503c 696e  tern = r"^(?P<in
+00000610: 7465 6765 723e 5c64 2b29 285c 2e29 3f28  teger>\d+)(\.)?(
+00000620: 3f50 3c66 7261 6374 696f 6e3e 5c64 2b29  ?P<fraction>\d+)
+00000630: 3f28 3f50 3c75 6e69 743e 5b61 2d7a 5d2b  ?(?P<unit>[a-z]+
+00000640: 293f 2422 0d0a 2020 2020 7375 7070 6f72  )?$"..    suppor
+00000650: 745f 756e 6974 7320 3d20 5b22 6e73 222c  t_units = ["ns",
+00000660: 2022 7573 222c 2022 6d73 222c 2022 7322   "us", "ms", "s"
+00000670: 2c20 226d 222c 2022 6822 2c20 2264 225d  , "m", "h", "d"]
+00000680: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
+00000690: 6974 5f5f 2873 656c 662c 2064 7572 6174  it__(self, durat
+000006a0: 696f 6e3a 2073 7472 293a 0d0a 2020 2020  ion: str):..    
+000006b0: 2020 2020 7365 6c66 2e5f 5f70 6174 7465      self.__patte
+000006c0: 726e 203d 2072 652e 636f 6d70 696c 6528  rn = re.compile(
+000006d0: 7365 6c66 2e64 7572 6174 696f 6e5f 7061  self.duration_pa
+000006e0: 7474 6572 6e29 0d0a 2020 2020 2020 2020  ttern)..        
+000006f0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00000700: 2073 656c 662e 5f5f 7061 7474 6572 6e2e   self.__pattern.
+00000710: 6d61 7463 6828 6475 7261 7469 6f6e 293a  match(duration):
+00000720: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00000730: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00000740: 2249 6e76 616c 6964 2056 6175 6c74 2064  "Invalid Vault d
+00000750: 7572 6174 696f 6e20 666f 726d 6174 3a20  uration format: 
+00000760: 7b64 7572 6174 696f 6e7d 2229 0d0a 2020  {duration}")..  
+00000770: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00000780: 7365 6c66 2e5f 5f6d 6174 6368 203d 2073  self.__match = s
+00000790: 656c 662e 5f5f 7061 7474 6572 6e2e 6d61  elf.__pattern.ma
+000007a0: 7463 6828 6475 7261 7469 6f6e 290d 0a0d  tch(duration)...
+000007b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000007c0: 2e75 6e69 7420 6e6f 7420 696e 2073 656c  .unit not in sel
+000007d0: 662e 7375 7070 6f72 745f 756e 6974 733a  f.support_units:
+000007e0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+000007f0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00000800: 2249 6e76 616c 6964 2056 6175 6c74 2064  "Invalid Vault d
+00000810: 7572 6174 696f 6e20 756e 6974 3a20 7b73  uration unit: {s
+00000820: 656c 662e 756e 6974 7d22 290d 0a20 2020  elf.unit}")..   
+00000830: 2020 2020 200d 0a20 2020 2040 7072 6f70       ..    @prop
+00000840: 6572 7479 0d0a 2020 2020 6465 6620 696e  erty..    def in
+00000850: 7465 6765 7228 7365 6c66 2920 2d3e 2069  teger(self) -> i
+00000860: 6e74 3a0d 0a20 2020 2020 2020 2072 6574  nt:..        ret
+00000870: 7572 6e20 696e 7428 7365 6c66 2e5f 5f6d  urn int(self.__m
+00000880: 6174 6368 2e67 726f 7570 2822 696e 7465  atch.group("inte
+00000890: 6765 7222 2929 0d0a 2020 2020 0d0a 2020  ger"))..    ..  
+000008a0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+000008b0: 2064 6566 2066 7261 6374 696f 6e28 7365   def fraction(se
+000008c0: 6c66 2920 2d3e 2066 6c6f 6174 3a0d 0a20  lf) -> float:.. 
+000008d0: 2020 2020 2020 2066 7261 6374 696f 6e20         fraction 
+000008e0: 3d20 7365 6c66 2e5f 5f6d 6174 6368 2e67  = self.__match.g
+000008f0: 726f 7570 2822 6672 6163 7469 6f6e 2229  roup("fraction")
+00000900: 0d0a 2020 2020 2020 2020 6966 2066 7261  ..        if fra
+00000910: 6374 696f 6e20 6973 206e 6f74 204e 6f6e  ction is not Non
+00000920: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00000930: 6672 6163 7469 6f6e 203d 2066 6c6f 6174  fraction = float
+00000940: 2866 2230 2e7b 6672 6163 7469 6f6e 7d22  (f"0.{fraction}"
+00000950: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00000960: 0d0a 2020 2020 2020 2020 2020 2020 6672  ..            fr
+00000970: 6163 7469 6f6e 203d 2030 2e30 0d0a 2020  action = 0.0..  
+00000980: 2020 2020 2020 7265 7475 726e 2066 7261        return fra
+00000990: 6374 696f 6e0d 0a20 2020 200d 0a20 2020  ction..    ..   
+000009a0: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+000009b0: 6465 6620 7661 6c75 6528 7365 6c66 2920  def value(self) 
+000009c0: 2d3e 2066 6c6f 6174 3a0d 0a20 2020 2020  -> float:..     
+000009d0: 2020 2072 6574 7572 6e20 7365 6c66 2e69     return self.i
+000009e0: 6e74 6567 6572 202b 2073 656c 662e 6672  nteger + self.fr
+000009f0: 6163 7469 6f6e 0d0a 2020 2020 0d0a 2020  action..    ..  
+00000a00: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00000a10: 2064 6566 2075 6e69 7428 7365 6c66 2920   def unit(self) 
+00000a20: 2d3e 2073 7472 3a0d 0a20 2020 2020 2020  -> str:..       
+00000a30: 2075 6e69 7420 3d20 7365 6c66 2e5f 5f6d   unit = self.__m
+00000a40: 6174 6368 2e67 726f 7570 2822 756e 6974  atch.group("unit
+00000a50: 2229 0d0a 2020 2020 2020 2020 6966 2075  ")..        if u
+00000a60: 6e69 7420 6973 204e 6f6e 653a 0d0a 2020  nit is None:..  
+00000a70: 2020 2020 2020 2020 2020 756e 6974 203d            unit =
+00000a80: 2022 7322 0d0a 2020 2020 2020 2020 7265   "s"..        re
+00000a90: 7475 726e 2075 6e69 740d 0a20 2020 200d  turn unit..    .
+00000aa0: 0a20 2020 2064 6566 2074 6f5f 7365 636f  .    def to_seco
+00000ab0: 6e64 7328 7365 6c66 293a 0d0a 2020 2020  nds(self):..    
+00000ac0: 2020 2020 6966 2073 656c 662e 756e 6974      if self.unit
+00000ad0: 203d 3d20 226e 7322 3a0d 0a20 2020 2020   == "ns":..     
+00000ae0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00000af0: 6c66 2e76 616c 7565 202f 2031 6539 0d0a  lf.value / 1e9..
+00000b00: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00000b10: 662e 756e 6974 203d 3d20 2275 7322 3a0d  f.unit == "us":.
+00000b20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00000b30: 7572 6e20 7365 6c66 2e76 616c 7565 202f  urn self.value /
+00000b40: 2031 6536 0d0a 0d0a 2020 2020 2020 2020   1e6....        
+00000b50: 6966 2073 656c 662e 756e 6974 203d 3d20  if self.unit == 
+00000b60: 226d 7322 3a0d 0a20 2020 2020 2020 2020  "ms":..         
+00000b70: 2020 2072 6574 7572 6e20 7365 6c66 2e76     return self.v
+00000b80: 616c 7565 202f 2031 6533 0d0a 0d0a 2020  alue / 1e3....  
+00000b90: 2020 2020 2020 6966 2073 656c 662e 756e        if self.un
+00000ba0: 6974 203d 3d20 2273 223a 0d0a 2020 2020  it == "s":..    
+00000bb0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00000bc0: 656c 662e 7661 6c75 650d 0a0d 0a20 2020  elf.value....   
+00000bd0: 2020 2020 2069 6620 7365 6c66 2e75 6e69       if self.uni
+00000be0: 7420 3d3d 2022 6d22 3a0d 0a20 2020 2020  t == "m":..     
+00000bf0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00000c00: 6c66 2e76 616c 7565 202a 2036 300d 0a20  lf.value * 60.. 
+00000c10: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00000c20: 2069 6620 7365 6c66 2e75 6e69 7420 3d3d   if self.unit ==
+00000c30: 2022 6822 3a0d 0a20 2020 2020 2020 2020   "h":..         
+00000c40: 2020 2072 6574 7572 6e20 7365 6c66 2e76     return self.v
+00000c50: 616c 7565 202a 2036 3020 2a20 3630 0d0a  alue * 60 * 60..
+00000c60: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00000c70: 2020 6966 2073 656c 662e 756e 6974 203d    if self.unit =
+00000c80: 3d20 2264 223a 0d0a 2020 2020 2020 2020  = "d":..        
+00000c90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00000ca0: 7661 6c75 6520 2a20 3630 202a 2036 3020  value * 60 * 60 
+00000cb0: 2a20 3234 0d0a 2020 2020 2020 2020 0d0a  * 24..        ..
+00000cc0: 2020 2020 6465 6620 5f5f 6571 5f5f 2873      def __eq__(s
+00000cd0: 656c 662c 206f 7468 6572 3a20 2256 6175  elf, other: "Vau
+00000ce0: 6c74 4475 7261 7469 6f6e 2229 202d 3e20  ltDuration") -> 
+00000cf0: 626f 6f6c 3a0d 0a20 2020 2020 2020 2069  bool:..        i
+00000d00: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00000d10: 286f 7468 6572 2c20 5661 756c 7444 7572  (other, VaultDur
+00000d20: 6174 696f 6e29 3a0d 0a20 2020 2020 2020  ation):..       
+00000d30: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00000d40: 7272 6f72 2866 2255 6e73 7570 706f 7274  rror(f"Unsupport
+00000d50: 6564 206f 7065 7261 6e64 2074 7970 6528  ed operand type(
+00000d60: 7329 2066 6f72 203d 3d3a 2027 7b74 7970  s) for ==: '{typ
+00000d70: 6528 7365 6c66 292e 5f5f 6e61 6d65 5f5f  e(self).__name__
+00000d80: 7d27 2061 6e64 2027 7b74 7970 6528 6f74  }' and '{type(ot
+00000d90: 6865 7229 2e5f 5f6e 616d 655f 5f7d 2722  her).__name__}'"
+00000da0: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00000db0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00000dc0: 2e74 6f5f 7365 636f 6e64 7328 2920 3d3d  .to_seconds() ==
+00000dd0: 206f 7468 6572 2e74 6f5f 7365 636f 6e64   other.to_second
+00000de0: 7328 290d 0a20 2020 200d 0a20 2020 2064  s()..    ..    d
+00000df0: 6566 205f 5f6e 655f 5f28 7365 6c66 2c20  ef __ne__(self, 
+00000e00: 6f74 6865 723a 2022 5661 756c 7444 7572  other: "VaultDur
+00000e10: 6174 696f 6e22 2920 2d3e 2062 6f6f 6c3a  ation") -> bool:
+00000e20: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00000e30: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+00000e40: 722c 2056 6175 6c74 4475 7261 7469 6f6e  r, VaultDuration
+00000e50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00000e60: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00000e70: 6622 556e 7375 7070 6f72 7465 6420 6f70  f"Unsupported op
+00000e80: 6572 616e 6420 7479 7065 2873 2920 666f  erand type(s) fo
+00000e90: 7220 213d 3a20 277b 7479 7065 2873 656c  r !=: '{type(sel
+00000ea0: 6629 2e5f 5f6e 616d 655f 5f7d 2720 616e  f).__name__}' an
+00000eb0: 6420 277b 7479 7065 286f 7468 6572 292e  d '{type(other).
+00000ec0: 5f5f 6e61 6d65 5f5f 7d27 2229 0d0a 2020  __name__}'")..  
+00000ed0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00000ee0: 7265 7475 726e 2073 656c 662e 746f 5f73  return self.to_s
+00000ef0: 6563 6f6e 6473 2829 2021 3d20 6f74 6865  econds() != othe
+00000f00: 722e 746f 5f73 6563 6f6e 6473 2829 0d0a  r.to_seconds()..
+00000f10: 2020 2020 0d0a 2020 2020 6465 6620 5f5f      ..    def __
+00000f20: 6c74 5f5f 2873 656c 662c 206f 7468 6572  lt__(self, other
+00000f30: 3a20 2256 6175 6c74 4475 7261 7469 6f6e  : "VaultDuration
+00000f40: 2229 202d 3e20 626f 6f6c 3a0d 0a20 2020  ") -> bool:..   
+00000f50: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00000f60: 7374 616e 6365 286f 7468 6572 2c20 5661  stance(other, Va
+00000f70: 756c 7444 7572 6174 696f 6e29 3a0d 0a20  ultDuration):.. 
+00000f80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00000f90: 2054 7970 6545 7272 6f72 2866 2255 6e73   TypeError(f"Uns
+00000fa0: 7570 706f 7274 6564 206f 7065 7261 6e64  upported operand
+00000fb0: 2074 7970 6528 7329 2066 6f72 203c 3a20   type(s) for <: 
+00000fc0: 277b 7479 7065 2873 656c 6629 2e5f 5f6e  '{type(self).__n
+00000fd0: 616d 655f 5f7d 2720 616e 6420 277b 7479  ame__}' and '{ty
+00000fe0: 7065 286f 7468 6572 292e 5f5f 6e61 6d65  pe(other).__name
+00000ff0: 5f5f 7d27 2229 0d0a 2020 2020 2020 2020  __}'")..        
+00001000: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00001010: 2073 656c 662e 746f 5f73 6563 6f6e 6473   self.to_seconds
+00001020: 2829 203c 206f 7468 6572 2e74 6f5f 7365  () < other.to_se
+00001030: 636f 6e64 7328 290d 0a20 2020 200d 0a20  conds()..    .. 
+00001040: 2020 2064 6566 205f 5f6c 655f 5f28 7365     def __le__(se
+00001050: 6c66 2c20 6f74 6865 723a 2022 5661 756c  lf, other: "Vaul
+00001060: 7444 7572 6174 696f 6e22 2920 2d3e 2062  tDuration") -> b
+00001070: 6f6f 6c3a 0d0a 2020 2020 2020 2020 6966  ool:..        if
+00001080: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00001090: 6f74 6865 722c 2056 6175 6c74 4475 7261  other, VaultDura
+000010a0: 7469 6f6e 293a 0d0a 2020 2020 2020 2020  tion):..        
+000010b0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+000010c0: 726f 7228 6622 556e 7375 7070 6f72 7465  ror(f"Unsupporte
+000010d0: 6420 6f70 6572 616e 6420 7479 7065 2873  d operand type(s
+000010e0: 2920 666f 7220 3c3d 3a20 277b 7479 7065  ) for <=: '{type
+000010f0: 2873 656c 6629 2e5f 5f6e 616d 655f 5f7d  (self).__name__}
+00001100: 2720 616e 6420 277b 7479 7065 286f 7468  ' and '{type(oth
+00001110: 6572 292e 5f5f 6e61 6d65 5f5f 7d27 2229  er).__name__}'")
+00001120: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00001130: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00001140: 746f 5f73 6563 6f6e 6473 2829 203c 3d20  to_seconds() <= 
+00001150: 6f74 6865 722e 746f 5f73 6563 6f6e 6473  other.to_seconds
+00001160: 2829 0d0a 2020 2020 0d0a 2020 2020 6465  ()..    ..    de
+00001170: 6620 5f5f 6774 5f5f 2873 656c 662c 206f  f __gt__(self, o
+00001180: 7468 6572 3a20 2256 6175 6c74 4475 7261  ther: "VaultDura
+00001190: 7469 6f6e 2229 202d 3e20 626f 6f6c 3a0d  tion") -> bool:.
+000011a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000011b0: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
+000011c0: 2c20 5661 756c 7444 7572 6174 696f 6e29  , VaultDuration)
+000011d0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000011e0: 6169 7365 2054 7970 6545 7272 6f72 2866  aise TypeError(f
+000011f0: 2255 6e73 7570 706f 7274 6564 206f 7065  "Unsupported ope
+00001200: 7261 6e64 2074 7970 6528 7329 2066 6f72  rand type(s) for
+00001210: 203e 3a20 277b 7479 7065 2873 656c 6629   >: '{type(self)
+00001220: 2e5f 5f6e 616d 655f 5f7d 2720 616e 6420  .__name__}' and 
+00001230: 277b 7479 7065 286f 7468 6572 292e 5f5f  '{type(other).__
+00001240: 6e61 6d65 5f5f 7d27 2229 0d0a 2020 2020  name__}'")..    
+00001250: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+00001260: 7475 726e 2073 656c 662e 746f 5f73 6563  turn self.to_sec
+00001270: 6f6e 6473 2829 203e 206f 7468 6572 2e74  onds() > other.t
+00001280: 6f5f 7365 636f 6e64 7328 290d 0a20 2020  o_seconds()..   
+00001290: 200d 0a20 2020 2064 6566 205f 5f67 655f   ..    def __ge_
+000012a0: 5f28 7365 6c66 2c20 6f74 6865 723a 2022  _(self, other: "
+000012b0: 5661 756c 7444 7572 6174 696f 6e22 2920  VaultDuration") 
+000012c0: 2d3e 2062 6f6f 6c3a 0d0a 2020 2020 2020  -> bool:..      
+000012d0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+000012e0: 6e63 6528 6f74 6865 722c 2056 6175 6c74  nce(other, Vault
+000012f0: 4475 7261 7469 6f6e 293a 0d0a 2020 2020  Duration):..    
+00001300: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00001310: 7065 4572 726f 7228 6622 556e 7375 7070  peError(f"Unsupp
+00001320: 6f72 7465 6420 6f70 6572 616e 6420 7479  orted operand ty
+00001330: 7065 2873 2920 666f 7220 3e3d 3a20 277b  pe(s) for >=: '{
+00001340: 7479 7065 2873 656c 6629 2e5f 5f6e 616d  type(self).__nam
+00001350: 655f 5f7d 2720 616e 6420 277b 7479 7065  e__}' and '{type
+00001360: 286f 7468 6572 292e 5f5f 6e61 6d65 5f5f  (other).__name__
+00001370: 7d27 2229 0d0a 2020 2020 2020 2020 0d0a  }'")..        ..
+00001380: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001390: 656c 662e 746f 5f73 6563 6f6e 6473 2829  elf.to_seconds()
+000013a0: 203e 3d20 6f74 6865 722e 746f 5f73 6563   >= other.to_sec
+000013b0: 6f6e 6473 2829 0d0a 2020 2020 0d0a 2020  onds()..    ..  
+000013c0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
+000013d0: 6c66 2920 2d3e 2073 7472 3a0d 0a20 2020  lf) -> str:..   
+000013e0: 2020 2020 2072 6574 7572 6e20 6622 7b73       return f"{s
+000013f0: 656c 662e 7661 6c75 657d 7b73 656c 662e  elf.value}{self.
+00001400: 756e 6974 7d22 0d0a 0d0a 0d0a 636c 6173  unit}"......clas
+00001410: 7320 5f56 6175 6c74 4854 5450 4150 493a  s _VaultHTTPAPI:
+00001420: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00001430: 5f5f 2873 656c 662c 200d 0a20 2020 2020  __(self, ..     
+00001440: 2020 2020 2020 2020 2020 2020 7572 6c3a              url:
+00001450: 2073 7472 2c20 0d0a 2020 2020 2020 2020   str, ..        
+00001460: 2020 2020 2020 2020 2061 7574 685f 6366           auth_cf
+00001470: 673a 2055 6e69 6f6e 5b64 6963 742c 2043  g: Union[dict, C
+00001480: 6f6e 6669 6744 6963 745d 2c0d 0a20 2020  onfigDict],..   
+00001490: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000014a0: 6566 6978 3a20 7374 7220 3d20 222f 7631  efix: str = "/v1
+000014b0: 2f22 2c0d 0a20 2020 2020 2020 2020 2020  /",..           
+000014c0: 2020 2020 2020 776f 726b 5f64 6972 3a20        work_dir: 
+000014d0: 4f70 7469 6f6e 616c 5b50 6174 684c 696b  Optional[PathLik
+000014e0: 6554 7970 655d 203d 204e 6f6e 652c 0d0a  eType] = None,..
+000014f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001500: 206c 6f67 6765 723a 204f 7074 696f 6e61   logger: Optiona
+00001510: 6c5b 4c6f 6767 6572 5d20 3d20 4e6f 6e65  l[Logger] = None
+00001520: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00001530: 2020 2020 7175 6965 743a 2062 6f6f 6c20      quiet: bool 
+00001540: 3d20 4661 6c73 6529 3a0d 0a20 2020 2020  = False):..     
+00001550: 2020 2022 2222 5661 756c 7420 4854 5450     """Vault HTTP
+00001560: 2041 5049 0d0a 2020 2020 2020 2020 5265   API..        Re
+00001570: 6665 7220 746f 2068 7474 7073 3a2f 2f64  fer to https://d
+00001580: 6576 656c 6f70 6572 2e68 6173 6869 636f  eveloper.hashico
+00001590: 7270 2e63 6f6d 2f76 6175 6c74 2f61 7069  rp.com/vault/api
+000015a0: 2d64 6f63 7320 666f 7220 6d6f 7265 2064  -docs for more d
+000015b0: 6574 6169 6c73 2e0d 0a0d 0a20 2020 2020  etails.....     
+000015c0: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+000015d0: 2020 2020 2020 7572 6c20 2873 7472 290d        url (str).
+000015e0: 0a20 2020 2020 2020 2020 2020 2061 7574  .            aut
+000015f0: 685f 6366 6720 2855 6e69 6f6e 5b43 6f6e  h_cfg (Union[Con
+00001600: 6669 6744 6963 742c 2064 6963 745d 293a  figDict, dict]):
+00001610: 2061 7574 686f 7269 7a61 7469 6f6e 2063   authorization c
+00001620: 6f6e 6669 672e 0d0a 2020 2020 2020 2020  onfig...        
+00001630: 2020 2020 7072 6566 6978 2028 7374 722c      prefix (str,
+00001640: 206f 7074 696f 6e61 6c29 3a20 6375 7272   optional): curr
+00001650: 656e 746c 7920 616c 6c20 4150 4920 726f  ently all API ro
+00001660: 7574 6573 2070 7265 6669 7865 6420 7769  utes prefixed wi
+00001670: 7468 202f 7631 2f2e 2044 6566 6175 6c74  th /v1/. Default
+00001680: 7320 746f 2022 2f76 312f 222e 0d0a 2020  s to "/v1/"...  
+00001690: 2020 2020 2020 2020 2020 776f 726b 5f64            work_d
+000016a0: 6972 2028 4f70 7469 6f6e 616c 5b50 6174  ir (Optional[Pat
+000016b0: 684c 696b 6554 7970 655d 2c20 6f70 7469  hLikeType], opti
+000016c0: 6f6e 616c 293a 2077 696c 6c20 7361 7665  onal): will save
+000016d0: 2074 6865 206c 6f67 2066 696c 6520 746f   the log file to
+000016e0: 2022 776f 726b 5f64 6972 2f6c 6f67 2f22   "work_dir/log/"
+000016f0: 2069 6620 0d0a 2020 2020 2020 2020 2020   if ..          
+00001700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001720: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00001730: 6f72 6b5f 6469 7220 6973 2073 7065 6369  ork_dir is speci
+00001740: 6669 6564 2e20 4465 6661 756c 7473 2074  fied. Defaults t
+00001750: 6f20 4e6f 6e65 2e0d 0a20 2020 2020 2020  o None...       
+00001760: 2020 2020 206c 6f67 6765 7220 284f 7074       logger (Opt
+00001770: 696f 6e61 6c5b 4c6f 6767 6572 5d2c 206f  ional[Logger], o
+00001780: 7074 696f 6e61 6c29 3a20 4465 6661 756c  ptional): Defaul
+00001790: 7473 2074 6f20 4e6f 6e65 2e0d 0a20 2020  ts to None...   
+000017a0: 2020 2020 2020 2020 2071 7569 6574 2028           quiet (
+000017b0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+000017c0: 2077 6865 7468 6572 2074 6865 206c 6f67   whether the log
+000017d0: 6765 7220 746f 2072 756e 2069 6e20 7175  ger to run in qu
+000017e0: 6965 7420 6d6f 6465 2e20 4465 6661 756c  iet mode. Defaul
+000017f0: 7473 2074 6f20 4661 6c73 652e 0d0a 2020  ts to False...  
+00001800: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00001810: 2020 2073 656c 662e 776f 726b 5f64 6972     self.work_dir
+00001820: 203d 2050 6174 6828 776f 726b 5f64 6972   = Path(work_dir
+00001830: 2920 6966 2077 6f72 6b5f 6469 7220 6973  ) if work_dir is
+00001840: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
+00001850: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
+00001860: 662e 6c6f 6767 6572 203d 2073 656c 662e  f.logger = self.
+00001870: 5f73 6574 5f6c 6f67 6765 7228 6c6f 6767  _set_logger(logg
+00001880: 6572 2c20 7175 6965 7429 0d0a 0d0a 2020  er, quiet)....  
+00001890: 2020 2020 2020 6173 7365 7274 2070 7265        assert pre
+000018a0: 6669 7820 3d3d 2022 2f76 312f 222c 2022  fix == "/v1/", "
+000018b0: 7631 2069 7320 6375 7272 656e 746c 7920  v1 is currently 
+000018c0: 7468 6520 6f6e 6c79 2041 5049 2076 6572  the only API ver
+000018d0: 7369 6f6e 2066 6f72 2048 6173 6869 436f  sion for HashiCo
+000018e0: 7270 2056 6175 6c74 2e22 0d0a 2020 2020  rp Vault."..    
+000018f0: 2020 2020 7365 6c66 2e73 7570 706f 7274      self.support
+00001900: 5f61 7574 685f 6d65 7468 6f64 7320 3d20  _auth_methods = 
+00001910: 5b22 746f 6b65 6e22 2c20 2275 7365 7270  ["token", "userp
+00001920: 6173 7322 5d0d 0a20 2020 2020 2020 200d  ass"]..        .
+00001930: 0a20 2020 2020 2020 2075 726c 203d 2075  .        url = u
+00001940: 726c 2e72 7374 7269 7028 272f 2729 202b  rl.rstrip('/') +
+00001950: 2070 7265 6669 780d 0a20 2020 2020 2020   prefix..       
+00001960: 2073 656c 662e 5f6b 6579 5f6c 656e 203d   self._key_len =
+00001970: 2032 340d 0a20 2020 2020 2020 2073 656c   24..        sel
+00001980: 662e 5f73 6565 6420 3d20 7261 6e64 6f6d  f._seed = random
+00001990: 2e72 616e 6469 6e74 2830 2c20 3165 3130  .randint(0, 1e10
+000019a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000019b0: 6973 5f61 7574 682c 2073 656c 662e 7572  is_auth, self.ur
+000019c0: 6c2c 2073 656c 662e 746f 6b65 6e20 3d20  l, self.token = 
+000019d0: 7365 6c66 2e5f 5f61 7574 686f 7269 7a65  self.__authorize
+000019e0: 2875 726c 2c20 6175 7468 5f63 6667 290d  (url, auth_cfg).
+000019f0: 0a0d 0a20 2020 2064 6566 205f 5f61 7574  ...    def __aut
+00001a00: 686f 7269 7a65 2873 656c 662c 2075 726c  horize(self, url
+00001a10: 3a20 7374 722c 2061 7574 685f 6366 673a  : str, auth_cfg:
+00001a20: 2055 6e69 6f6e 5b43 6f6e 6669 6744 6963   Union[ConfigDic
+00001a30: 742c 2064 6963 745d 293a 0d0a 2020 2020  t, dict]):..    
+00001a40: 2020 2020 6175 7468 5f63 6667 203d 2043      auth_cfg = C
+00001a50: 6f6e 6669 6744 6963 7428 6175 7468 5f63  onfigDict(auth_c
+00001a60: 6667 290d 0a20 2020 2020 2020 2061 7574  fg)..        aut
+00001a70: 685f 6d65 7468 6f64 203d 2061 7574 685f  h_method = auth_
+00001a80: 6366 672e 706f 7028 226d 6574 686f 6422  cfg.pop("method"
+00001a90: 2c20 2274 6f6b 656e 2229 0d0a 2020 2020  , "token")..    
+00001aa0: 2020 2020 6173 7365 7274 2061 7574 685f      assert auth_
+00001ab0: 6d65 7468 6f64 2069 6e20 7365 6c66 2e73  method in self.s
+00001ac0: 7570 706f 7274 5f61 7574 685f 6d65 7468  upport_auth_meth
+00001ad0: 6f64 732c 2066 2275 6e73 7570 706f 7274  ods, f"unsupport
+00001ae0: 6564 2061 7574 6820 6d65 7468 6f64 3a20  ed auth method: 
+00001af0: 7b61 7574 685f 6d65 7468 6f64 7d22 0d0a  {auth_method}"..
+00001b00: 0d0a 2020 2020 2020 2020 6966 2061 7574  ..        if aut
+00001b10: 685f 6d65 7468 6f64 203d 3d20 2274 6f6b  h_method == "tok
+00001b20: 656e 223a 0d0a 2020 2020 2020 2020 2020  en":..          
+00001b30: 2020 746f 6b65 6e20 3d20 6175 7468 5f63    token = auth_c
+00001b40: 6667 2e74 6f6b 656e 0d0a 2020 2020 2020  fg.token..      
+00001b50: 2020 2020 2020 7265 7320 3d20 7265 7175        res = requ
+00001b60: 6573 7473 2e67 6574 2875 726c 2b22 6175  ests.get(url+"au
+00001b70: 7468 2f74 6f6b 656e 2f6c 6f6f 6b75 702d  th/token/lookup-
+00001b80: 7365 6c66 222c 2068 6561 6465 7273 3d7b  self", headers={
+00001b90: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
+00001ba0: 2074 6f6b 656e 7d29 0d0a 2020 2020 2020   token})..      
+00001bb0: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
+00001bc0: 7475 735f 636f 6465 203d 3d20 3230 303a  tus_code == 200:
+00001bd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001be0: 2020 6973 5f61 7574 6820 3d20 5472 7565    is_auth = True
+00001bf0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00001c00: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00001c10: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
+00001c20: 7272 6f72 5f72 6573 706f 6e73 6528 5f5f  rror_response(__
+00001c30: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00001c40: 2c20 7265 732c 2022 7661 756c 7420 636f  , res, "vault co
+00001c50: 6e6e 6563 7420 6661 696c 6564 2229 0d0a  nnect failed")..
+00001c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c70: 6973 5f61 7574 6820 3d20 4661 6c73 650d  is_auth = False.
+00001c80: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00001c90: 2020 2069 6620 6175 7468 5f6d 6574 686f     if auth_metho
+00001ca0: 6420 3d3d 2022 7573 6572 7061 7373 223a  d == "userpass":
+00001cb0: 0d0a 2020 2020 2020 2020 2020 2020 7573  ..            us
+00001cc0: 6572 6e61 6d65 203d 2061 7574 685f 6366  ername = auth_cf
+00001cd0: 672e 7573 6572 6e61 6d65 0d0a 2020 2020  g.username..    
+00001ce0: 2020 2020 2020 2020 7061 7373 776f 7264          password
+00001cf0: 203d 2061 7574 685f 6366 672e 7061 7373   = auth_cfg.pass
+00001d00: 776f 7264 0d0a 2020 2020 2020 2020 2020  word..          
+00001d10: 2020 7265 7320 3d20 7265 7175 6573 7473    res = requests
+00001d20: 2e70 6f73 7428 7572 6c2b 6622 6175 7468  .post(url+f"auth
+00001d30: 2f75 7365 7270 6173 732f 6c6f 6769 6e2f  /userpass/login/
+00001d40: 7b75 7365 726e 616d 657d 222c 2064 6174  {username}", dat
+00001d50: 613d 7b22 7061 7373 776f 7264 223a 2070  a={"password": p
+00001d60: 6173 7377 6f72 647d 290d 0a20 2020 2020  assword})..     
+00001d70: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
+00001d80: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
+00001d90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00001da0: 2020 2069 735f 6175 7468 203d 2054 7275     is_auth = Tru
+00001db0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00001dc0: 2020 2074 6f6b 656e 203d 2072 6573 2e6a     token = res.j
+00001dd0: 736f 6e28 295b 2261 7574 6822 5d5b 2263  son()["auth"]["c
+00001de0: 6c69 656e 745f 746f 6b65 6e22 5d0d 0a20  lient_token"].. 
+00001df0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00001e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001e10: 2020 7365 6c66 2e5f 6c6f 675f 6572 726f    self._log_erro
+00001e20: 725f 7265 7370 6f6e 7365 285f 5f63 6c61  r_response(__cla
+00001e30: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
+00001e40: 6573 2c20 2276 6175 6c74 2063 6f6e 6e65  es, "vault conne
+00001e50: 6374 2066 6169 6c65 6422 290d 0a20 2020  ct failed")..   
+00001e60: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+00001e70: 6175 7468 203d 2046 616c 7365 0d0a 0d0a  auth = False....
+00001e80: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00001e90: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
+00001ea0: 2020 2020 2075 726c 203d 204e 6f6e 650d       url = None.
+00001eb0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+00001ec0: 656e 203d 204e 6f6e 650d 0a20 2020 2020  en = None..     
+00001ed0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00001ee0: 2020 2020 2020 7572 6c20 3d20 6165 735f        url = aes_
+00001ef0: 656e 6372 7970 745f 7465 7874 2875 726c  encrypt_text(url
+00001f00: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+00001f10: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+00001f20: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00001f30: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00001f40: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+00001f50: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+00001f60: 656e 203d 2061 6573 5f65 6e63 7279 7074  en = aes_encrypt
+00001f70: 5f74 6578 7428 746f 6b65 6e2c 206b 6579  _text(token, key
+00001f80: 3d72 616e 646f 6d5f 6865 7828 7365 6c66  =random_hex(self
+00001f90: 2e5f 6b65 795f 6c65 6e2c 2073 656c 662e  ._key_len, self.
+00001fa0: 5f73 6565 642a 3229 2c20 6976 3d72 616e  _seed*2), iv=ran
+00001fb0: 646f 6d5f 6865 7828 3136 2c20 7365 6c66  dom_hex(16, self
+00001fc0: 2e5f 7365 6564 2a33 2929 0d0a 0d0a 2020  ._seed*3))....  
+00001fd0: 2020 2020 2020 7265 7475 726e 2069 735f        return is_
+00001fe0: 6175 7468 2c20 7572 6c2c 2074 6f6b 656e  auth, url, token
+00001ff0: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
+00002000: 5f6c 6f67 5f65 7272 6f72 5f72 6573 706f  _log_error_respo
+00002010: 6e73 6528 7365 6c66 2c20 6d6f 6475 6c65  nse(self, module
+00002020: 5f6e 616d 653a 2073 7472 2c20 7265 7370  _name: str, resp
+00002030: 6f6e 7365 3a20 7265 7175 6573 7473 2e52  onse: requests.R
+00002040: 6573 706f 6e73 652c 206c 6f67 5f74 6578  esponse, log_tex
+00002050: 743a 2073 7472 293a 0d0a 2020 2020 2020  t: str):..      
+00002060: 2020 7265 735f 6469 6374 203d 2043 6f6e    res_dict = Con
+00002070: 6669 6744 6963 7428 7265 7370 6f6e 7365  figDict(response
+00002080: 2e6a 736f 6e28 2929 0d0a 2020 2020 2020  .json())..      
+00002090: 2020 6572 726f 7273 203d 2072 6573 5f64    errors = res_d
+000020a0: 6963 742e 6572 726f 7273 0d0a 2020 2020  ict.errors..    
+000020b0: 2020 2020 7761 726e 696e 6773 203d 2072      warnings = r
+000020c0: 6573 5f64 6963 742e 7761 726e 696e 6773  es_dict.warnings
+000020d0: 0d0a 2020 2020 2020 2020 6966 2065 7272  ..        if err
+000020e0: 6f72 7320 6973 206e 6f74 204e 6f6e 653a  ors is not None:
+000020f0: 0d0a 2020 2020 2020 2020 2020 2020 6572  ..            er
+00002100: 726f 725f 7465 7874 203d 2022 222e 6a6f  ror_text = "".jo
+00002110: 696e 2865 7272 6f72 7329 0d0a 2020 2020  in(errors)..    
+00002120: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00002130: 6765 722e 6572 726f 7228 6622 7b6d 6f64  ger.error(f"{mod
+00002140: 756c 655f 6e61 6d65 7d20 2d20 7b6c 6f67  ule_name} - {log
+00002150: 5f74 6578 747d 205b 7b72 6573 706f 6e73  _text} [{respons
+00002160: 652e 7374 6174 7573 5f63 6f64 657d 5d3a  e.status_code}]:
+00002170: 207b 6572 726f 725f 7465 7874 7d22 290d   {error_text}").
+00002180: 0a20 2020 2020 2020 2069 6620 7761 726e  .        if warn
+00002190: 696e 6773 2069 7320 6e6f 7420 4e6f 6e65  ings is not None
+000021a0: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
+000021b0: 6172 6e69 6e67 5f74 6578 7420 3d20 2222  arning_text = ""
+000021c0: 2e6a 6f69 6e28 7761 726e 696e 6773 290d  .join(warnings).
+000021d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000021e0: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
+000021f0: 227b 6d6f 6475 6c65 5f6e 616d 657d 202d  "{module_name} -
+00002200: 207b 6c6f 675f 7465 7874 7d20 5b7b 7265   {log_text} [{re
+00002210: 7370 6f6e 7365 2e73 7461 7475 735f 636f  sponse.status_co
+00002220: 6465 7d5d 3a20 7b77 6172 6e69 6e67 5f74  de}]: {warning_t
+00002230: 6578 747d 2229 0d0a 2020 2020 2020 2020  ext}")..        
+00002240: 0d0a 2020 2020 6465 6620 5f73 6574 5f6c  ..    def _set_l
+00002250: 6f67 6765 7228 7365 6c66 2c20 6c6f 6767  ogger(self, logg
+00002260: 6572 3a20 4f70 7469 6f6e 616c 5b4c 6f67  er: Optional[Log
+00002270: 6765 725d 2c20 7175 6965 743a 2062 6f6f  ger], quiet: boo
+00002280: 6c29 3a0d 0a20 2020 2020 2020 2069 6620  l):..        if 
+00002290: 6c6f 6767 6572 2069 7320 4e6f 6e65 3a0d  logger is None:.
+000022a0: 0a20 2020 2020 2020 2020 2020 206e 6f77  .            now
+000022b0: 5f74 696d 6520 3d20 6461 7465 7469 6d65  _time = datetime
+000022c0: 2e6e 6f77 2829 2e73 7472 6674 696d 6528  .now().strftime(
+000022d0: 2725 5925 6d25 642d 2548 254d 2553 2729  '%Y%m%d-%H%M%S')
+000022e0: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
+000022f0: 6767 6572 203d 204c 6f67 6765 7228 290d  gger = Logger().
+00002300: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002310: 7365 6c66 2e77 6f72 6b5f 6469 7220 6973  self.work_dir is
+00002320: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00002330: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00002340: 6572 2e69 6e69 745f 6c6f 6767 6572 2873  er.init_logger(s
+00002350: 6176 655f 7061 7468 3d73 656c 662e 776f  ave_path=self.wo
+00002360: 726b 5f64 6972 2f27 6c6f 6727 2f66 277b  rk_dir/'log'/f'{
+00002370: 6e6f 775f 7469 6d65 7d2e 6c6f 6727 290d  now_time}.log').
+00002380: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00002390: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000023a0: 2020 2020 6c6f 6767 6572 2e69 6e69 745f      logger.init_
+000023b0: 6c6f 6767 6572 2829 0d0a 2020 2020 2020  logger()..      
+000023c0: 2020 6966 2071 7569 6574 3a0d 0a20 2020    if quiet:..   
+000023d0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+000023e0: 7365 745f 7175 6965 7428 290d 0a20 2020  set_quiet()..   
+000023f0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00002400: 2020 2020 2020 2020 6c6f 6767 6572 2e73          logger.s
+00002410: 6574 5f61 6374 6976 6174 6528 290d 0a20  et_activate().. 
+00002420: 2020 2020 2020 2072 6574 7572 6e20 6c6f         return lo
+00002430: 6767 6572 0d0a 2020 2020 0d0a 0d0a 4053  gger..    ....@S
+00002440: 4543 5245 542e 7265 6769 7374 6572 5f6d  ECRET.register_m
+00002450: 6f64 756c 6528 290d 0a63 6c61 7373 2056  odule()..class V
+00002460: 6175 6c74 5365 6372 6574 456e 6769 6e65  aultSecretEngine
+00002470: 4b56 3128 5f56 6175 6c74 4854 5450 4150  KV1(_VaultHTTPAP
+00002480: 4929 3a0d 0a20 2020 2022 2222 4b56 2053  I):..    """KV S
+00002490: 6563 7265 7420 456e 6769 6e65 2028 7665  ecret Engine (ve
+000024a0: 7273 696f 6e20 3129 0d0a 2020 2020 5265  rsion 1)..    Re
+000024b0: 6665 7220 746f 2068 7474 7073 3a2f 2f64  fer to https://d
+000024c0: 6576 656c 6f70 6572 2e68 6173 6869 636f  eveloper.hashico
+000024d0: 7270 2e63 6f6d 2f76 6175 6c74 2f61 7069  rp.com/vault/api
+000024e0: 2d64 6f63 732f 7365 6372 6574 2f6b 762f  -docs/secret/kv/
+000024f0: 6b76 2d76 3120 666f 7220 6d6f 7265 2064  kv-v1 for more d
+00002500: 6574 6169 6c73 2e0d 0a0d 0a20 2020 2049  etails.....    I
+00002510: 6e69 743a 0d0a 2020 2020 2020 2020 636f  nit:..        co
+00002520: 6e6e 6563 7469 6e67 2077 6974 6820 746f  nnecting with to
+00002530: 6b65 6e3a 0d0a 2020 2020 2020 2020 3e3e  ken:..        >>
+00002540: 3e20 6b76 315f 656e 6769 6e65 203d 2056  > kv1_engine = V
+00002550: 6175 6c74 5365 6372 6574 456e 6769 6e65  aultSecretEngine
+00002560: 4b56 3128 0d0a 2020 2020 2020 2020 3e3e  KV1(..        >>
+00002570: 3e20 2020 2020 7572 6c3d 2268 7474 703a  >     url="http:
+00002580: 2f2f 3132 372e 302e 302e 313a 3832 3030  //127.0.0.1:8200
+00002590: 222c 200d 0a20 2020 2020 2020 203e 3e3e  ", ..        >>>
+000025a0: 2020 2020 2061 7574 685f 6366 673d 6469       auth_cfg=di
+000025b0: 6374 286d 6574 686f 643d 2274 6f6b 656e  ct(method="token
+000025c0: 222c 2074 6f6b 656e 3d22 544f 4b45 4e22  ", token="TOKEN"
+000025d0: 290d 0a20 2020 2020 2020 203e 3e3e 2029  )..        >>> )
+000025e0: 0d0a 0d0a 2020 2020 2020 2020 636f 6e6e  ....        conn
+000025f0: 6563 7469 6e67 2077 6974 6820 7573 6572  ecting with user
+00002600: 6e61 6d65 2026 2070 6173 7377 6f72 643a  name & password:
+00002610: 0d0a 2020 2020 2020 2020 3e3e 3e20 6b76  ..        >>> kv
+00002620: 315f 656e 6769 6e65 203d 2056 6175 6c74  1_engine = Vault
+00002630: 5365 6372 6574 456e 6769 6e65 4b56 3128  SecretEngineKV1(
+00002640: 0d0a 2020 2020 2020 2020 3e3e 3e20 2020  ..        >>>   
+00002650: 2020 7572 6c3d 2268 7474 703a 2f2f 3132    url="http://12
+00002660: 372e 302e 302e 313a 3832 3030 222c 0d0a  7.0.0.1:8200",..
+00002670: 2020 2020 2020 2020 3e3e 3e20 2020 2020          >>>     
+00002680: 6175 7468 5f63 6667 3d64 6963 7428 6d65  auth_cfg=dict(me
+00002690: 7468 6f64 3d22 7573 6572 7061 7373 222c  thod="userpass",
+000026a0: 2075 7365 726e 616d 653d 2275 7365 726e   username="usern
+000026b0: 616d 6522 2c20 7061 7373 776f 7264 3d22  ame", password="
+000026c0: 7061 7373 776f 7264 2229 0d0a 2020 2020  password")..    
+000026d0: 2020 2020 3e3e 3e20 290d 0a20 2020 2022      >>> )..    "
+000026e0: 2222 0d0a 0d0a 2020 2020 6465 6620 7265  ""....    def re
+000026f0: 6164 5f73 6563 7265 7428 7365 6c66 2c20  ad_secret(self, 
+00002700: 6d6f 756e 745f 7061 7468 3a20 7374 722c  mount_path: str,
+00002710: 2070 6174 683a 2073 7472 2c20 6b65 793a   path: str, key:
+00002720: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00002730: 204e 6f6e 6529 3a0d 0a20 2020 2020 2020   None):..       
+00002740: 2022 2222 7265 6164 2061 2073 6563 7265   """read a secre
+00002750: 7420 6672 6f6d 2022 6d6f 756e 745f 7061  t from "mount_pa
+00002760: 7468 2f70 6174 6822 0d0a 0d0a 2020 2020  th/path"....    
+00002770: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+00002780: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
+00002790: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
+000027a0: 2020 2020 2070 6174 6820 2873 7472 290d       path (str).
+000027b0: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
+000027c0: 2028 4f70 7469 6f6e 616c 5b73 7472 5d2c   (Optional[str],
+000027d0: 206f 7074 696f 6e61 6c29 3a20 6966 206b   optional): if k
+000027e0: 6579 2069 7320 4e6f 6e65 2c20 7265 7475  ey is None, retu
+000027f0: 726e 7320 616c 6c20 7365 6372 6574 7320  rns all secrets 
+00002800: 696e 2064 6963 7420 6672 6f6d 200d 0a20  in dict from .. 
+00002810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002830: 2020 2020 2020 2020 2020 226d 6f75 6e74            "mount
+00002840: 5f70 6174 682f 7061 7468 222c 2077 6869  _path/path", whi
+00002850: 6368 2069 7320 7468 6520 7361 6d65 2061  ch is the same a
+00002860: 7320 6c69 7374 5f73 6563 7265 7428 292e  s list_secret().
+00002870: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00002880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002890: 2020 2020 2020 2020 2020 2020 2020 4465                De
+000028a0: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0d  faults to None..
+000028b0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+000028c0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+000028d0: 2064 6963 743a 2072 6574 7572 6e20 6120   dict: return a 
+000028e0: 6469 6374 2069 6620 6b65 7920 6973 206e  dict if key is n
+000028f0: 6f74 2073 7065 6369 6669 6564 0d0a 2020  ot specified..  
+00002900: 2020 2020 2020 2020 2020 7374 7220 6f72            str or
+00002910: 2069 6e74 3a20 7265 7475 726e 2061 2073   int: return a s
+00002920: 7472 206f 7220 696e 7420 6966 206b 6579  tr or int if key
+00002930: 2069 7320 7370 6563 6966 6965 640d 0a20   is specified.. 
+00002940: 2020 2020 2020 2020 2020 204e 6f6e 653a             None:
+00002950: 2072 6574 7572 6e20 4e6f 6e65 2069 6620   return None if 
+00002960: 616e 2065 7272 6f72 206f 6363 7572 6564  an error occured
+00002970: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00002980: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00002990: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
+000029a0: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
+000029b0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+000029c0: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
+000029d0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+000029e0: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+000029f0: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+00002a00: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+00002a10: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00002a20: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
+00002a30: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
+00002a40: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
+00002a50: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+00002a60: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+00002a70: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+00002a80: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+00002a90: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00002aa0: 2072 6573 203d 2072 6571 7565 7374 732e   res = requests.
+00002ab0: 6765 7428 7572 6c2b 6622 7b6d 6f75 6e74  get(url+f"{mount
+00002ac0: 5f70 6174 687d 2f7b 7061 7468 7d22 2c20  _path}/{path}", 
+00002ad0: 6865 6164 6572 733d 7b22 582d 5661 756c  headers={"X-Vaul
+00002ae0: 742d 546f 6b65 6e22 3a20 746f 6b65 6e7d  t-Token": token}
+00002af0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00002b00: 6620 7265 732e 7374 6174 7573 5f63 6f64  f res.status_cod
+00002b10: 6520 3d3d 2032 3030 3a0d 0a20 2020 2020  e == 200:..     
+00002b20: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+00002b30: 3d20 7265 732e 6a73 6f6e 2829 5b22 6461  = res.json()["da
+00002b40: 7461 225d 0d0a 2020 2020 2020 2020 2020  ta"]..          
+00002b50: 2020 2020 2020 6966 206b 6579 2069 7320        if key is 
+00002b60: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00002b70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00002b80: 6e20 6461 7461 0d0a 2020 2020 2020 2020  n data..        
+00002b90: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00002ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002bb0: 2020 2069 6620 6b65 7920 696e 2064 6174     if key in dat
+00002bc0: 612e 6b65 7973 2829 3a0d 0a20 2020 2020  a.keys():..     
+00002bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002be0: 2020 2072 6574 7572 6e20 6461 7461 2e6b     return data.k
+00002bf0: 6579 0d0a 2020 2020 2020 2020 2020 2020  ey..            
+00002c00: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00002c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c20: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+00002c30: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+00002c40: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+00002c50: 2d20 7265 6164 2073 6563 7265 7420 6572  - read secret er
+00002c60: 726f 723a 206b 6579 2027 7b6b 6579 7d27  ror: key '{key}'
+00002c70: 206e 6f74 2066 6f75 6e64 2229 0d0a 2020   not found")..  
+00002c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c90: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00002ca0: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+00002cb0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00002cc0: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
+00002cd0: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
+00002ce0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00002cf0: 5f2c 2072 6573 2c20 2272 6561 6420 7365  _, res, "read se
+00002d00: 6372 6574 2065 7272 6f72 2229 0d0a 2020  cret error")..  
+00002d10: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00002d20: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+00002d30: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00002d40: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+00002d50: 2020 2020 2020 0d0a 2020 2020 6465 6620        ..    def 
+00002d60: 6c69 7374 5f73 6563 7265 7428 7365 6c66  list_secret(self
+00002d70: 2c20 6d6f 756e 745f 7061 7468 3a20 7374  , mount_path: st
+00002d80: 722c 2070 6174 683a 2073 7472 293a 0d0a  r, path: str):..
+00002d90: 2020 2020 2020 2020 2222 226c 6973 7420          """list 
+00002da0: 616c 6c20 7363 6572 6574 7320 6672 6f6d  all scerets from
+00002db0: 2022 6d6f 756e 745f 7061 7468 2f70 6174   "mount_path/pat
+00002dc0: 6822 0d0a 0d0a 2020 2020 2020 2020 4172  h"....        Ar
+00002dd0: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
+00002de0: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
+00002df0: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
+00002e00: 6174 6820 2873 7472 290d 0a0d 0a20 2020  ath (str)....   
+00002e10: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+00002e20: 2020 2020 2020 2020 2020 2064 6963 7420             dict 
+00002e30: 6f72 204e 6f6e 653a 2072 6574 7572 6e20  or None: return 
+00002e40: 6120 6469 6374 2069 6620 7375 6363 6573  a dict if succes
+00002e50: 732c 206f 7468 6572 7769 7365 2072 6574  s, otherwise ret
+00002e60: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+00002e70: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+00002e80: 6620 7365 6c66 2e69 735f 6175 7468 3a0d  f self.is_auth:.
+00002e90: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
+00002ea0: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
+00002eb0: 6578 7428 7365 6c66 2e75 726c 2c20 6b65  ext(self.url, ke
+00002ec0: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
+00002ed0: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
+00002ee0: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
+00002ef0: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
+00002f00: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
+00002f10: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
+00002f20: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+00002f30: 7428 7365 6c66 2e74 6f6b 656e 2c20 6b65  t(self.token, ke
+00002f40: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
+00002f50: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
+00002f60: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
+00002f70: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
+00002f80: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
+00002f90: 2020 2020 2020 2020 2072 6573 203d 2072           res = r
+00002fa0: 6571 7565 7374 732e 6765 7428 7572 6c2b  equests.get(url+
+00002fb0: 6622 7b6d 6f75 6e74 5f70 6174 687d 2f7b  f"{mount_path}/{
+00002fc0: 7061 7468 7d22 2c20 6865 6164 6572 733d  path}", headers=
+00002fd0: 7b22 582d 5661 756c 742d 546f 6b65 6e22  {"X-Vault-Token"
+00002fe0: 3a20 746f 6b65 6e2c 2022 6c69 7374 223a  : token, "list":
+00002ff0: 2022 7472 7565 227d 290d 0a20 2020 2020   "true"})..     
+00003000: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
+00003010: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
+00003020: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003030: 2020 2064 6174 6120 3d20 7265 732e 6a73     data = res.js
+00003040: 6f6e 2829 5b22 6461 7461 225d 0d0a 2020  on()["data"]..  
+00003050: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00003060: 7475 726e 2064 6174 610d 0a20 2020 2020  turn data..     
+00003070: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00003080: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003090: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+000030a0: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+000030b0: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+000030c0: 226c 6973 7420 7365 6372 6574 2065 7272  "list secret err
+000030d0: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
+000030e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+000030f0: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
+00003100: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00003110: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
+00003120: 6164 645f 7365 6372 6574 2873 656c 662c  add_secret(self,
+00003130: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
+00003140: 2c20 7061 7468 3a20 7374 722c 2073 6563  , path: str, sec
+00003150: 7265 7473 3a20 556e 696f 6e5b 6469 6374  rets: Union[dict
+00003160: 2c20 436f 6e66 6967 4469 6374 5d29 3a0d  , ConfigDict]):.
+00003170: 0a20 2020 2020 2020 2022 2222 6164 6420  .        """add 
+00003180: 7365 6372 6574 7320 746f 2022 6d6f 756e  secrets to "moun
+00003190: 745f 7061 7468 2f70 6174 6822 0d0a 2020  t_path/path"..  
+000031a0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000031b0: 596f 7520 646f 206e 6f74 206e 6565 6420  You do not need 
+000031c0: 746f 2073 7065 6369 6679 2061 6c6c 2074  to specify all t
+000031d0: 6865 2073 7562 6b65 7973 206f 6620 7365  he subkeys of se
+000031e0: 6372 6574 732c 206f 6e6c 7920 7468 6520  crets, only the 
+000031f0: 7375 626b 6579 7320 7468 6174 206e 6565  subkeys that nee
+00003200: 6420 746f 2062 6520 6164 6465 642c 2077  d to be added, w
+00003210: 6869 6368 2069 7320 636f 6e76 656e 6965  hich is convenie
+00003220: 6e74 2e0d 0a0d 0a20 2020 2020 2020 2041  nt.....        A
+00003230: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+00003240: 2020 6d6f 756e 745f 7061 7468 2028 7374    mount_path (st
+00003250: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+00003260: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
+00003270: 2020 2020 2020 2020 7365 6372 6574 7320          secrets 
+00003280: 2855 6e69 6f6e 5b64 6963 742c 2043 6f6e  (Union[dict, Con
+00003290: 6669 6744 6963 745d 290d 0a0d 0a20 2020  figDict])....   
+000032a0: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+000032b0: 2020 2020 2020 2020 2020 2062 6f6f 6c3a             bool:
+000032c0: 2072 6574 7572 6e20 5472 7565 2069 6620   return True if 
+000032d0: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
+000032e0: 7365 2072 6574 7572 6e20 4661 6c73 650d  se return False.
+000032f0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00003300: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+00003310: 5f61 7574 683a 0d0a 2020 2020 2020 2020  _auth:..        
+00003320: 2020 2020 6966 206e 6f74 2069 735f 6469      if not is_di
+00003330: 6374 2873 6563 7265 7473 293a 0d0a 2020  ct(secrets):..  
+00003340: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003350: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00003360: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
+00003370: 616d 655f 5f7d 202d 2061 6464 2073 6563  ame__} - add sec
+00003380: 7265 7420 6572 726f 723a 2073 6563 7265  ret error: secre
+00003390: 7473 206d 7573 7420 6265 2061 2064 6963  ts must be a dic
+000033a0: 7420 6f72 2043 6f6e 6669 6744 6963 7422  t or ConfigDict"
+000033b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000033c0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+000033d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000033e0: 6c65 6e28 6c69 7374 2873 6563 7265 7473  len(list(secrets
+000033f0: 2e6b 6579 7328 2929 2920 3d3d 2030 3a0d  .keys())) == 0:.
+00003400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003410: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+00003420: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+00003430: 5f5f 6e61 6d65 5f5f 7d20 2d20 6164 6420  __name__} - add 
+00003440: 7365 6372 6574 2065 7272 6f72 3a20 7365  secret error: se
+00003450: 6372 6574 7320 6d75 7374 206e 6f74 2062  crets must not b
+00003460: 6520 656d 7074 7922 290d 0a20 2020 2020  e empty")..     
+00003470: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003480: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
+00003490: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+000034a0: 2020 2065 7869 7374 735f 7365 6372 6574     exists_secret
+000034b0: 7320 3d20 7365 6c66 2e6c 6973 745f 7365  s = self.list_se
+000034c0: 6372 6574 286d 6f75 6e74 5f70 6174 682c  cret(mount_path,
+000034d0: 2070 6174 6829 0d0a 2020 2020 2020 2020   path)..        
+000034e0: 2020 2020 6966 2065 7869 7374 735f 7365      if exists_se
+000034f0: 6372 6574 7320 6973 206e 6f74 204e 6f6e  crets is not Non
+00003500: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00003510: 2020 2020 666f 7220 6b65 7920 696e 2065      for key in e
+00003520: 7869 7374 735f 7365 6372 6574 732e 6b65  xists_secrets.ke
+00003530: 7973 2829 3a0d 0a20 2020 2020 2020 2020  ys():..         
+00003540: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
+00003550: 7920 696e 2073 6563 7265 7473 2e6b 6579  y in secrets.key
+00003560: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+00003570: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003580: 6c66 2e6c 6f67 6765 722e 7761 726e 696e  lf.logger.warnin
+00003590: 6728 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  g(f"{__class__._
+000035a0: 5f6e 616d 655f 5f7d 202d 2061 6464 2073  _name__} - add s
+000035b0: 6563 7265 7420 6572 726f 723a 206b 6579  ecret error: key
+000035c0: 2027 7b6b 6579 7d27 2061 6c72 6561 6479   '{key}' already
+000035d0: 2065 7869 7374 7322 290d 0a20 2020 2020   exists")..     
+000035e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035f0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00003600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003610: 2020 2020 2073 6563 7265 7473 5b6b 6579       secrets[key
+00003620: 5d20 3d20 6578 6973 7473 5f73 6563 7265  ] = exists_secre
+00003630: 7473 5b6b 6579 5d0d 0a20 2020 2020 2020  ts[key]..       
+00003640: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00003650: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003660: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
+00003670: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00003680: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
+00003690: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
+000036a0: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
+000036b0: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
+000036c0: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
+000036d0: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
+000036e0: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
+000036f0: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
+00003700: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
+00003710: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
+00003720: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
+00003730: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
+00003740: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
+00003750: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
+00003760: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
+00003770: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
+00003780: 2020 2020 7365 6372 6574 732e 7570 6461      secrets.upda
+00003790: 7465 2865 7869 7374 735f 7365 6372 6574  te(exists_secret
+000037a0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+000037b0: 7265 7320 3d20 7265 7175 6573 7473 2e70  res = requests.p
+000037c0: 6f73 7428 7572 6c2b 6622 7b6d 6f75 6e74  ost(url+f"{mount
+000037d0: 5f70 6174 687d 2f7b 7061 7468 7d22 2c20  _path}/{path}", 
+000037e0: 6865 6164 6572 733d 7b22 582d 5661 756c  headers={"X-Vaul
+000037f0: 742d 546f 6b65 6e22 3a20 746f 6b65 6e7d  t-Token": token}
+00003800: 2c20 6461 7461 3d73 6563 7265 7473 290d  , data=secrets).
+00003810: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003820: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+00003830: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
+00003840: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
+00003850: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003860: 2020 2072 6574 7572 6e20 5472 7565 0d0a     return True..
+00003870: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00003880: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003890: 2020 2073 656c 662e 5f6c 6f67 5f65 7272     self._log_err
+000038a0: 6f72 5f72 6573 706f 6e73 6528 5f5f 636c  or_response(__cl
+000038b0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
+000038c0: 7265 732c 2022 6164 6420 7365 6372 6574  res, "add secret
+000038d0: 2065 7272 6f72 2229 0d0a 2020 2020 2020   error")..      
+000038e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000038f0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00003900: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00003910: 2046 616c 7365 0d0a 2020 2020 0d0a 2020   False..    ..  
+00003920: 2020 6465 6620 7570 6461 7465 5f73 6563    def update_sec
+00003930: 7265 7428 7365 6c66 2c20 6d6f 756e 745f  ret(self, mount_
+00003940: 7061 7468 3a20 7374 722c 2070 6174 683a  path: str, path:
+00003950: 2073 7472 2c20 7365 6372 6574 733a 2055   str, secrets: U
+00003960: 6e69 6f6e 5b64 6963 742c 2043 6f6e 6669  nion[dict, Confi
+00003970: 6744 6963 745d 293a 0d0a 2020 2020 2020  gDict]):..      
+00003980: 2020 2222 2275 7064 6174 6520 7468 6520    """update the 
+00003990: 6578 6973 7469 6e67 2073 6563 7265 7420  existing secret 
+000039a0: 696e 2022 6d6f 756e 745f 7061 7468 2f70  in "mount_path/p
+000039b0: 6174 6822 0d0a 2020 2020 2020 2020 0d0a  ath"..        ..
+000039c0: 2020 2020 2020 2020 596f 7520 646f 206e          You do n
+000039d0: 6f74 206e 6565 6420 746f 2073 7065 6369  ot need to speci
+000039e0: 6679 2061 6c6c 2074 6865 2073 7562 6b65  fy all the subke
+000039f0: 7973 206f 6620 7365 6372 6574 732c 206f  ys of secrets, o
+00003a00: 6e6c 7920 7468 6520 7375 626b 6579 7320  nly the subkeys 
+00003a10: 7468 6174 206e 6565 6420 746f 2062 6520  that need to be 
+00003a20: 7570 6461 7465 642c 2077 6869 6368 2069  updated, which i
+00003a30: 7320 636f 6e76 656e 6965 6e74 2e0d 0a0d  s convenient....
+00003a40: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
+00003a50: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
+00003a60: 745f 7061 7468 2028 7374 7229 0d0a 2020  t_path (str)..  
+00003a70: 2020 2020 2020 2020 2020 7061 7468 2028            path (
+00003a80: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
+00003a90: 2020 7365 6372 6574 7320 2855 6e69 6f6e    secrets (Union
+00003aa0: 5b64 6963 742c 2043 6f6e 6669 6744 6963  [dict, ConfigDic
+00003ab0: 745d 290d 0a0d 0a20 2020 2020 2020 2052  t])....        R
+00003ac0: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
+00003ad0: 2020 2020 2062 6f6f 6c3a 2072 6574 7572       bool: retur
+00003ae0: 6e20 5472 7565 2069 6620 7375 6363 6573  n True if succes
+00003af0: 732c 206f 7468 6572 7769 7365 2072 6574  s, otherwise ret
+00003b00: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+00003b10: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00003b20: 6966 2073 656c 662e 6973 5f61 7574 683a  if self.is_auth:
+00003b30: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00003b40: 206e 6f74 2069 735f 6469 6374 2873 6563   not is_dict(sec
+00003b50: 7265 7473 293a 0d0a 2020 2020 2020 2020  rets):..        
+00003b60: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00003b70: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+00003b80: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00003b90: 202d 2075 7064 6174 6520 7365 6372 6574   - update secret
+00003ba0: 2065 7272 6f72 3a20 7365 6372 6574 7320   error: secrets 
+00003bb0: 6d75 7374 2062 6520 6120 6469 6374 206f  must be a dict o
+00003bc0: 7220 436f 6e66 6967 4469 6374 2229 0d0a  r ConfigDict")..
+00003bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003be0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+00003bf0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00003c00: 286c 6973 7428 7365 6372 6574 732e 6b65  (list(secrets.ke
+00003c10: 7973 2829 2929 203d 3d20 303a 0d0a 2020  ys())) == 0:..  
+00003c20: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003c30: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00003c40: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
+00003c50: 616d 655f 5f7d 202d 2075 7064 6174 6520  ame__} - update 
+00003c60: 7365 6372 6574 2065 7272 6f72 3a20 7365  secret error: se
+00003c70: 6372 6574 7320 6d75 7374 206e 6f74 2062  crets must not b
+00003c80: 6520 656d 7074 7922 290d 0a20 2020 2020  e empty")..     
+00003c90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003ca0: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
+00003cb0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00003cc0: 2020 2065 7869 7374 735f 7365 6372 6574     exists_secret
+00003cd0: 7320 3d20 7365 6c66 2e6c 6973 745f 7365  s = self.list_se
+00003ce0: 6372 6574 286d 6f75 6e74 5f70 6174 682c  cret(mount_path,
+00003cf0: 2070 6174 6829 0d0a 2020 2020 2020 2020   path)..        
+00003d00: 2020 2020 6966 2065 7869 7374 735f 7365      if exists_se
+00003d10: 6372 6574 7320 6973 206e 6f74 204e 6f6e  crets is not Non
+00003d20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00003d30: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
+00003d40: 6563 7265 7473 2e6b 6579 7328 293a 0d0a  ecrets.keys():..
 00003d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d60: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00003d70: 2e77 6172 6e69 6e67 2866 227b 5f5f 636c  .warning(f"{__cl
-00003d80: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-00003d90: 2d20 7570 6461 7465 2073 6563 7265 7420  - update secret 
-00003da0: 6572 726f 723a 206b 6579 2027 7b6b 6579  error: key '{key
-00003db0: 7d27 206e 6f74 2066 6f75 6e64 2229 0d0a  }' not found")..
-00003dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003dd0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00003de0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-00003df0: 2020 2020 2020 2020 2020 6578 6973 7473            exists
-00003e00: 5f73 6563 7265 7473 5b6b 6579 5d20 3d20  _secrets[key] = 
-00003e10: 7365 6372 6574 735b 6b65 795d 0d0a 2020  secrets[key]..  
-00003e20: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00003e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e40: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00003e50: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-00003e60: 2020 2020 2020 2020 2075 726c 203d 2061           url = a
-00003e70: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
-00003e80: 7365 6c66 2e75 726c 2c20 6b65 793d 7261  self.url, key=ra
-00003e90: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
-00003ea0: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
-00003eb0: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
-00003ec0: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
-00003ed0: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
-00003ee0: 2020 2020 2074 6f6b 656e 203d 2061 6573       token = aes
-00003ef0: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-00003f00: 6c66 2e74 6f6b 656e 2c20 6b65 793d 7261  lf.token, key=ra
-00003f10: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
-00003f20: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
-00003f30: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
-00003f40: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
-00003f50: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
-00003f60: 2020 2020 2072 6573 203d 2072 6571 7565       res = reque
-00003f70: 7374 732e 706f 7374 2875 726c 2b66 227b  sts.post(url+f"{
-00003f80: 6d6f 756e 745f 7061 7468 7d2f 7b70 6174  mount_path}/{pat
-00003f90: 687d 222c 2068 6561 6465 7273 3d7b 2258  h}", headers={"X
-00003fa0: 2d56 6175 6c74 2d54 6f6b 656e 223a 2074  -Vault-Token": t
-00003fb0: 6f6b 656e 7d2c 2064 6174 613d 6578 6973  oken}, data=exis
-00003fc0: 7473 5f73 6563 7265 7473 290d 0a20 2020  ts_secrets)..   
-00003fd0: 2020 2020 2020 2020 2069 6620 7265 732e           if res.
-00003fe0: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
-00003ff0: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
-00004000: 5f63 6f64 6520 3d3d 2032 3034 3a0d 0a20  _code == 204:.. 
-00004010: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004020: 6574 7572 6e20 5472 7565 0d0a 2020 2020  eturn True..    
-00004030: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00004040: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00004050: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
-00004060: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
-00004070: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
-00004080: 2022 7570 6461 7465 2073 6563 7265 7420   "update secret 
-00004090: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
-000040a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000040b0: 4661 6c73 650d 0a20 2020 2020 2020 200d  False..        .
-000040c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000040d0: 4661 6c73 650d 0a20 2020 200d 0a20 2020  False..    ..   
-000040e0: 2064 6566 2064 656c 6574 655f 7365 6372   def delete_secr
-000040f0: 6574 2873 656c 662c 206d 6f75 6e74 5f70  et(self, mount_p
-00004100: 6174 683a 2073 7472 2c20 7061 7468 3a20  ath: str, path: 
-00004110: 7374 722c 206b 6579 3a20 556e 696f 6e5b  str, key: Union[
-00004120: 7374 722c 204c 6973 745b 7374 725d 5d29  str, List[str]])
-00004130: 3a0d 0a20 2020 2020 2020 2022 2222 6465  :..        """de
-00004140: 6c65 7465 2074 6865 2065 7869 7374 696e  lete the existin
-00004150: 6720 7365 6372 6574 2066 726f 6d20 226d  g secret from "m
-00004160: 6f75 6e74 5f70 6174 682f 7061 7468 220d  ount_path/path".
-00004170: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00004180: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
-00004190: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
-000041a0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-000041b0: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
-000041c0: 2020 2020 6b65 7920 2855 6e69 6f6e 5b73      key (Union[s
-000041d0: 7472 2c20 4c69 7374 5b73 7472 5d5d 290d  tr, List[str]]).
-000041e0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-000041f0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-00004200: 2062 6f6f 6c3a 2072 6574 7572 6e20 5472   bool: return Tr
-00004210: 7565 2069 6620 7375 6363 6573 732c 206f  ue if success, o
-00004220: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
-00004230: 4661 6c73 650d 0a20 2020 2020 2020 2022  False..        "
-00004240: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
-00004250: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
-00004260: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
-00004270: 7374 7228 6b65 7929 3a0d 0a20 2020 2020  str(key):..     
-00004280: 2020 2020 2020 2020 2020 206b 6579 203d             key =
-00004290: 205b 6b65 795d 0d0a 2020 2020 2020 2020   [key]..        
-000042a0: 2020 2020 6966 206e 6f74 2069 735f 6c69      if not is_li
-000042b0: 7374 286b 6579 293a 0d0a 2020 2020 2020  st(key):..      
-000042c0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-000042d0: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
-000042e0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-000042f0: 5f7d 202d 2064 656c 6574 6520 7365 6372  _} - delete secr
-00004300: 6574 2065 7272 6f72 3a20 6b65 7920 6d75  et error: key mu
-00004310: 7374 2062 6520 6120 7374 7220 6f72 206c  st be a str or l
-00004320: 6973 7420 6f66 2073 7472 2229 0d0a 2020  ist of str")..  
-00004330: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00004340: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-00004350: 2020 2020 2020 2020 6966 206c 656e 286b          if len(k
-00004360: 6579 2920 3d3d 2030 3a0d 0a20 2020 2020  ey) == 0:..     
-00004370: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004380: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-00004390: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-000043a0: 5f5f 7d20 2d20 6465 6c65 7465 2073 6563  __} - delete sec
-000043b0: 7265 7420 6572 726f 723a 206b 6579 206d  ret error: key m
-000043c0: 7573 7420 6e6f 7420 6265 2065 6d70 7479  ust not be empty
-000043d0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-000043e0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000043f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00004400: 6578 6973 7473 5f73 6563 7265 7473 203d  exists_secrets =
-00004410: 2073 656c 662e 6c69 7374 5f73 6563 7265   self.list_secre
-00004420: 7428 6d6f 756e 745f 7061 7468 2c20 7061  t(mount_path, pa
-00004430: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
-00004440: 2069 6620 6578 6973 7473 5f73 6563 7265   if exists_secre
-00004450: 7473 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ts is not None:.
-00004460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004470: 2066 6f72 206b 2069 6e20 6b65 793a 0d0a   for k in key:..
-00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004490: 2020 2020 6966 206b 206e 6f74 2069 6e20      if k not in 
-000044a0: 6578 6973 7473 5f73 6563 7265 7473 2e6b  exists_secrets.k
-000044b0: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
+00003d60: 2020 2020 6966 206b 6579 206e 6f74 2069      if key not i
+00003d70: 6e20 6578 6973 7473 5f73 6563 7265 7473  n exists_secrets
+00003d80: 2e6b 6579 7328 293a 0d0a 2020 2020 2020  .keys():..      
+00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003da0: 2020 7365 6c66 2e6c 6f67 6765 722e 7761    self.logger.wa
+00003db0: 726e 696e 6728 6622 7b5f 5f63 6c61 7373  rning(f"{__class
+00003dc0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2075  __.__name__} - u
+00003dd0: 7064 6174 6520 7365 6372 6574 2065 7272  pdate secret err
+00003de0: 6f72 3a20 6b65 7920 277b 6b65 797d 2720  or: key '{key}' 
+00003df0: 6e6f 7420 666f 756e 6422 290d 0a20 2020  not found")..   
+00003e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e10: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00003e20: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00003e30: 2020 2020 2020 2065 7869 7374 735f 7365         exists_se
+00003e40: 6372 6574 735b 6b65 795d 203d 2073 6563  crets[key] = sec
+00003e50: 7265 7473 5b6b 6579 5d0d 0a20 2020 2020  rets[key]..     
+00003e60: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00003e70: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00003e80: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00003e90: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00003ea0: 2020 2020 2020 7572 6c20 3d20 6165 735f        url = aes_
+00003eb0: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
+00003ec0: 662e 7572 6c2c 206b 6579 3d72 616e 646f  f.url, key=rando
+00003ed0: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
+00003ee0: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
+00003ef0: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
+00003f00: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
+00003f10: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
+00003f20: 2020 746f 6b65 6e20 3d20 6165 735f 6465    token = aes_de
+00003f30: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
+00003f40: 746f 6b65 6e2c 206b 6579 3d72 616e 646f  token, key=rando
+00003f50: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
+00003f60: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
+00003f70: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
+00003f80: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
+00003f90: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
+00003fa0: 2020 7265 7320 3d20 7265 7175 6573 7473    res = requests
+00003fb0: 2e70 6f73 7428 7572 6c2b 6622 7b6d 6f75  .post(url+f"{mou
+00003fc0: 6e74 5f70 6174 687d 2f7b 7061 7468 7d22  nt_path}/{path}"
+00003fd0: 2c20 6865 6164 6572 733d 7b22 582d 5661  , headers={"X-Va
+00003fe0: 756c 742d 546f 6b65 6e22 3a20 746f 6b65  ult-Token": toke
+00003ff0: 6e7d 2c20 6461 7461 3d65 7869 7374 735f  n}, data=exists_
+00004000: 7365 6372 6574 7329 0d0a 2020 2020 2020  secrets)..      
+00004010: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
+00004020: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
+00004030: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
+00004040: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
+00004050: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00004060: 726e 2054 7275 650d 0a20 2020 2020 2020  rn True..       
+00004070: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00004080: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004090: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
+000040a0: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
+000040b0: 5f6e 616d 655f 5f2c 2072 6573 2c20 2275  _name__, res, "u
+000040c0: 7064 6174 6520 7365 6372 6574 2065 7272  pdate secret err
+000040d0: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
+000040e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000040f0: 7365 0d0a 2020 2020 2020 2020 0d0a 2020  se..        ..  
+00004100: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00004110: 7365 0d0a 2020 2020 0d0a 2020 2020 6465  se..    ..    de
+00004120: 6620 6465 6c65 7465 5f73 6563 7265 7428  f delete_secret(
+00004130: 7365 6c66 2c20 6d6f 756e 745f 7061 7468  self, mount_path
+00004140: 3a20 7374 722c 2070 6174 683a 2073 7472  : str, path: str
+00004150: 2c20 6b65 793a 2055 6e69 6f6e 5b73 7472  , key: Union[str
+00004160: 2c20 4c69 7374 5b73 7472 5d5d 293a 0d0a  , List[str]]):..
+00004170: 2020 2020 2020 2020 2222 2264 656c 6574          """delet
+00004180: 6520 7468 6520 6578 6973 7469 6e67 2073  e the existing s
+00004190: 6563 7265 7420 6672 6f6d 2022 6d6f 756e  ecret from "moun
+000041a0: 745f 7061 7468 2f70 6174 6822 0d0a 0d0a  t_path/path"....
+000041b0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
+000041c0: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
+000041d0: 5f70 6174 6820 2873 7472 290d 0a20 2020  _path (str)..   
+000041e0: 2020 2020 2020 2020 2070 6174 6820 2873           path (s
+000041f0: 7472 290d 0a20 2020 2020 2020 2020 2020  tr)..           
+00004200: 206b 6579 2028 556e 696f 6e5b 7374 722c   key (Union[str,
+00004210: 204c 6973 745b 7374 725d 5d29 0d0a 0d0a   List[str]])....
+00004220: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+00004230: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
+00004240: 6f6c 3a20 7265 7475 726e 2054 7275 6520  ol: return True 
+00004250: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
+00004260: 7277 6973 6520 7265 7475 726e 2046 616c  rwise return Fal
+00004270: 7365 0d0a 2020 2020 2020 2020 2222 220d  se..        """.
+00004280: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00004290: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
+000042a0: 2020 2020 2020 2069 6620 6973 5f73 7472         if is_str
+000042b0: 286b 6579 293a 0d0a 2020 2020 2020 2020  (key):..        
+000042c0: 2020 2020 2020 2020 6b65 7920 3d20 5b6b          key = [k
+000042d0: 6579 5d0d 0a20 2020 2020 2020 2020 2020  ey]..           
+000042e0: 2069 6620 6e6f 7420 6973 5f6c 6973 7428   if not is_list(
+000042f0: 6b65 7929 3a0d 0a20 2020 2020 2020 2020  key):..         
+00004300: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+00004310: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+00004320: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+00004330: 2d20 6465 6c65 7465 2073 6563 7265 7420  - delete secret 
+00004340: 6572 726f 723a 206b 6579 206d 7573 7420  error: key must 
+00004350: 6265 2061 2073 7472 206f 7220 6c69 7374  be a str or list
+00004360: 206f 6620 7374 7222 290d 0a20 2020 2020   of str")..     
+00004370: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004380: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
+00004390: 2020 2020 2069 6620 6c65 6e28 6b65 7929       if len(key)
+000043a0: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+000043b0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000043c0: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+000043d0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+000043e0: 202d 2064 656c 6574 6520 7365 6372 6574   - delete secret
+000043f0: 2065 7272 6f72 3a20 6b65 7920 6d75 7374   error: key must
+00004400: 206e 6f74 2062 6520 656d 7074 7922 290d   not be empty").
+00004410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004420: 2072 6574 7572 6e20 4661 6c73 650d 0a0d   return False...
+00004430: 0a20 2020 2020 2020 2020 2020 2065 7869  .            exi
+00004440: 7374 735f 7365 6372 6574 7320 3d20 7365  sts_secrets = se
+00004450: 6c66 2e6c 6973 745f 7365 6372 6574 286d  lf.list_secret(m
+00004460: 6f75 6e74 5f70 6174 682c 2070 6174 6829  ount_path, path)
+00004470: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00004480: 2065 7869 7374 735f 7365 6372 6574 7320   exists_secrets 
+00004490: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000044a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000044b0: 7220 6b20 696e 206b 6579 3a0d 0a20 2020  r k in key:..   
 000044c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044d0: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
-000044e0: 696e 6728 6622 7b5f 5f63 6c61 7373 5f5f  ing(f"{__class__
-000044f0: 2e5f 5f6e 616d 655f 5f7d 202d 2064 656c  .__name__} - del
-00004500: 6574 6520 7365 6372 6574 2065 7272 6f72  ete secret error
-00004510: 3a20 6b65 7920 277b 6b7d 2720 6e6f 7420  : key '{k}' not 
-00004520: 666f 756e 6422 290d 0a20 2020 2020 2020  found")..       
-00004530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004540: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00004550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004560: 2020 2064 656c 2065 7869 7374 735f 7365     del exists_se
-00004570: 6372 6574 735b 6b5d 0d0a 2020 2020 2020  crets[k]..      
-00004580: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00004590: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000045a0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-000045b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000045c0: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
-000045d0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-000045e0: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
-000045f0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
-00004600: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
-00004610: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
-00004620: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
-00004630: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
-00004640: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
-00004650: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
-00004660: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
-00004670: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
-00004680: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
-00004690: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
-000046a0: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
-000046b0: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
-000046c0: 2072 6573 203d 2072 6571 7565 7374 732e   res = requests.
-000046d0: 706f 7374 2875 726c 2b66 227b 6d6f 756e  post(url+f"{moun
-000046e0: 745f 7061 7468 7d2f 7b70 6174 687d 222c  t_path}/{path}",
-000046f0: 2068 6561 6465 7273 3d7b 2258 2d56 6175   headers={"X-Vau
-00004700: 6c74 2d54 6f6b 656e 223a 2074 6f6b 656e  lt-Token": token
-00004710: 7d2c 2064 6174 613d 6578 6973 7473 5f73  }, data=exists_s
-00004720: 6563 7265 7473 290d 0a20 2020 2020 2020  ecrets)..       
-00004730: 2020 2020 2069 6620 7265 732e 7374 6174       if res.stat
-00004740: 7573 5f63 6f64 6520 3d3d 2032 3030 206f  us_code == 200 o
-00004750: 7220 7265 732e 7374 6174 7573 5f63 6f64  r res.status_cod
-00004760: 6520 3d3d 2032 3034 3a0d 0a20 2020 2020  e == 204:..     
-00004770: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00004780: 6e20 5472 7565 0d0a 2020 2020 2020 2020  n True..        
-00004790: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000047a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000047b0: 5f6c 6f67 5f65 7272 6f72 5f72 6573 706f  _log_error_respo
-000047c0: 6e73 6528 5f5f 636c 6173 735f 5f2e 5f5f  nse(__class__.__
-000047d0: 6e61 6d65 5f5f 2c20 7265 732c 2022 6465  name__, res, "de
-000047e0: 6c65 7465 2073 6563 7265 7420 6572 726f  lete secret erro
-000047f0: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
-00004800: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00004810: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
-00004820: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00004830: 650d 0a20 2020 200d 0a20 2020 2064 6566  e..    ..    def
-00004840: 2064 656c 6574 655f 7365 6372 6574 5f70   delete_secret_p
-00004850: 6174 6828 7365 6c66 2c20 6d6f 756e 745f  ath(self, mount_
-00004860: 7061 7468 3a20 7374 722c 2070 6174 683a  path: str, path:
-00004870: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
-00004880: 2222 2264 656c 6574 6520 7468 6520 656e  """delete the en
-00004890: 7469 7265 2073 6563 7265 7420 7061 7468  tire secret path
-000048a0: 206f 6620 226d 6f75 6e74 5f70 6174 682f   of "mount_path/
-000048b0: 7061 7468 220d 0a0d 0a20 2020 2020 2020  path"....       
-000048c0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-000048d0: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-000048e0: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-000048f0: 2020 7061 7468 2028 7374 7229 0d0a 0d0a    path (str)....
-00004900: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00004910: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-00004920: 6f6c 3a20 7265 7475 726e 2054 7275 6520  ol: return True 
-00004930: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-00004940: 7277 6973 6520 7265 7475 726e 2046 616c  rwise return Fal
-00004950: 7365 0d0a 2020 2020 2020 2020 2222 220d  se..        """.
-00004960: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00004970: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-00004980: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
-00004990: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-000049a0: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
-000049b0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-000049c0: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-000049d0: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-000049e0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-000049f0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00004a00: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
-00004a10: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-00004a20: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
-00004a30: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-00004a40: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-00004a50: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-00004a60: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-00004a70: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00004a80: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-00004a90: 732e 6465 6c65 7465 2875 726c 2b66 227b  s.delete(url+f"{
-00004aa0: 6d6f 756e 745f 7061 7468 7d2f 7b70 6174  mount_path}/{pat
-00004ab0: 687d 222c 2068 6561 6465 7273 3d7b 2258  h}", headers={"X
-00004ac0: 2d56 6175 6c74 2d54 6f6b 656e 223a 2074  -Vault-Token": t
-00004ad0: 6f6b 656e 7d29 0d0a 2020 2020 2020 2020  oken})..        
-00004ae0: 2020 2020 6966 2072 6573 2e73 7461 7475      if res.statu
-00004af0: 735f 636f 6465 203d 3d20 3230 3020 6f72  s_code == 200 or
-00004b00: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-00004b10: 203d 3d20 3230 343a 0d0a 2020 2020 2020   == 204:..      
-00004b20: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00004b30: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-00004b40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00004b50: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00004b60: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
-00004b70: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
-00004b80: 616d 655f 5f2c 2072 6573 2c20 2264 656c  ame__, res, "del
-00004b90: 6574 6520 7365 6372 6574 2070 6174 6820  ete secret path 
-00004ba0: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
-00004bb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004bc0: 4661 6c73 650d 0a0d 0a20 2020 2020 2020  False....       
-00004bd0: 2072 6574 7572 6e20 4661 6c73 650d 0a0d   return False...
-00004be0: 0a0d 0a63 6c61 7373 2056 6175 6c74 5365  ...class VaultSe
-00004bf0: 6372 6574 456e 6769 6e65 4b56 3228 5f56  cretEngineKV2(_V
-00004c00: 6175 6c74 4854 5450 4150 4929 3a0d 0a20  aultHTTPAPI):.. 
-00004c10: 2020 2022 2222 4b56 2053 6563 7265 7420     """KV Secret 
-00004c20: 456e 6769 6e65 2028 7665 7273 696f 6e20  Engine (version 
-00004c30: 3229 0d0a 2020 2020 0d0a 2020 2020 5265  2)..    ..    Re
-00004c40: 6665 7220 746f 2068 7474 7073 3a2f 2f64  fer to https://d
-00004c50: 6576 656c 6f70 6572 2e68 6173 6869 636f  eveloper.hashico
-00004c60: 7270 2e63 6f6d 2f76 6175 6c74 2f61 7069  rp.com/vault/api
-00004c70: 2d64 6f63 732f 7365 6372 6574 2f6b 762f  -docs/secret/kv/
-00004c80: 6b76 2d76 3220 666f 7220 6d6f 7265 2064  kv-v2 for more d
-00004c90: 6574 6169 6c73 2e0d 0a0d 0a20 2020 2049  etails.....    I
-00004ca0: 6e69 743a 0d0a 2020 2020 2020 2020 636f  nit:..        co
-00004cb0: 6e6e 6563 7469 6e67 2077 6974 6820 746f  nnecting with to
-00004cc0: 6b65 6e3a 0d0a 2020 2020 2020 2020 3e3e  ken:..        >>
-00004cd0: 3e20 6b76 325f 656e 6769 6e65 203d 2056  > kv2_engine = V
-00004ce0: 6175 6c74 5365 6372 6574 456e 6769 6e65  aultSecretEngine
-00004cf0: 4b56 3228 0d0a 2020 2020 2020 2020 3e3e  KV2(..        >>
-00004d00: 3e20 2020 2020 7572 6c3d 2268 7474 703a  >     url="http:
-00004d10: 2f2f 3132 372e 302e 302e 313a 3832 3030  //127.0.0.1:8200
-00004d20: 222c 200d 0a20 2020 2020 2020 203e 3e3e  ", ..        >>>
-00004d30: 2020 2020 2061 7574 685f 6366 673d 6469       auth_cfg=di
-00004d40: 6374 286d 6574 686f 643d 2274 6f6b 656e  ct(method="token
-00004d50: 222c 2074 6f6b 656e 3d22 6876 732e 534d  ", token="hvs.SM
-00004d60: 4630 6e46 306e 6474 3264 5a33 6452 4366  F0nF0ndt2dZ3dRCf
-00004d70: 6536 6f48 5636 2229 0d0a 2020 2020 2020  e6oHV6")..      
-00004d80: 2020 3e3e 3e20 290d 0a0d 0a20 2020 2020    >>> )....     
-00004d90: 2020 2063 6f6e 6e65 6374 696e 6720 7769     connecting wi
-00004da0: 7468 2075 7365 726e 616d 6520 2620 7061  th username & pa
-00004db0: 7373 776f 7264 3a0d 0a20 2020 2020 2020  ssword:..       
-00004dc0: 203e 3e3e 206b 7632 5f65 6e67 696e 6520   >>> kv2_engine 
-00004dd0: 3d20 5661 756c 7453 6563 7265 7445 6e67  = VaultSecretEng
-00004de0: 696e 654b 5632 280d 0a20 2020 2020 2020  ineKV2(..       
-00004df0: 203e 3e3e 2020 2020 2075 726c 3d22 6874   >>>     url="ht
-00004e00: 7470 3a2f 2f31 3237 2e30 2e30 2e31 3a38  tp://127.0.0.1:8
-00004e10: 3230 3022 2c0d 0a20 2020 2020 2020 203e  200",..        >
-00004e20: 3e3e 2020 2020 2061 7574 685f 6366 673d  >>     auth_cfg=
-00004e30: 6469 6374 286d 6574 686f 643d 2275 7365  dict(method="use
-00004e40: 7270 6173 7322 2c20 7573 6572 6e61 6d65  rpass", username
-00004e50: 3d22 7573 6572 6e61 6d65 222c 2070 6173  ="username", pas
-00004e60: 7377 6f72 643d 2270 6173 7377 6f72 6422  sword="password"
-00004e70: 290d 0a20 2020 2020 2020 203e 3e3e 2029  )..        >>> )
-00004e80: 0d0a 2020 2020 2222 220d 0a20 2020 200d  ..    """..    .
-00004e90: 0a20 2020 2064 6566 2073 6574 5f65 6e67  .    def set_eng
-00004ea0: 696e 655f 636f 6e66 6967 2873 656c 662c  ine_config(self,
-00004eb0: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
-00004ec0: 2c20 6366 673a 2055 6e69 6f6e 5b64 6963  , cfg: Union[dic
-00004ed0: 742c 2043 6f6e 6669 6744 6963 745d 293a  t, ConfigDict]):
-00004ee0: 0d0a 2020 2020 2020 2020 2222 2273 6574  ..        """set
-00004ef0: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00004f00: 6f6e 206f 6620 7468 6520 7365 6372 6574  on of the secret
-00004f10: 2065 6e67 696e 650d 0a0d 0a20 2020 2020   engine....     
-00004f20: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
-00004f30: 2020 2020 2020 6d6f 756e 745f 7061 7468        mount_path
-00004f40: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
-00004f50: 2020 2020 6366 6720 2855 6e69 6f6e 5b64      cfg (Union[d
-00004f60: 6963 742c 2043 6f6e 6669 6744 6963 745d  ict, ConfigDict]
-00004f70: 290d 0a0d 0a20 2020 2020 2020 2052 6574  )....        Ret
-00004f80: 7572 6e73 3a0d 0a20 2020 2020 2020 2020  urns:..         
-00004f90: 2020 2062 6f6f 6c3a 2072 6574 7572 6e20     bool: return 
-00004fa0: 5472 7565 2069 6620 7375 6363 6573 732c  True if success,
-00004fb0: 206f 7468 6572 7769 7365 2072 6574 7572   otherwise retur
-00004fc0: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
-00004fd0: 2022 2222 0d0a 2020 2020 2020 2020 7375   """..        su
-00004fe0: 7070 6f72 745f 7061 7261 6d73 203d 205b  pport_params = [
-00004ff0: 226d 6178 5f76 6572 7369 6f6e 7322 2c20  "max_versions", 
-00005000: 2263 6173 5f72 6571 7569 7265 6422 2c20  "cas_required", 
-00005010: 2264 656c 6574 655f 7665 7273 696f 6e5f  "delete_version_
-00005020: 6166 7465 7222 5d0d 0a20 2020 2020 2020  after"]..       
-00005030: 2069 6620 6e6f 7420 6973 5f64 6963 743a   if not is_dict:
-00005040: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00005050: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00005060: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00005070: 616d 655f 5f7d 202d 2073 6574 2065 6e67  ame__} - set eng
-00005080: 696e 6520 636f 6e66 6967 2065 7272 6f72  ine config error
-00005090: 3a20 6366 6720 6d75 7374 2062 6520 6120  : cfg must be a 
-000050a0: 6469 6374 206f 7220 436f 6e66 6967 4469  dict or ConfigDi
-000050b0: 6374 2229 0d0a 2020 2020 2020 2020 2020  ct")..          
-000050c0: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-000050d0: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
-000050e0: 696e 2063 6667 2e6b 6579 7328 293a 0d0a  in cfg.keys():..
-000050f0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00005100: 6579 206e 6f74 2069 6e20 7375 7070 6f72  ey not in suppor
-00005110: 745f 7061 7261 6d73 3a0d 0a20 2020 2020  t_params:..     
-00005120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005130: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-00005140: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00005150: 5f5f 7d20 2d20 7365 7420 656e 6769 6e65  __} - set engine
-00005160: 2063 6f6e 6669 6720 6572 726f 723a 206b   config error: k
-00005170: 6579 2027 7b6b 6579 7d27 206e 6f74 2073  ey '{key}' not s
-00005180: 7570 706f 7274 2229 0d0a 2020 2020 2020  upport")..      
-00005190: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000051a0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000051b0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000051c0: 662e 6973 5f61 7574 683a 0d0a 2020 2020  f.is_auth:..    
-000051d0: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
-000051e0: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-000051f0: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
-00005200: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-00005210: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-00005220: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-00005230: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-00005240: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-00005250: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
-00005260: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
-00005270: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
-00005280: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-00005290: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-000052a0: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-000052b0: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-000052c0: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-000052d0: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
-000052e0: 7473 2e70 6f73 7428 7572 6c2b 6622 7b6d  ts.post(url+f"{m
-000052f0: 6f75 6e74 5f70 6174 687d 2f63 6f6e 6669  ount_path}/confi
-00005300: 6722 2c20 6865 6164 6572 733d 7b22 582d  g", headers={"X-
-00005310: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
-00005320: 6b65 6e7d 2c20 6461 7461 3d63 6667 290d  ken}, data=cfg).
-00005330: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00005340: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-00005350: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
-00005360: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
-00005370: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00005380: 2020 2072 6574 7572 6e20 5472 7565 0d0a     return True..
-00005390: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000053a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000053b0: 2020 2073 656c 662e 5f6c 6f67 5f65 7272     self._log_err
-000053c0: 6f72 5f72 6573 706f 6e73 6528 5f5f 636c  or_response(__cl
-000053d0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
-000053e0: 7265 732c 2022 7365 7420 656e 6769 6e65  res, "set engine
-000053f0: 2063 6f6e 6669 6720 6572 726f 7222 290d   config error").
-00005400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005410: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00005420: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00005430: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00005440: 2020 200d 0a20 2020 2064 6566 2072 6561     ..    def rea
-00005450: 645f 656e 6769 6e65 5f63 6f6e 6669 6728  d_engine_config(
-00005460: 7365 6c66 2c20 6d6f 756e 745f 7061 7468  self, mount_path
-00005470: 3a20 7374 7229 3a0d 0a20 2020 2020 2020  : str):..       
-00005480: 2022 2222 7265 6164 2074 6865 2063 6f6e   """read the con
-00005490: 6669 6775 7261 7469 6f6e 206f 6620 7468  figuration of th
-000054a0: 6520 7365 6372 6574 2065 6e67 696e 650d  e secret engine.
-000054b0: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-000054c0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
-000054d0: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
-000054e0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000054f0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00005500: 6469 6374 206f 7220 4e6f 6e65 3a20 7265  dict or None: re
-00005510: 7475 726e 2061 2064 6963 7420 6966 2073  turn a dict if s
-00005520: 7563 6365 7373 2c20 6f74 6865 7277 6973  uccess, otherwis
-00005530: 6520 7265 7475 726e 204e 6f6e 650d 0a20  e return None.. 
-00005540: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00005550: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
-00005560: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
-00005570: 2020 7572 6c20 3d20 6165 735f 6465 6372    url = aes_decr
-00005580: 7970 745f 7465 7874 2873 656c 662e 7572  ypt_text(self.ur
-00005590: 6c2c 206b 6579 3d72 616e 646f 6d5f 6865  l, key=random_he
-000055a0: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
-000055b0: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
-000055c0: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
-000055d0: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
-000055e0: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-000055f0: 6b65 6e20 3d20 6165 735f 6465 6372 7970  ken = aes_decryp
-00005600: 745f 7465 7874 2873 656c 662e 746f 6b65  t_text(self.toke
-00005610: 6e2c 206b 6579 3d72 616e 646f 6d5f 6865  n, key=random_he
-00005620: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
-00005630: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
-00005640: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
-00005650: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
-00005660: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00005670: 7320 3d20 7265 7175 6573 7473 2e67 6574  s = requests.get
-00005680: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
-00005690: 7468 7d2f 636f 6e66 6967 222c 2068 6561  th}/config", hea
-000056a0: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
-000056b0: 6f6b 656e 223a 2074 6f6b 656e 7d29 0d0a  oken": token})..
-000056c0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-000056d0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-000056e0: 3d20 3230 3020 6f72 2072 6573 2e73 7461  = 200 or res.sta
-000056f0: 7475 735f 636f 6465 203d 3d20 3230 343a  tus_code == 204:
-00005700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005710: 2020 7265 7475 726e 2072 6573 2e6a 736f    return res.jso
-00005720: 6e28 295b 2264 6174 6122 5d0d 0a20 2020  n()["data"]..   
-00005730: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00005740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005750: 7365 6c66 2e5f 6c6f 675f 6572 726f 725f  self._log_error_
-00005760: 7265 7370 6f6e 7365 285f 5f63 6c61 7373  response(__class
-00005770: 5f5f 2e5f 5f6e 616d 655f 5f2c 2072 6573  __.__name__, res
-00005780: 2c20 2272 6561 6420 656e 6769 6e65 2063  , "read engine c
-00005790: 6f6e 6669 6720 6572 726f 7222 290d 0a20  onfig error").. 
-000057a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000057b0: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-000057c0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-000057d0: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-000057e0: 2020 200d 0a20 2020 2064 6566 2072 6561     ..    def rea
-000057f0: 645f 7365 6372 6574 2873 656c 662c 206d  d_secret(self, m
-00005800: 6f75 6e74 5f70 6174 683a 2073 7472 2c20  ount_path: str, 
-00005810: 7061 7468 3a20 7374 722c 206b 6579 3a20  path: str, key: 
-00005820: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00005830: 4e6f 6e65 2c20 7665 7273 696f 6e3a 204f  None, version: O
-00005840: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-00005850: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
-00005860: 2222 7265 6164 2073 6563 7265 7420 6672  ""read secret fr
-00005870: 6f6d 2022 6d6f 756e 745f 7061 7468 2f70  om "mount_path/p
-00005880: 6174 6822 0d0a 0d0a 2020 2020 2020 2020  ath"....        
-00005890: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
-000058a0: 2020 206d 6f75 6e74 5f70 6174 6820 2873     mount_path (s
-000058b0: 7472 290d 0a20 2020 2020 2020 2020 2020  tr)..           
-000058c0: 2070 6174 6820 2873 7472 290d 0a20 2020   path (str)..   
-000058d0: 2020 2020 2020 2020 206b 6579 2028 4f70           key (Op
-000058e0: 7469 6f6e 616c 5b73 7472 5d2c 206f 7074  tional[str], opt
-000058f0: 696f 6e61 6c29 3a20 7265 6164 2061 2073  ional): read a s
-00005900: 7065 6369 6669 6320 7365 6372 6574 2e20  pecific secret. 
-00005910: 6966 204e 6f6e 652c 2072 6574 7572 6e20  if None, return 
-00005920: 616c 6c20 7365 6372 6574 7320 696e 200d  all secrets in .
-00005930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005950: 2020 2020 2020 2020 2020 2020 226d 6f75              "mou
-00005960: 6e74 5f70 6174 682f 7061 7468 222e 2044  nt_path/path". D
-00005970: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-00005980: 0d0a 2020 2020 2020 2020 2020 2020 7665  ..            ve
-00005990: 7273 696f 6e20 284f 7074 696f 6e61 6c5b  rsion (Optional[
-000059a0: 696e 745d 2c20 6f70 7469 6f6e 616c 293a  int], optional):
-000059b0: 2072 6561 6420 6120 7370 6563 6966 6963   read a specific
-000059c0: 2076 6572 7369 6f6e 206f 6620 7365 6372   version of secr
-000059d0: 6574 2e20 6966 204e 6f6e 652c 2072 6574  et. if None, ret
-000059e0: 7572 6e20 7468 6520 0d0a 2020 2020 2020  urn the ..      
-000059f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a10: 2020 2020 2020 2020 206c 6174 6573 7420           latest 
-00005a20: 7665 7273 696f 6e20 6f66 2073 6563 7265  version of secre
-00005a30: 742e 2044 6566 6175 6c74 7320 746f 204e  t. Defaults to N
-00005a40: 6f6e 652e 0d0a 0d0a 2020 2020 2020 2020  one.....        
-00005a50: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
-00005a60: 2020 2020 2020 6469 6374 2c20 6469 6374        dict, dict
-00005a70: 3a20 7265 7475 726e 2074 776f 2064 6963  : return two dic
-00005a80: 7473 2063 6f72 7265 7370 6f6e 6469 6e67  ts corresponding
-00005a90: 2074 6f20 7365 6372 6574 2061 6e64 206d   to secret and m
-00005aa0: 6574 6164 6174 6120 6966 2073 7563 6365  etadata if succe
-00005ab0: 7373 0d0a 2020 2020 2020 2020 2020 2020  ss..            
-00005ac0: 4e6f 6e65 3a20 7265 7475 726e 204e 6f6e  None: return Non
-00005ad0: 6520 6966 2066 6169 6c0d 0a20 2020 2020  e if fail..     
-00005ae0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00005af0: 6966 2073 656c 662e 6973 5f61 7574 683a  if self.is_auth:
-00005b00: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
-00005b10: 6c5f 7665 7273 696f 6e73 203d 2073 656c  l_versions = sel
-00005b20: 662e 6765 745f 616c 6c5f 7365 6372 6574  f.get_all_secret
-00005b30: 5f76 6572 7369 6f6e 7328 6d6f 756e 745f  _versions(mount_
-00005b40: 7061 7468 2c20 7061 7468 290d 0a20 2020  path, path)..   
-00005b50: 2020 2020 2020 2020 2069 6620 616c 6c5f           if all_
-00005b60: 7665 7273 696f 6e73 2069 7320 4e6f 6e65  versions is None
-00005b70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00005b80: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00005b90: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00005ba0: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
-00005bb0: 7369 6f6e 2069 7320 6e6f 7420 4e6f 6e65  sion is not None
-00005bc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00005bd0: 2020 2069 6620 7374 7228 7665 7273 696f     if str(versio
-00005be0: 6e29 206e 6f74 2069 6e20 616c 6c5f 7665  n) not in all_ve
-00005bf0: 7273 696f 6e73 2e6b 6579 7328 293a 0d0a  rsions.keys():..
-00005c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c10: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-00005c20: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
-00005c30: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2072  __.__name__} - r
-00005c40: 6561 6420 7365 6372 6574 2065 7272 6f72  ead secret error
-00005c50: 3a20 7665 7273 696f 6e20 277b 7665 7273  : version '{vers
-00005c60: 696f 6e7d 2720 6e6f 7420 666f 756e 6422  ion}' not found"
-00005c70: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00005c80: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00005c90: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00005ca0: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00005cb0: 2020 2020 2020 6966 2061 6c6c 5f76 6572        if all_ver
-00005cc0: 7369 6f6e 735b 7374 7228 7665 7273 696f  sions[str(versio
-00005cd0: 6e29 5d5b 2264 6573 7472 6f79 6564 225d  n)]["destroyed"]
-00005ce0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00005cf0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-00005d00: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-00005d10: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-00005d20: 2d20 7265 6164 2073 6563 7265 7420 6572  - read secret er
-00005d30: 726f 723a 2076 6572 7369 6f6e 2027 7b76  ror: version '{v
-00005d40: 6572 7369 6f6e 7d27 2068 6173 2022 0d0a  ersion}' has "..
-00005d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d70: 2020 2020 2020 6622 6265 656e 2070 6572        f"been per
-00005d80: 6d61 6e65 6e74 6c79 2064 6573 7472 6f79  manently destroy
-00005d90: 6564 2229 0d0a 2020 2020 2020 2020 2020  ed")..          
-00005da0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00005db0: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-00005dc0: 2020 2020 2020 2020 2069 6620 616c 6c5f           if all_
-00005dd0: 7665 7273 696f 6e73 5b73 7472 2876 6572  versions[str(ver
-00005de0: 7369 6f6e 295d 5b22 6465 6c65 7465 6422  sion)]["deleted"
-00005df0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00005e00: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00005e10: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-00005e20: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00005e30: 202d 2072 6561 6420 7365 6372 6574 2065   - read secret e
-00005e40: 7272 6f72 3a20 7665 7273 696f 6e20 277b  rror: version '{
-00005e50: 7665 7273 696f 6e7d 2720 6861 7320 220d  version}' has ".
-00005e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e80: 2020 2020 2020 2066 2262 6565 6e20 6465         f"been de
-00005e90: 6c65 7465 642c 2070 6c65 6173 6520 756e  leted, please un
-00005ea0: 6465 6c65 7465 2069 7420 6669 7273 7422  delete it first"
-00005eb0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00005ec0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00005ed0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00005ee0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00005ef0: 2020 2020 2020 2076 6572 7369 6f6e 203d         version =
-00005f00: 2061 6c6c 5f76 6572 7369 6f6e 735b 2263   all_versions["c
-00005f10: 7572 7265 6e74 5f76 6572 7369 6f6e 225d  urrent_version"]
-00005f20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005f30: 2020 7377 6974 6368 5f63 7572 7265 6e74    switch_current
-00005f40: 5f76 6572 7369 6f6e 203d 2046 616c 7365  _version = False
-00005f50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005f60: 2020 6966 2061 6c6c 5f76 6572 7369 6f6e    if all_version
-00005f70: 735b 7374 7228 7665 7273 696f 6e29 5d5b  s[str(version)][
-00005f80: 2264 6573 7472 6f79 6564 225d 3a0d 0a20  "destroyed"]:.. 
-00005f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fa0: 2020 2073 656c 662e 6c6f 6767 6572 2e77     self.logger.w
-00005fb0: 6172 6e69 6e67 2866 227b 5f5f 636c 6173  arning(f"{__clas
-00005fc0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-00005fd0: 7265 6164 2073 6563 7265 7420 7761 726e  read secret warn
-00005fe0: 696e 673a 2063 7572 7265 6e74 2076 6572  ing: current ver
-00005ff0: 7369 6f6e 2027 7b76 6572 7369 6f6e 7d27  sion '{version}'
-00006000: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-00006010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006020: 2020 2020 2020 2020 2020 2020 6622 6861              f"ha
-00006030: 7320 6265 656e 2070 6572 6d61 6e65 6e74  s been permanent
-00006040: 6c79 2064 6573 7472 6f79 6564 2c20 7377  ly destroyed, sw
-00006050: 6974 6368 696e 6720 746f 2061 6e6f 7468  itching to anoth
-00006060: 6572 2076 6572 7369 6f6e 2e2e 2e22 290d  er version...").
-00006070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006080: 2020 2020 2073 7769 7463 685f 6375 7272       switch_curr
-00006090: 656e 745f 7665 7273 696f 6e20 3d20 5472  ent_version = Tr
-000060a0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-000060b0: 2020 2020 6966 2061 6c6c 5f76 6572 7369      if all_versi
-000060c0: 6f6e 735b 7374 7228 7665 7273 696f 6e29  ons[str(version)
-000060d0: 5d5b 2264 656c 6574 6564 225d 3a0d 0a20  ]["deleted"]:.. 
-000060e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060f0: 2020 2073 656c 662e 6c6f 6767 6572 2e77     self.logger.w
-00006100: 6172 6e69 6e67 2866 227b 5f5f 636c 6173  arning(f"{__clas
-00006110: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-00006120: 7265 6164 2073 6563 7265 7420 7761 726e  read secret warn
-00006130: 696e 673a 2063 7572 7265 6e74 2076 6572  ing: current ver
-00006140: 7369 6f6e 2027 7b76 6572 7369 6f6e 7d27  sion '{version}'
-00006150: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-00006160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006170: 2020 2020 2020 2020 2020 2020 6622 6861              f"ha
-00006180: 7320 6265 656e 2064 656c 6574 6564 2c20  s been deleted, 
-00006190: 7377 6974 6368 696e 6720 746f 2061 6e6f  switching to ano
-000061a0: 7468 6572 2076 6572 7369 6f6e 2e2e 2e22  ther version..."
-000061b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000061c0: 2020 2020 2020 2073 7769 7463 685f 6375         switch_cu
-000061d0: 7272 656e 745f 7665 7273 696f 6e20 3d20  rrent_version = 
-000061e0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-000061f0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00006200: 2020 2020 2020 2020 6966 2073 7769 7463          if switc
-00006210: 685f 6375 7272 656e 745f 7665 7273 696f  h_current_versio
-00006220: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00006230: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
-00006240: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
-00006250: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-00006260: 7369 6f6e 202d 3d20 310d 0a20 2020 2020  sion -= 1..     
-00006270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006280: 2020 2069 6620 7374 7228 7665 7273 696f     if str(versio
-00006290: 6e29 206e 6f74 2069 6e20 616c 6c5f 7665  n) not in all_ve
-000062a0: 7273 696f 6e73 2e6b 6579 7328 293a 0d0a  rsions.keys():..
+000044d0: 2069 6620 6b20 6e6f 7420 696e 2065 7869   if k not in exi
+000044e0: 7374 735f 7365 6372 6574 732e 6b65 7973  sts_secrets.keys
+000044f0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00004500: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00004510: 662e 6c6f 6767 6572 2e77 6172 6e69 6e67  f.logger.warning
+00004520: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+00004530: 6e61 6d65 5f5f 7d20 2d20 6465 6c65 7465  name__} - delete
+00004540: 2073 6563 7265 7420 6572 726f 723a 206b   secret error: k
+00004550: 6579 2027 7b6b 7d27 206e 6f74 2066 6f75  ey '{k}' not fou
+00004560: 6e64 2229 0d0a 2020 2020 2020 2020 2020  nd")..          
+00004570: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00004580: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00004590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045a0: 6465 6c20 6578 6973 7473 5f73 6563 7265  del exists_secre
+000045b0: 7473 5b6b 5d0d 0a20 2020 2020 2020 2020  ts[k]..         
+000045c0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000045d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000045e0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+000045f0: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00004600: 2020 7572 6c20 3d20 6165 735f 6465 6372    url = aes_decr
+00004610: 7970 745f 7465 7874 2873 656c 662e 7572  ypt_text(self.ur
+00004620: 6c2c 206b 6579 3d72 616e 646f 6d5f 6865  l, key=random_he
+00004630: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+00004640: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+00004650: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+00004660: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+00004670: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+00004680: 6b65 6e20 3d20 6165 735f 6465 6372 7970  ken = aes_decryp
+00004690: 745f 7465 7874 2873 656c 662e 746f 6b65  t_text(self.toke
+000046a0: 6e2c 206b 6579 3d72 616e 646f 6d5f 6865  n, key=random_he
+000046b0: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+000046c0: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+000046d0: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+000046e0: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+000046f0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00004700: 7320 3d20 7265 7175 6573 7473 2e70 6f73  s = requests.pos
+00004710: 7428 7572 6c2b 6622 7b6d 6f75 6e74 5f70  t(url+f"{mount_p
+00004720: 6174 687d 2f7b 7061 7468 7d22 2c20 6865  ath}/{path}", he
+00004730: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+00004740: 546f 6b65 6e22 3a20 746f 6b65 6e7d 2c20  Token": token}, 
+00004750: 6461 7461 3d65 7869 7374 735f 7365 6372  data=exists_secr
+00004760: 6574 7329 0d0a 2020 2020 2020 2020 2020  ets)..          
+00004770: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
+00004780: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
+00004790: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+000047a0: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
+000047b0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+000047c0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+000047d0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000047e0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
+000047f0: 675f 6572 726f 725f 7265 7370 6f6e 7365  g_error_response
+00004800: 285f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  (__class__.__nam
+00004810: 655f 5f2c 2072 6573 2c20 2264 656c 6574  e__, res, "delet
+00004820: 6520 7365 6372 6574 2065 7272 6f72 2229  e secret error")
+00004830: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004840: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
+00004850: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00004860: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
+00004870: 2020 2020 0d0a 2020 2020 6465 6620 6465      ..    def de
+00004880: 6c65 7465 5f73 6563 7265 745f 7061 7468  lete_secret_path
+00004890: 2873 656c 662c 206d 6f75 6e74 5f70 6174  (self, mount_pat
+000048a0: 683a 2073 7472 2c20 7061 7468 3a20 7374  h: str, path: st
+000048b0: 7229 3a0d 0a20 2020 2020 2020 2022 2222  r):..        """
+000048c0: 6465 6c65 7465 2074 6865 2065 6e74 6972  delete the entir
+000048d0: 6520 7365 6372 6574 2070 6174 6820 6f66  e secret path of
+000048e0: 2022 6d6f 756e 745f 7061 7468 2f70 6174   "mount_path/pat
+000048f0: 6822 0d0a 0d0a 2020 2020 2020 2020 4172  h"....        Ar
+00004900: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
+00004910: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
+00004920: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
+00004930: 6174 6820 2873 7472 290d 0a0d 0a20 2020  ath (str)....   
+00004940: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+00004950: 2020 2020 2020 2020 2020 2062 6f6f 6c3a             bool:
+00004960: 2072 6574 7572 6e20 5472 7565 2069 6620   return True if 
+00004970: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
+00004980: 7365 2072 6574 7572 6e20 4661 6c73 650d  se return False.
+00004990: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+000049a0: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+000049b0: 5f61 7574 683a 0d0a 2020 2020 2020 2020  _auth:..        
+000049c0: 2020 2020 7572 6c20 3d20 6165 735f 6465      url = aes_de
+000049d0: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
+000049e0: 7572 6c2c 206b 6579 3d72 616e 646f 6d5f  url, key=random_
+000049f0: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
+00004a00: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
+00004a10: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
+00004a20: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
+00004a30: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00004a40: 746f 6b65 6e20 3d20 6165 735f 6465 6372  token = aes_decr
+00004a50: 7970 745f 7465 7874 2873 656c 662e 746f  ypt_text(self.to
+00004a60: 6b65 6e2c 206b 6579 3d72 616e 646f 6d5f  ken, key=random_
+00004a70: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
+00004a80: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
+00004a90: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
+00004aa0: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
+00004ab0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00004ac0: 7265 7320 3d20 7265 7175 6573 7473 2e64  res = requests.d
+00004ad0: 656c 6574 6528 7572 6c2b 6622 7b6d 6f75  elete(url+f"{mou
+00004ae0: 6e74 5f70 6174 687d 2f7b 7061 7468 7d22  nt_path}/{path}"
+00004af0: 2c20 6865 6164 6572 733d 7b22 582d 5661  , headers={"X-Va
+00004b00: 756c 742d 546f 6b65 6e22 3a20 746f 6b65  ult-Token": toke
+00004b10: 6e7d 290d 0a20 2020 2020 2020 2020 2020  n})..           
+00004b20: 2069 6620 7265 732e 7374 6174 7573 5f63   if res.status_c
+00004b30: 6f64 6520 3d3d 2032 3030 206f 7220 7265  ode == 200 or re
+00004b40: 732e 7374 6174 7573 5f63 6f64 6520 3d3d  s.status_code ==
+00004b50: 2032 3034 3a0d 0a20 2020 2020 2020 2020   204:..         
+00004b60: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00004b70: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00004b80: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00004b90: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
+00004ba0: 5f65 7272 6f72 5f72 6573 706f 6e73 6528  _error_response(
+00004bb0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00004bc0: 5f5f 2c20 7265 732c 2022 6465 6c65 7465  __, res, "delete
+00004bd0: 2073 6563 7265 7420 7061 7468 2065 7272   secret path err
+00004be0: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
+00004bf0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00004c00: 7365 0d0a 0d0a 2020 2020 2020 2020 7265  se....        re
+00004c10: 7475 726e 2046 616c 7365 0d0a 0d0a 0d0a  turn False......
+00004c20: 4053 4543 5245 542e 7265 6769 7374 6572  @SECRET.register
+00004c30: 5f6d 6f64 756c 6528 290d 0a63 6c61 7373  _module()..class
+00004c40: 2056 6175 6c74 5365 6372 6574 456e 6769   VaultSecretEngi
+00004c50: 6e65 4b56 3228 5f56 6175 6c74 4854 5450  neKV2(_VaultHTTP
+00004c60: 4150 4929 3a0d 0a20 2020 2022 2222 4b56  API):..    """KV
+00004c70: 2053 6563 7265 7420 456e 6769 6e65 2028   Secret Engine (
+00004c80: 7665 7273 696f 6e20 3229 0d0a 2020 2020  version 2)..    
+00004c90: 0d0a 2020 2020 5265 6665 7220 746f 2068  ..    Refer to h
+00004ca0: 7474 7073 3a2f 2f64 6576 656c 6f70 6572  ttps://developer
+00004cb0: 2e68 6173 6869 636f 7270 2e63 6f6d 2f76  .hashicorp.com/v
+00004cc0: 6175 6c74 2f61 7069 2d64 6f63 732f 7365  ault/api-docs/se
+00004cd0: 6372 6574 2f6b 762f 6b76 2d76 3220 666f  cret/kv/kv-v2 fo
+00004ce0: 7220 6d6f 7265 2064 6574 6169 6c73 2e0d  r more details..
+00004cf0: 0a0d 0a20 2020 2049 6e69 743a 0d0a 2020  ...    Init:..  
+00004d00: 2020 2020 2020 636f 6e6e 6563 7469 6e67        connecting
+00004d10: 2077 6974 6820 746f 6b65 6e3a 0d0a 2020   with token:..  
+00004d20: 2020 2020 2020 3e3e 3e20 6b76 325f 656e        >>> kv2_en
+00004d30: 6769 6e65 203d 2056 6175 6c74 5365 6372  gine = VaultSecr
+00004d40: 6574 456e 6769 6e65 4b56 3228 0d0a 2020  etEngineKV2(..  
+00004d50: 2020 2020 2020 3e3e 3e20 2020 2020 7572        >>>     ur
+00004d60: 6c3d 2268 7474 703a 2f2f 3132 372e 302e  l="http://127.0.
+00004d70: 302e 313a 3832 3030 222c 200d 0a20 2020  0.1:8200", ..   
+00004d80: 2020 2020 203e 3e3e 2020 2020 2061 7574       >>>     aut
+00004d90: 685f 6366 673d 6469 6374 286d 6574 686f  h_cfg=dict(metho
+00004da0: 643d 2274 6f6b 656e 222c 2074 6f6b 656e  d="token", token
+00004db0: 3d22 544f 4b45 4e22 290d 0a20 2020 2020  ="TOKEN")..     
+00004dc0: 2020 203e 3e3e 2029 0d0a 0d0a 2020 2020     >>> )....    
+00004dd0: 2020 2020 636f 6e6e 6563 7469 6e67 2077      connecting w
+00004de0: 6974 6820 7573 6572 6e61 6d65 2026 2070  ith username & p
+00004df0: 6173 7377 6f72 643a 0d0a 2020 2020 2020  assword:..      
+00004e00: 2020 3e3e 3e20 6b76 325f 656e 6769 6e65    >>> kv2_engine
+00004e10: 203d 2056 6175 6c74 5365 6372 6574 456e   = VaultSecretEn
+00004e20: 6769 6e65 4b56 3228 0d0a 2020 2020 2020  gineKV2(..      
+00004e30: 2020 3e3e 3e20 2020 2020 7572 6c3d 2268    >>>     url="h
+00004e40: 7474 703a 2f2f 3132 372e 302e 302e 313a  ttp://127.0.0.1:
+00004e50: 3832 3030 222c 0d0a 2020 2020 2020 2020  8200",..        
+00004e60: 3e3e 3e20 2020 2020 6175 7468 5f63 6667  >>>     auth_cfg
+00004e70: 3d64 6963 7428 6d65 7468 6f64 3d22 7573  =dict(method="us
+00004e80: 6572 7061 7373 222c 2075 7365 726e 616d  erpass", usernam
+00004e90: 653d 2275 7365 726e 616d 6522 2c20 7061  e="username", pa
+00004ea0: 7373 776f 7264 3d22 7061 7373 776f 7264  ssword="password
+00004eb0: 2229 0d0a 2020 2020 2020 2020 3e3e 3e20  ")..        >>> 
+00004ec0: 290d 0a20 2020 2022 2222 0d0a 2020 2020  )..    """..    
+00004ed0: 0d0a 2020 2020 6465 6620 7365 745f 656e  ..    def set_en
+00004ee0: 6769 6e65 5f63 6f6e 6669 6728 7365 6c66  gine_config(self
+00004ef0: 2c20 6d6f 756e 745f 7061 7468 3a20 7374  , mount_path: st
+00004f00: 722c 2063 6667 3a20 556e 696f 6e5b 6469  r, cfg: Union[di
+00004f10: 6374 2c20 436f 6e66 6967 4469 6374 5d29  ct, ConfigDict])
+00004f20: 3a0d 0a20 2020 2020 2020 2022 2222 7365  :..        """se
+00004f30: 7420 7468 6520 636f 6e66 6967 7572 6174  t the configurat
+00004f40: 696f 6e20 6f66 2074 6865 2073 6563 7265  ion of the secre
+00004f50: 7420 656e 6769 6e65 0d0a 0d0a 2020 2020  t engine....    
+00004f60: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+00004f70: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
+00004f80: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
+00004f90: 2020 2020 2063 6667 2028 556e 696f 6e5b       cfg (Union[
+00004fa0: 6469 6374 2c20 436f 6e66 6967 4469 6374  dict, ConfigDict
+00004fb0: 5d29 0d0a 0d0a 2020 2020 2020 2020 5265  ])....        Re
+00004fc0: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
+00004fd0: 2020 2020 626f 6f6c 3a20 7265 7475 726e      bool: return
+00004fe0: 2054 7275 6520 6966 2073 7563 6365 7373   True if success
+00004ff0: 2c20 6f74 6865 7277 6973 6520 7265 7475  , otherwise retu
+00005000: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
+00005010: 2020 2222 220d 0a20 2020 2020 2020 2073    """..        s
+00005020: 7570 706f 7274 5f70 6172 616d 7320 3d20  upport_params = 
+00005030: 5b22 6d61 785f 7665 7273 696f 6e73 222c  ["max_versions",
+00005040: 2022 6361 735f 7265 7175 6972 6564 222c   "cas_required",
+00005050: 2022 6465 6c65 7465 5f76 6572 7369 6f6e   "delete_version
+00005060: 5f61 6674 6572 225d 0d0a 2020 2020 2020  _after"]..      
+00005070: 2020 6966 206e 6f74 2069 735f 6469 6374    if not is_dict
+00005080: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00005090: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+000050a0: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+000050b0: 6e61 6d65 5f5f 7d20 2d20 7365 7420 656e  name__} - set en
+000050c0: 6769 6e65 2063 6f6e 6669 6720 6572 726f  gine config erro
+000050d0: 723a 2063 6667 206d 7573 7420 6265 2061  r: cfg must be a
+000050e0: 2064 6963 7420 6f72 2043 6f6e 6669 6744   dict or ConfigD
+000050f0: 6963 7422 290d 0a20 2020 2020 2020 2020  ict")..         
+00005100: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00005110: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+00005120: 2069 6e20 6366 672e 6b65 7973 2829 3a0d   in cfg.keys():.
+00005130: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005140: 6b65 7920 6e6f 7420 696e 2073 7570 706f  key not in suppo
+00005150: 7274 5f70 6172 616d 733a 0d0a 2020 2020  rt_params:..    
+00005160: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005170: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
+00005180: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
+00005190: 655f 5f7d 202d 2073 6574 2065 6e67 696e  e__} - set engin
+000051a0: 6520 636f 6e66 6967 2065 7272 6f72 3a20  e config error: 
+000051b0: 6b65 7920 277b 6b65 797d 2720 6e6f 7420  key '{key}' not 
+000051c0: 7375 7070 6f72 7422 290d 0a20 2020 2020  support")..     
+000051d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000051e0: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
+000051f0: 200d 0a20 2020 2020 2020 2069 6620 7365   ..        if se
+00005200: 6c66 2e69 735f 6175 7468 3a0d 0a20 2020  lf.is_auth:..   
+00005210: 2020 2020 2020 2020 2075 726c 203d 2061           url = a
+00005220: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+00005230: 7365 6c66 2e75 726c 2c20 6b65 793d 7261  self.url, key=ra
+00005240: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+00005250: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+00005260: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+00005270: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+00005280: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+00005290: 2020 2020 2074 6f6b 656e 203d 2061 6573       token = aes
+000052a0: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
+000052b0: 6c66 2e74 6f6b 656e 2c20 6b65 793d 7261  lf.token, key=ra
+000052c0: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+000052d0: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+000052e0: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+000052f0: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+00005300: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+00005310: 2020 2020 2072 6573 203d 2072 6571 7565       res = reque
+00005320: 7374 732e 706f 7374 2875 726c 2b66 227b  sts.post(url+f"{
+00005330: 6d6f 756e 745f 7061 7468 7d2f 636f 6e66  mount_path}/conf
+00005340: 6967 222c 2068 6561 6465 7273 3d7b 2258  ig", headers={"X
+00005350: 2d56 6175 6c74 2d54 6f6b 656e 223a 2074  -Vault-Token": t
+00005360: 6f6b 656e 7d2c 2064 6174 613d 6366 6729  oken}, data=cfg)
+00005370: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00005380: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
+00005390: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
+000053a0: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+000053b0: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
+000053c0: 2020 2020 7265 7475 726e 2054 7275 650d      return True.
+000053d0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000053e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000053f0: 2020 2020 7365 6c66 2e5f 6c6f 675f 6572      self._log_er
+00005400: 726f 725f 7265 7370 6f6e 7365 285f 5f63  ror_response(__c
+00005410: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
+00005420: 2072 6573 2c20 2273 6574 2065 6e67 696e   res, "set engin
+00005430: 6520 636f 6e66 6967 2065 7272 6f72 2229  e config error")
+00005440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005450: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
+00005460: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00005470: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
+00005480: 2020 2020 0d0a 2020 2020 6465 6620 7265      ..    def re
+00005490: 6164 5f65 6e67 696e 655f 636f 6e66 6967  ad_engine_config
+000054a0: 2873 656c 662c 206d 6f75 6e74 5f70 6174  (self, mount_pat
+000054b0: 683a 2073 7472 293a 0d0a 2020 2020 2020  h: str):..      
+000054c0: 2020 2222 2272 6561 6420 7468 6520 636f    """read the co
+000054d0: 6e66 6967 7572 6174 696f 6e20 6f66 2074  nfiguration of t
+000054e0: 6865 2073 6563 7265 7420 656e 6769 6e65  he secret engine
+000054f0: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
+00005500: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+00005510: 6f75 6e74 5f70 6174 6820 2873 7472 290d  ount_path (str).
+00005520: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00005530: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+00005540: 2064 6963 7420 6f72 204e 6f6e 653a 2072   dict or None: r
+00005550: 6574 7572 6e20 6120 6469 6374 2069 6620  eturn a dict if 
+00005560: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
+00005570: 7365 2072 6574 7572 6e20 4e6f 6e65 0d0a  se return None..
+00005580: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00005590: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+000055a0: 6175 7468 3a0d 0a20 2020 2020 2020 2020  auth:..         
+000055b0: 2020 2075 726c 203d 2061 6573 5f64 6563     url = aes_dec
+000055c0: 7279 7074 5f74 6578 7428 7365 6c66 2e75  rypt_text(self.u
+000055d0: 726c 2c20 6b65 793d 7261 6e64 6f6d 5f68  rl, key=random_h
+000055e0: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
+000055f0: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
+00005600: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
+00005610: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
+00005620: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
+00005630: 6f6b 656e 203d 2061 6573 5f64 6563 7279  oken = aes_decry
+00005640: 7074 5f74 6578 7428 7365 6c66 2e74 6f6b  pt_text(self.tok
+00005650: 656e 2c20 6b65 793d 7261 6e64 6f6d 5f68  en, key=random_h
+00005660: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
+00005670: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
+00005680: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
+00005690: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
+000056a0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+000056b0: 6573 203d 2072 6571 7565 7374 732e 6765  es = requests.ge
+000056c0: 7428 7572 6c2b 6622 7b6d 6f75 6e74 5f70  t(url+f"{mount_p
+000056d0: 6174 687d 2f63 6f6e 6669 6722 2c20 6865  ath}/config", he
+000056e0: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+000056f0: 546f 6b65 6e22 3a20 746f 6b65 6e7d 290d  Token": token}).
+00005700: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005710: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+00005720: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
+00005730: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
+00005740: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005750: 2020 2072 6574 7572 6e20 7265 732e 6a73     return res.js
+00005760: 6f6e 2829 5b22 6461 7461 225d 0d0a 2020  on()["data"]..  
+00005770: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00005780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005790: 2073 656c 662e 5f6c 6f67 5f65 7272 6f72   self._log_error
+000057a0: 5f72 6573 706f 6e73 6528 5f5f 636c 6173  _response(__clas
+000057b0: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265  s__.__name__, re
+000057c0: 732c 2022 7265 6164 2065 6e67 696e 6520  s, "read engine 
+000057d0: 636f 6e66 6967 2065 7272 6f72 2229 0d0a  config error")..
+000057e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057f0: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+00005800: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00005810: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+00005820: 2020 2020 0d0a 2020 2020 6465 6620 7265      ..    def re
+00005830: 6164 5f73 6563 7265 7428 7365 6c66 2c20  ad_secret(self, 
+00005840: 6d6f 756e 745f 7061 7468 3a20 7374 722c  mount_path: str,
+00005850: 2070 6174 683a 2073 7472 2c20 6b65 793a   path: str, key:
+00005860: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00005870: 204e 6f6e 652c 2076 6572 7369 6f6e 3a20   None, version: 
+00005880: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+00005890: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+000058a0: 2222 2272 6561 6420 7365 6372 6574 2066  """read secret f
+000058b0: 726f 6d20 226d 6f75 6e74 5f70 6174 682f  rom "mount_path/
+000058c0: 7061 7468 220d 0a0d 0a20 2020 2020 2020  path"....       
+000058d0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
+000058e0: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
+000058f0: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
+00005900: 2020 7061 7468 2028 7374 7229 0d0a 2020    path (str)..  
+00005910: 2020 2020 2020 2020 2020 6b65 7920 284f            key (O
+00005920: 7074 696f 6e61 6c5b 7374 725d 2c20 6f70  ptional[str], op
+00005930: 7469 6f6e 616c 293a 2072 6561 6420 6120  tional): read a 
+00005940: 7370 6563 6966 6963 2073 6563 7265 742e  specific secret.
+00005950: 2069 6620 4e6f 6e65 2c20 7265 7475 726e   if None, return
+00005960: 2061 6c6c 2073 6563 7265 7473 2069 6e20   all secrets in 
+00005970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005990: 2020 2020 2020 2020 2020 2020 2022 6d6f               "mo
+000059a0: 756e 745f 7061 7468 2f70 6174 6822 2e20  unt_path/path". 
+000059b0: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
+000059c0: 2e0d 0a20 2020 2020 2020 2020 2020 2076  ...            v
+000059d0: 6572 7369 6f6e 2028 4f70 7469 6f6e 616c  ersion (Optional
+000059e0: 5b69 6e74 5d2c 206f 7074 696f 6e61 6c29  [int], optional)
+000059f0: 3a20 7265 6164 2061 2073 7065 6369 6669  : read a specifi
+00005a00: 6320 7665 7273 696f 6e20 6f66 2073 6563  c version of sec
+00005a10: 7265 742e 2069 6620 4e6f 6e65 2c20 7265  ret. if None, re
+00005a20: 7475 726e 2074 6865 200d 0a20 2020 2020  turn the ..     
+00005a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a50: 2020 2020 2020 2020 2020 6c61 7465 7374            latest
+00005a60: 2076 6572 7369 6f6e 206f 6620 7365 6372   version of secr
+00005a70: 6574 2e20 4465 6661 756c 7473 2074 6f20  et. Defaults to 
+00005a80: 4e6f 6e65 2e0d 0a0d 0a20 2020 2020 2020  None.....       
+00005a90: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
+00005aa0: 2020 2020 2020 2064 6963 742c 2064 6963         dict, dic
+00005ab0: 743a 2072 6574 7572 6e20 7477 6f20 6469  t: return two di
+00005ac0: 6374 7320 636f 7272 6573 706f 6e64 696e  cts correspondin
+00005ad0: 6720 746f 2073 6563 7265 7420 616e 6420  g to secret and 
+00005ae0: 6d65 7461 6461 7461 2069 6620 7375 6363  metadata if succ
+00005af0: 6573 730d 0a20 2020 2020 2020 2020 2020  ess..           
+00005b00: 204e 6f6e 653a 2072 6574 7572 6e20 4e6f   None: return No
+00005b10: 6e65 2069 6620 6661 696c 0d0a 2020 2020  ne if fail..    
+00005b20: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00005b30: 2069 6620 7365 6c66 2e69 735f 6175 7468   if self.is_auth
+00005b40: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
+00005b50: 6c6c 5f76 6572 7369 6f6e 7320 3d20 7365  ll_versions = se
+00005b60: 6c66 2e67 6574 5f61 6c6c 5f73 6563 7265  lf.get_all_secre
+00005b70: 745f 7665 7273 696f 6e73 286d 6f75 6e74  t_versions(mount
+00005b80: 5f70 6174 682c 2070 6174 6829 0d0a 2020  _path, path)..  
+00005b90: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
+00005ba0: 5f76 6572 7369 6f6e 7320 6973 204e 6f6e  _versions is Non
+00005bb0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00005bc0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+00005bd0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00005be0: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+00005bf0: 7273 696f 6e20 6973 206e 6f74 204e 6f6e  rsion is not Non
+00005c00: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00005c10: 2020 2020 6966 2073 7472 2876 6572 7369      if str(versi
+00005c20: 6f6e 2920 6e6f 7420 696e 2061 6c6c 5f76  on) not in all_v
+00005c30: 6572 7369 6f6e 732e 6b65 7973 2829 3a0d  ersions.keys():.
+00005c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005c50: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00005c60: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+00005c70: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+00005c80: 7265 6164 2073 6563 7265 7420 6572 726f  read secret erro
+00005c90: 723a 2076 6572 7369 6f6e 2027 7b76 6572  r: version '{ver
+00005ca0: 7369 6f6e 7d27 206e 6f74 2066 6f75 6e64  sion}' not found
+00005cb0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00005cc0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00005cd0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00005ce0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00005cf0: 2020 2020 2020 2069 6620 616c 6c5f 7665         if all_ve
+00005d00: 7273 696f 6e73 5b73 7472 2876 6572 7369  rsions[str(versi
+00005d10: 6f6e 295d 5b22 6465 7374 726f 7965 6422  on)]["destroyed"
+00005d20: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00005d30: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00005d40: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+00005d50: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00005d60: 202d 2072 6561 6420 7365 6372 6574 2065   - read secret e
+00005d70: 7272 6f72 3a20 7665 7273 696f 6e20 277b  rror: version '{
+00005d80: 7665 7273 696f 6e7d 2720 6861 7320 220d  version}' has ".
+00005d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005db0: 2020 2020 2020 2066 2262 6565 6e20 7065         f"been pe
+00005dc0: 726d 616e 656e 746c 7920 6465 7374 726f  rmanently destro
+00005dd0: 7965 6422 290d 0a20 2020 2020 2020 2020  yed")..         
+00005de0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00005df0: 6e20 4e6f 6e65 0d0a 0d0a 2020 2020 2020  n None....      
+00005e00: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
+00005e10: 5f76 6572 7369 6f6e 735b 7374 7228 7665  _versions[str(ve
+00005e20: 7273 696f 6e29 5d5b 2264 656c 6574 6564  rsion)]["deleted
+00005e30: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+00005e40: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00005e50: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+00005e60: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00005e70: 7d20 2d20 7265 6164 2073 6563 7265 7420  } - read secret 
+00005e80: 6572 726f 723a 2076 6572 7369 6f6e 2027  error: version '
+00005e90: 7b76 6572 7369 6f6e 7d27 2068 6173 2022  {version}' has "
+00005ea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ec0: 2020 2020 2020 2020 6622 6265 656e 2064          f"been d
+00005ed0: 656c 6574 6564 2c20 706c 6561 7365 2075  eleted, please u
+00005ee0: 6e64 656c 6574 6520 6974 2066 6972 7374  ndelete it first
+00005ef0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00005f00: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00005f10: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00005f20: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00005f30: 2020 2020 2020 2020 7665 7273 696f 6e20          version 
+00005f40: 3d20 616c 6c5f 7665 7273 696f 6e73 5b22  = all_versions["
+00005f50: 6375 7272 656e 745f 7665 7273 696f 6e22  current_version"
+00005f60: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00005f70: 2020 2073 7769 7463 685f 6375 7272 656e     switch_curren
+00005f80: 745f 7665 7273 696f 6e20 3d20 4661 6c73  t_version = Fals
+00005f90: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00005fa0: 2020 2069 6620 616c 6c5f 7665 7273 696f     if all_versio
+00005fb0: 6e73 5b73 7472 2876 6572 7369 6f6e 295d  ns[str(version)]
+00005fc0: 5b22 6465 7374 726f 7965 6422 5d3a 0d0a  ["destroyed"]:..
+00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fe0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00005ff0: 7761 726e 696e 6728 6622 7b5f 5f63 6c61  warning(f"{__cla
+00006000: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+00006010: 2072 6561 6420 7365 6372 6574 2077 6172   read secret war
+00006020: 6e69 6e67 3a20 6375 7272 656e 7420 7665  ning: current ve
+00006030: 7273 696f 6e20 277b 7665 7273 696f 6e7d  rsion '{version}
+00006040: 2720 220d 0a20 2020 2020 2020 2020 2020  ' "..           
+00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006060: 2020 2020 2020 2020 2020 2020 2066 2268               f"h
+00006070: 6173 2062 6565 6e20 7065 726d 616e 656e  as been permanen
+00006080: 746c 7920 6465 7374 726f 7965 642c 2073  tly destroyed, s
+00006090: 7769 7463 6869 6e67 2074 6f20 616e 6f74  witching to anot
+000060a0: 6865 7220 7665 7273 696f 6e2e 2e2e 2229  her version...")
+000060b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000060c0: 2020 2020 2020 7377 6974 6368 5f63 7572        switch_cur
+000060d0: 7265 6e74 5f76 6572 7369 6f6e 203d 2054  rent_version = T
+000060e0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+000060f0: 2020 2020 2069 6620 616c 6c5f 7665 7273       if all_vers
+00006100: 696f 6e73 5b73 7472 2876 6572 7369 6f6e  ions[str(version
+00006110: 295d 5b22 6465 6c65 7465 6422 5d3a 0d0a  )]["deleted"]:..
+00006120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006130: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00006140: 7761 726e 696e 6728 6622 7b5f 5f63 6c61  warning(f"{__cla
+00006150: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+00006160: 2072 6561 6420 7365 6372 6574 2077 6172   read secret war
+00006170: 6e69 6e67 3a20 6375 7272 656e 7420 7665  ning: current ve
+00006180: 7273 696f 6e20 277b 7665 7273 696f 6e7d  rsion '{version}
+00006190: 2720 220d 0a20 2020 2020 2020 2020 2020  ' "..           
+000061a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061b0: 2020 2020 2020 2020 2020 2020 2066 2268               f"h
+000061c0: 6173 2062 6565 6e20 6465 6c65 7465 642c  as been deleted,
+000061d0: 2073 7769 7463 6869 6e67 2074 6f20 616e   switching to an
+000061e0: 6f74 6865 7220 7665 7273 696f 6e2e 2e2e  other version...
+000061f0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00006200: 2020 2020 2020 2020 7377 6974 6368 5f63          switch_c
+00006210: 7572 7265 6e74 5f76 6572 7369 6f6e 203d  urrent_version =
+00006220: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00006230: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00006240: 2020 2020 2020 2020 2069 6620 7377 6974           if swit
+00006250: 6368 5f63 7572 7265 6e74 5f76 6572 7369  ch_current_versi
+00006260: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
+00006270: 2020 2020 2020 2020 2077 6869 6c65 2054           while T
+00006280: 7275 653a 0d0a 2020 2020 2020 2020 2020  rue:..          
+00006290: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+000062a0: 7273 696f 6e20 2d3d 2031 0d0a 2020 2020  rsion -= 1..    
 000062b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000062d0: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-000062e0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-000062f0: 655f 5f7d 202d 2072 6561 6420 7365 6372  e__} - read secr
-00006300: 6574 2065 7272 6f72 3a20 6e6f 2061 7661  et error: no ava
-00006310: 696c 6162 6c65 2076 6572 7369 6f6e 7322  ilable versions"
-00006320: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00006330: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00006340: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-00006350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006360: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00006370: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00006380: 7374 726f 7965 6420 3d20 616c 6c5f 7665  stroyed = all_ve
-00006390: 7273 696f 6e73 5b73 7472 2876 6572 7369  rsions[str(versi
-000063a0: 6f6e 295d 5b22 6465 7374 726f 7965 6422  on)]["destroyed"
-000063b0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-000063c0: 2020 2020 2020 2020 2020 2064 656c 6574             delet
-000063d0: 6564 203d 2061 6c6c 5f76 6572 7369 6f6e  ed = all_version
-000063e0: 735b 7374 7228 7665 7273 696f 6e29 5d5b  s[str(version)][
-000063f0: 2264 656c 6574 6564 225d 0d0a 2020 2020  "deleted"]..    
-00006400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006410: 2020 2020 6966 206e 6f74 2064 6573 7472      if not destr
-00006420: 6f79 6564 2061 6e64 206e 6f74 2064 656c  oyed and not del
-00006430: 6574 6564 3a0d 0a20 2020 2020 2020 2020  eted:..         
+000062c0: 2020 2020 6966 2073 7472 2876 6572 7369      if str(versi
+000062d0: 6f6e 2920 6e6f 7420 696e 2061 6c6c 5f76  on) not in all_v
+000062e0: 6572 7369 6f6e 732e 6b65 7973 2829 3a0d  ersions.keys():.
+000062f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006300: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00006310: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
+00006320: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
+00006330: 6d65 5f5f 7d20 2d20 7265 6164 2073 6563  me__} - read sec
+00006340: 7265 7420 6572 726f 723a 206e 6f20 6176  ret error: no av
+00006350: 6169 6c61 626c 6520 7665 7273 696f 6e73  ailable versions
+00006360: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00006370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006380: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+00006390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063a0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+000063b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000063c0: 6573 7472 6f79 6564 203d 2061 6c6c 5f76  estroyed = all_v
+000063d0: 6572 7369 6f6e 735b 7374 7228 7665 7273  ersions[str(vers
+000063e0: 696f 6e29 5d5b 2264 6573 7472 6f79 6564  ion)]["destroyed
+000063f0: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+00006400: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
+00006410: 7465 6420 3d20 616c 6c5f 7665 7273 696f  ted = all_versio
+00006420: 6e73 5b73 7472 2876 6572 7369 6f6e 295d  ns[str(version)]
+00006430: 5b22 6465 6c65 7465 6422 5d0d 0a20 2020  ["deleted"]..   
 00006440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006450: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
-00006460: 6e66 6f28 6622 7b5f 5f63 6c61 7373 5f5f  nfo(f"{__class__
-00006470: 2e5f 5f6e 616d 655f 5f7d 202d 2072 6561  .__name__} - rea
-00006480: 6420 7365 6372 6574 2069 6e66 6f3a 2073  d secret info: s
-00006490: 7769 7463 6820 746f 2076 6572 7369 6f6e  witch to version
-000064a0: 2027 7b76 6572 7369 6f6e 7d27 2229 0d0a   '{version}'")..
-000064b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064c0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-000064d0: 6b0d 0a0d 0a20 2020 2020 2020 2020 2020  k....           
-000064e0: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
-000064f0: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
-00006500: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00006510: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-00006520: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-00006530: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-00006540: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-00006550: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
-00006560: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
-00006570: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
-00006580: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00006590: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-000065a0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-000065b0: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-000065c0: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-000065d0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000065e0: 203d 2072 6571 7565 7374 732e 6765 7428   = requests.get(
-000065f0: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
-00006600: 687d 2f64 6174 612f 7b70 6174 687d 3f76  h}/data/{path}?v
-00006610: 6572 7369 6f6e 3d7b 7665 7273 696f 6e7d  ersion={version}
-00006620: 222c 2068 6561 6465 7273 3d7b 2258 2d56  ", headers={"X-V
-00006630: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
-00006640: 656e 7d29 0d0a 2020 2020 2020 2020 2020  en})..          
-00006650: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
-00006660: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
-00006670: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-00006680: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
-00006690: 2020 2020 2020 2020 6461 7461 203d 2072          data = r
-000066a0: 6573 2e6a 736f 6e28 295b 2264 6174 6122  es.json()["data"
-000066b0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-000066c0: 2020 2073 6563 7265 7420 3d20 6461 7461     secret = data
-000066d0: 5b22 6461 7461 225d 0d0a 2020 2020 2020  ["data"]..      
-000066e0: 2020 2020 2020 2020 2020 6d65 7461 6461            metada
-000066f0: 7461 203d 2064 6174 615b 226d 6574 6164  ta = data["metad
-00006700: 6174 6122 5d0d 0a20 2020 2020 2020 2020  ata"]..         
-00006710: 2020 2020 2020 2069 6620 6b65 7920 6973         if key is
-00006720: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00006730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006740: 6966 206b 6579 206e 6f74 2069 6e20 7365  if key not in se
-00006750: 6372 6574 2e6b 6579 7328 293a 0d0a 2020  cret.keys():..  
-00006760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006770: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00006780: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-00006790: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-000067a0: 2072 6561 6420 7365 6372 6574 2065 7272   read secret err
-000067b0: 6f72 3a20 6b65 7920 277b 6b65 797d 2720  or: key '{key}' 
-000067c0: 6e6f 7420 666f 756e 6422 290d 0a20 2020  not found")..   
-000067d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000067e0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000067f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006800: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00006450: 2020 2020 2069 6620 6e6f 7420 6465 7374       if not dest
+00006460: 726f 7965 6420 616e 6420 6e6f 7420 6465  royed and not de
+00006470: 6c65 7465 643a 0d0a 2020 2020 2020 2020  leted:..        
+00006480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006490: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+000064a0: 696e 666f 2866 227b 5f5f 636c 6173 735f  info(f"{__class_
+000064b0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 7265  _.__name__} - re
+000064c0: 6164 2073 6563 7265 7420 696e 666f 3a20  ad secret info: 
+000064d0: 7377 6974 6368 2074 6f20 7665 7273 696f  switch to versio
+000064e0: 6e20 277b 7665 7273 696f 6e7d 2722 290d  n '{version}'").
+000064f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006500: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00006510: 616b 0d0a 0d0a 2020 2020 2020 2020 2020  ak....          
+00006520: 2020 7572 6c20 3d20 6165 735f 6465 6372    url = aes_decr
+00006530: 7970 745f 7465 7874 2873 656c 662e 7572  ypt_text(self.ur
+00006540: 6c2c 206b 6579 3d72 616e 646f 6d5f 6865  l, key=random_he
+00006550: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+00006560: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+00006570: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+00006580: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+00006590: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+000065a0: 6b65 6e20 3d20 6165 735f 6465 6372 7970  ken = aes_decryp
+000065b0: 745f 7465 7874 2873 656c 662e 746f 6b65  t_text(self.toke
+000065c0: 6e2c 206b 6579 3d72 616e 646f 6d5f 6865  n, key=random_he
+000065d0: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+000065e0: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+000065f0: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+00006600: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+00006610: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00006620: 7320 3d20 7265 7175 6573 7473 2e67 6574  s = requests.get
+00006630: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
+00006640: 7468 7d2f 6461 7461 2f7b 7061 7468 7d3f  th}/data/{path}?
+00006650: 7665 7273 696f 6e3d 7b76 6572 7369 6f6e  version={version
+00006660: 7d22 2c20 6865 6164 6572 733d 7b22 582d  }", headers={"X-
+00006670: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
+00006680: 6b65 6e7d 290d 0a20 2020 2020 2020 2020  ken})..         
+00006690: 2020 2069 6620 7265 732e 7374 6174 7573     if res.status
+000066a0: 5f63 6f64 6520 3d3d 2032 3030 206f 7220  _code == 200 or 
+000066b0: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+000066c0: 3d3d 2032 3034 3a0d 0a20 2020 2020 2020  == 204:..       
+000066d0: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
+000066e0: 7265 732e 6a73 6f6e 2829 5b22 6461 7461  res.json()["data
+000066f0: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+00006700: 2020 2020 7365 6372 6574 203d 2064 6174      secret = dat
+00006710: 615b 2264 6174 6122 5d0d 0a20 2020 2020  a["data"]..     
+00006720: 2020 2020 2020 2020 2020 206d 6574 6164             metad
+00006730: 6174 6120 3d20 6461 7461 5b22 6d65 7461  ata = data["meta
+00006740: 6461 7461 225d 0d0a 2020 2020 2020 2020  data"]..        
+00006750: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
+00006760: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00006770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006780: 2069 6620 6b65 7920 6e6f 7420 696e 2073   if key not in s
+00006790: 6563 7265 742e 6b65 7973 2829 3a0d 0a20  ecret.keys():.. 
+000067a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000067b0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+000067c0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+000067d0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+000067e0: 2d20 7265 6164 2073 6563 7265 7420 6572  - read secret er
+000067f0: 726f 723a 206b 6579 2027 7b6b 6579 7d27  ror: key '{key}'
+00006800: 206e 6f74 2066 6f75 6e64 2229 0d0a 2020   not found")..  
 00006810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006820: 2020 2020 2073 6563 7265 7420 3d20 7365       secret = se
-00006830: 6372 6574 5b6b 6579 5d0d 0a20 2020 2020  cret[key]..     
-00006840: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00006850: 6e20 7365 6372 6574 2c20 6d65 7461 6461  n secret, metada
-00006860: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
-00006870: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00006880: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
-00006890: 5f65 7272 6f72 5f72 6573 706f 6e73 6528  _error_response(
-000068a0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-000068b0: 5f5f 2c20 7265 732c 2022 7265 6164 2073  __, res, "read s
-000068c0: 6563 7265 7420 6572 726f 7222 290d 0a20  ecret error").. 
-000068d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000068e0: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-000068f0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00006900: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-00006910: 2020 200d 0a20 2020 2064 6566 2072 6561     ..    def rea
-00006920: 645f 7365 6372 6574 5f6d 6574 6164 6174  d_secret_metadat
-00006930: 6128 7365 6c66 2c20 6d6f 756e 745f 7061  a(self, mount_pa
-00006940: 7468 3a20 7374 722c 2070 6174 683a 2073  th: str, path: s
-00006950: 7472 293a 0d0a 2020 2020 2020 2020 2222  tr):..        ""
-00006960: 2272 6561 6420 7468 6520 6d65 7461 6461  "read the metada
-00006970: 7461 206f 6620 226d 6f75 6e74 5f70 6174  ta of "mount_pat
-00006980: 682f 7061 7468 220d 0a0d 0a20 2020 2020  h/path"....     
-00006990: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
-000069a0: 2020 2020 2020 6d6f 756e 745f 7061 7468        mount_path
-000069b0: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
-000069c0: 2020 2020 7061 7468 2028 7374 7229 0d0a      path (str)..
-000069d0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000069e0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000069f0: 6469 6374 206f 7220 4e6f 6e65 3a20 7265  dict or None: re
-00006a00: 7475 726e 2061 2064 6963 7420 6966 2073  turn a dict if s
-00006a10: 7563 6365 7373 2c20 6f74 6865 7277 6973  uccess, otherwis
-00006a20: 6520 7265 7475 726e 204e 6f6e 650d 0a20  e return None.. 
-00006a30: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00006a40: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
-00006a50: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
-00006a60: 2020 7572 6c20 3d20 6165 735f 6465 6372    url = aes_decr
-00006a70: 7970 745f 7465 7874 2873 656c 662e 7572  ypt_text(self.ur
-00006a80: 6c2c 206b 6579 3d72 616e 646f 6d5f 6865  l, key=random_he
-00006a90: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
-00006aa0: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
-00006ab0: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
-00006ac0: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
-00006ad0: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-00006ae0: 6b65 6e20 3d20 6165 735f 6465 6372 7970  ken = aes_decryp
-00006af0: 745f 7465 7874 2873 656c 662e 746f 6b65  t_text(self.toke
-00006b00: 6e2c 206b 6579 3d72 616e 646f 6d5f 6865  n, key=random_he
-00006b10: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
-00006b20: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
-00006b30: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
-00006b40: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
-00006b50: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00006b60: 7320 3d20 7265 7175 6573 7473 2e67 6574  s = requests.get
-00006b70: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
-00006b80: 7468 7d2f 6d65 7461 6461 7461 2f7b 7061  th}/metadata/{pa
-00006b90: 7468 7d22 2c20 6865 6164 6572 733d 7b22  th}", headers={"
-00006ba0: 582d 5661 756c 742d 546f 6b65 6e22 3a20  X-Vault-Token": 
-00006bb0: 746f 6b65 6e7d 290d 0a20 2020 2020 2020  token})..       
-00006bc0: 2020 2020 2069 6620 7265 732e 7374 6174       if res.stat
-00006bd0: 7573 5f63 6f64 6520 3d3d 2032 3030 206f  us_code == 200 o
-00006be0: 7220 7265 732e 7374 6174 7573 5f63 6f64  r res.status_cod
-00006bf0: 6520 3d3d 2032 3034 3a0d 0a20 2020 2020  e == 204:..     
-00006c00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00006c10: 6e20 7265 732e 6a73 6f6e 2829 5b22 6461  n res.json()["da
-00006c20: 7461 225d 0d0a 2020 2020 2020 2020 2020  ta"]..          
-00006c30: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00006c40: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-00006c50: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
-00006c60: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
-00006c70: 6d65 5f5f 2c20 7265 732c 2022 7265 6164  me__, res, "read
-00006c80: 2073 6563 7265 7420 6d65 7461 6461 7461   secret metadata
-00006c90: 2065 7272 6f72 2229 0d0a 2020 2020 2020   error")..      
-00006ca0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00006cb0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-00006cc0: 2020 200d 0a20 2020 2020 2020 2072 6574     ..        ret
-00006cd0: 7572 6e20 4e6f 6e65 0d0a 2020 2020 0d0a  urn None..    ..
-00006ce0: 2020 2020 6465 6620 6765 745f 616c 6c5f      def get_all_
-00006cf0: 7365 6372 6574 5f76 6572 7369 6f6e 7328  secret_versions(
-00006d00: 7365 6c66 2c20 6d6f 756e 745f 7061 7468  self, mount_path
-00006d10: 3a20 7374 722c 2070 6174 683a 2073 7472  : str, path: str
-00006d20: 293a 0d0a 2020 2020 2020 2020 2222 2267  ):..        """g
-00006d30: 6574 2061 6c6c 2061 7661 696c 6162 6c65  et all available
-00006d40: 2073 6563 7265 7420 7665 7273 696f 6e73   secret versions
-00006d50: 2069 6e20 226d 6f75 6e74 5f70 6174 682f   in "mount_path/
-00006d60: 7061 7468 220d 0a0d 0a20 2020 2020 2020  path"....       
-00006d70: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00006d80: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-00006d90: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-00006da0: 2020 7061 7468 2028 7374 7229 0d0a 0d0a    path (str)....
-00006db0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00006dc0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-00006dd0: 6374 206f 7220 4e6f 6e65 3a20 7265 7475  ct or None: retu
-00006de0: 726e 2061 2064 6963 7420 6966 2073 7563  rn a dict if suc
-00006df0: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
-00006e00: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-00006e10: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00006e20: 2020 2052 6575 726e 7320 6578 616d 706c     Reurns exampl
-00006e30: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00006e40: 4966 2074 6865 2063 6f6e 6669 6775 7261  If the configura
-00006e50: 7469 6f6e 206f 6620 7468 6520 7365 6372  tion of the secr
-00006e60: 6574 2065 6e67 696e 6520 6973 206d 6178  et engine is max
-00006e70: 5f76 6572 7369 6f6e 733d 332e 0d0a 2020  _versions=3...  
-00006e80: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00006e90: 2020 2020 2020 2020 4966 2074 6865 2073          If the s
-00006ea0: 6563 7265 7420 656e 6769 6e65 2068 6173  ecret engine has
-00006eb0: 206f 6e6c 7920 7265 636f 7264 6564 2032   only recorded 2
-00006ec0: 2076 6572 7369 6f6e 7320 7369 6e63 6520   versions since 
-00006ed0: 6372 6561 7465 642c 2074 6865 2022 7665  created, the "ve
-00006ee0: 7273 696f 6e73 2220 7265 7475 726e 7320  rsions" returns 
-00006ef0: 776f 756c 6420 6265 3a0d 0a20 2020 2020  would be:..     
-00006f00: 2020 2020 2020 203e 3e3e 2076 6572 7369         >>> versi
-00006f10: 6f6e 7320 3d20 7b22 6375 7272 656e 745f  ons = {"current_
-00006f20: 7665 7273 696f 6e22 3a20 322c 200d 0a20  version": 2, .. 
-00006f30: 2020 2020 2020 2020 2020 203e 3e3e 2020             >>>  
-00006f40: 2020 2020 2020 2020 2020 2022 3222 3a20             "2": 
-00006f50: 7b22 6465 7374 726f 7965 6422 3a20 626f  {"destroyed": bo
-00006f60: 6f6c 2c20 2264 656c 6574 6564 223a 2062  ol, "deleted": b
-00006f70: 6f6f 6c7d 2c20 0d0a 2020 2020 2020 2020  ool}, ..        
-00006f80: 2020 2020 3e3e 3e20 2020 2020 2020 2020      >>>         
-00006f90: 2020 2020 2231 223a 207b 2264 6573 7472      "1": {"destr
-00006fa0: 6f79 6564 223a 2062 6f6f 6c2c 2022 6465  oyed": bool, "de
-00006fb0: 6c65 7465 6422 3a20 626f 6f6c 7d7d 0d0a  leted": bool}}..
-00006fc0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00006fd0: 2020 2020 2020 2020 2020 5468 6520 6b65            The ke
-00006fe0: 7920 2263 7572 7265 6e74 5f76 6572 7369  y "current_versi
-00006ff0: 6f6e 2220 6973 2074 6865 206c 6174 6573  on" is the lates
-00007000: 7420 7665 7273 696f 6e20 6e75 6d62 6572  t version number
-00007010: 2c20 616e 6420 6b65 7920 2264 6573 7472  , and key "destr
-00007020: 6f79 6564 2220 7265 7072 6573 656e 7473  oyed" represents
-00007030: 2069 6620 7468 6973 2076 6572 7369 6f6e   if this version
-00007040: 206f 660d 0a20 2020 2020 2020 2020 2020   of..           
-00007050: 2073 6563 7265 7420 6861 7320 6265 656e   secret has been
-00007060: 2070 6572 6d61 6e65 6e74 6c79 2064 6573   permanently des
-00007070: 7472 6f79 6564 2c20 616e 6420 6b65 7920  troyed, and key 
-00007080: 2264 656c 6574 6564 2220 7265 7072 6573  "deleted" repres
-00007090: 656e 7473 2069 6620 6974 2068 6173 2062  ents if it has b
-000070a0: 6565 6e20 6465 6c65 7465 642e 0d0a 2020  een deleted...  
-000070b0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000070c0: 2020 2020 2020 2020 4966 2074 6865 2073          If the s
-000070d0: 6563 7265 7420 656e 6769 6e65 2068 6173  ecret engine has
-000070e0: 2072 6563 6f72 6465 6420 3520 7665 7273   recorded 5 vers
-000070f0: 696f 6e73 2073 696e 6365 2063 7265 6174  ions since creat
-00007100: 6564 2c20 7468 6520 2276 6572 7369 6f6e  ed, the "version
-00007110: 7322 2072 6574 7572 6e73 2077 6f75 6c64  s" returns would
-00007120: 2062 653a 0d0a 2020 2020 2020 2020 2020   be:..          
-00007130: 2020 3e3e 3e20 7665 7273 696f 6e73 203d    >>> versions =
-00007140: 207b 2263 7572 7265 6e74 5f76 6572 7369   {"current_versi
-00007150: 6f6e 223a 2035 2c0d 0a20 2020 2020 2020  on": 5,..       
-00007160: 2020 2020 203e 3e3e 2020 2020 2020 2020       >>>        
-00007170: 2020 2020 2022 3522 3a20 7b22 6465 7374       "5": {"dest
-00007180: 726f 7965 6422 3a20 626f 6f6c 2c20 2264  royed": bool, "d
-00007190: 656c 6574 6564 223a 2062 6f6f 6c7d 2c0d  eleted": bool},.
-000071a0: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
-000071b0: 2020 2020 2020 2020 2020 2020 2022 3422               "4"
-000071c0: 3a20 7b22 6465 7374 726f 7965 6422 3a20  : {"destroyed": 
-000071d0: 626f 6f6c 2c20 2264 656c 6574 6564 223a  bool, "deleted":
-000071e0: 2062 6f6f 6c7d 2c0d 0a20 2020 2020 2020   bool},..       
-000071f0: 2020 2020 203e 3e3e 2020 2020 2020 2020       >>>        
-00007200: 2020 2020 2022 3322 3a20 7b22 6465 7374       "3": {"dest
-00007210: 726f 7965 6422 3a20 626f 6f6c 2c20 2264  royed": bool, "d
-00007220: 656c 6574 6564 223a 2062 6f6f 6c7d 7d0d  eleted": bool}}.
-00007230: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00007240: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
-00007250: 5f61 7574 683a 0d0a 2020 2020 2020 2020  _auth:..        
-00007260: 2020 2020 7365 6372 6574 5f6d 6574 6164      secret_metad
-00007270: 6174 6120 3d20 7365 6c66 2e72 6561 645f  ata = self.read_
-00007280: 7365 6372 6574 5f6d 6574 6164 6174 6128  secret_metadata(
-00007290: 6d6f 756e 745f 7061 7468 2c20 7061 7468  mount_path, path
-000072a0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-000072b0: 6620 7365 6372 6574 5f6d 6574 6164 6174  f secret_metadat
-000072c0: 6120 6973 204e 6f6e 653a 0d0a 2020 2020  a is None:..    
-000072d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000072e0: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
-000072f0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00007300: 2020 2076 6572 7369 6f6e 735f 6d65 7461     versions_meta
-00007310: 203d 2073 6563 7265 745f 6d65 7461 6461   = secret_metada
-00007320: 7461 5b22 7665 7273 696f 6e73 225d 0d0a  ta["versions"]..
-00007330: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-00007340: 696f 6e73 203d 207b 2263 7572 7265 6e74  ions = {"current
-00007350: 5f76 6572 7369 6f6e 223a 2073 6563 7265  _version": secre
-00007360: 745f 6d65 7461 6461 7461 5b22 6375 7272  t_metadata["curr
-00007370: 656e 745f 7665 7273 696f 6e22 5d7d 0d0a  ent_version"]}..
-00007380: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00007390: 7665 7273 696f 6e20 696e 2076 6572 7369  version in versi
-000073a0: 6f6e 735f 6d65 7461 2e6b 6579 7328 293a  ons_meta.keys():
-000073b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000073c0: 2020 6465 7374 726f 7965 6420 3d20 7665    destroyed = ve
-000073d0: 7273 696f 6e73 5f6d 6574 615b 7665 7273  rsions_meta[vers
-000073e0: 696f 6e5d 5b22 6465 7374 726f 7965 6422  ion]["destroyed"
-000073f0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00007400: 2020 2064 656c 6574 6564 203d 2076 6572     deleted = ver
-00007410: 7369 6f6e 735f 6d65 7461 5b76 6572 7369  sions_meta[versi
-00007420: 6f6e 5d5b 2264 656c 6574 696f 6e5f 7469  on]["deletion_ti
-00007430: 6d65 225d 2021 3d20 2222 0d0a 2020 2020  me"] != ""..    
-00007440: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-00007450: 696f 6e73 5b76 6572 7369 6f6e 5d20 3d20  ions[version] = 
-00007460: 7b22 6465 7374 726f 7965 6422 3a20 6465  {"destroyed": de
-00007470: 7374 726f 7965 642c 2022 6465 6c65 7465  stroyed, "delete
-00007480: 6422 3a20 6465 6c65 7465 647d 0d0a 2020  d": deleted}..  
-00007490: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000074a0: 2020 2020 2020 2020 7265 7475 726e 2076          return v
-000074b0: 6572 7369 6f6e 730d 0a20 2020 2020 2020  ersions..       
-000074c0: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
-000074d0: 6e20 4e6f 6e65 0d0a 2020 2020 0d0a 2020  n None..    ..  
-000074e0: 2020 6465 6620 6164 645f 7365 6372 6574    def add_secret
-000074f0: 2873 656c 662c 200d 0a20 2020 2020 2020  (self, ..       
-00007500: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-00007510: 745f 7061 7468 3a20 7374 722c 200d 0a20  t_path: str, .. 
-00007520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007530: 2020 7061 7468 3a20 7374 722c 200d 0a20    path: str, .. 
-00007540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007550: 2020 7365 6372 6574 733a 2055 6e69 6f6e    secrets: Union
-00007560: 5b64 6963 742c 2043 6f6e 6669 6744 6963  [dict, ConfigDic
-00007570: 745d 2c20 0d0a 2020 2020 2020 2020 2020  t], ..          
-00007580: 2020 2020 2020 2020 206f 7074 696f 6e73           options
-00007590: 3a20 556e 696f 6e5b 6469 6374 2c20 436f  : Union[dict, Co
-000075a0: 6e66 6967 4469 6374 5d20 3d20 4e6f 6e65  nfigDict] = None
-000075b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000075c0: 2020 2020 2020 7665 7273 696f 6e3a 204f        version: O
-000075d0: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-000075e0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
-000075f0: 2222 6164 6420 7365 6372 6574 7320 746f  ""add secrets to
-00007600: 2022 6d6f 756e 745f 7061 7468 2f70 6174   "mount_path/pat
-00007610: 6822 0d0a 2020 2020 2020 2020 5265 6665  h"..        Refe
-00007620: 7220 746f 2068 7474 7073 3a2f 2f64 6576  r to https://dev
-00007630: 656c 6f70 6572 2e68 6173 6869 636f 7270  eloper.hashicorp
-00007640: 2e63 6f6d 2f76 6175 6c74 2f61 7069 2d64  .com/vault/api-d
-00007650: 6f63 732f 7365 6372 6574 2f6b 762f 6b76  ocs/secret/kv/kv
-00007660: 2d76 3223 6f70 7469 6f6e 7320 666f 7220  -v2#options for 
-00007670: 6d6f 7265 2064 6574 6169 6c73 2061 626f  more details abo
-00007680: 7574 206f 7074 696f 6e73 2e0d 0a20 2020  ut options...   
-00007690: 2020 2020 200d 0a20 2020 2020 2020 2059       ..        Y
-000076a0: 6f75 2064 6f20 6e6f 7420 6e65 6564 2074  ou do not need t
-000076b0: 6f20 7370 6563 6966 7920 616c 6c20 7468  o specify all th
-000076c0: 6520 7375 626b 6579 7320 6f66 2073 6563  e subkeys of sec
-000076d0: 7265 7473 2c20 6f6e 6c79 2074 6865 2073  rets, only the s
-000076e0: 7562 6b65 7973 2074 6861 7420 6e65 6564  ubkeys that need
-000076f0: 2074 6f20 6265 2061 6464 6564 2c20 7768   to be added, wh
-00007700: 6963 6820 6973 2063 6f6e 7665 6e69 656e  ich is convenien
-00007710: 742e 0d0a 0d0a 2020 2020 2020 2020 4172  t.....        Ar
-00007720: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-00007730: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
-00007740: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-00007750: 6174 6820 2873 7472 290d 0a20 2020 2020  ath (str)..     
-00007760: 2020 2020 2020 2073 6563 7265 7473 2028         secrets (
-00007770: 556e 696f 6e5b 6469 6374 2c20 436f 6e66  Union[dict, Conf
-00007780: 6967 4469 6374 5d29 0d0a 2020 2020 2020  igDict])..      
-00007790: 2020 2020 2020 6f70 7469 6f6e 7320 2855        options (U
-000077a0: 6e69 6f6e 5b64 6963 742c 2043 6f6e 6669  nion[dict, Confi
-000077b0: 6744 6963 745d 2c20 6f70 7469 6f6e 616c  gDict], optional
-000077c0: 293a 2044 6566 6175 6c74 7320 746f 204e  ): Defaults to N
-000077d0: 6f6e 652e 0d0a 2020 2020 2020 2020 2020  one...          
-000077e0: 2020 7665 7273 696f 6e20 284f 7074 696f    version (Optio
-000077f0: 6e61 6c5b 696e 745d 2c20 6f70 7469 6f6e  nal[int], option
-00007800: 616c 293a 2061 6464 2073 6563 7265 7473  al): add secrets
-00007810: 2062 6173 6564 206f 6e20 6120 7370 6563   based on a spec
-00007820: 6966 6963 2076 6572 7369 6f6e 2e20 6966  ific version. if
-00007830: 204e 6f6e 652c 2062 6173 6564 206f 6e20   None, based on 
-00007840: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007870: 2074 6865 206c 6174 6573 7420 7665 7273   the latest vers
-00007880: 696f 6e2e 2044 6566 6175 6c74 7320 746f  ion. Defaults to
-00007890: 204e 6f6e 652e 0d0a 0d0a 2020 2020 2020   None.....      
-000078a0: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
-000078b0: 2020 2020 2020 2020 626f 6f6c 3a20 7265          bool: re
-000078c0: 7475 726e 2054 7275 6520 6966 2073 7563  turn True if suc
-000078d0: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
-000078e0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-000078f0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00007900: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
-00007910: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
-00007920: 2069 6620 6e6f 7420 6973 5f64 6963 7428   if not is_dict(
-00007930: 7365 6372 6574 7329 3a0d 0a20 2020 2020  secrets):..     
-00007940: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007950: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-00007960: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00007970: 5f5f 7d20 2d20 6164 6420 7365 6372 6574  __} - add secret
-00007980: 2065 7272 6f72 3a20 7365 6372 6574 7320   error: secrets 
-00007990: 6d75 7374 2062 6520 6120 6469 6374 206f  must be a dict o
-000079a0: 7220 436f 6e66 6967 4469 6374 2229 0d0a  r ConfigDict")..
-000079b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079c0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-000079d0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-000079e0: 286c 6973 7428 7365 6372 6574 732e 6b65  (list(secrets.ke
-000079f0: 7973 2829 2929 203d 3d20 303a 0d0a 2020  ys())) == 0:..  
-00007a00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00007a10: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00007a20: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00007a30: 616d 655f 5f7d 202d 2061 6464 2073 6563  ame__} - add sec
-00007a40: 7265 7420 6572 726f 723a 2073 6563 7265  ret error: secre
-00007a50: 7473 206d 7573 7420 6e6f 7420 6265 2065  ts must not be e
-00007a60: 6d70 7479 2229 0d0a 2020 2020 2020 2020  mpty")..        
-00007a70: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00007a80: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-00007a90: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00007aa0: 6578 6973 7473 5f73 6563 7265 7473 203d  exists_secrets =
-00007ab0: 2073 656c 662e 7265 6164 5f73 6563 7265   self.read_secre
-00007ac0: 7428 6d6f 756e 745f 7061 7468 2c20 7061  t(mount_path, pa
-00007ad0: 7468 2c20 7665 7273 696f 6e3d 7665 7273  th, version=vers
-00007ae0: 696f 6e29 0d0a 2020 2020 2020 2020 2020  ion)..          
-00007af0: 2020 6966 2065 7869 7374 735f 7365 6372    if exists_secr
-00007b00: 6574 7320 6973 206e 6f74 204e 6f6e 653a  ets is not None:
-00007b10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007b20: 2020 6578 6973 7473 5f73 6563 7265 7473    exists_secrets
-00007b30: 203d 2065 7869 7374 735f 7365 6372 6574   = exists_secret
-00007b40: 735b 305d 0d0a 2020 2020 2020 2020 2020  s[0]..          
-00007b50: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
-00007b60: 2065 7869 7374 735f 7365 6372 6574 732e   exists_secrets.
-00007b70: 6b65 7973 2829 3a0d 0a20 2020 2020 2020  keys():..       
-00007b80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00007b90: 6b65 7920 696e 2073 6563 7265 7473 2e6b  key in secrets.k
-00007ba0: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
-00007bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007bc0: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
-00007bd0: 696e 6728 6622 7b5f 5f63 6c61 7373 5f5f  ing(f"{__class__
-00007be0: 2e5f 5f6e 616d 655f 5f7d 202d 2061 6464  .__name__} - add
-00007bf0: 2073 6563 7265 7420 6572 726f 723a 206b   secret error: k
-00007c00: 6579 2027 7b6b 6579 7d27 2061 6c72 6561  ey '{key}' alrea
-00007c10: 6479 2065 7869 7374 7322 290d 0a20 2020  dy exists")..   
-00007c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c30: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00007c40: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00007c50: 2020 2020 2020 2073 6563 7265 7473 5b6b         secrets[k
-00007c60: 6579 5d20 3d20 6578 6973 7473 5f73 6563  ey] = exists_sec
-00007c70: 7265 7473 5b6b 6579 5d0d 0a20 2020 2020  rets[key]..     
-00007c80: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00007c90: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00007ca0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-00007cb0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00007cc0: 2020 2020 2020 6966 206f 7074 696f 6e73        if options
-00007cd0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00007ce0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00007cf0: 6620 6e6f 7420 6973 5f64 6963 7428 6f70  f not is_dict(op
-00007d00: 7469 6f6e 7329 3a0d 0a20 2020 2020 2020  tions):..       
-00007d10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00007d20: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-00007d30: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-00007d40: 6d65 5f5f 7d20 2d20 6164 6420 7365 6372  me__} - add secr
-00007d50: 6574 2065 7272 6f72 3a20 6f70 7469 6f6e  et error: option
-00007d60: 7320 6d75 7374 2062 6520 6120 6469 6374  s must be a dict
-00007d70: 206f 7220 436f 6e66 6967 4469 6374 2229   or ConfigDict")
-00007d80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007d90: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00007da0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00007db0: 2020 2020 6461 7461 203d 2064 6963 7428      data = dict(
-00007dc0: 6f70 7469 6f6e 733d 6f70 7469 6f6e 732c  options=options,
-00007dd0: 2064 6174 613d 7365 6372 6574 7329 0d0a   data=secrets)..
-00007de0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00007df0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00007e00: 2020 2064 6174 6120 3d20 6469 6374 2864     data = dict(d
-00007e10: 6174 613d 7365 6372 6574 7329 0d0a 2020  ata=secrets)..  
-00007e20: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00007e30: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
-00007e40: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-00007e50: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
-00007e60: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-00007e70: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-00007e80: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-00007e90: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-00007ea0: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-00007eb0: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
-00007ec0: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
-00007ed0: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
-00007ee0: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-00007ef0: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-00007f00: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-00007f10: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-00007f20: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-00007f30: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
-00007f40: 7473 2e70 6f73 7428 7572 6c2b 6622 7b6d  ts.post(url+f"{m
-00007f50: 6f75 6e74 5f70 6174 687d 2f64 6174 612f  ount_path}/data/
-00007f60: 7b70 6174 687d 222c 2068 6561 6465 7273  {path}", headers
-00007f70: 3d7b 2258 2d56 6175 6c74 2d54 6f6b 656e  ={"X-Vault-Token
-00007f80: 223a 2074 6f6b 656e 7d2c 2064 6174 613d  ": token}, data=
-00007f90: 6a73 6f6e 2e64 756d 7073 2864 6174 6129  json.dumps(data)
-00007fa0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00007fb0: 6620 7265 732e 7374 6174 7573 5f63 6f64  f res.status_cod
-00007fc0: 6520 3d3d 2032 3030 206f 7220 7265 732e  e == 200 or res.
-00007fd0: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
-00007fe0: 3034 3a0d 0a20 2020 2020 2020 2020 2020  04:..           
-00007ff0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00008000: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00008010: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00008020: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
-00008030: 7272 6f72 5f72 6573 706f 6e73 6528 5f5f  rror_response(__
-00008040: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00008050: 2c20 7265 732c 2022 6164 6420 7365 6372  , res, "add secr
-00008060: 6574 2065 7272 6f72 2229 0d0a 2020 2020  et error")..    
-00008070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008080: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-00008090: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000080a0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-000080b0: 2020 0d0a 2020 2020 6465 6620 7570 6461    ..    def upda
-000080c0: 7465 5f73 6563 7265 7428 7365 6c66 2c0d  te_secret(self,.
-000080d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000080e0: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
-000080f0: 683a 2073 7472 2c20 0d0a 2020 2020 2020  h: str, ..      
-00008100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008110: 7061 7468 3a20 7374 722c 0d0a 2020 2020  path: str,..    
-00008120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008130: 2020 7365 6372 6574 733a 2055 6e69 6f6e    secrets: Union
-00008140: 5b64 6963 742c 2043 6f6e 6669 6744 6963  [dict, ConfigDic
-00008150: 745d 2c0d 0a20 2020 2020 2020 2020 2020  t],..           
-00008160: 2020 2020 2020 2020 2020 206f 7074 696f             optio
-00008170: 6e73 3a20 556e 696f 6e5b 6469 6374 2c20  ns: Union[dict, 
-00008180: 436f 6e66 6967 4469 6374 5d20 3d20 4e6f  ConfigDict] = No
-00008190: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-000081a0: 2020 2020 2020 2020 2020 2076 6572 7369             versi
-000081b0: 6f6e 3a20 4f70 7469 6f6e 616c 5b69 6e74  on: Optional[int
-000081c0: 5d20 3d20 4e6f 6e65 293a 0d0a 2020 2020  ] = None):..    
-000081d0: 2020 2020 2222 2275 7064 6174 6520 7365      """update se
-000081e0: 6372 6574 7320 696e 2022 6d6f 756e 745f  crets in "mount_
-000081f0: 7061 7468 2f70 6174 6822 0d0a 2020 2020  path/path"..    
-00008200: 2020 2020 5265 6665 7220 746f 2068 7474      Refer to htt
-00008210: 7073 3a2f 2f64 6576 656c 6f70 6572 2e68  ps://developer.h
-00008220: 6173 6869 636f 7270 2e63 6f6d 2f76 6175  ashicorp.com/vau
-00008230: 6c74 2f61 7069 2d64 6f63 732f 7365 6372  lt/api-docs/secr
-00008240: 6574 2f6b 762f 6b76 2d76 3223 6f70 7469  et/kv/kv-v2#opti
-00008250: 6f6e 7320 666f 7220 6d6f 7265 2064 6574  ons for more det
-00008260: 6169 6c73 2061 626f 7574 206f 7074 696f  ails about optio
-00008270: 6e73 2e0d 0a20 2020 2020 2020 200d 0a20  ns...        .. 
-00008280: 2020 2020 2020 2059 6f75 2064 6f20 6e6f         You do no
-00008290: 7420 6e65 6564 2074 6f20 7370 6563 6966  t need to specif
-000082a0: 7920 616c 6c20 7468 6520 7375 626b 6579  y all the subkey
-000082b0: 7320 6f66 2073 6563 7265 7473 2c20 6f6e  s of secrets, on
-000082c0: 6c79 2074 6865 2073 7562 6b65 7973 2074  ly the subkeys t
-000082d0: 6861 7420 6e65 6564 2074 6f20 6265 2075  hat need to be u
-000082e0: 7064 6174 6564 2c20 7768 6963 6820 6973  pdated, which is
-000082f0: 2076 6572 790d 0a20 2020 2020 2020 2073   very..        s
-00008300: 696d 696c 6172 2074 6f20 7468 6520 2250  imilar to the "P
-00008310: 6174 6368 2073 6563 7265 7422 2066 6561  atch secret" fea
-00008320: 7475 7265 2074 6861 7420 6f66 6669 6361  ture that offica
-00008330: 6c6c 7920 7375 7070 6f72 7465 642e 0d0a  lly supported...
-00008340: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
-00008350: 0a20 2020 2020 2020 2020 2020 206d 6f75  .            mou
-00008360: 6e74 5f70 6174 6820 2873 7472 290d 0a20  nt_path (str).. 
-00008370: 2020 2020 2020 2020 2020 2070 6174 6820             path 
-00008380: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
-00008390: 2020 2073 6563 7265 7473 2028 556e 696f     secrets (Unio
-000083a0: 6e5b 6469 6374 2c20 436f 6e66 6967 4469  n[dict, ConfigDi
-000083b0: 6374 5d29 0d0a 2020 2020 2020 2020 2020  ct])..          
-000083c0: 2020 6f70 7469 6f6e 7320 2855 6e69 6f6e    options (Union
-000083d0: 5b64 6963 742c 2043 6f6e 6669 6744 6963  [dict, ConfigDic
-000083e0: 745d 2c20 6f70 7469 6f6e 616c 293a 2044  t], optional): D
-000083f0: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-00008400: 0d0a 2020 2020 2020 2020 2020 2020 7665  ..            ve
-00008410: 7273 696f 6e20 284f 7074 696f 6e61 6c5b  rsion (Optional[
-00008420: 696e 745d 2c20 6f70 7469 6f6e 616c 293a  int], optional):
-00008430: 2075 7064 6174 6520 7365 6372 6574 7320   update secrets 
-00008440: 696e 2061 2073 7065 6369 6669 6320 7665  in a specific ve
-00008450: 7273 696f 6e2e 2069 6620 4e6f 6e65 2c20  rsion. if None, 
-00008460: 7570 6461 7465 2074 6865 206c 6174 6573  update the lates
-00008470: 7420 7665 7273 696f 6e2e 0d0a 2020 2020  t version...    
-00008480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084a0: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-000084b0: 6c74 7320 746f 204e 6f6e 652e 0d0a 0d0a  lts to None.....
-000084c0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-000084d0: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-000084e0: 6f6c 3a20 7265 7475 726e 2054 7275 6520  ol: return True 
-000084f0: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-00008500: 7277 6973 6520 7265 7475 726e 2046 616c  rwise return Fal
-00008510: 7365 0d0a 2020 2020 2020 2020 2222 220d  se..        """.
-00008520: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00008530: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-00008540: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00008550: 5f64 6963 7428 7365 6372 6574 7329 3a0d  _dict(secrets):.
-00008560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008570: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-00008580: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-00008590: 5f5f 6e61 6d65 5f5f 7d20 2d20 7570 6461  __name__} - upda
-000085a0: 7465 2073 6563 7265 7420 6572 726f 723a  te secret error:
-000085b0: 2073 6563 7265 7473 206d 7573 7420 6265   secrets must be
-000085c0: 2061 2064 6963 7420 6f72 2043 6f6e 6669   a dict or Confi
-000085d0: 6744 6963 7422 290d 0a20 2020 2020 2020  gDict")..       
-000085e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000085f0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-00008600: 2020 2069 6620 6c65 6e28 6c69 7374 2873     if len(list(s
-00008610: 6563 7265 7473 2e6b 6579 7328 2929 2920  ecrets.keys())) 
-00008620: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00008630: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-00008640: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-00008650: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-00008660: 2d20 7570 6461 7465 2073 6563 7265 7420  - update secret 
-00008670: 6572 726f 723a 2073 6563 7265 7473 206d  error: secrets m
-00008680: 7573 7420 6e6f 7420 6265 2065 6d70 7479  ust not be empty
-00008690: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-000086a0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000086b0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-000086c0: 2020 2020 2020 2020 2020 2020 6578 6973              exis
-000086d0: 7473 5f73 6563 7265 7473 203d 2073 656c  ts_secrets = sel
-000086e0: 662e 7265 6164 5f73 6563 7265 7428 6d6f  f.read_secret(mo
-000086f0: 756e 745f 7061 7468 2c20 7061 7468 2c20  unt_path, path, 
-00008700: 7665 7273 696f 6e3d 7665 7273 696f 6e29  version=version)
-00008710: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00008720: 2065 7869 7374 735f 7365 6372 6574 7320   exists_secrets 
-00008730: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00008740: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00008750: 6973 7473 5f73 6563 7265 7473 203d 2065  ists_secrets = e
-00008760: 7869 7374 735f 7365 6372 6574 735b 305d  xists_secrets[0]
-00008770: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008780: 2020 666f 7220 6b65 7920 696e 2073 6563    for key in sec
-00008790: 7265 7473 2e6b 6579 7328 293a 0d0a 2020  rets.keys():..  
-000087a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087b0: 2020 6966 206b 6579 206e 6f74 2069 6e20    if key not in 
-000087c0: 6578 6973 7473 5f73 6563 7265 7473 2e6b  exists_secrets.k
-000087d0: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
+00006820: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00006830: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00006840: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00006850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006860: 2020 2020 2020 7365 6372 6574 203d 2073        secret = s
+00006870: 6563 7265 745b 6b65 795d 0d0a 2020 2020  ecret[key]..    
+00006880: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006890: 726e 2073 6563 7265 742c 206d 6574 6164  rn secret, metad
+000068a0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
+000068b0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000068c0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
+000068d0: 675f 6572 726f 725f 7265 7370 6f6e 7365  g_error_response
+000068e0: 285f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  (__class__.__nam
+000068f0: 655f 5f2c 2072 6573 2c20 2272 6561 6420  e__, res, "read 
+00006900: 7365 6372 6574 2065 7272 6f72 2229 0d0a  secret error")..
+00006910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006920: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+00006930: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00006940: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+00006950: 2020 2020 0d0a 2020 2020 6465 6620 7265      ..    def re
+00006960: 6164 5f73 6563 7265 745f 6d65 7461 6461  ad_secret_metada
+00006970: 7461 2873 656c 662c 206d 6f75 6e74 5f70  ta(self, mount_p
+00006980: 6174 683a 2073 7472 2c20 7061 7468 3a20  ath: str, path: 
+00006990: 7374 7229 3a0d 0a20 2020 2020 2020 2022  str):..        "
+000069a0: 2222 7265 6164 2074 6865 206d 6574 6164  ""read the metad
+000069b0: 6174 6120 6f66 2022 6d6f 756e 745f 7061  ata of "mount_pa
+000069c0: 7468 2f70 6174 6822 0d0a 0d0a 2020 2020  th/path"....    
+000069d0: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+000069e0: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
+000069f0: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
+00006a00: 2020 2020 2070 6174 6820 2873 7472 290d       path (str).
+00006a10: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00006a20: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+00006a30: 2064 6963 7420 6f72 204e 6f6e 653a 2072   dict or None: r
+00006a40: 6574 7572 6e20 6120 6469 6374 2069 6620  eturn a dict if 
+00006a50: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
+00006a60: 7365 2072 6574 7572 6e20 4e6f 6e65 0d0a  se return None..
+00006a70: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00006a80: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+00006a90: 6175 7468 3a0d 0a20 2020 2020 2020 2020  auth:..         
+00006aa0: 2020 2075 726c 203d 2061 6573 5f64 6563     url = aes_dec
+00006ab0: 7279 7074 5f74 6578 7428 7365 6c66 2e75  rypt_text(self.u
+00006ac0: 726c 2c20 6b65 793d 7261 6e64 6f6d 5f68  rl, key=random_h
+00006ad0: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
+00006ae0: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
+00006af0: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
+00006b00: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
+00006b10: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
+00006b20: 6f6b 656e 203d 2061 6573 5f64 6563 7279  oken = aes_decry
+00006b30: 7074 5f74 6578 7428 7365 6c66 2e74 6f6b  pt_text(self.tok
+00006b40: 656e 2c20 6b65 793d 7261 6e64 6f6d 5f68  en, key=random_h
+00006b50: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
+00006b60: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
+00006b70: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
+00006b80: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
+00006b90: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00006ba0: 6573 203d 2072 6571 7565 7374 732e 6765  es = requests.ge
+00006bb0: 7428 7572 6c2b 6622 7b6d 6f75 6e74 5f70  t(url+f"{mount_p
+00006bc0: 6174 687d 2f6d 6574 6164 6174 612f 7b70  ath}/metadata/{p
+00006bd0: 6174 687d 222c 2068 6561 6465 7273 3d7b  ath}", headers={
+00006be0: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
+00006bf0: 2074 6f6b 656e 7d29 0d0a 2020 2020 2020   token})..      
+00006c00: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
+00006c10: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
+00006c20: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
+00006c30: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
+00006c40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006c50: 726e 2072 6573 2e6a 736f 6e28 295b 2264  rn res.json()["d
+00006c60: 6174 6122 5d0d 0a20 2020 2020 2020 2020  ata"]..         
+00006c70: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00006c80: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00006c90: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
+00006ca0: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
+00006cb0: 616d 655f 5f2c 2072 6573 2c20 2272 6561  ame__, res, "rea
+00006cc0: 6420 7365 6372 6574 206d 6574 6164 6174  d secret metadat
+00006cd0: 6120 6572 726f 7222 290d 0a20 2020 2020  a error")..     
+00006ce0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00006cf0: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+00006d00: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+00006d10: 7475 726e 204e 6f6e 650d 0a20 2020 200d  turn None..    .
+00006d20: 0a20 2020 2064 6566 2067 6574 5f61 6c6c  .    def get_all
+00006d30: 5f73 6563 7265 745f 7665 7273 696f 6e73  _secret_versions
+00006d40: 2873 656c 662c 206d 6f75 6e74 5f70 6174  (self, mount_pat
+00006d50: 683a 2073 7472 2c20 7061 7468 3a20 7374  h: str, path: st
+00006d60: 7229 3a0d 0a20 2020 2020 2020 2022 2222  r):..        """
+00006d70: 6765 7420 616c 6c20 6176 6169 6c61 626c  get all availabl
+00006d80: 6520 7365 6372 6574 2076 6572 7369 6f6e  e secret version
+00006d90: 7320 696e 2022 6d6f 756e 745f 7061 7468  s in "mount_path
+00006da0: 2f70 6174 6822 0d0a 0d0a 2020 2020 2020  /path"....      
+00006db0: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+00006dc0: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
+00006dd0: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
+00006de0: 2020 2070 6174 6820 2873 7472 290d 0a0d     path (str)...
+00006df0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00006e00: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00006e10: 6963 7420 6f72 204e 6f6e 653a 2072 6574  ict or None: ret
+00006e20: 7572 6e20 6120 6469 6374 2069 6620 7375  urn a dict if su
+00006e30: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
+00006e40: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+00006e50: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00006e60: 2020 2020 5265 7572 6e73 2065 7861 6d70      Reurns examp
+00006e70: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
+00006e80: 2049 6620 7468 6520 636f 6e66 6967 7572   If the configur
+00006e90: 6174 696f 6e20 6f66 2074 6865 2073 6563  ation of the sec
+00006ea0: 7265 7420 656e 6769 6e65 2069 7320 6d61  ret engine is ma
+00006eb0: 785f 7665 7273 696f 6e73 3d33 2e0d 0a20  x_versions=3... 
+00006ec0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00006ed0: 2020 2020 2020 2020 2049 6620 7468 6520           If the 
+00006ee0: 7365 6372 6574 2065 6e67 696e 6520 6861  secret engine ha
+00006ef0: 7320 6f6e 6c79 2072 6563 6f72 6465 6420  s only recorded 
+00006f00: 3220 7665 7273 696f 6e73 2073 696e 6365  2 versions since
+00006f10: 2063 7265 6174 6564 2c20 7468 6520 2276   created, the "v
+00006f20: 6572 7369 6f6e 7322 2072 6574 7572 6e73  ersions" returns
+00006f30: 2077 6f75 6c64 2062 653a 0d0a 2020 2020   would be:..    
+00006f40: 2020 2020 2020 2020 3e3e 3e20 7665 7273          >>> vers
+00006f50: 696f 6e73 203d 207b 2263 7572 7265 6e74  ions = {"current
+00006f60: 5f76 6572 7369 6f6e 223a 2032 2c20 0d0a  _version": 2, ..
+00006f70: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+00006f80: 2020 2020 2020 2020 2020 2020 2232 223a              "2":
+00006f90: 207b 2264 6573 7472 6f79 6564 223a 2062   {"destroyed": b
+00006fa0: 6f6f 6c2c 2022 6465 6c65 7465 6422 3a20  ool, "deleted": 
+00006fb0: 626f 6f6c 7d2c 200d 0a20 2020 2020 2020  bool}, ..       
+00006fc0: 2020 2020 203e 3e3e 2020 2020 2020 2020       >>>        
+00006fd0: 2020 2020 2022 3122 3a20 7b22 6465 7374       "1": {"dest
+00006fe0: 726f 7965 6422 3a20 626f 6f6c 2c20 2264  royed": bool, "d
+00006ff0: 656c 6574 6564 223a 2062 6f6f 6c7d 7d0d  eleted": bool}}.
+00007000: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00007010: 2020 2020 2020 2020 2020 2054 6865 206b             The k
+00007020: 6579 2022 6375 7272 656e 745f 7665 7273  ey "current_vers
+00007030: 696f 6e22 2069 7320 7468 6520 6c61 7465  ion" is the late
+00007040: 7374 2076 6572 7369 6f6e 206e 756d 6265  st version numbe
+00007050: 722c 2061 6e64 206b 6579 2022 6465 7374  r, and key "dest
+00007060: 726f 7965 6422 2072 6570 7265 7365 6e74  royed" represent
+00007070: 7320 6966 2074 6869 7320 7665 7273 696f  s if this versio
+00007080: 6e20 6f66 0d0a 2020 2020 2020 2020 2020  n of..          
+00007090: 2020 7365 6372 6574 2068 6173 2062 6565    secret has bee
+000070a0: 6e20 7065 726d 616e 656e 746c 7920 6465  n permanently de
+000070b0: 7374 726f 7965 642c 2061 6e64 206b 6579  stroyed, and key
+000070c0: 2022 6465 6c65 7465 6422 2072 6570 7265   "deleted" repre
+000070d0: 7365 6e74 7320 6966 2069 7420 6861 7320  sents if it has 
+000070e0: 6265 656e 2064 656c 6574 6564 2e0d 0a20  been deleted... 
+000070f0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00007100: 2020 2020 2020 2020 2049 6620 7468 6520           If the 
+00007110: 7365 6372 6574 2065 6e67 696e 6520 6861  secret engine ha
+00007120: 7320 7265 636f 7264 6564 2035 2076 6572  s recorded 5 ver
+00007130: 7369 6f6e 7320 7369 6e63 6520 6372 6561  sions since crea
+00007140: 7465 642c 2074 6865 2022 7665 7273 696f  ted, the "versio
+00007150: 6e73 2220 7265 7475 726e 7320 776f 756c  ns" returns woul
+00007160: 6420 6265 3a0d 0a20 2020 2020 2020 2020  d be:..         
+00007170: 2020 203e 3e3e 2076 6572 7369 6f6e 7320     >>> versions 
+00007180: 3d20 7b22 6375 7272 656e 745f 7665 7273  = {"current_vers
+00007190: 696f 6e22 3a20 352c 0d0a 2020 2020 2020  ion": 5,..      
+000071a0: 2020 2020 2020 3e3e 3e20 2020 2020 2020        >>>       
+000071b0: 2020 2020 2020 2235 223a 207b 2264 6573        "5": {"des
+000071c0: 7472 6f79 6564 223a 2062 6f6f 6c2c 2022  troyed": bool, "
+000071d0: 6465 6c65 7465 6422 3a20 626f 6f6c 7d2c  deleted": bool},
+000071e0: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
+000071f0: 3e20 2020 2020 2020 2020 2020 2020 2234  >             "4
+00007200: 223a 207b 2264 6573 7472 6f79 6564 223a  ": {"destroyed":
+00007210: 2062 6f6f 6c2c 2022 6465 6c65 7465 6422   bool, "deleted"
+00007220: 3a20 626f 6f6c 7d2c 0d0a 2020 2020 2020  : bool},..      
+00007230: 2020 2020 2020 3e3e 3e20 2020 2020 2020        >>>       
+00007240: 2020 2020 2020 2233 223a 207b 2264 6573        "3": {"des
+00007250: 7472 6f79 6564 223a 2062 6f6f 6c2c 2022  troyed": bool, "
+00007260: 6465 6c65 7465 6422 3a20 626f 6f6c 7d7d  deleted": bool}}
+00007270: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00007280: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00007290: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
+000072a0: 2020 2020 2073 6563 7265 745f 6d65 7461       secret_meta
+000072b0: 6461 7461 203d 2073 656c 662e 7265 6164  data = self.read
+000072c0: 5f73 6563 7265 745f 6d65 7461 6461 7461  _secret_metadata
+000072d0: 286d 6f75 6e74 5f70 6174 682c 2070 6174  (mount_path, pat
+000072e0: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
+000072f0: 6966 2073 6563 7265 745f 6d65 7461 6461  if secret_metada
+00007300: 7461 2069 7320 4e6f 6e65 3a0d 0a20 2020  ta is None:..   
+00007310: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00007320: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+00007330: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00007340: 2020 2020 7665 7273 696f 6e73 5f6d 6574      versions_met
+00007350: 6120 3d20 7365 6372 6574 5f6d 6574 6164  a = secret_metad
+00007360: 6174 615b 2276 6572 7369 6f6e 7322 5d0d  ata["versions"].
+00007370: 0a20 2020 2020 2020 2020 2020 2076 6572  .            ver
+00007380: 7369 6f6e 7320 3d20 7b22 6375 7272 656e  sions = {"curren
+00007390: 745f 7665 7273 696f 6e22 3a20 7365 6372  t_version": secr
+000073a0: 6574 5f6d 6574 6164 6174 615b 2263 7572  et_metadata["cur
+000073b0: 7265 6e74 5f76 6572 7369 6f6e 225d 7d0d  rent_version"]}.
+000073c0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000073d0: 2076 6572 7369 6f6e 2069 6e20 7665 7273   version in vers
+000073e0: 696f 6e73 5f6d 6574 612e 6b65 7973 2829  ions_meta.keys()
+000073f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00007400: 2020 2064 6573 7472 6f79 6564 203d 2076     destroyed = v
+00007410: 6572 7369 6f6e 735f 6d65 7461 5b76 6572  ersions_meta[ver
+00007420: 7369 6f6e 5d5b 2264 6573 7472 6f79 6564  sion]["destroyed
+00007430: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+00007440: 2020 2020 6465 6c65 7465 6420 3d20 7665      deleted = ve
+00007450: 7273 696f 6e73 5f6d 6574 615b 7665 7273  rsions_meta[vers
+00007460: 696f 6e5d 5b22 6465 6c65 7469 6f6e 5f74  ion]["deletion_t
+00007470: 696d 6522 5d20 213d 2022 220d 0a20 2020  ime"] != ""..   
+00007480: 2020 2020 2020 2020 2020 2020 2076 6572               ver
+00007490: 7369 6f6e 735b 7665 7273 696f 6e5d 203d  sions[version] =
+000074a0: 207b 2264 6573 7472 6f79 6564 223a 2064   {"destroyed": d
+000074b0: 6573 7472 6f79 6564 2c20 2264 656c 6574  estroyed, "delet
+000074c0: 6564 223a 2064 656c 6574 6564 7d0d 0a20  ed": deleted}.. 
+000074d0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+000074e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000074f0: 7665 7273 696f 6e73 0d0a 2020 2020 2020  versions..      
+00007500: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
+00007510: 726e 204e 6f6e 650d 0a20 2020 200d 0a20  rn None..    .. 
+00007520: 2020 2064 6566 2061 6464 5f73 6563 7265     def add_secre
+00007530: 7428 7365 6c66 2c20 0d0a 2020 2020 2020  t(self, ..      
+00007540: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
+00007550: 6e74 5f70 6174 683a 2073 7472 2c20 0d0a  nt_path: str, ..
+00007560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007570: 2020 2070 6174 683a 2073 7472 2c20 0d0a     path: str, ..
+00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007590: 2020 2073 6563 7265 7473 3a20 556e 696f     secrets: Unio
+000075a0: 6e5b 6469 6374 2c20 436f 6e66 6967 4469  n[dict, ConfigDi
+000075b0: 6374 5d2c 200d 0a20 2020 2020 2020 2020  ct], ..         
+000075c0: 2020 2020 2020 2020 2020 6f70 7469 6f6e            option
+000075d0: 733a 2055 6e69 6f6e 5b64 6963 742c 2043  s: Union[dict, C
+000075e0: 6f6e 6669 6744 6963 745d 203d 204e 6f6e  onfigDict] = Non
+000075f0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00007600: 2020 2020 2020 2076 6572 7369 6f6e 3a20         version: 
+00007610: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+00007620: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+00007630: 2222 2261 6464 2073 6563 7265 7473 2074  """add secrets t
+00007640: 6f20 226d 6f75 6e74 5f70 6174 682f 7061  o "mount_path/pa
+00007650: 7468 220d 0a20 2020 2020 2020 2052 6566  th"..        Ref
+00007660: 6572 2074 6f20 6874 7470 733a 2f2f 6465  er to https://de
+00007670: 7665 6c6f 7065 722e 6861 7368 6963 6f72  veloper.hashicor
+00007680: 702e 636f 6d2f 7661 756c 742f 6170 692d  p.com/vault/api-
+00007690: 646f 6373 2f73 6563 7265 742f 6b76 2f6b  docs/secret/kv/k
+000076a0: 762d 7632 236f 7074 696f 6e73 2066 6f72  v-v2#options for
+000076b0: 206d 6f72 6520 6465 7461 696c 7320 6162   more details ab
+000076c0: 6f75 7420 6f70 7469 6f6e 732e 0d0a 2020  out options...  
+000076d0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000076e0: 596f 7520 646f 206e 6f74 206e 6565 6420  You do not need 
+000076f0: 746f 2073 7065 6369 6679 2061 6c6c 2074  to specify all t
+00007700: 6865 2073 7562 6b65 7973 206f 6620 7365  he subkeys of se
+00007710: 6372 6574 732c 206f 6e6c 7920 7468 6520  crets, only the 
+00007720: 7375 626b 6579 7320 7468 6174 206e 6565  subkeys that nee
+00007730: 6420 746f 2062 6520 6164 6465 642c 2077  d to be added, w
+00007740: 6869 6368 2069 7320 636f 6e76 656e 6965  hich is convenie
+00007750: 6e74 2e0d 0a0d 0a20 2020 2020 2020 2041  nt.....        A
+00007760: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+00007770: 2020 6d6f 756e 745f 7061 7468 2028 7374    mount_path (st
+00007780: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+00007790: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
+000077a0: 2020 2020 2020 2020 7365 6372 6574 7320          secrets 
+000077b0: 2855 6e69 6f6e 5b64 6963 742c 2043 6f6e  (Union[dict, Con
+000077c0: 6669 6744 6963 745d 290d 0a20 2020 2020  figDict])..     
+000077d0: 2020 2020 2020 206f 7074 696f 6e73 2028         options (
+000077e0: 556e 696f 6e5b 6469 6374 2c20 436f 6e66  Union[dict, Conf
+000077f0: 6967 4469 6374 5d2c 206f 7074 696f 6e61  igDict], optiona
+00007800: 6c29 3a20 4465 6661 756c 7473 2074 6f20  l): Defaults to 
+00007810: 4e6f 6e65 2e0d 0a20 2020 2020 2020 2020  None...         
+00007820: 2020 2076 6572 7369 6f6e 2028 4f70 7469     version (Opti
+00007830: 6f6e 616c 5b69 6e74 5d2c 206f 7074 696f  onal[int], optio
+00007840: 6e61 6c29 3a20 6164 6420 7365 6372 6574  nal): add secret
+00007850: 7320 6261 7365 6420 6f6e 2061 2073 7065  s based on a spe
+00007860: 6369 6669 6320 7665 7273 696f 6e2e 2069  cific version. i
+00007870: 6620 4e6f 6e65 2c20 6261 7365 6420 6f6e  f None, based on
+00007880: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00007890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078b0: 2020 7468 6520 6c61 7465 7374 2076 6572    the latest ver
+000078c0: 7369 6f6e 2e20 4465 6661 756c 7473 2074  sion. Defaults t
+000078d0: 6f20 4e6f 6e65 2e0d 0a0d 0a20 2020 2020  o None.....     
+000078e0: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
+000078f0: 2020 2020 2020 2020 2062 6f6f 6c3a 2072           bool: r
+00007900: 6574 7572 6e20 5472 7565 2069 6620 7375  eturn True if su
+00007910: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
+00007920: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+00007930: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00007940: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
+00007950: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
+00007960: 2020 6966 206e 6f74 2069 735f 6469 6374    if not is_dict
+00007970: 2873 6563 7265 7473 293a 0d0a 2020 2020  (secrets):..    
+00007980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007990: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
+000079a0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
+000079b0: 655f 5f7d 202d 2061 6464 2073 6563 7265  e__} - add secre
+000079c0: 7420 6572 726f 723a 2073 6563 7265 7473  t error: secrets
+000079d0: 206d 7573 7420 6265 2061 2064 6963 7420   must be a dict 
+000079e0: 6f72 2043 6f6e 6669 6744 6963 7422 290d  or ConfigDict").
+000079f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007a00: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+00007a10: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00007a20: 6e28 6c69 7374 2873 6563 7265 7473 2e6b  n(list(secrets.k
+00007a30: 6579 7328 2929 2920 3d3d 2030 3a0d 0a20  eys())) == 0:.. 
+00007a40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007a50: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+00007a60: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+00007a70: 6e61 6d65 5f5f 7d20 2d20 6164 6420 7365  name__} - add se
+00007a80: 6372 6574 2065 7272 6f72 3a20 7365 6372  cret error: secr
+00007a90: 6574 7320 6d75 7374 206e 6f74 2062 6520  ets must not be 
+00007aa0: 656d 7074 7922 290d 0a20 2020 2020 2020  empty")..       
+00007ab0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00007ac0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+00007ad0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00007ae0: 2065 7869 7374 735f 7365 6372 6574 7320   exists_secrets 
+00007af0: 3d20 7365 6c66 2e72 6561 645f 7365 6372  = self.read_secr
+00007b00: 6574 286d 6f75 6e74 5f70 6174 682c 2070  et(mount_path, p
+00007b10: 6174 682c 2076 6572 7369 6f6e 3d76 6572  ath, version=ver
+00007b20: 7369 6f6e 290d 0a20 2020 2020 2020 2020  sion)..         
+00007b30: 2020 2069 6620 6578 6973 7473 5f73 6563     if exists_sec
+00007b40: 7265 7473 2069 7320 6e6f 7420 4e6f 6e65  rets is not None
+00007b50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00007b60: 2020 2065 7869 7374 735f 7365 6372 6574     exists_secret
+00007b70: 7320 3d20 6578 6973 7473 5f73 6563 7265  s = exists_secre
+00007b80: 7473 5b30 5d0d 0a20 2020 2020 2020 2020  ts[0]..         
+00007b90: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+00007ba0: 6e20 6578 6973 7473 5f73 6563 7265 7473  n exists_secrets
+00007bb0: 2e6b 6579 7328 293a 0d0a 2020 2020 2020  .keys():..      
+00007bc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00007bd0: 206b 6579 2069 6e20 7365 6372 6574 732e   key in secrets.
+00007be0: 6b65 7973 2829 3a0d 0a20 2020 2020 2020  keys():..       
+00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c00: 2073 656c 662e 6c6f 6767 6572 2e77 6172   self.logger.war
+00007c10: 6e69 6e67 2866 227b 5f5f 636c 6173 735f  ning(f"{__class_
+00007c20: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6164  _.__name__} - ad
+00007c30: 6420 7365 6372 6574 2065 7272 6f72 3a20  d secret error: 
+00007c40: 6b65 7920 277b 6b65 797d 2720 616c 7265  key '{key}' alre
+00007c50: 6164 7920 6578 6973 7473 2229 0d0a 2020  ady exists")..  
+00007c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c70: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00007c80: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00007c90: 2020 2020 2020 2020 7365 6372 6574 735b          secrets[
+00007ca0: 6b65 795d 203d 2065 7869 7374 735f 7365  key] = exists_se
+00007cb0: 6372 6574 735b 6b65 795d 0d0a 2020 2020  crets[key]..    
+00007cc0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00007cd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00007ce0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+00007cf0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00007d00: 2020 2020 2020 2069 6620 6f70 7469 6f6e         if option
+00007d10: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
+00007d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d30: 6966 206e 6f74 2069 735f 6469 6374 286f  if not is_dict(o
+00007d40: 7074 696f 6e73 293a 0d0a 2020 2020 2020  ptions):..      
+00007d50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00007d60: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00007d70: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
+00007d80: 616d 655f 5f7d 202d 2061 6464 2073 6563  ame__} - add sec
+00007d90: 7265 7420 6572 726f 723a 206f 7074 696f  ret error: optio
+00007da0: 6e73 206d 7573 7420 6265 2061 2064 6963  ns must be a dic
+00007db0: 7420 6f72 2043 6f6e 6669 6744 6963 7422  t or ConfigDict"
+00007dc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00007dd0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00007de0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00007df0: 2020 2020 2064 6174 6120 3d20 6469 6374       data = dict
+00007e00: 286f 7074 696f 6e73 3d6f 7074 696f 6e73  (options=options
+00007e10: 2c20 6461 7461 3d73 6563 7265 7473 290d  , data=secrets).
+00007e20: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00007e30: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00007e40: 2020 2020 6461 7461 203d 2064 6963 7428      data = dict(
+00007e50: 6461 7461 3d73 6563 7265 7473 290d 0a20  data=secrets).. 
+00007e60: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00007e70: 2020 2020 2020 2020 2075 726c 203d 2061           url = a
+00007e80: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+00007e90: 7365 6c66 2e75 726c 2c20 6b65 793d 7261  self.url, key=ra
+00007ea0: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+00007eb0: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+00007ec0: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+00007ed0: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+00007ee0: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+00007ef0: 2020 2020 2074 6f6b 656e 203d 2061 6573       token = aes
+00007f00: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
+00007f10: 6c66 2e74 6f6b 656e 2c20 6b65 793d 7261  lf.token, key=ra
+00007f20: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+00007f30: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+00007f40: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+00007f50: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+00007f60: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+00007f70: 2020 2020 2072 6573 203d 2072 6571 7565       res = reque
+00007f80: 7374 732e 706f 7374 2875 726c 2b66 227b  sts.post(url+f"{
+00007f90: 6d6f 756e 745f 7061 7468 7d2f 6461 7461  mount_path}/data
+00007fa0: 2f7b 7061 7468 7d22 2c20 6865 6164 6572  /{path}", header
+00007fb0: 733d 7b22 582d 5661 756c 742d 546f 6b65  s={"X-Vault-Toke
+00007fc0: 6e22 3a20 746f 6b65 6e7d 2c20 6461 7461  n": token}, data
+00007fd0: 3d6a 736f 6e2e 6475 6d70 7328 6461 7461  =json.dumps(data
+00007fe0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00007ff0: 6966 2072 6573 2e73 7461 7475 735f 636f  if res.status_co
+00008000: 6465 203d 3d20 3230 3020 6f72 2072 6573  de == 200 or res
+00008010: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
+00008020: 3230 343a 0d0a 2020 2020 2020 2020 2020  204:..          
+00008030: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00008040: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+00008050: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00008060: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
+00008070: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
+00008080: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00008090: 5f2c 2072 6573 2c20 2261 6464 2073 6563  _, res, "add sec
+000080a0: 7265 7420 6572 726f 7222 290d 0a20 2020  ret error")..   
+000080b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000080c0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+000080d0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000080e0: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+000080f0: 2020 200d 0a20 2020 2064 6566 2075 7064     ..    def upd
+00008100: 6174 655f 7365 6372 6574 2873 656c 662c  ate_secret(self,
+00008110: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008120: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+00008130: 7468 3a20 7374 722c 200d 0a20 2020 2020  th: str, ..     
+00008140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008150: 2070 6174 683a 2073 7472 2c0d 0a20 2020   path: str,..   
+00008160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008170: 2020 2073 6563 7265 7473 3a20 556e 696f     secrets: Unio
+00008180: 6e5b 6469 6374 2c20 436f 6e66 6967 4469  n[dict, ConfigDi
+00008190: 6374 5d2c 0d0a 2020 2020 2020 2020 2020  ct],..          
+000081a0: 2020 2020 2020 2020 2020 2020 6f70 7469              opti
+000081b0: 6f6e 733a 2055 6e69 6f6e 5b64 6963 742c  ons: Union[dict,
+000081c0: 2043 6f6e 6669 6744 6963 745d 203d 204e   ConfigDict] = N
+000081d0: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+000081e0: 2020 2020 2020 2020 2020 2020 7665 7273              vers
+000081f0: 696f 6e3a 204f 7074 696f 6e61 6c5b 696e  ion: Optional[in
+00008200: 745d 203d 204e 6f6e 6529 3a0d 0a20 2020  t] = None):..   
+00008210: 2020 2020 2022 2222 7570 6461 7465 2073       """update s
+00008220: 6563 7265 7473 2069 6e20 226d 6f75 6e74  ecrets in "mount
+00008230: 5f70 6174 682f 7061 7468 220d 0a20 2020  _path/path"..   
+00008240: 2020 2020 2052 6566 6572 2074 6f20 6874       Refer to ht
+00008250: 7470 733a 2f2f 6465 7665 6c6f 7065 722e  tps://developer.
+00008260: 6861 7368 6963 6f72 702e 636f 6d2f 7661  hashicorp.com/va
+00008270: 756c 742f 6170 692d 646f 6373 2f73 6563  ult/api-docs/sec
+00008280: 7265 742f 6b76 2f6b 762d 7632 236f 7074  ret/kv/kv-v2#opt
+00008290: 696f 6e73 2066 6f72 206d 6f72 6520 6465  ions for more de
+000082a0: 7461 696c 7320 6162 6f75 7420 6f70 7469  tails about opti
+000082b0: 6f6e 732e 0d0a 2020 2020 2020 2020 0d0a  ons...        ..
+000082c0: 2020 2020 2020 2020 596f 7520 646f 206e          You do n
+000082d0: 6f74 206e 6565 6420 746f 2073 7065 6369  ot need to speci
+000082e0: 6679 2061 6c6c 2074 6865 2073 7562 6b65  fy all the subke
+000082f0: 7973 206f 6620 7365 6372 6574 732c 206f  ys of secrets, o
+00008300: 6e6c 7920 7468 6520 7375 626b 6579 7320  nly the subkeys 
+00008310: 7468 6174 206e 6565 6420 746f 2062 6520  that need to be 
+00008320: 7570 6461 7465 642c 2077 6869 6368 2069  updated, which i
+00008330: 7320 7665 7279 0d0a 2020 2020 2020 2020  s very..        
+00008340: 7369 6d69 6c61 7220 746f 2074 6865 2022  similar to the "
+00008350: 5061 7463 6820 7365 6372 6574 2220 6665  Patch secret" fe
+00008360: 6174 7572 6520 7468 6174 206f 6666 6963  ature that offic
+00008370: 616c 6c79 2073 7570 706f 7274 6564 2e0d  ally supported..
+00008380: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00008390: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+000083a0: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
+000083b0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+000083c0: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
+000083d0: 2020 2020 7365 6372 6574 7320 2855 6e69      secrets (Uni
+000083e0: 6f6e 5b64 6963 742c 2043 6f6e 6669 6744  on[dict, ConfigD
+000083f0: 6963 745d 290d 0a20 2020 2020 2020 2020  ict])..         
+00008400: 2020 206f 7074 696f 6e73 2028 556e 696f     options (Unio
+00008410: 6e5b 6469 6374 2c20 436f 6e66 6967 4469  n[dict, ConfigDi
+00008420: 6374 5d2c 206f 7074 696f 6e61 6c29 3a20  ct], optional): 
+00008430: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
+00008440: 2e0d 0a20 2020 2020 2020 2020 2020 2076  ...            v
+00008450: 6572 7369 6f6e 2028 4f70 7469 6f6e 616c  ersion (Optional
+00008460: 5b69 6e74 5d2c 206f 7074 696f 6e61 6c29  [int], optional)
+00008470: 3a20 7570 6461 7465 2073 6563 7265 7473  : update secrets
+00008480: 2069 6e20 6120 7370 6563 6966 6963 2076   in a specific v
+00008490: 6572 7369 6f6e 2e20 6966 204e 6f6e 652c  ersion. if None,
+000084a0: 2075 7064 6174 6520 7468 6520 6c61 7465   update the late
+000084b0: 7374 2076 6572 7369 6f6e 2e0d 0a20 2020  st version...   
+000084c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084e0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+000084f0: 756c 7473 2074 6f20 4e6f 6e65 2e0d 0a0d  ults to None....
+00008500: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00008510: 3a0d 0a20 2020 2020 2020 2020 2020 2062  :..            b
+00008520: 6f6f 6c3a 2072 6574 7572 6e20 5472 7565  ool: return True
+00008530: 2069 6620 7375 6363 6573 732c 206f 7468   if success, oth
+00008540: 6572 7769 7365 2072 6574 7572 6e20 4661  erwise return Fa
+00008550: 6c73 650d 0a20 2020 2020 2020 2022 2222  lse..        """
+00008560: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00008570: 662e 6973 5f61 7574 683a 0d0a 2020 2020  f.is_auth:..    
+00008580: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00008590: 735f 6469 6374 2873 6563 7265 7473 293a  s_dict(secrets):
+000085a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000085b0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+000085c0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+000085d0: 2e5f 5f6e 616d 655f 5f7d 202d 2075 7064  .__name__} - upd
+000085e0: 6174 6520 7365 6372 6574 2065 7272 6f72  ate secret error
+000085f0: 3a20 7365 6372 6574 7320 6d75 7374 2062  : secrets must b
+00008600: 6520 6120 6469 6374 206f 7220 436f 6e66  e a dict or Conf
+00008610: 6967 4469 6374 2229 0d0a 2020 2020 2020  igDict")..      
+00008620: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00008630: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00008640: 2020 2020 6966 206c 656e 286c 6973 7428      if len(list(
+00008650: 7365 6372 6574 732e 6b65 7973 2829 2929  secrets.keys()))
+00008660: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+00008670: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00008680: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+00008690: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+000086a0: 202d 2075 7064 6174 6520 7365 6372 6574   - update secret
+000086b0: 2065 7272 6f72 3a20 7365 6372 6574 7320   error: secrets 
+000086c0: 6d75 7374 206e 6f74 2062 6520 656d 7074  must not be empt
+000086d0: 7922 290d 0a20 2020 2020 2020 2020 2020  y")..           
+000086e0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000086f0: 650d 0a20 2020 2020 2020 2020 2020 200d  e..            .
+00008700: 0a20 2020 2020 2020 2020 2020 2065 7869  .            exi
+00008710: 7374 735f 7365 6372 6574 7320 3d20 7365  sts_secrets = se
+00008720: 6c66 2e72 6561 645f 7365 6372 6574 286d  lf.read_secret(m
+00008730: 6f75 6e74 5f70 6174 682c 2070 6174 682c  ount_path, path,
+00008740: 2076 6572 7369 6f6e 3d76 6572 7369 6f6e   version=version
+00008750: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00008760: 6620 6578 6973 7473 5f73 6563 7265 7473  f exists_secrets
+00008770: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00008780: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00008790: 7869 7374 735f 7365 6372 6574 7320 3d20  xists_secrets = 
+000087a0: 6578 6973 7473 5f73 6563 7265 7473 5b30  exists_secrets[0
+000087b0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+000087c0: 2020 2066 6f72 206b 6579 2069 6e20 7365     for key in se
+000087d0: 6372 6574 732e 6b65 7973 2829 3a0d 0a20  crets.keys():.. 
 000087e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087f0: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
-00008800: 696e 6728 6622 7b5f 5f63 6c61 7373 5f5f  ing(f"{__class__
-00008810: 2e5f 5f6e 616d 655f 5f7d 202d 2075 7064  .__name__} - upd
-00008820: 6174 6520 7365 6372 6574 2065 7272 6f72  ate secret error
-00008830: 3a20 6b65 7920 277b 6b65 797d 2720 6e6f  : key '{key}' no
-00008840: 7420 666f 756e 6422 290d 0a20 2020 2020  t found")..     
-00008850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008860: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-00008870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008880: 2020 2020 2065 7869 7374 735f 7365 6372       exists_secr
-00008890: 6574 735b 6b65 795d 203d 2073 6563 7265  ets[key] = secre
-000088a0: 7473 5b6b 6579 5d0d 0a20 2020 2020 2020  ts[key]..       
-000088b0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000088c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000088d0: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-000088e0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000088f0: 2020 2020 6966 206f 7074 696f 6e73 2069      if options i
-00008900: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00008910: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00008920: 6e6f 7420 6973 5f64 6963 7428 6f70 7469  not is_dict(opti
-00008930: 6f6e 7329 3a0d 0a20 2020 2020 2020 2020  ons):..         
-00008940: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008950: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-00008960: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00008970: 5f5f 7d20 2d20 7570 6461 7465 2073 6563  __} - update sec
-00008980: 7265 7420 6572 726f 723a 206f 7074 696f  ret error: optio
-00008990: 6e73 206d 7573 7420 6265 2061 2064 6963  ns must be a dic
-000089a0: 7420 6f72 2043 6f6e 6669 6744 6963 7422  t or ConfigDict"
-000089b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000089c0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000089d0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-000089e0: 2020 2020 2064 6174 6120 3d20 6469 6374       data = dict
-000089f0: 286f 7074 696f 6e73 3d6f 7074 696f 6e73  (options=options
-00008a00: 2c20 6461 7461 3d65 7869 7374 735f 7365  , data=exists_se
-00008a10: 6372 6574 7329 0d0a 2020 2020 2020 2020  crets)..        
-00008a20: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00008a30: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00008a40: 3d20 6469 6374 2864 6174 613d 6578 6973  = dict(data=exis
-00008a50: 7473 5f73 6563 7265 7473 290d 0a20 2020  ts_secrets)..   
-00008a60: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
-00008a70: 2020 2020 2020 2020 2020 2075 726c 203d             url =
-00008a80: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
-00008a90: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
-00008aa0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-00008ab0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-00008ac0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-00008ad0: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-00008ae0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-00008af0: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
-00008b00: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
-00008b10: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
-00008b20: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-00008b30: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-00008b40: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-00008b50: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-00008b60: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-00008b70: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
-00008b80: 7565 7374 732e 706f 7374 2875 726c 2b66  uests.post(url+f
-00008b90: 227b 6d6f 756e 745f 7061 7468 7d2f 6461  "{mount_path}/da
-00008ba0: 7461 2f7b 7061 7468 7d22 2c20 6865 6164  ta/{path}", head
-00008bb0: 6572 733d 7b22 582d 5661 756c 742d 546f  ers={"X-Vault-To
-00008bc0: 6b65 6e22 3a20 746f 6b65 6e7d 2c20 6461  ken": token}, da
-00008bd0: 7461 3d6a 736f 6e2e 6475 6d70 7328 6461  ta=json.dumps(da
-00008be0: 7461 2929 0d0a 2020 2020 2020 2020 2020  ta))..          
-00008bf0: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
-00008c00: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
-00008c10: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-00008c20: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
-00008c30: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00008c40: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00008c50: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00008c60: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-00008c70: 675f 6572 726f 725f 7265 7370 6f6e 7365  g_error_response
-00008c80: 285f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  (__class__.__nam
-00008c90: 655f 5f2c 2072 6573 2c20 2275 7064 6174  e__, res, "updat
-00008ca0: 6520 7365 6372 6574 2065 7272 6f72 2229  e secret error")
-00008cb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008cc0: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00008cd0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00008ce0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00008cf0: 7365 0d0a 2020 2020 2020 2020 0d0a 2020  se..        ..  
-00008d00: 2020 6465 6620 7265 6164 5f73 6563 7265    def read_secre
-00008d10: 745f 7375 626b 6579 7328 7365 6c66 2c20  t_subkeys(self, 
-00008d20: 6d6f 756e 745f 7061 7468 3a20 7374 722c  mount_path: str,
-00008d30: 2070 6174 683a 2073 7472 2c20 7665 7273   path: str, vers
-00008d40: 696f 6e3a 204f 7074 696f 6e61 6c5b 696e  ion: Optional[in
-00008d50: 745d 203d 204e 6f6e 652c 2064 6570 7468  t] = None, depth
-00008d60: 3a20 696e 7420 3d20 3029 3a0d 0a20 2020  : int = 0):..   
-00008d70: 2020 2020 2022 2222 7265 6164 2073 7562       """read sub
-00008d80: 6b65 7973 206f 6620 7365 6372 6574 7320  keys of secrets 
-00008d90: 696e 2022 6d6f 756e 745f 7061 7468 2f70  in "mount_path/p
-00008da0: 6174 6822 0d0a 0d0a 2020 2020 2020 2020  ath"....        
-00008db0: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
-00008dc0: 2020 206d 6f75 6e74 5f70 6174 6820 2873     mount_path (s
-00008dd0: 7472 290d 0a20 2020 2020 2020 2020 2020  tr)..           
-00008de0: 2070 6174 6820 2873 7472 290d 0a20 2020   path (str)..   
-00008df0: 2020 2020 2020 2020 2076 6572 7369 6f6e           version
-00008e00: 2028 4f70 7469 6f6e 616c 5b69 6e74 5d2c   (Optional[int],
-00008e10: 206f 7074 696f 6e61 6c29 3a20 7265 6164   optional): read
-00008e20: 2073 7562 6b65 7973 206f 6620 6120 7370   subkeys of a sp
-00008e30: 6563 6966 6963 2076 6572 7369 6f6e 2e20  ecific version. 
-00008e40: 6966 204e 6f6e 652c 2072 6561 6420 7375  if None, read su
-00008e50: 626b 6579 7320 6f66 200d 0a20 2020 2020  bkeys of ..     
-00008e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e80: 2020 2020 2020 2020 2020 7468 6520 6c61            the la
-00008e90: 7465 7374 2076 6572 7369 6f6e 2e20 4465  test version. De
-00008ea0: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0d  faults to None..
-00008eb0: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-00008ec0: 7468 2028 696e 742c 206f 7074 696f 6e61  th (int, optiona
-00008ed0: 6c29 3a20 7370 6563 6966 7920 7468 6520  l): specify the 
-00008ee0: 6465 7074 6820 6f66 2073 7562 6b65 7973  depth of subkeys
-00008ef0: 2e20 6966 2065 7175 616c 7320 302c 206d  . if equals 0, m
-00008f00: 6561 6e73 206e 6f20 6c69 6d69 742e 2044  eans no limit. D
-00008f10: 6566 6175 6c74 7320 746f 2030 2e0d 0a0d  efaults to 0....
-00008f20: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00008f30: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00008f40: 6963 7420 6f72 204e 6f6e 653a 2072 6574  ict or None: ret
-00008f50: 7572 6e20 6120 6469 6374 2069 6620 7375  urn a dict if su
-00008f60: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
-00008f70: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-00008f80: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00008f90: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
-00008fa0: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
-00008fb0: 2061 6c6c 5f76 6572 7369 6f6e 7320 3d20   all_versions = 
-00008fc0: 7365 6c66 2e67 6574 5f61 6c6c 5f73 6563  self.get_all_sec
-00008fd0: 7265 745f 7665 7273 696f 6e73 286d 6f75  ret_versions(mou
-00008fe0: 6e74 5f70 6174 682c 2070 6174 6829 0d0a  nt_path, path)..
-00008ff0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00009000: 6c6c 5f76 6572 7369 6f6e 7320 6973 204e  ll_versions is N
-00009010: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00009020: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00009030: 650d 0a20 2020 2020 2020 2020 2020 200d  e..            .
-00009040: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009050: 7665 7273 696f 6e20 6973 206e 6f74 204e  version is not N
-00009060: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00009070: 2020 2020 2020 6966 206e 6f74 2069 735f        if not is_
-00009080: 696e 7428 7665 7273 696f 6e29 3a0d 0a20  int(version):.. 
-00009090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000090a0: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-000090b0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-000090c0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 7265  _.__name__} - re
-000090d0: 6164 2073 6563 7265 7420 7375 626b 6579  ad secret subkey
-000090e0: 7320 6572 726f 723a 2076 6572 7369 6f6e  s error: version
-000090f0: 206d 7573 7420 6265 2061 6e20 696e 7422   must be an int"
-00009100: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00009110: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00009120: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00009130: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00009140: 2020 2020 2020 6966 2073 7472 2876 6572        if str(ver
-00009150: 7369 6f6e 2920 6e6f 7420 696e 2061 6c6c  sion) not in all
-00009160: 5f76 6572 7369 6f6e 732e 6b65 7973 2829  _versions.keys()
-00009170: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00009180: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-00009190: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-000091a0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-000091b0: 2d20 7265 6164 2073 6563 7265 7420 7375  - read secret su
-000091c0: 626b 6579 7320 6572 726f 723a 2076 6572  bkeys error: ver
-000091d0: 7369 6f6e 2027 7b76 6572 7369 6f6e 7d27  sion '{version}'
-000091e0: 206e 6f74 2066 6f75 6e64 2229 0d0a 2020   not found")..  
-000091f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009200: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-00009210: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00009220: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009230: 2020 7665 7273 696f 6e20 3d20 616c 6c5f    version = all_
-00009240: 7665 7273 696f 6e73 5b22 6375 7272 656e  versions["curren
-00009250: 745f 7665 7273 696f 6e22 5d0d 0a20 2020  t_version"]..   
-00009260: 2020 2020 2020 2020 2069 6620 616c 6c5f           if all_
-00009270: 7665 7273 696f 6e73 5b73 7472 2876 6572  versions[str(ver
-00009280: 7369 6f6e 295d 5b22 6465 7374 726f 7965  sion)]["destroye
-00009290: 6422 5d3a 0d0a 2020 2020 2020 2020 2020  d"]:..          
-000092a0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-000092b0: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-000092c0: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-000092d0: 2072 6561 6420 7365 6372 6574 2073 7562   read secret sub
-000092e0: 6b65 7973 2065 7272 6f72 3a20 7665 7273  keys error: vers
-000092f0: 696f 6e20 277b 7665 7273 696f 6e7d 2720  ion '{version}' 
-00009300: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009320: 2020 2020 2066 2268 6173 2062 6565 6e20       f"has been 
-00009330: 7065 726d 616e 656e 746c 7920 6465 7374  permanently dest
-00009340: 726f 7965 6422 290d 0a20 2020 2020 2020  royed")..       
-00009350: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00009360: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00009370: 2020 6966 2061 6c6c 5f76 6572 7369 6f6e    if all_version
-00009380: 735b 7374 7228 7665 7273 696f 6e29 5d5b  s[str(version)][
-00009390: 2264 656c 6574 6564 225d 3a0d 0a20 2020  "deleted"]:..   
-000093a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000093b0: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-000093c0: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-000093d0: 6d65 5f5f 7d20 2d20 7265 6164 2073 6563  me__} - read sec
-000093e0: 7265 7420 7375 626b 6579 7320 6572 726f  ret subkeys erro
-000093f0: 723a 2076 6572 7369 6f6e 2027 7b76 6572  r: version '{ver
-00009400: 7369 6f6e 7d27 2022 0d0a 2020 2020 2020  sion}' "..      
-00009410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009420: 2020 2020 2020 2020 2020 2020 6622 6861              f"ha
-00009430: 7320 6265 656e 2064 656c 6574 6564 2c20  s been deleted, 
-00009440: 706c 6561 7365 2075 6e64 656c 6574 6520  please undelete 
-00009450: 6974 2066 6972 7374 2229 0d0a 2020 2020  it first")..    
-00009460: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00009470: 726e 204e 6f6e 650d 0a0d 0a20 2020 2020  rn None....     
-00009480: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00009490: 5f69 6e74 2864 6570 7468 293a 0d0a 2020  _int(depth):..  
-000094a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000094b0: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-000094c0: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-000094d0: 616d 655f 5f7d 202d 2072 6561 6420 7365  ame__} - read se
-000094e0: 6372 6574 2073 7562 6b65 7973 2065 7272  cret subkeys err
-000094f0: 6f72 3a20 6465 7074 6820 6d75 7374 2062  or: depth must b
-00009500: 6520 616e 2069 6e74 2229 0d0a 2020 2020  e an int")..    
-00009510: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00009520: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
-00009530: 2020 2020 2070 6172 616d 203d 2066 223f       param = f"?
-00009540: 7665 7273 696f 6e3d 7b76 6572 7369 6f6e  version={version
-00009550: 7d26 6465 7074 683d 7b64 6570 7468 7d22  }&depth={depth}"
-00009560: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00009570: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-00009580: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-00009590: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-000095a0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-000095b0: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-000095c0: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-000095d0: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-000095e0: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-000095f0: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
-00009600: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
-00009610: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-00009620: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-00009630: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-00009640: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-00009650: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-00009660: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-00009670: 3d20 7265 7175 6573 7473 2e67 6574 2875  = requests.get(u
-00009680: 726c 2b66 227b 6d6f 756e 745f 7061 7468  rl+f"{mount_path
-00009690: 7d2f 7375 626b 6579 732f 7b70 6174 687d  }/subkeys/{path}
-000096a0: 222c 2068 6561 6465 7273 3d7b 2258 2d56  ", headers={"X-V
-000096b0: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
-000096c0: 656e 7d2c 2070 6172 616d 733d 7061 7261  en}, params=para
-000096d0: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
-000096e0: 6966 2072 6573 2e73 7461 7475 735f 636f  if res.status_co
-000096f0: 6465 203d 3d20 3230 3020 6f72 2072 6573  de == 200 or res
-00009700: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-00009710: 3230 343a 0d0a 2020 2020 2020 2020 2020  204:..          
-00009720: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-00009730: 2e6a 736f 6e28 295b 2264 6174 6122 5d5b  .json()["data"][
-00009740: 2273 7562 6b65 7973 225d 0d0a 2020 2020  "subkeys"]..    
-00009750: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00009760: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009770: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
-00009780: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
-00009790: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
-000097a0: 2022 7265 6164 2073 6563 7265 7420 7375   "read secret su
-000097b0: 626b 6579 7320 6572 726f 7222 290d 0a20  bkeys error").. 
-000097c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000097d0: 6574 7572 6e20 4e6f 6e65 0d0a 0d0a 2020  eturn None....  
-000097e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-000097f0: 650d 0a20 2020 200d 0a20 2020 2064 6566  e..    ..    def
-00009800: 2064 656c 6574 655f 7365 6372 6574 2873   delete_secret(s
-00009810: 656c 662c 206d 6f75 6e74 5f70 6174 683a  elf, mount_path:
-00009820: 2073 7472 2c20 7061 7468 3a20 7374 722c   str, path: str,
-00009830: 2076 6572 7369 6f6e 3a20 4f70 7469 6f6e   version: Option
-00009840: 616c 5b55 6e69 6f6e 5b69 6e74 2c20 4c69  al[Union[int, Li
-00009850: 7374 5b69 6e74 5d5d 5d20 3d20 4e6f 6e65  st[int]]] = None
-00009860: 293a 0d0a 2020 2020 2020 2020 2222 2264  ):..        """d
-00009870: 656c 6574 6520 7365 6372 6574 6573 2066  elete secretes f
-00009880: 726f 6d20 226d 6f75 6e74 5f70 6174 682f  rom "mount_path/
-00009890: 7061 7468 220d 0a0d 0a20 2020 2020 2020  path"....       
-000098a0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-000098b0: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-000098c0: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-000098d0: 2020 7061 7468 2028 7374 7229 0d0a 2020    path (str)..  
-000098e0: 2020 2020 2020 2020 2020 7665 7273 696f            versio
-000098f0: 6e20 284f 7074 696f 6e61 6c5b 556e 696f  n (Optional[Unio
-00009900: 6e5b 696e 742c 204c 6973 745b 696e 745d  n[int, List[int]
-00009910: 5d5d 2c20 6f70 7469 6f6e 616c 293a 2064  ]], optional): d
-00009920: 656c 6574 6520 6120 7370 6563 6966 6963  elete a specific
-00009930: 2076 6572 7369 6f6e 206f 7220 6120 6c69   version or a li
-00009940: 7374 206f 6620 7665 7273 696f 6e73 2e0d  st of versions..
-00009950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009990: 2020 6966 2076 6572 7369 6f6e 2069 7320    if version is 
-000099a0: 4e6f 6e65 2c20 7468 656e 2064 656c 6574  None, then delet
-000099b0: 6520 7468 6520 6c61 7465 7374 2076 6572  e the latest ver
-000099c0: 7369 6f6e 2e20 0d0a 2020 2020 2020 2020  sion. ..        
-000099d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a00: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00009a10: 7320 746f 204e 6f6e 652e 0d0a 0d0a 2020  s to None.....  
-00009a20: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
-00009a30: 2020 2020 2020 2020 2020 2020 626f 6f6c              bool
-00009a40: 3a20 7265 7475 726e 2054 7275 6520 6966  : return True if
-00009a50: 2073 7563 6365 7373 2c20 6f74 6865 7277   success, otherw
-00009a60: 6973 6520 7265 7475 726e 2046 616c 7365  ise return False
-00009a70: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00009a80: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-00009a90: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
-00009aa0: 2020 2020 2061 6c6c 5f76 6572 7369 6f6e       all_version
-00009ab0: 7320 3d20 7365 6c66 2e67 6574 5f61 6c6c  s = self.get_all
-00009ac0: 5f73 6563 7265 745f 7665 7273 696f 6e73  _secret_versions
-00009ad0: 286d 6f75 6e74 5f70 6174 682c 2070 6174  (mount_path, pat
-00009ae0: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
-00009af0: 6966 2061 6c6c 5f76 6572 7369 6f6e 7320  if all_versions 
-00009b00: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00009b10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009b20: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00009b30: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00009b40: 2020 6966 2076 6572 7369 6f6e 2069 7320    if version is 
-00009b50: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00009b60: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00009b70: 7420 2869 735f 696e 7428 7665 7273 696f  t (is_int(versio
-00009b80: 6e29 206f 7220 6973 5f6c 6973 7428 7665  n) or is_list(ve
-00009b90: 7273 696f 6e29 293a 0d0a 2020 2020 2020  rsion)):..      
-00009ba0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00009bb0: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00009bc0: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00009bd0: 616d 655f 5f7d 202d 2064 656c 6574 6520  ame__} - delete 
-00009be0: 7365 6372 6574 2065 7272 6f72 3a20 7665  secret error: ve
-00009bf0: 7273 696f 6e20 6d75 7374 2062 6520 616e  rsion must be an
-00009c00: 2069 6e74 206f 7220 6120 6c69 7374 206f   int or a list o
-00009c10: 6620 696e 7422 290d 0a20 2020 2020 2020  f int")..       
-00009c20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00009c30: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-00009c40: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-00009c50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009c60: 6973 5f69 6e74 2876 6572 7369 6f6e 293a  is_int(version):
-00009c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009c80: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
-00009c90: 5b76 6572 7369 6f6e 5d0d 0a20 2020 2020  [version]..     
-00009ca0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00009cb0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-00009cc0: 7273 696f 6e20 3d20 5b61 6c6c 5f76 6572  rsion = [all_ver
-00009cd0: 7369 6f6e 735b 2263 7572 7265 6e74 5f76  sions["current_v
-00009ce0: 6572 7369 6f6e 225d 5d0d 0a20 2020 2020  ersion"]]..     
-00009cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009d00: 6c6f 6767 6572 2e69 6e66 6f28 6622 7b5f  logger.info(f"{_
-00009d10: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00009d20: 5f7d 202d 2064 656c 6574 6520 7365 6372  _} - delete secr
-00009d30: 6574 2065 7272 6f72 3a20 6465 6c65 7469  et error: deleti
-00009d40: 6e67 2074 6865 206c 6174 6573 7420 7665  ng the latest ve
-00009d50: 7273 696f 6e20 277b 7665 7273 696f 6e5b  rsion '{version[
-00009d60: 305d 7d27 202e 2e2e 2229 0d0a 2020 2020  0]}' ...")..    
-00009d70: 2020 2020 2020 2020 666f 7220 7620 696e          for v in
-00009d80: 2076 6572 7369 6f6e 3a0d 0a20 2020 2020   version:..     
-00009d90: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00009da0: 7420 6973 5f69 6e74 2876 293a 0d0a 2020  t is_int(v):..  
-00009db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dc0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-00009dd0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-00009de0: 2e5f 5f6e 616d 655f 5f7d 202d 2064 656c  .__name__} - del
-00009df0: 6574 6520 7365 6372 6574 2065 7272 6f72  ete secret error
-00009e00: 3a20 7665 7273 696f 6e20 277b 767d 2720  : version '{v}' 
-00009e10: 6d75 7374 2062 6520 616e 2069 6e74 2229  must be an int")
-00009e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009e30: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00009e40: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00009e50: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00009e60: 2020 2020 2020 6966 2073 7472 2876 2920        if str(v) 
-00009e70: 6e6f 7420 696e 2061 6c6c 5f76 6572 7369  not in all_versi
-00009e80: 6f6e 732e 6b65 7973 2829 3a0d 0a20 2020  ons.keys():..   
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ea0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-00009eb0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-00009ec0: 5f5f 6e61 6d65 5f5f 7d20 2d20 6465 6c65  __name__} - dele
-00009ed0: 7465 2073 6563 7265 7420 6572 726f 723a  te secret error:
-00009ee0: 2076 6572 7369 6f6e 2027 7b76 7d27 206e   version '{v}' n
-00009ef0: 6f74 2066 6f75 6e64 2229 0d0a 2020 2020  ot found")..    
-00009f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f10: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00009f20: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
-00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f40: 6465 7374 726f 7965 6420 3d20 616c 6c5f  destroyed = all_
-00009f50: 7665 7273 696f 6e73 5b73 7472 2876 295d  versions[str(v)]
-00009f60: 5b22 6465 7374 726f 7965 6422 5d0d 0a20  ["destroyed"].. 
-00009f70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009f80: 6620 6465 7374 726f 7965 643a 0d0a 2020  f destroyed:..  
-00009f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fa0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-00009fb0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-00009fc0: 2e5f 5f6e 616d 655f 5f7d 202d 2064 656c  .__name__} - del
-00009fd0: 6574 6520 7365 6372 6574 2065 7272 6f72  ete secret error
-00009fe0: 3a20 7665 7273 696f 6e20 277b 767d 2720  : version '{v}' 
-00009ff0: 6973 2061 6c72 6561 6479 2064 6573 7472  is already destr
-0000a000: 6f79 6564 2229 0d0a 2020 2020 2020 2020  oyed")..        
-0000a010: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a020: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-0000a030: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0000a040: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
-0000a050: 7465 6420 3d20 616c 6c5f 7665 7273 696f  ted = all_versio
-0000a060: 6e73 5b73 7472 2876 295d 5b22 6465 6c65  ns[str(v)]["dele
-0000a070: 7465 6422 5d0d 0a20 2020 2020 2020 2020  ted"]..         
-0000a080: 2020 2020 2020 2069 6620 6465 6c65 7465         if delete
-0000a090: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-0000a0a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000a0b0: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-0000a0c0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0000a0d0: 202d 2064 656c 6574 6520 7365 6372 6574   - delete secret
-0000a0e0: 2065 7272 6f72 3a20 7665 7273 696f 6e20   error: version 
-0000a0f0: 277b 767d 2720 6973 2061 6c72 6561 6479  '{v}' is already
-0000a100: 2064 656c 6574 6564 2229 0d0a 2020 2020   deleted")..    
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-0000a130: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0000a140: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
-0000a150: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-0000a160: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
-0000a170: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-0000a180: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-0000a190: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-0000a1a0: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-0000a1b0: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-0000a1c0: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
-0000a1d0: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
-0000a1e0: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
-0000a1f0: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-0000a200: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-0000a210: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-0000a220: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-0000a230: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-0000a240: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
-0000a250: 7473 2e70 6f73 7428 7572 6c2b 6622 7b6d  ts.post(url+f"{m
-0000a260: 6f75 6e74 5f70 6174 687d 2f64 656c 6574  ount_path}/delet
-0000a270: 652f 7b70 6174 687d 222c 200d 0a20 2020  e/{path}", ..   
-0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a290: 2020 2020 2020 2020 2020 2020 2068 6561               hea
-0000a2a0: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
-0000a2b0: 6f6b 656e 223a 2074 6f6b 656e 7d2c 200d  oken": token}, .
-0000a2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2e0: 2064 6174 613d 6a73 6f6e 2e64 756d 7073   data=json.dumps
-0000a2f0: 2864 6963 7428 7665 7273 696f 6e73 3d76  (dict(versions=v
-0000a300: 6572 7369 6f6e 2929 290d 0a20 2020 2020  ersion)))..     
-0000a310: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
-0000a320: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
-0000a330: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
-0000a340: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
-0000a350: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000a360: 7572 6e20 5472 7565 0d0a 2020 2020 2020  urn True..      
-0000a370: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000a380: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000a390: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
-0000a3a0: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
-0000a3b0: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
-0000a3c0: 6465 6c65 7465 2073 6563 7265 7420 6572  delete secret er
-0000a3d0: 726f 7222 290d 0a20 2020 2020 2020 2020  ror")..         
-0000a3e0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000a3f0: 6c73 650d 0a0d 0a20 2020 2020 2020 2072  lse....        r
-0000a400: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-0000a410: 200d 0a20 2020 2064 6566 2075 6e64 656c   ..    def undel
-0000a420: 6574 655f 7365 6372 6574 2873 656c 662c  ete_secret(self,
-0000a430: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
-0000a440: 2c20 7061 7468 3a20 7374 722c 2076 6572  , path: str, ver
-0000a450: 7369 6f6e 3a20 556e 696f 6e5b 696e 742c  sion: Union[int,
-0000a460: 204c 6973 745b 696e 745d 5d29 3a0d 0a20   List[int]]):.. 
-0000a470: 2020 2020 2020 2022 2222 756e 6465 6c65         """undele
-0000a480: 7465 2073 6563 7265 7473 2069 6e20 226d  te secrets in "m
-0000a490: 6f75 6e74 5f70 6174 682f 7061 7468 220d  ount_path/path".
-0000a4a0: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-0000a4b0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
-0000a4c0: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
-0000a4d0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0000a4e0: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
-0000a4f0: 2020 2020 7665 7273 696f 6e20 2855 6e69      version (Uni
-0000a500: 6f6e 5b69 6e74 2c20 4c69 7374 5b69 6e74  on[int, List[int
-0000a510: 5d5d 290d 0a0d 0a20 2020 2020 2020 2052  ]])....        R
-0000a520: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-0000a530: 2020 2020 2062 6f6f 6c3a 2072 6574 7572       bool: retur
-0000a540: 6e20 5472 7565 2069 6620 7375 6363 6573  n True if succes
-0000a550: 732c 206f 7468 6572 7769 7365 2072 6574  s, otherwise ret
-0000a560: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-0000a570: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000a580: 6966 2073 656c 662e 6973 5f61 7574 683a  if self.is_auth:
-0000a590: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
-0000a5a0: 6c5f 7665 7273 696f 6e73 203d 2073 656c  l_versions = sel
-0000a5b0: 662e 6765 745f 616c 6c5f 7365 6372 6574  f.get_all_secret
-0000a5c0: 5f76 6572 7369 6f6e 7328 6d6f 756e 745f  _versions(mount_
-0000a5d0: 7061 7468 2c20 7061 7468 290d 0a20 2020  path, path)..   
-0000a5e0: 2020 2020 2020 2020 2069 6620 616c 6c5f           if all_
-0000a5f0: 7665 7273 696f 6e73 2069 7320 4e6f 6e65  versions is None
-0000a600: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000a610: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-0000a620: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-0000a630: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000a640: 7420 2869 735f 696e 7428 7665 7273 696f  t (is_int(versio
-0000a650: 6e29 206f 7220 6973 5f6c 6973 7428 7665  n) or is_list(ve
-0000a660: 7273 696f 6e29 293a 0d0a 2020 2020 2020  rsion)):..      
-0000a670: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000a680: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
-0000a690: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0000a6a0: 5f7d 202d 2075 6e64 656c 6574 6520 7365  _} - undelete se
-0000a6b0: 6372 6574 2065 7272 6f72 3a20 7665 7273  cret error: vers
-0000a6c0: 696f 6e20 6d75 7374 2062 6520 616e 2069  ion must be an i
-0000a6d0: 6e74 206f 7220 6120 6c69 7374 206f 6620  nt or a list of 
-0000a6e0: 696e 7422 290d 0a20 2020 2020 2020 2020  int")..         
-0000a6f0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000a700: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-0000a710: 2069 6620 6973 5f69 6e74 2876 6572 7369   if is_int(versi
-0000a720: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
-0000a730: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
-0000a740: 5b76 6572 7369 6f6e 5d0d 0a20 2020 2020  [version]..     
-0000a750: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000a760: 2020 2020 2020 2020 2066 6f72 2076 2069           for v i
-0000a770: 6e20 7665 7273 696f 6e3a 0d0a 2020 2020  n version:..    
-0000a780: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000a790: 6f74 2069 735f 696e 7428 7629 3a0d 0a20  ot is_int(v):.. 
-0000a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7b0: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-0000a7c0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-0000a7d0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 756e  _.__name__} - un
-0000a7e0: 6465 6c65 7465 2073 6563 7265 7420 6572  delete secret er
-0000a7f0: 726f 723a 2076 6572 7369 6f6e 2027 7b76  ror: version '{v
-0000a800: 7d27 206d 7573 7420 6265 2061 6e20 696e  }' must be an in
-0000a810: 7422 290d 0a20 2020 2020 2020 2020 2020  t")..           
-0000a820: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000a830: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-0000a840: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000a850: 2020 2020 2020 2020 2069 6620 7374 7228           if str(
-0000a860: 7629 206e 6f74 2069 6e20 616c 6c5f 7665  v) not in all_ve
-0000a870: 7273 696f 6e73 2e6b 6579 7328 293a 0d0a  rsions.keys():..
-0000a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a890: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-0000a8a0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
-0000a8b0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2075  __.__name__} - u
-0000a8c0: 6e64 656c 6574 6520 7365 6372 6574 2065  ndelete secret e
-0000a8d0: 7272 6f72 3a20 7665 7273 696f 6e20 277b  rror: version '{
-0000a8e0: 767d 2720 6e6f 7420 666f 756e 6422 290d  v}' not found").
-0000a8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a900: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0000a910: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000a920: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-0000a930: 2020 2020 2064 6573 7472 6f79 6564 203d       destroyed =
-0000a940: 2061 6c6c 5f76 6572 7369 6f6e 735b 7374   all_versions[st
-0000a950: 7228 7629 5d5b 2264 6573 7472 6f79 6564  r(v)]["destroyed
-0000a960: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
-0000a970: 2020 2020 6966 2064 6573 7472 6f79 6564      if destroyed
-0000a980: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000a990: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-0000a9a0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-0000a9b0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-0000a9c0: 2d20 756e 6465 6c65 7465 2073 6563 7265  - undelete secre
-0000a9d0: 7420 6572 726f 723a 2076 6572 7369 6f6e  t error: version
-0000a9e0: 2027 7b76 7d27 2069 7320 616c 7265 6164   '{v}' is alread
-0000a9f0: 7920 220d 0a20 2020 2020 2020 2020 2020  y "..           
-0000aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa10: 2020 2020 2020 2020 2020 2066 2264 6573             f"des
-0000aa20: 7472 6f79 6564 2c20 6361 6e6e 6f74 2062  troyed, cannot b
-0000aa30: 6520 756e 6465 6c65 7465 6422 290d 0a20  e undeleted").. 
+000087f0: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
+00008800: 2065 7869 7374 735f 7365 6372 6574 732e   exists_secrets.
+00008810: 6b65 7973 2829 3a0d 0a20 2020 2020 2020  keys():..       
+00008820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008830: 2073 656c 662e 6c6f 6767 6572 2e77 6172   self.logger.war
+00008840: 6e69 6e67 2866 227b 5f5f 636c 6173 735f  ning(f"{__class_
+00008850: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 7570  _.__name__} - up
+00008860: 6461 7465 2073 6563 7265 7420 6572 726f  date secret erro
+00008870: 723a 206b 6579 2027 7b6b 6579 7d27 206e  r: key '{key}' n
+00008880: 6f74 2066 6f75 6e64 2229 0d0a 2020 2020  ot found")..    
+00008890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000088a0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+000088b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000088c0: 2020 2020 2020 6578 6973 7473 5f73 6563        exists_sec
+000088d0: 7265 7473 5b6b 6579 5d20 3d20 7365 6372  rets[key] = secr
+000088e0: 6574 735b 6b65 795d 0d0a 2020 2020 2020  ets[key]..      
+000088f0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00008900: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00008910: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+00008920: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00008930: 2020 2020 2069 6620 6f70 7469 6f6e 7320       if options 
+00008940: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00008950: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00008960: 206e 6f74 2069 735f 6469 6374 286f 7074   not is_dict(opt
+00008970: 696f 6e73 293a 0d0a 2020 2020 2020 2020  ions):..        
+00008980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008990: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
+000089a0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
+000089b0: 655f 5f7d 202d 2075 7064 6174 6520 7365  e__} - update se
+000089c0: 6372 6574 2065 7272 6f72 3a20 6f70 7469  cret error: opti
+000089d0: 6f6e 7320 6d75 7374 2062 6520 6120 6469  ons must be a di
+000089e0: 6374 206f 7220 436f 6e66 6967 4469 6374  ct or ConfigDict
+000089f0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00008a00: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00008a10: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00008a20: 2020 2020 2020 6461 7461 203d 2064 6963        data = dic
+00008a30: 7428 6f70 7469 6f6e 733d 6f70 7469 6f6e  t(options=option
+00008a40: 732c 2064 6174 613d 6578 6973 7473 5f73  s, data=exists_s
+00008a50: 6563 7265 7473 290d 0a20 2020 2020 2020  ecrets)..       
+00008a60: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00008a70: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00008a80: 203d 2064 6963 7428 6461 7461 3d65 7869   = dict(data=exi
+00008a90: 7374 735f 7365 6372 6574 7329 0d0a 2020  sts_secrets)..  
+00008aa0: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00008ab0: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+00008ac0: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
+00008ad0: 7874 2873 656c 662e 7572 6c2c 206b 6579  xt(self.url, key
+00008ae0: 3d72 616e 646f 6d5f 6865 7828 7365 6c66  =random_hex(self
+00008af0: 2e5f 6b65 795f 6c65 6e2c 2073 656c 662e  ._key_len, self.
+00008b00: 5f73 6565 642a 3229 2c20 6976 3d72 616e  _seed*2), iv=ran
+00008b10: 646f 6d5f 6865 7828 3136 2c20 7365 6c66  dom_hex(16, self
+00008b20: 2e5f 7365 6564 2a33 2929 0d0a 2020 2020  ._seed*3))..    
+00008b30: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+00008b40: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
+00008b50: 2873 656c 662e 746f 6b65 6e2c 206b 6579  (self.token, key
+00008b60: 3d72 616e 646f 6d5f 6865 7828 7365 6c66  =random_hex(self
+00008b70: 2e5f 6b65 795f 6c65 6e2c 2073 656c 662e  ._key_len, self.
+00008b80: 5f73 6565 642a 3229 2c20 6976 3d72 616e  _seed*2), iv=ran
+00008b90: 646f 6d5f 6865 7828 3136 2c20 7365 6c66  dom_hex(16, self
+00008ba0: 2e5f 7365 6564 2a33 2929 0d0a 2020 2020  ._seed*3))..    
+00008bb0: 2020 2020 2020 2020 7265 7320 3d20 7265          res = re
+00008bc0: 7175 6573 7473 2e70 6f73 7428 7572 6c2b  quests.post(url+
+00008bd0: 6622 7b6d 6f75 6e74 5f70 6174 687d 2f64  f"{mount_path}/d
+00008be0: 6174 612f 7b70 6174 687d 222c 2068 6561  ata/{path}", hea
+00008bf0: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
+00008c00: 6f6b 656e 223a 2074 6f6b 656e 7d2c 2064  oken": token}, d
+00008c10: 6174 613d 6a73 6f6e 2e64 756d 7073 2864  ata=json.dumps(d
+00008c20: 6174 6129 290d 0a20 2020 2020 2020 2020  ata))..         
+00008c30: 2020 2069 6620 7265 732e 7374 6174 7573     if res.status
+00008c40: 5f63 6f64 6520 3d3d 2032 3030 206f 7220  _code == 200 or 
+00008c50: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+00008c60: 3d3d 2032 3034 3a0d 0a20 2020 2020 2020  == 204:..       
+00008c70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008c80: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00008c90: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00008ca0: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+00008cb0: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
+00008cc0: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
+00008cd0: 6d65 5f5f 2c20 7265 732c 2022 7570 6461  me__, res, "upda
+00008ce0: 7465 2073 6563 7265 7420 6572 726f 7222  te secret error"
+00008cf0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00008d00: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00008d10: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00008d20: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00008d30: 6c73 650d 0a20 2020 2020 2020 200d 0a20  lse..        .. 
+00008d40: 2020 2064 6566 2072 6561 645f 7365 6372     def read_secr
+00008d50: 6574 5f73 7562 6b65 7973 2873 656c 662c  et_subkeys(self,
+00008d60: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
+00008d70: 2c20 7061 7468 3a20 7374 722c 2076 6572  , path: str, ver
+00008d80: 7369 6f6e 3a20 4f70 7469 6f6e 616c 5b69  sion: Optional[i
+00008d90: 6e74 5d20 3d20 4e6f 6e65 2c20 6465 7074  nt] = None, dept
+00008da0: 683a 2069 6e74 203d 2030 293a 0d0a 2020  h: int = 0):..  
+00008db0: 2020 2020 2020 2222 2272 6561 6420 7375        """read su
+00008dc0: 626b 6579 7320 6f66 2073 6563 7265 7473  bkeys of secrets
+00008dd0: 2069 6e20 226d 6f75 6e74 5f70 6174 682f   in "mount_path/
+00008de0: 7061 7468 220d 0a0d 0a20 2020 2020 2020  path"....       
+00008df0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
+00008e00: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
+00008e10: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
+00008e20: 2020 7061 7468 2028 7374 7229 0d0a 2020    path (str)..  
+00008e30: 2020 2020 2020 2020 2020 7665 7273 696f            versio
+00008e40: 6e20 284f 7074 696f 6e61 6c5b 696e 745d  n (Optional[int]
+00008e50: 2c20 6f70 7469 6f6e 616c 293a 2072 6561  , optional): rea
+00008e60: 6420 7375 626b 6579 7320 6f66 2061 2073  d subkeys of a s
+00008e70: 7065 6369 6669 6320 7665 7273 696f 6e2e  pecific version.
+00008e80: 2069 6620 4e6f 6e65 2c20 7265 6164 2073   if None, read s
+00008e90: 7562 6b65 7973 206f 6620 0d0a 2020 2020  ubkeys of ..    
+00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ec0: 2020 2020 2020 2020 2020 2074 6865 206c             the l
+00008ed0: 6174 6573 7420 7665 7273 696f 6e2e 2044  atest version. D
+00008ee0: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
+00008ef0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00008f00: 7074 6820 2869 6e74 2c20 6f70 7469 6f6e  pth (int, option
+00008f10: 616c 293a 2073 7065 6369 6679 2074 6865  al): specify the
+00008f20: 2064 6570 7468 206f 6620 7375 626b 6579   depth of subkey
+00008f30: 732e 2069 6620 6571 7561 6c73 2030 2c20  s. if equals 0, 
+00008f40: 6d65 616e 7320 6e6f 206c 696d 6974 2e20  means no limit. 
+00008f50: 4465 6661 756c 7473 2074 6f20 302e 0d0a  Defaults to 0...
+00008f60: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00008f70: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00008f80: 6469 6374 206f 7220 4e6f 6e65 3a20 7265  dict or None: re
+00008f90: 7475 726e 2061 2064 6963 7420 6966 2073  turn a dict if s
+00008fa0: 7563 6365 7373 2c20 6f74 6865 7277 6973  uccess, otherwis
+00008fb0: 6520 7265 7475 726e 204e 6f6e 650d 0a20  e return None.. 
+00008fc0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00008fd0: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
+00008fe0: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
+00008ff0: 2020 616c 6c5f 7665 7273 696f 6e73 203d    all_versions =
+00009000: 2073 656c 662e 6765 745f 616c 6c5f 7365   self.get_all_se
+00009010: 6372 6574 5f76 6572 7369 6f6e 7328 6d6f  cret_versions(mo
+00009020: 756e 745f 7061 7468 2c20 7061 7468 290d  unt_path, path).
+00009030: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009040: 616c 6c5f 7665 7273 696f 6e73 2069 7320  all_versions is 
+00009050: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00009060: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00009070: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00009080: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00009090: 2076 6572 7369 6f6e 2069 7320 6e6f 7420   version is not 
+000090a0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000090b0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+000090c0: 5f69 6e74 2876 6572 7369 6f6e 293a 0d0a  _int(version):..
+000090d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090e0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+000090f0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+00009100: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2072  __.__name__} - r
+00009110: 6561 6420 7365 6372 6574 2073 7562 6b65  ead secret subke
+00009120: 7973 2065 7272 6f72 3a20 7665 7273 696f  ys error: versio
+00009130: 6e20 6d75 7374 2062 6520 616e 2069 6e74  n must be an int
+00009140: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00009150: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00009160: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00009170: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00009180: 2020 2020 2020 2069 6620 7374 7228 7665         if str(ve
+00009190: 7273 696f 6e29 206e 6f74 2069 6e20 616c  rsion) not in al
+000091a0: 6c5f 7665 7273 696f 6e73 2e6b 6579 7328  l_versions.keys(
+000091b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000091c0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000091d0: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+000091e0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+000091f0: 202d 2072 6561 6420 7365 6372 6574 2073   - read secret s
+00009200: 7562 6b65 7973 2065 7272 6f72 3a20 7665  ubkeys error: ve
+00009210: 7273 696f 6e20 277b 7665 7273 696f 6e7d  rsion '{version}
+00009220: 2720 6e6f 7420 666f 756e 6422 290d 0a20  ' not found").. 
+00009230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009240: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+00009250: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00009260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009270: 2020 2076 6572 7369 6f6e 203d 2061 6c6c     version = all
+00009280: 5f76 6572 7369 6f6e 735b 2263 7572 7265  _versions["curre
+00009290: 6e74 5f76 6572 7369 6f6e 225d 0d0a 2020  nt_version"]..  
+000092a0: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
+000092b0: 5f76 6572 7369 6f6e 735b 7374 7228 7665  _versions[str(ve
+000092c0: 7273 696f 6e29 5d5b 2264 6573 7472 6f79  rsion)]["destroy
+000092d0: 6564 225d 3a0d 0a20 2020 2020 2020 2020  ed"]:..         
+000092e0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+000092f0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+00009300: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+00009310: 2d20 7265 6164 2073 6563 7265 7420 7375  - read secret su
+00009320: 626b 6579 7320 6572 726f 723a 2076 6572  bkeys error: ver
+00009330: 7369 6f6e 2027 7b76 6572 7369 6f6e 7d27  sion '{version}'
+00009340: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+00009350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009360: 2020 2020 2020 6622 6861 7320 6265 656e        f"has been
+00009370: 2070 6572 6d61 6e65 6e74 6c79 2064 6573   permanently des
+00009380: 7472 6f79 6564 2229 0d0a 2020 2020 2020  troyed")..      
+00009390: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000093a0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+000093b0: 2020 2069 6620 616c 6c5f 7665 7273 696f     if all_versio
+000093c0: 6e73 5b73 7472 2876 6572 7369 6f6e 295d  ns[str(version)]
+000093d0: 5b22 6465 6c65 7465 6422 5d3a 0d0a 2020  ["deleted"]:..  
+000093e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000093f0: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00009400: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
+00009410: 616d 655f 5f7d 202d 2072 6561 6420 7365  ame__} - read se
+00009420: 6372 6574 2073 7562 6b65 7973 2065 7272  cret subkeys err
+00009430: 6f72 3a20 7665 7273 696f 6e20 277b 7665  or: version '{ve
+00009440: 7273 696f 6e7d 2720 220d 0a20 2020 2020  rsion}' "..     
+00009450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009460: 2020 2020 2020 2020 2020 2020 2066 2268               f"h
+00009470: 6173 2062 6565 6e20 6465 6c65 7465 642c  as been deleted,
+00009480: 2070 6c65 6173 6520 756e 6465 6c65 7465   please undelete
+00009490: 2069 7420 6669 7273 7422 290d 0a20 2020   it first")..   
+000094a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000094b0: 7572 6e20 4e6f 6e65 0d0a 0d0a 2020 2020  urn None....    
+000094c0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+000094d0: 735f 696e 7428 6465 7074 6829 3a0d 0a20  s_int(depth):.. 
+000094e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000094f0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+00009500: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+00009510: 6e61 6d65 5f5f 7d20 2d20 7265 6164 2073  name__} - read s
+00009520: 6563 7265 7420 7375 626b 6579 7320 6572  ecret subkeys er
+00009530: 726f 723a 2064 6570 7468 206d 7573 7420  ror: depth must 
+00009540: 6265 2061 6e20 696e 7422 290d 0a20 2020  be an int")..   
+00009550: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00009560: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+00009570: 2020 2020 2020 7061 7261 6d20 3d20 6622        param = f"
+00009580: 3f76 6572 7369 6f6e 3d7b 7665 7273 696f  ?version={versio
+00009590: 6e7d 2664 6570 7468 3d7b 6465 7074 687d  n}&depth={depth}
+000095a0: 220d 0a0d 0a20 2020 2020 2020 2020 2020  "....           
+000095b0: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
+000095c0: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
+000095d0: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+000095e0: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+000095f0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00009600: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00009610: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+00009620: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+00009630: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
+00009640: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
+00009650: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+00009660: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+00009670: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00009680: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00009690: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+000096a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000096b0: 203d 2072 6571 7565 7374 732e 6765 7428   = requests.get(
+000096c0: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
+000096d0: 687d 2f73 7562 6b65 7973 2f7b 7061 7468  h}/subkeys/{path
+000096e0: 7d22 2c20 6865 6164 6572 733d 7b22 582d  }", headers={"X-
+000096f0: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
+00009700: 6b65 6e7d 2c20 7061 7261 6d73 3d70 6172  ken}, params=par
+00009710: 616d 290d 0a20 2020 2020 2020 2020 2020  am)..           
+00009720: 2069 6620 7265 732e 7374 6174 7573 5f63   if res.status_c
+00009730: 6f64 6520 3d3d 2032 3030 206f 7220 7265  ode == 200 or re
+00009740: 732e 7374 6174 7573 5f63 6f64 6520 3d3d  s.status_code ==
+00009750: 2032 3034 3a0d 0a20 2020 2020 2020 2020   204:..         
+00009760: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00009770: 732e 6a73 6f6e 2829 5b22 6461 7461 225d  s.json()["data"]
+00009780: 5b22 7375 626b 6579 7322 5d0d 0a20 2020  ["subkeys"]..   
+00009790: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000097a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097b0: 7365 6c66 2e5f 6c6f 675f 6572 726f 725f  self._log_error_
+000097c0: 7265 7370 6f6e 7365 285f 5f63 6c61 7373  response(__class
+000097d0: 5f5f 2e5f 5f6e 616d 655f 5f2c 2072 6573  __.__name__, res
+000097e0: 2c20 2272 6561 6420 7365 6372 6574 2073  , "read secret s
+000097f0: 7562 6b65 7973 2065 7272 6f72 2229 0d0a  ubkeys error")..
+00009800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009810: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
+00009820: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00009830: 6e65 0d0a 2020 2020 0d0a 2020 2020 6465  ne..    ..    de
+00009840: 6620 6465 6c65 7465 5f73 6563 7265 7428  f delete_secret(
+00009850: 7365 6c66 2c20 6d6f 756e 745f 7061 7468  self, mount_path
+00009860: 3a20 7374 722c 2070 6174 683a 2073 7472  : str, path: str
+00009870: 2c20 7665 7273 696f 6e3a 204f 7074 696f  , version: Optio
+00009880: 6e61 6c5b 556e 696f 6e5b 696e 742c 204c  nal[Union[int, L
+00009890: 6973 745b 696e 745d 5d5d 203d 204e 6f6e  ist[int]]] = Non
+000098a0: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+000098b0: 6465 6c65 7465 2073 6563 7265 7465 7320  delete secretes 
+000098c0: 6672 6f6d 2022 6d6f 756e 745f 7061 7468  from "mount_path
+000098d0: 2f70 6174 6822 0d0a 0d0a 2020 2020 2020  /path"....      
+000098e0: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+000098f0: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
+00009900: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
+00009910: 2020 2070 6174 6820 2873 7472 290d 0a20     path (str).. 
+00009920: 2020 2020 2020 2020 2020 2076 6572 7369             versi
+00009930: 6f6e 2028 4f70 7469 6f6e 616c 5b55 6e69  on (Optional[Uni
+00009940: 6f6e 5b69 6e74 2c20 4c69 7374 5b69 6e74  on[int, List[int
+00009950: 5d5d 5d2c 206f 7074 696f 6e61 6c29 3a20  ]]], optional): 
+00009960: 6465 6c65 7465 2061 2073 7065 6369 6669  delete a specifi
+00009970: 6320 7665 7273 696f 6e20 6f72 2061 206c  c version or a l
+00009980: 6973 7420 6f66 2076 6572 7369 6f6e 732e  ist of versions.
+00009990: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000099a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099d0: 2020 2069 6620 7665 7273 696f 6e20 6973     if version is
+000099e0: 204e 6f6e 652c 2074 6865 6e20 6465 6c65   None, then dele
+000099f0: 7465 2074 6865 206c 6174 6573 7420 7665  te the latest ve
+00009a00: 7273 696f 6e2e 200d 0a20 2020 2020 2020  rsion. ..       
+00009a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a40: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+00009a50: 7473 2074 6f20 4e6f 6e65 2e0d 0a0d 0a20  ts to None..... 
+00009a60: 2020 2020 2020 2052 6574 7572 6e73 3a0d         Returns:.
+00009a70: 0a20 2020 2020 2020 2020 2020 2062 6f6f  .            boo
+00009a80: 6c3a 2072 6574 7572 6e20 5472 7565 2069  l: return True i
+00009a90: 6620 7375 6363 6573 732c 206f 7468 6572  f success, other
+00009aa0: 7769 7365 2072 6574 7572 6e20 4661 6c73  wise return Fals
+00009ab0: 650d 0a20 2020 2020 2020 2022 2222 0d0a  e..        """..
+00009ac0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00009ad0: 6973 5f61 7574 683a 0d0a 2020 2020 2020  is_auth:..      
+00009ae0: 2020 2020 2020 616c 6c5f 7665 7273 696f        all_versio
+00009af0: 6e73 203d 2073 656c 662e 6765 745f 616c  ns = self.get_al
+00009b00: 6c5f 7365 6372 6574 5f76 6572 7369 6f6e  l_secret_version
+00009b10: 7328 6d6f 756e 745f 7061 7468 2c20 7061  s(mount_path, pa
+00009b20: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
+00009b30: 2069 6620 616c 6c5f 7665 7273 696f 6e73   if all_versions
+00009b40: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00009b50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009b60: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
+00009b70: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00009b80: 2020 2069 6620 7665 7273 696f 6e20 6973     if version is
+00009b90: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00009ba0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00009bb0: 6f74 2028 6973 5f69 6e74 2876 6572 7369  ot (is_int(versi
+00009bc0: 6f6e 2920 6f72 2069 735f 6c69 7374 2876  on) or is_list(v
+00009bd0: 6572 7369 6f6e 2929 3a0d 0a20 2020 2020  ersion)):..     
+00009be0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009bf0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+00009c00: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+00009c10: 6e61 6d65 5f5f 7d20 2d20 6465 6c65 7465  name__} - delete
+00009c20: 2073 6563 7265 7420 6572 726f 723a 2076   secret error: v
+00009c30: 6572 7369 6f6e 206d 7573 7420 6265 2061  ersion must be a
+00009c40: 6e20 696e 7420 6f72 2061 206c 6973 7420  n int or a list 
+00009c50: 6f66 2069 6e74 2229 0d0a 2020 2020 2020  of int")..      
+00009c60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00009c70: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00009c80: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00009c90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00009ca0: 2069 735f 696e 7428 7665 7273 696f 6e29   is_int(version)
+00009cb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009cc0: 2020 2020 2020 2076 6572 7369 6f6e 203d         version =
+00009cd0: 205b 7665 7273 696f 6e5d 0d0a 2020 2020   [version]..    
+00009ce0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00009cf0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00009d00: 6572 7369 6f6e 203d 205b 616c 6c5f 7665  ersion = [all_ve
+00009d10: 7273 696f 6e73 5b22 6375 7272 656e 745f  rsions["current_
+00009d20: 7665 7273 696f 6e22 5d5d 0d0a 2020 2020  version"]]..    
+00009d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009d40: 2e6c 6f67 6765 722e 696e 666f 2866 227b  .logger.info(f"{
+00009d50: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00009d60: 5f5f 7d20 2d20 6465 6c65 7465 2073 6563  __} - delete sec
+00009d70: 7265 7420 6572 726f 723a 2064 656c 6574  ret error: delet
+00009d80: 696e 6720 7468 6520 6c61 7465 7374 2076  ing the latest v
+00009d90: 6572 7369 6f6e 2027 7b76 6572 7369 6f6e  ersion '{version
+00009da0: 5b30 5d7d 2720 2e2e 2e22 290d 0a20 2020  [0]}' ...")..   
+00009db0: 2020 2020 2020 2020 2066 6f72 2076 2069           for v i
+00009dc0: 6e20 7665 7273 696f 6e3a 0d0a 2020 2020  n version:..    
+00009dd0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00009de0: 6f74 2069 735f 696e 7428 7629 3a0d 0a20  ot is_int(v):.. 
+00009df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e00: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+00009e10: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+00009e20: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6465  _.__name__} - de
+00009e30: 6c65 7465 2073 6563 7265 7420 6572 726f  lete secret erro
+00009e40: 723a 2076 6572 7369 6f6e 2027 7b76 7d27  r: version '{v}'
+00009e50: 206d 7573 7420 6265 2061 6e20 696e 7422   must be an int"
+00009e60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00009e70: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00009e80: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00009e90: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00009ea0: 2020 2020 2020 2069 6620 7374 7228 7629         if str(v)
+00009eb0: 206e 6f74 2069 6e20 616c 6c5f 7665 7273   not in all_vers
+00009ec0: 696f 6e73 2e6b 6579 7328 293a 0d0a 2020  ions.keys():..  
+00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ee0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+00009ef0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+00009f00: 2e5f 5f6e 616d 655f 5f7d 202d 2064 656c  .__name__} - del
+00009f10: 6574 6520 7365 6372 6574 2065 7272 6f72  ete secret error
+00009f20: 3a20 7665 7273 696f 6e20 277b 767d 2720  : version '{v}' 
+00009f30: 6e6f 7420 666f 756e 6422 290d 0a20 2020  not found")..   
+00009f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f50: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+00009f60: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+00009f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009f80: 2064 6573 7472 6f79 6564 203d 2061 6c6c   destroyed = all
+00009f90: 5f76 6572 7369 6f6e 735b 7374 7228 7629  _versions[str(v)
+00009fa0: 5d5b 2264 6573 7472 6f79 6564 225d 0d0a  ]["destroyed"]..
+00009fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fc0: 6966 2064 6573 7472 6f79 6564 3a0d 0a20  if destroyed:.. 
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fe0: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+00009ff0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+0000a000: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6465  _.__name__} - de
+0000a010: 6c65 7465 2073 6563 7265 7420 6572 726f  lete secret erro
+0000a020: 723a 2076 6572 7369 6f6e 2027 7b76 7d27  r: version '{v}'
+0000a030: 2069 7320 616c 7265 6164 7920 6465 7374   is already dest
+0000a040: 726f 7965 6422 290d 0a20 2020 2020 2020  royed")..       
+0000a050: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000a060: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+0000a070: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+0000a080: 2020 2020 2020 2020 2020 2020 2064 656c               del
+0000a090: 6574 6564 203d 2061 6c6c 5f76 6572 7369  eted = all_versi
+0000a0a0: 6f6e 735b 7374 7228 7629 5d5b 2264 656c  ons[str(v)]["del
+0000a0b0: 6574 6564 225d 0d0a 2020 2020 2020 2020  eted"]..        
+0000a0c0: 2020 2020 2020 2020 6966 2064 656c 6574          if delet
+0000a0d0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+0000a0e0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0000a0f0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+0000a100: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0000a110: 7d20 2d20 6465 6c65 7465 2073 6563 7265  } - delete secre
+0000a120: 7420 6572 726f 723a 2076 6572 7369 6f6e  t error: version
+0000a130: 2027 7b76 7d27 2069 7320 616c 7265 6164   '{v}' is alread
+0000a140: 7920 6465 6c65 7465 6422 290d 0a20 2020  y deleted")..   
+0000a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a160: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+0000a170: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+0000a180: 2020 2020 2020 2020 2075 726c 203d 2061           url = a
+0000a190: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+0000a1a0: 7365 6c66 2e75 726c 2c20 6b65 793d 7261  self.url, key=ra
+0000a1b0: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+0000a1c0: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+0000a1d0: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+0000a1e0: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+0000a1f0: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+0000a200: 2020 2020 2074 6f6b 656e 203d 2061 6573       token = aes
+0000a210: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
+0000a220: 6c66 2e74 6f6b 656e 2c20 6b65 793d 7261  lf.token, key=ra
+0000a230: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+0000a240: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+0000a250: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+0000a260: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+0000a270: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+0000a280: 2020 2020 2072 6573 203d 2072 6571 7565       res = reque
+0000a290: 7374 732e 706f 7374 2875 726c 2b66 227b  sts.post(url+f"{
+0000a2a0: 6d6f 756e 745f 7061 7468 7d2f 6465 6c65  mount_path}/dele
+0000a2b0: 7465 2f7b 7061 7468 7d22 2c20 0d0a 2020  te/{path}", ..  
+0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2d0: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0000a2e0: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+0000a2f0: 546f 6b65 6e22 3a20 746f 6b65 6e7d 2c20  Token": token}, 
+0000a300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a320: 2020 6461 7461 3d6a 736f 6e2e 6475 6d70    data=json.dump
+0000a330: 7328 6469 6374 2876 6572 7369 6f6e 733d  s(dict(versions=
+0000a340: 7665 7273 696f 6e29 2929 0d0a 2020 2020  version)))..    
+0000a350: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
+0000a360: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+0000a370: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
+0000a380: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
+0000a390: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000a3a0: 7475 726e 2054 7275 650d 0a20 2020 2020  turn True..     
+0000a3b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000a3c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000a3d0: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+0000a3e0: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+0000a3f0: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+0000a400: 2264 656c 6574 6520 7365 6372 6574 2065  "delete secret e
+0000a410: 7272 6f72 2229 0d0a 2020 2020 2020 2020  rror")..        
+0000a420: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0000a430: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
+0000a440: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+0000a450: 2020 0d0a 2020 2020 6465 6620 756e 6465    ..    def unde
+0000a460: 6c65 7465 5f73 6563 7265 7428 7365 6c66  lete_secret(self
+0000a470: 2c20 6d6f 756e 745f 7061 7468 3a20 7374  , mount_path: st
+0000a480: 722c 2070 6174 683a 2073 7472 2c20 7665  r, path: str, ve
+0000a490: 7273 696f 6e3a 2055 6e69 6f6e 5b69 6e74  rsion: Union[int
+0000a4a0: 2c20 4c69 7374 5b69 6e74 5d5d 293a 0d0a  , List[int]]):..
+0000a4b0: 2020 2020 2020 2020 2222 2275 6e64 656c          """undel
+0000a4c0: 6574 6520 7365 6372 6574 7320 696e 2022  ete secrets in "
+0000a4d0: 6d6f 756e 745f 7061 7468 2f70 6174 6822  mount_path/path"
+0000a4e0: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
+0000a4f0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+0000a500: 6f75 6e74 5f70 6174 6820 2873 7472 290d  ount_path (str).
+0000a510: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+0000a520: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
+0000a530: 2020 2020 2076 6572 7369 6f6e 2028 556e       version (Un
+0000a540: 696f 6e5b 696e 742c 204c 6973 745b 696e  ion[int, List[in
+0000a550: 745d 5d29 0d0a 0d0a 2020 2020 2020 2020  t]])....        
+0000a560: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
+0000a570: 2020 2020 2020 626f 6f6c 3a20 7265 7475        bool: retu
+0000a580: 726e 2054 7275 6520 6966 2073 7563 6365  rn True if succe
+0000a590: 7373 2c20 6f74 6865 7277 6973 6520 7265  ss, otherwise re
+0000a5a0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+0000a5b0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0000a5c0: 2069 6620 7365 6c66 2e69 735f 6175 7468   if self.is_auth
+0000a5d0: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
+0000a5e0: 6c6c 5f76 6572 7369 6f6e 7320 3d20 7365  ll_versions = se
+0000a5f0: 6c66 2e67 6574 5f61 6c6c 5f73 6563 7265  lf.get_all_secre
+0000a600: 745f 7665 7273 696f 6e73 286d 6f75 6e74  t_versions(mount
+0000a610: 5f70 6174 682c 2070 6174 6829 0d0a 2020  _path, path)..  
+0000a620: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
+0000a630: 5f76 6572 7369 6f6e 7320 6973 204e 6f6e  _versions is Non
+0000a640: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000a650: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000a660: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0000a670: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000a680: 6f74 2028 6973 5f69 6e74 2876 6572 7369  ot (is_int(versi
+0000a690: 6f6e 2920 6f72 2069 735f 6c69 7374 2876  on) or is_list(v
+0000a6a0: 6572 7369 6f6e 2929 3a0d 0a20 2020 2020  ersion)):..     
+0000a6b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a6c0: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
+0000a6d0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0000a6e0: 5f5f 7d20 2d20 756e 6465 6c65 7465 2073  __} - undelete s
+0000a6f0: 6563 7265 7420 6572 726f 723a 2076 6572  ecret error: ver
+0000a700: 7369 6f6e 206d 7573 7420 6265 2061 6e20  sion must be an 
+0000a710: 696e 7420 6f72 2061 206c 6973 7420 6f66  int or a list of
+0000a720: 2069 6e74 2229 0d0a 2020 2020 2020 2020   int")..        
+0000a730: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0000a740: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+0000a750: 2020 6966 2069 735f 696e 7428 7665 7273    if is_int(vers
+0000a760: 696f 6e29 3a0d 0a20 2020 2020 2020 2020  ion):..         
+0000a770: 2020 2020 2020 2076 6572 7369 6f6e 203d         version =
+0000a780: 205b 7665 7273 696f 6e5d 0d0a 2020 2020   [version]..    
+0000a790: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0000a7a0: 2020 2020 2020 2020 2020 666f 7220 7620            for v 
+0000a7b0: 696e 2076 6572 7369 6f6e 3a0d 0a20 2020  in version:..   
+0000a7c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a7d0: 6e6f 7420 6973 5f69 6e74 2876 293a 0d0a  not is_int(v):..
+0000a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7f0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0000a800: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+0000a810: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2075  __.__name__} - u
+0000a820: 6e64 656c 6574 6520 7365 6372 6574 2065  ndelete secret e
+0000a830: 7272 6f72 3a20 7665 7273 696f 6e20 277b  rror: version '{
+0000a840: 767d 2720 6d75 7374 2062 6520 616e 2069  v}' must be an i
+0000a850: 6e74 2229 0d0a 2020 2020 2020 2020 2020  nt")..          
+0000a860: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000a870: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0000a880: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000a890: 2020 2020 2020 2020 2020 6966 2073 7472            if str
+0000a8a0: 2876 2920 6e6f 7420 696e 2061 6c6c 5f76  (v) not in all_v
+0000a8b0: 6572 7369 6f6e 732e 6b65 7973 2829 3a0d  ersions.keys():.
+0000a8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a8d0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000a8e0: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+0000a8f0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+0000a900: 756e 6465 6c65 7465 2073 6563 7265 7420  undelete secret 
+0000a910: 6572 726f 723a 2076 6572 7369 6f6e 2027  error: version '
+0000a920: 7b76 7d27 206e 6f74 2066 6f75 6e64 2229  {v}' not found")
+0000a930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a940: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000a950: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+0000a960: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+0000a970: 2020 2020 2020 6465 7374 726f 7965 6420        destroyed 
+0000a980: 3d20 616c 6c5f 7665 7273 696f 6e73 5b73  = all_versions[s
+0000a990: 7472 2876 295d 5b22 6465 7374 726f 7965  tr(v)]["destroye
+0000a9a0: 6422 5d0d 0a20 2020 2020 2020 2020 2020  d"]..           
+0000a9b0: 2020 2020 2069 6620 6465 7374 726f 7965       if destroye
+0000a9c0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+0000a9d0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000a9e0: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+0000a9f0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0000aa00: 202d 2075 6e64 656c 6574 6520 7365 6372   - undelete secr
+0000aa10: 6574 2065 7272 6f72 3a20 7665 7273 696f  et error: versio
+0000aa20: 6e20 277b 767d 2720 6973 2061 6c72 6561  n '{v}' is alrea
+0000aa30: 6479 2022 0d0a 2020 2020 2020 2020 2020  dy "..          
 0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa50: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-0000aa60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aa70: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0000aa80: 2020 2064 656c 6574 6564 203d 2061 6c6c     deleted = all
-0000aa90: 5f76 6572 7369 6f6e 735b 7374 7228 7629  _versions[str(v)
-0000aaa0: 5d5b 2264 656c 6574 6564 225d 0d0a 2020  ]["deleted"]..  
-0000aab0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000aac0: 206e 6f74 2064 656c 6574 6564 3a0d 0a20   not deleted:.. 
-0000aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aae0: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-0000aaf0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-0000ab00: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 756e  _.__name__} - un
-0000ab10: 6465 6c65 7465 2073 6563 7265 7420 6572  delete secret er
-0000ab20: 726f 723a 2076 6572 7369 6f6e 2027 7b76  ror: version '{v
-0000ab30: 7d27 2069 7320 616c 7265 6164 7920 220d  }' is already ".
-0000ab40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab60: 2020 2020 2020 2066 2275 6e64 656c 6574         f"undelet
-0000ab70: 6564 2c20 6361 6e6e 6f74 2062 6520 756e  ed, cannot be un
-0000ab80: 6465 6c65 7465 6422 290d 0a20 2020 2020  deleted")..     
-0000ab90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000aba0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-0000abb0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-0000abc0: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
-0000abd0: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-0000abe0: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
-0000abf0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-0000ac00: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-0000ac10: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-0000ac20: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-0000ac30: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-0000ac40: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
-0000ac50: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-0000ac60: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
-0000ac70: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-0000ac80: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-0000ac90: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-0000aca0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-0000acb0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-0000acc0: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-0000acd0: 732e 706f 7374 2875 726c 2b66 227b 6d6f  s.post(url+f"{mo
-0000ace0: 756e 745f 7061 7468 7d2f 756e 6465 6c65  unt_path}/undele
-0000acf0: 7465 2f7b 7061 7468 7d22 2c20 0d0a 2020  te/{path}", ..  
-0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad10: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0000ad20: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
-0000ad30: 546f 6b65 6e22 3a20 746f 6b65 6e7d 2c20  Token": token}, 
-0000ad40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad60: 2020 6461 7461 3d6a 736f 6e2e 6475 6d70    data=json.dump
-0000ad70: 7328 6469 6374 2876 6572 7369 6f6e 733d  s(dict(versions=
-0000ad80: 7665 7273 696f 6e29 2929 0d0a 2020 2020  version)))..    
-0000ad90: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
-0000ada0: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
-0000adb0: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
-0000adc0: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
-0000add0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ade0: 7475 726e 2054 7275 650d 0a20 2020 2020  turn True..     
-0000adf0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000ae00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000ae10: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
-0000ae20: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
-0000ae30: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
-0000ae40: 2275 6e64 656c 6574 6520 7365 6372 6574  "undelete secret
-0000ae50: 2065 7272 6f72 2229 0d0a 2020 2020 2020   error")..      
-0000ae60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000ae70: 2046 616c 7365 0d0a 0d0a 2020 2020 2020   False....      
-0000ae80: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-0000ae90: 2020 2020 0d0a 2020 2020 6465 6620 6465      ..    def de
-0000aea0: 7374 726f 795f 7365 6372 6574 2873 656c  stroy_secret(sel
-0000aeb0: 662c 206d 6f75 6e74 5f70 6174 683a 2073  f, mount_path: s
-0000aec0: 7472 2c20 7061 7468 3a20 7374 722c 2076  tr, path: str, v
-0000aed0: 6572 7369 6f6e 3a20 556e 696f 6e5b 696e  ersion: Union[in
-0000aee0: 742c 204c 6973 745b 696e 745d 5d29 3a0d  t, List[int]]):.
-0000aef0: 0a20 2020 2020 2020 2022 2222 6465 7374  .        """dest
-0000af00: 726f 7920 7365 6372 6574 7320 696e 2022  roy secrets in "
-0000af10: 6d6f 756e 745f 7061 7468 2f70 6174 6822  mount_path/path"
-0000af20: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
-0000af30: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-0000af40: 6f75 6e74 5f70 6174 6820 2873 7472 290d  ount_path (str).
-0000af50: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0000af60: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
-0000af70: 2020 2020 2076 6572 7369 6f6e 2028 556e       version (Un
-0000af80: 696f 6e5b 696e 742c 204c 6973 745b 696e  ion[int, List[in
-0000af90: 745d 5d29 0d0a 0d0a 2020 2020 2020 2020  t]])....        
-0000afa0: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
-0000afb0: 2020 2020 2020 626f 6f6c 3a20 7265 7475        bool: retu
-0000afc0: 726e 2054 7275 6520 6966 2073 7563 6365  rn True if succe
-0000afd0: 7373 2c20 6f74 6865 7277 6973 6520 7265  ss, otherwise re
-0000afe0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-0000aff0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0000b000: 2069 6620 7365 6c66 2e69 735f 6175 7468   if self.is_auth
-0000b010: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
-0000b020: 6c6c 5f76 6572 7369 6f6e 7320 3d20 7365  ll_versions = se
-0000b030: 6c66 2e67 6574 5f61 6c6c 5f73 6563 7265  lf.get_all_secre
-0000b040: 745f 7665 7273 696f 6e73 286d 6f75 6e74  t_versions(mount
-0000b050: 5f70 6174 682c 2070 6174 6829 0d0a 2020  _path, path)..  
-0000b060: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
-0000b070: 5f76 6572 7369 6f6e 7320 6973 204e 6f6e  _versions is Non
-0000b080: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000b090: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0000b0a0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-0000b0b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000b0c0: 6f74 2028 6973 5f69 6e74 2876 6572 7369  ot (is_int(versi
-0000b0d0: 6f6e 2920 6f72 2069 735f 6c69 7374 2876  on) or is_list(v
-0000b0e0: 6572 7369 6f6e 2929 3a0d 0a20 2020 2020  ersion)):..     
-0000b0f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b100: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-0000b110: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0000b120: 5f5f 7d20 2d20 6465 7374 726f 7920 7365  __} - destroy se
-0000b130: 6372 6574 2065 7272 6f72 3a20 7665 7273  cret error: vers
-0000b140: 696f 6e20 6d75 7374 2062 6520 616e 2069  ion must be an i
-0000b150: 6e74 206f 7220 6120 6c69 7374 206f 6620  nt or a list of 
-0000b160: 696e 7422 290d 0a20 2020 2020 2020 2020  int")..         
-0000b170: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000b180: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-0000b190: 2069 6620 6973 5f69 6e74 2876 6572 7369   if is_int(versi
-0000b1a0: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
-0000b1b0: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
-0000b1c0: 5b76 6572 7369 6f6e 5d0d 0a20 2020 2020  [version]..     
-0000b1d0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000b1e0: 2020 2020 2020 2020 2066 6f72 2076 2069           for v i
-0000b1f0: 6e20 7665 7273 696f 6e3a 0d0a 2020 2020  n version:..    
-0000b200: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000b210: 6f74 2069 735f 696e 7428 7629 3a0d 0a20  ot is_int(v):.. 
-0000b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b230: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-0000b240: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-0000b250: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6465  _.__name__} - de
-0000b260: 7374 726f 7920 7365 6372 6574 2065 7272  stroy secret err
-0000b270: 6f72 3a20 7665 7273 696f 6e20 277b 767d  or: version '{v}
-0000b280: 2720 6d75 7374 2062 6520 616e 2069 6e74  ' must be an int
-0000b290: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0000b2a0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0000b2b0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0000b2c0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000b2d0: 2020 2020 2020 2020 6966 2073 7472 2876          if str(v
-0000b2e0: 2920 6e6f 7420 696e 2061 6c6c 5f76 6572  ) not in all_ver
-0000b2f0: 7369 6f6e 732e 6b65 7973 2829 3a0d 0a20  sions.keys():.. 
-0000b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b310: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-0000b320: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-0000b330: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6465  _.__name__} - de
-0000b340: 7374 726f 7920 7365 6372 6574 2065 7272  stroy secret err
-0000b350: 6f72 3a20 7665 7273 696f 6e20 277b 767d  or: version '{v}
-0000b360: 2720 6e6f 7420 666f 756e 6422 290d 0a20  ' not found").. 
-0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b380: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-0000b390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b3a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0000b3b0: 2020 2064 6573 7472 6f79 6564 203d 2061     destroyed = a
-0000b3c0: 6c6c 5f76 6572 7369 6f6e 735b 7374 7228  ll_versions[str(
-0000b3d0: 7629 5d5b 2264 6573 7472 6f79 6564 225d  v)]["destroyed"]
-0000b3e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b3f0: 2020 6966 2064 6573 7472 6f79 6564 3a0d    if destroyed:.
-0000b400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b410: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-0000b420: 2e77 6172 6e69 6e67 2866 227b 5f5f 636c  .warning(f"{__cl
-0000b430: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-0000b440: 2d20 6465 7374 726f 7920 7365 6372 6574  - destroy secret
-0000b450: 2065 7272 6f72 3a20 7665 7273 696f 6e20   error: version 
-0000b460: 277b 767d 2720 6973 2061 6c72 6561 6479  '{v}' is already
-0000b470: 2064 6573 7472 6f79 6564 2229 0d0a 2020   destroyed")..  
-0000b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b490: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-0000b4a0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0000b4b0: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-0000b4c0: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
-0000b4d0: 2873 656c 662e 7572 6c2c 206b 6579 3d72  (self.url, key=r
-0000b4e0: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-0000b4f0: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-0000b500: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-0000b510: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-0000b520: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-0000b530: 2020 2020 2020 746f 6b65 6e20 3d20 6165        token = ae
-0000b540: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-0000b550: 656c 662e 746f 6b65 6e2c 206b 6579 3d72  elf.token, key=r
-0000b560: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-0000b570: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-0000b580: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-0000b590: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-0000b5a0: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-0000b5b0: 2020 2020 2020 7265 7320 3d20 7265 7175        res = requ
-0000b5c0: 6573 7473 2e70 7574 2875 726c 2b66 227b  ests.put(url+f"{
-0000b5d0: 6d6f 756e 745f 7061 7468 7d2f 6465 7374  mount_path}/dest
-0000b5e0: 726f 792f 7b70 6174 687d 222c 200d 0a20  roy/{path}", .. 
-0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b600: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0000b610: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
-0000b620: 546f 6b65 6e22 3a20 746f 6b65 6e7d 2c20  Token": token}, 
-0000b630: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b650: 2064 6174 613d 6a73 6f6e 2e64 756d 7073   data=json.dumps
-0000b660: 2864 6963 7428 7665 7273 696f 6e73 3d76  (dict(versions=v
-0000b670: 6572 7369 6f6e 2929 290d 0a20 2020 2020  ersion)))..     
-0000b680: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
-0000b690: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
-0000b6a0: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
-0000b6b0: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
-0000b6c0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000b6d0: 7572 6e20 5472 7565 0d0a 2020 2020 2020  urn True..      
-0000b6e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000b6f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b700: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
-0000b710: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
-0000b720: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
-0000b730: 6465 7374 726f 7920 7365 6372 6574 2065  destroy secret e
-0000b740: 7272 6f72 2229 0d0a 2020 2020 2020 2020  rror")..        
-0000b750: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0000b760: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0000b770: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
-0000b780: 726e 2046 616c 7365 0d0a 2020 2020 0d0a  rn False..    ..
-0000b790: 2020 2020 6465 6620 6465 6c65 7465 5f73      def delete_s
-0000b7a0: 6563 7265 745f 7061 7468 2873 656c 662c  ecret_path(self,
-0000b7b0: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
-0000b7c0: 2c20 7061 7468 3a20 7374 7229 3a0d 0a20  , path: str):.. 
-0000b7d0: 2020 2020 2020 2022 2222 6465 6c65 7465         """delete
-0000b7e0: 2074 6865 2065 6e74 6972 6520 7365 6372   the entire secr
-0000b7f0: 6574 2070 6174 6820 6f66 2022 6d6f 756e  et path of "moun
-0000b800: 745f 7061 7468 2f70 6174 6822 0d0a 2020  t_path/path"..  
-0000b810: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000b820: 546f 2064 656c 6574 6520 7365 6372 6574  To delete secret
-0000b830: 2070 6174 6820 666f 7220 4b56 2076 322c   path for KV v2,
-0000b840: 2079 6f75 206d 7573 7420 6861 7665 2061   you must have a
-0000b850: 2070 6f6c 6963 7920 6772 616e 7469 6e67   policy granting
-0000b860: 2079 6f75 2074 6865 2064 656c 6574 6520   you the delete 
-0000b870: 6361 7061 6269 6c69 7479 200d 0a20 2020  capability ..   
-0000b880: 2020 2020 206f 6e20 7468 6973 202f 6d65       on this /me
-0000b890: 7461 6461 7461 2f20 7061 7468 2e0d 0a0d  tadata/ path....
-0000b8a0: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-0000b8b0: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-0000b8c0: 745f 7061 7468 2028 7374 7229 0d0a 2020  t_path (str)..  
-0000b8d0: 2020 2020 2020 2020 2020 7061 7468 2028            path (
-0000b8e0: 7374 7229 0d0a 0d0a 2020 2020 2020 2020  str)....        
-0000b8f0: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
-0000b900: 2020 2020 2020 626f 6f6c 3a20 7265 7475        bool: retu
-0000b910: 726e 2054 7275 6520 6966 2073 7563 6365  rn True if succe
-0000b920: 7373 2c20 6f74 6865 7277 6973 6520 7265  ss, otherwise re
-0000b930: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-0000b940: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0000b950: 2069 6620 7365 6c66 2e69 735f 6175 7468   if self.is_auth
-0000b960: 3a0d 0a20 2020 2020 2020 2020 2020 2075  :..            u
-0000b970: 726c 203d 2061 6573 5f64 6563 7279 7074  rl = aes_decrypt
-0000b980: 5f74 6578 7428 7365 6c66 2e75 726c 2c20  _text(self.url, 
-0000b990: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
-0000b9a0: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
-0000b9b0: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
-0000b9c0: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
-0000b9d0: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
-0000b9e0: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
-0000b9f0: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
-0000ba00: 6578 7428 7365 6c66 2e74 6f6b 656e 2c20  ext(self.token, 
-0000ba10: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
-0000ba20: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
-0000ba30: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
-0000ba40: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
-0000ba50: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
-0000ba60: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-0000ba70: 2072 6571 7565 7374 732e 6465 6c65 7465   requests.delete
-0000ba80: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
-0000ba90: 7468 7d2f 6d65 7461 6461 7461 2f7b 7061  th}/metadata/{pa
-0000baa0: 7468 7d22 2c20 6865 6164 6572 733d 7b22  th}", headers={"
-0000bab0: 582d 5661 756c 742d 546f 6b65 6e22 3a20  X-Vault-Token": 
-0000bac0: 746f 6b65 6e7d 290d 0a20 2020 2020 2020  token})..       
-0000bad0: 2020 2020 2069 6620 7265 732e 7374 6174       if res.stat
-0000bae0: 7573 5f63 6f64 6520 3d3d 2032 3030 206f  us_code == 200 o
-0000baf0: 7220 7265 732e 7374 6174 7573 5f63 6f64  r res.status_cod
-0000bb00: 6520 3d3d 2032 3034 3a0d 0a20 2020 2020  e == 204:..     
-0000bb10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000bb20: 6e20 5472 7565 0d0a 2020 2020 2020 2020  n True..        
-0000bb30: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000bb40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000bb50: 5f6c 6f67 5f65 7272 6f72 5f72 6573 706f  _log_error_respo
-0000bb60: 6e73 6528 5f5f 636c 6173 735f 5f2e 5f5f  nse(__class__.__
-0000bb70: 6e61 6d65 5f5f 2c20 7265 732c 2022 6465  name__, res, "de
-0000bb80: 6c65 7465 2073 6563 7265 7420 7061 7468  lete secret path
-0000bb90: 2065 7272 6f72 2229 0d0a 2020 2020 2020   error")..      
-0000bba0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000bbb0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0000bbc0: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
-0000bbd0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-0000bbe0: 0d0a 2020 2020 0d0a 636c 6173 7320 5661  ..    ..class Va
-0000bbf0: 756c 7453 6563 7265 7445 6e67 696e 6554  ultSecretEngineT
-0000bc00: 4f54 5028 5f56 6175 6c74 4854 5450 4150  OTP(_VaultHTTPAP
-0000bc10: 4929 3a0d 0a20 2020 2022 2222 544f 5450  I):..    """TOTP
-0000bc20: 2053 6563 7265 7420 456e 6769 6e65 0d0a   Secret Engine..
-0000bc30: 2020 2020 0d0a 2020 2020 5265 6665 7220      ..    Refer 
-0000bc40: 746f 2068 7474 7073 3a2f 2f64 6576 656c  to https://devel
-0000bc50: 6f70 6572 2e68 6173 6869 636f 7270 2e63  oper.hashicorp.c
-0000bc60: 6f6d 2f76 6175 6c74 2f61 7069 2d64 6f63  om/vault/api-doc
-0000bc70: 732f 7365 6372 6574 2f74 6f74 7020 666f  s/secret/totp fo
-0000bc80: 7220 6d6f 7265 2064 6574 6169 6c73 2e0d  r more details..
-0000bc90: 0a0d 0a20 2020 2049 6e69 743a 0d0a 2020  ...    Init:..  
-0000bca0: 2020 2020 2020 636f 6e6e 6563 7469 6e67        connecting
-0000bcb0: 2077 6974 6820 746f 6b65 6e3a 0d0a 2020   with token:..  
-0000bcc0: 2020 2020 2020 3e3e 3e20 746f 7470 5f65        >>> totp_e
-0000bcd0: 6e67 696e 6520 3d20 5661 756c 7453 6563  ngine = VaultSec
-0000bce0: 7265 7445 6e67 696e 6554 4f54 5028 0d0a  retEngineTOTP(..
-0000bcf0: 2020 2020 2020 2020 3e3e 3e20 2020 2020          >>>     
-0000bd00: 7572 6c3d 2268 7474 703a 2f2f 3132 372e  url="http://127.
-0000bd10: 302e 302e 313a 3832 3030 222c 200d 0a20  0.0.1:8200", .. 
-0000bd20: 2020 2020 2020 203e 3e3e 2020 2020 2061         >>>     a
-0000bd30: 7574 685f 6366 673d 6469 6374 286d 6574  uth_cfg=dict(met
-0000bd40: 686f 643d 2274 6f6b 656e 222c 2074 6f6b  hod="token", tok
-0000bd50: 656e 3d22 6876 732e 534d 4630 6e46 306e  en="hvs.SMF0nF0n
-0000bd60: 6474 3264 5a33 6452 4366 6536 6f48 5636  dt2dZ3dRCfe6oHV6
-0000bd70: 2229 0d0a 2020 2020 2020 2020 3e3e 3e20  ")..        >>> 
-0000bd80: 290d 0a0d 0a20 2020 2020 2020 2063 6f6e  )....        con
-0000bd90: 6e65 6374 696e 6720 7769 7468 2075 7365  necting with use
-0000bda0: 726e 616d 6520 2620 7061 7373 776f 7264  rname & password
-0000bdb0: 3a0d 0a20 2020 2020 2020 203e 3e3e 2074  :..        >>> t
-0000bdc0: 6f74 705f 656e 6769 6e65 203d 2056 6175  otp_engine = Vau
-0000bdd0: 6c74 5365 6372 6574 456e 6769 6e65 544f  ltSecretEngineTO
-0000bde0: 5450 280d 0a20 2020 2020 2020 203e 3e3e  TP(..        >>>
-0000bdf0: 2020 2020 2075 726c 3d22 6874 7470 3a2f       url="http:/
-0000be00: 2f31 3237 2e30 2e30 2e31 3a38 3230 3022  /127.0.0.1:8200"
-0000be10: 2c0d 0a20 2020 2020 2020 203e 3e3e 2020  ,..        >>>  
-0000be20: 2020 2061 7574 685f 6366 673d 6469 6374     auth_cfg=dict
-0000be30: 286d 6574 686f 643d 2275 7365 7270 6173  (method="userpas
-0000be40: 7322 2c20 7573 6572 6e61 6d65 3d22 7573  s", username="us
-0000be50: 6572 6e61 6d65 222c 2070 6173 7377 6f72  ername", passwor
-0000be60: 643d 2270 6173 7377 6f72 6422 290d 0a20  d="password").. 
-0000be70: 2020 2020 2020 203e 3e3e 2029 0d0a 2020         >>> )..  
-0000be80: 2020 2222 220d 0a20 2020 200d 0a20 2020    """..    ..   
-0000be90: 2064 6566 2063 7265 6174 655f 6b65 7928   def create_key(
-0000bea0: 7365 6c66 2c20 0d0a 2020 2020 2020 2020  self, ..        
-0000beb0: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
-0000bec0: 5f70 6174 683a 2073 7472 2c20 0d0a 2020  _path: str, ..  
-0000bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bee0: 206e 616d 653a 2073 7472 2c0d 0a20 2020   name: str,..   
-0000bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf00: 6163 636f 756e 745f 6e61 6d65 3a20 7374  account_name: st
-0000bf10: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-0000bf20: 2020 2020 2020 2065 7870 6f72 7465 643a         exported:
-0000bf30: 2062 6f6f 6c20 3d20 5472 7565 2c0d 0a20   bool = True,.. 
-0000bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf50: 2020 6b65 795f 7369 7a65 3a20 696e 7420    key_size: int 
-0000bf60: 3d20 3230 2c0d 0a20 2020 2020 2020 2020  = 20,..         
-0000bf70: 2020 2020 2020 2020 2020 6973 7375 6572            issuer
-0000bf80: 3a20 7374 7220 3d20 224d 754c 696e 6743  : str = "MuLingC
-0000bf90: 6c6f 7564 222c 0d0a 2020 2020 2020 2020  loud",..        
-0000bfa0: 2020 2020 2020 2020 2020 2070 6572 696f             perio
-0000bfb0: 643a 2069 6e74 203d 2033 302c 0d0a 2020  d: int = 30,..  
-0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfd0: 2061 6c67 6f72 6974 686d 3a20 7374 7220   algorithm: str 
-0000bfe0: 3d20 2253 4841 3122 2c0d 0a20 2020 2020  = "SHA1",..     
-0000bff0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0000c000: 6769 7473 3a20 696e 7420 3d20 362c 0d0a  gits: int = 6,..
-0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c020: 2020 2073 6b65 773a 2069 6e74 203d 2031     skew: int = 1
-0000c030: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c040: 2020 2020 2020 7172 5f73 697a 653a 2069        qr_size: i
-0000c050: 6e74 203d 2032 3030 2c0d 0a20 2020 2020  nt = 200,..     
-0000c060: 2020 2020 2020 2020 2020 2020 2020 7172                qr
-0000c070: 5f73 6176 655f 7061 7468 3a20 4f70 7469  _save_path: Opti
-0000c080: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-0000c090: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c0a0: 2020 2020 2020 7265 7475 726e 5f73 6563        return_sec
-0000c0b0: 7265 743a 2062 6f6f 6c20 3d20 4661 6c73  ret: bool = Fals
-0000c0c0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000c0d0: 2020 2020 2020 2072 6574 7572 6e5f 7172         return_qr
-0000c0e0: 5f63 6f64 653a 2062 6f6f 6c20 3d20 5472  _code: bool = Tr
-0000c0f0: 7565 293a 0d0a 2020 2020 2020 2020 2222  ue):..        ""
-0000c100: 2263 7265 6174 6520 6120 6b65 7920 696e  "create a key in
-0000c110: 2022 6d6f 756e 745f 7061 7468 2f22 0d0a   "mount_path/"..
-0000c120: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000c130: 2020 5265 6665 7220 746f 2068 7474 7073    Refer to https
-0000c140: 3a2f 2f64 6576 656c 6f70 6572 2e68 6173  ://developer.has
-0000c150: 6869 636f 7270 2e63 6f6d 2f76 6175 6c74  hicorp.com/vault
-0000c160: 2f61 7069 2d64 6f63 732f 7365 6372 6574  /api-docs/secret
-0000c170: 2f74 6f74 7023 6372 6561 7465 2d6b 6579  /totp#create-key
-0000c180: 2066 6f72 206d 6f72 6520 6465 7461 696c   for more detail
-0000c190: 732e 0d0a 0d0a 2020 2020 2020 2020 4172  s.....        Ar
-0000c1a0: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-0000c1b0: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
-0000c1c0: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-0000c1d0: 616d 6520 2873 7472 293a 2053 7065 6369  ame (str): Speci
-0000c1e0: 6669 6573 2074 6865 206e 616d 6520 6f66  fies the name of
-0000c1f0: 2074 6865 206b 6579 2074 6f20 6372 6561   the key to crea
-0000c200: 7465 2e20 5468 6973 2069 7320 7370 6563  te. This is spec
-0000c210: 6966 6965 6420 6173 2070 6172 7420 6f66  ified as part of
-0000c220: 2074 6865 2055 524c 2e0d 0a20 2020 2020   the URL...     
-0000c230: 2020 2020 2020 2061 6363 6f75 6e74 5f6e         account_n
-0000c240: 616d 6520 2873 7472 293a 2053 7065 6369  ame (str): Speci
-0000c250: 6669 6573 2074 6865 206e 616d 6520 6f66  fies the name of
-0000c260: 2074 6865 2061 6363 6f75 6e74 2061 7373   the account ass
-0000c270: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
-0000c280: 206b 6579 2e20 4465 6661 756c 7473 2074   key. Defaults t
-0000c290: 6f20 4e6f 6e65 2e0d 0a20 2020 2020 2020  o None...       
-0000c2a0: 2020 2020 206b 6579 5f73 697a 6520 2869       key_size (i
-0000c2b0: 6e74 2c20 6f70 7469 6f6e 616c 293a 2053  nt, optional): S
-0000c2c0: 7065 6369 6669 6573 2074 6865 2073 697a  pecifies the siz
-0000c2d0: 6520 696e 2062 7974 6573 206f 6620 7468  e in bytes of th
-0000c2e0: 6520 5661 756c 7420 6765 6e65 7261 7465  e Vault generate
-0000c2f0: 6420 6b65 792e 2044 6566 6175 6c74 7320  d key. Defaults 
-0000c300: 746f 2032 302e 0d0a 2020 2020 2020 2020  to 20...        
-0000c310: 2020 2020 6973 7375 6572 2028 7374 722c      issuer (str,
-0000c320: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
-0000c330: 6966 6965 7320 7468 6520 6e61 6d65 206f  ifies the name o
-0000c340: 6620 7468 6520 6b65 7927 7320 6973 7375  f the key's issu
-0000c350: 696e 6720 6f72 6761 6e69 7a61 7469 6f6e  ing organization
-0000c360: 2e20 4465 6661 756c 7473 2074 6f20 4d75  . Defaults to Mu
-0000c370: 4c69 6e67 436c 6f75 642e 0d0a 2020 2020  LingCloud...    
-0000c380: 2020 2020 2020 2020 7065 7269 6f64 2028          period (
-0000c390: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
-0000c3a0: 5370 6563 6966 6965 7320 7468 6520 6c65  Specifies the le
-0000c3b0: 6e67 7468 206f 6620 7469 6d65 2069 6e20  ngth of time in 
-0000c3c0: 7365 636f 6e64 7320 7573 6564 2074 6f20  seconds used to 
-0000c3d0: 6765 6e65 7261 7465 2061 2063 6f75 6e74  generate a count
-0000c3e0: 6572 2066 6f72 2074 6865 200d 0a20 2020  er for the ..   
-0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c410: 2054 4f54 5020 636f 6465 2063 616c 6375   TOTP code calcu
-0000c420: 6c61 7469 6f6e 2e20 4465 6661 756c 7473  lation. Defaults
-0000c430: 2074 6f20 3330 2e0d 0a20 2020 2020 2020   to 30...       
-0000c440: 2020 2020 2061 6c67 6f72 6974 686d 2028       algorithm (
-0000c450: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
-0000c460: 5370 6563 6966 6965 7320 7468 6520 6861  Specifies the ha
-0000c470: 7368 696e 6720 616c 676f 7269 7468 6d20  shing algorithm 
-0000c480: 7573 6564 2074 6f20 6765 6e65 7261 7465  used to generate
-0000c490: 2074 6865 2054 4f54 5020 636f 6465 2e20   the TOTP code. 
-0000c4a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4c0: 2020 2020 2020 2020 204f 7074 696f 6e73           Options
-0000c4d0: 2069 6e63 6c75 6465 2022 5348 4131 222c   include "SHA1",
-0000c4e0: 2022 5348 4132 3536 2220 616e 6420 2253   "SHA256" and "S
-0000c4f0: 4841 3531 3222 2e20 4465 6661 756c 7473  HA512". Defaults
-0000c500: 2074 6f20 2253 4841 3122 2e0d 0a20 2020   to "SHA1"...   
-0000c510: 2020 2020 2020 2020 2064 6967 6974 7320           digits 
-0000c520: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
-0000c530: 2053 7065 6369 6669 6573 2074 6865 206e   Specifies the n
-0000c540: 756d 6265 7220 6f66 2064 6967 6974 7320  umber of digits 
-0000c550: 696e 2074 6865 2067 656e 6572 6174 6564  in the generated
-0000c560: 2054 4f54 5020 636f 6465 2e20 5468 6973   TOTP code. This
-0000c570: 2076 616c 7565 2063 616e 200d 0a20 2020   value can ..   
-0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5a0: 2062 6520 7365 7420 746f 2036 206f 7220   be set to 6 or 
-0000c5b0: 382e 2044 6566 6175 6c74 7320 746f 2036  8. Defaults to 6
-0000c5c0: 2e0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
-0000c5d0: 6b65 7720 2869 6e74 2c20 6f70 7469 6f6e  kew (int, option
-0000c5e0: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
-0000c5f0: 6865 206e 756d 6265 7220 6f66 2064 656c  he number of del
-0000c600: 6179 2070 6572 696f 6473 2074 6861 7420  ay periods that 
-0000c610: 6172 6520 616c 6c6f 7765 6420 7768 656e  are allowed when
-0000c620: 2076 616c 6964 6174 696e 6720 6120 0d0a   validating a ..
-0000c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c650: 2020 544f 5450 2063 6f64 652e 2054 6869    TOTP code. Thi
-0000c660: 7320 7661 6c75 6520 6361 6e20 6265 2065  s value can be e
-0000c670: 6974 6865 7220 3020 6f72 2031 2e20 4465  ither 0 or 1. De
-0000c680: 6661 756c 7473 2074 6f20 312e 0d0a 2020  faults to 1...  
-0000c690: 2020 2020 2020 2020 2020 7172 5f73 697a            qr_siz
-0000c6a0: 6520 2869 6e74 2c20 6f70 7469 6f6e 616c  e (int, optional
-0000c6b0: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
-0000c6c0: 2070 6978 656c 2073 697a 6520 6f66 2074   pixel size of t
-0000c6d0: 6865 2073 7175 6172 6520 5152 2063 6f64  he square QR cod
-0000c6e0: 6520 7768 656e 2067 656e 6572 6174 696e  e when generatin
-0000c6f0: 6720 6120 6e65 7720 6b65 792e 200d 0a20  g a new key. .. 
-0000c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c720: 2020 2020 4f6e 6c79 2075 7365 6420 6966      Only used if
-0000c730: 2065 7870 6f72 7465 6420 6973 2074 7275   exported is tru
-0000c740: 652e 2049 6620 7468 6973 2076 616c 7565  e. If this value
-0000c750: 2069 7320 302c 2061 2051 5220 636f 6465   is 0, a QR code
-0000c760: 2077 696c 6c20 6e6f 7420 6265 200d 0a20   will not be .. 
-0000c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c790: 2020 2020 7265 7475 726e 6564 2e20 4465      returned. De
-0000c7a0: 6661 756c 7473 2074 6f20 3230 302e 0d0a  faults to 200...
-0000c7b0: 2020 2020 2020 2020 2020 2020 7172 5f73              qr_s
-0000c7c0: 6176 655f 7061 7468 2028 4f70 7469 6f6e  ave_path (Option
-0000c7d0: 616c 5b73 7472 5d2c 206f 7074 696f 6e61  al[str], optiona
-0000c7e0: 6c29 3a20 5370 6563 6966 6965 7320 7468  l): Specifies th
-0000c7f0: 6520 7061 7468 2074 6f20 7361 7665 2074  e path to save t
-0000c800: 6865 2051 5220 636f 6465 2069 6d61 6765  he QR code image
-0000c810: 2077 6869 6368 2073 686f 756c 6420 0d0a   which should ..
-0000c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c850: 2020 2020 6265 2061 202e 706e 6720 6669      be a .png fi
-0000c860: 6c65 2e20 4465 6661 756c 7473 2074 6f20  le. Defaults to 
-0000c870: 4e6f 6e65 2e0d 0a20 2020 2020 2020 2020  None...         
-0000c880: 2020 2072 6574 7572 6e5f 7365 6372 6574     return_secret
-0000c890: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
-0000c8a0: 293a 2053 7065 6369 6669 6573 2069 6620  ): Specifies if 
-0000c8b0: 7468 6520 7365 6372 6574 2073 686f 756c  the secret shoul
-0000c8c0: 6420 6265 2072 6574 7572 6e65 642e 2044  d be returned. D
-0000c8d0: 6566 6175 6c74 7320 746f 2046 616c 7365  efaults to False
-0000c8e0: 2e0d 0a20 2020 2020 2020 2020 2020 2072  ...            r
-0000c8f0: 6574 7572 6e5f 7172 5f63 6f64 6520 2862  eturn_qr_code (b
-0000c900: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
-0000c910: 5370 6563 6966 6965 7320 6966 2074 6865  Specifies if the
-0000c920: 2051 5220 636f 6465 2073 686f 756c 6420   QR code should 
-0000c930: 6265 2072 6574 7572 6e65 642e 2044 6566  be returned. Def
-0000c940: 6175 6c74 7320 746f 2054 7275 652e 0d0a  aults to True...
-0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c970: 2020 2020 200d 0a20 2020 2020 2020 2052       ..        R
-0000c980: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-0000c990: 2020 2020 2064 6963 7420 6f72 204e 6f6e       dict or Non
-0000c9a0: 653a 2072 6574 7572 6e20 6120 6469 6374  e: return a dict
-0000c9b0: 2069 6620 7375 6363 6573 732c 206f 7468   if success, oth
-0000c9c0: 6572 7769 7365 2072 6574 7572 6e20 4e6f  erwise return No
-0000c9d0: 6e65 0d0a 2020 2020 2020 2020 2222 220d  ne..        """.
-0000c9e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000c9f0: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-0000ca00: 2020 2020 2020 2065 7869 7374 5f6b 6579         exist_key
-0000ca10: 7320 3d20 7365 6c66 2e6c 6973 745f 6b65  s = self.list_ke
-0000ca20: 7928 6d6f 756e 745f 7061 7468 290d 0a20  y(mount_path).. 
-0000ca30: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
-0000ca40: 6973 745f 6b65 7973 2069 7320 6e6f 7420  ist_keys is not 
-0000ca50: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0000ca60: 2020 2020 2020 2069 6620 6e61 6d65 2069         if name i
-0000ca70: 6e20 6578 6973 745f 6b65 7973 3a0d 0a20  n exist_keys:.. 
-0000ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca90: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-0000caa0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-0000cab0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6372  _.__name__} - cr
-0000cac0: 6561 7465 206b 6579 2065 7272 6f72 3a20  eate key error: 
-0000cad0: 6b65 7920 277b 6e61 6d65 7d27 2061 6c72  key '{name}' alr
-0000cae0: 6561 6479 2065 7869 7374 7322 290d 0a20  eady exists").. 
-0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb00: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-0000cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb20: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000cb30: 2061 6c67 6f72 6974 686d 206e 6f74 2069   algorithm not i
-0000cb40: 6e20 5b22 5348 4131 222c 2022 5348 4132  n ["SHA1", "SHA2
-0000cb50: 3536 222c 2022 5348 4135 3132 225d 3a0d  56", "SHA512"]:.
-0000cb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb70: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-0000cb80: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-0000cb90: 5f5f 6e61 6d65 5f5f 7d20 2d20 6372 6561  __name__} - crea
-0000cba0: 7465 206b 6579 2065 7272 6f72 3a20 616c  te key error: al
-0000cbb0: 676f 7269 7468 6d20 6d75 7374 2062 6520  gorithm must be 
-0000cbc0: 6f6e 6520 6f66 2022 0d0a 2020 2020 2020  one of "..      
-0000cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbe0: 2020 2020 2020 2020 2020 2020 6622 2753              f"'S
-0000cbf0: 4841 3127 2c20 2753 4841 3235 3627 206f  HA1', 'SHA256' o
-0000cc00: 7220 2753 4841 3531 3227 2229 0d0a 2020  r 'SHA512'")..  
-0000cc10: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000cc20: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-0000cc30: 2020 2020 2020 2069 6620 6469 6769 7473         if digits
-0000cc40: 206e 6f74 2069 6e20 5b36 2c20 385d 3a0d   not in [6, 8]:.
-0000cc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cc60: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-0000cc70: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-0000cc80: 5f5f 6e61 6d65 5f5f 7d20 2d20 6372 6561  __name__} - crea
-0000cc90: 7465 206b 6579 2065 7272 6f72 3a20 6469  te key error: di
-0000cca0: 6769 7473 206d 7573 7420 6265 206f 6e65  gits must be one
-0000ccb0: 206f 6620 3620 6f72 2038 2229 0d0a 2020   of 6 or 8")..  
-0000ccc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ccd0: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-0000cce0: 2020 2020 2020 2069 6620 736b 6577 206e         if skew n
-0000ccf0: 6f74 2069 6e20 5b30 2c20 315d 3a0d 0a20  ot in [0, 1]:.. 
-0000cd00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000cd10: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-0000cd20: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-0000cd30: 6e61 6d65 5f5f 7d20 2d20 6372 6561 7465  name__} - create
-0000cd40: 206b 6579 2065 7272 6f72 3a20 736b 6577   key error: skew
-0000cd50: 206d 7573 7420 6265 206f 6e65 206f 6620   must be one of 
-0000cd60: 3020 6f72 2031 2229 0d0a 2020 2020 2020  0 or 1")..      
-0000cd70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000cd80: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0000cd90: 2020 2069 6620 7172 5f73 697a 6520 3c20     if qr_size < 
-0000cda0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-0000cdb0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-0000cdc0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
-0000cdd0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2063  __.__name__} - c
-0000cde0: 7265 6174 6520 6b65 7920 6572 726f 723a  reate key error:
-0000cdf0: 2071 725f 7369 7a65 206d 7573 7420 6265   qr_size must be
-0000ce00: 2061 2070 6f73 6974 6976 6520 696e 7465   a positive inte
-0000ce10: 6765 7222 290d 0a20 2020 2020 2020 2020  ger")..         
-0000ce20: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000ce30: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0000ce40: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-0000ce50: 7461 203d 207b 2267 656e 6572 6174 6522  ta = {"generate"
-0000ce60: 3a20 5472 7565 2c0d 0a20 2020 2020 2020  : True,..       
-0000ce70: 2020 2020 2020 2020 2020 2020 2022 6973               "is
-0000ce80: 7375 6572 223a 2069 7373 7565 722c 0d0a  suer": issuer,..
-0000ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cea0: 2020 2020 2261 6363 6f75 6e74 5f6e 616d      "account_nam
-0000ceb0: 6522 3a20 6163 636f 756e 745f 6e61 6d65  e": account_name
-0000cec0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000ced0: 2020 2020 2020 2022 6578 706f 7274 6564         "exported
-0000cee0: 223a 2065 7870 6f72 7465 642c 0d0a 2020  ": exported,..  
-0000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf00: 2020 226b 6579 5f73 697a 6522 3a20 6b65    "key_size": ke
-0000cf10: 795f 7369 7a65 2c0d 0a20 2020 2020 2020  y_size,..       
-0000cf20: 2020 2020 2020 2020 2020 2020 2022 7065               "pe
-0000cf30: 7269 6f64 223a 2070 6572 696f 642c 0d0a  riod": period,..
-0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf50: 2020 2020 2261 6c67 6f72 6974 686d 223a      "algorithm":
-0000cf60: 2061 6c67 6f72 6974 686d 2c0d 0a20 2020   algorithm,..   
-0000cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf80: 2022 6469 6769 7473 223a 2064 6967 6974   "digits": digit
-0000cf90: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000cfa0: 2020 2020 2020 2020 2273 6b65 7722 3a20          "skew": 
-0000cfb0: 736b 6577 7d0d 0a20 2020 2020 2020 2020  skew}..         
-0000cfc0: 2020 2069 6620 6e6f 7420 6578 706f 7274     if not export
-0000cfd0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-0000cfe0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-0000cff0: 2e77 6172 6e69 6e67 2866 227b 5f5f 636c  .warning(f"{__cl
-0000d000: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-0000d010: 2d20 6372 6561 7465 206b 6579 2077 6172  - create key war
-0000d020: 6e69 6e67 3a20 6578 706f 7274 6564 2069  ning: exported i
-0000d030: 7320 7365 7420 746f 2046 616c 7365 2c20  s set to False, 
-0000d040: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-0000d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d060: 2020 2020 2020 2066 2269 7420 776f 6e27         f"it won'
-0000d070: 7420 7265 7475 726e 2061 2051 5220 636f  t return a QR co
-0000d080: 6465 206f 7220 7572 6c22 290d 0a20 2020  de or url")..   
-0000d090: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000d0a0: 7572 6e5f 7365 6372 6574 203d 2046 616c  urn_secret = Fal
-0000d0b0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-0000d0c0: 2020 2020 7265 7475 726e 5f71 725f 636f      return_qr_co
-0000d0d0: 6465 203d 2046 616c 7365 0d0a 2020 2020  de = False..    
-0000d0e0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000d0f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000d100: 6174 615b 2271 725f 7369 7a65 225d 203d  ata["qr_size"] =
-0000d110: 2071 725f 7369 7a65 0d0a 2020 2020 2020   qr_size..      
-0000d120: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000d130: 2020 2020 7572 6c20 3d20 6165 735f 6465      url = aes_de
-0000d140: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
-0000d150: 7572 6c2c 206b 6579 3d72 616e 646f 6d5f  url, key=random_
-0000d160: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
-0000d170: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
-0000d180: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
-0000d190: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
-0000d1a0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0000d1b0: 746f 6b65 6e20 3d20 6165 735f 6465 6372  token = aes_decr
-0000d1c0: 7970 745f 7465 7874 2873 656c 662e 746f  ypt_text(self.to
-0000d1d0: 6b65 6e2c 206b 6579 3d72 616e 646f 6d5f  ken, key=random_
-0000d1e0: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
-0000d1f0: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
-0000d200: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
-0000d210: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
-0000d220: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0000d230: 7265 7320 3d20 7265 7175 6573 7473 2e70  res = requests.p
-0000d240: 6f73 7428 7572 6c2b 6622 7b6d 6f75 6e74  ost(url+f"{mount
-0000d250: 5f70 6174 687d 2f6b 6579 732f 7b6e 616d  _path}/keys/{nam
-0000d260: 657d 222c 2068 6561 6465 7273 3d7b 2258  e}", headers={"X
-0000d270: 2d56 6175 6c74 2d54 6f6b 656e 223a 2074  -Vault-Token": t
-0000d280: 6f6b 656e 7d2c 2064 6174 613d 6a73 6f6e  oken}, data=json
-0000d290: 2e64 756d 7073 2864 6174 6129 290d 0a20  .dumps(data)).. 
-0000d2a0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0000d2b0: 732e 7374 6174 7573 5f63 6f64 6520 3d3d  s.status_code ==
-0000d2c0: 2032 3030 206f 7220 7265 732e 7374 6174   200 or res.stat
-0000d2d0: 7573 5f63 6f64 6520 3d3d 2032 3034 3a0d  us_code == 204:.
-0000d2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d2f0: 2072 6573 706f 6e73 655f 6461 7461 203d   response_data =
-0000d300: 2072 6573 2e6a 736f 6e28 295b 2264 6174   res.json()["dat
-0000d310: 6122 5d0d 0a20 2020 2020 2020 2020 2020  a"]..           
-0000d320: 2020 2020 2072 6573 756c 7420 3d20 7b22       result = {"
-0000d330: 6d65 7461 6461 7461 223a 207b 226d 6f75  metadata": {"mou
-0000d340: 6e74 5f70 6174 6822 3a20 6d6f 756e 745f  nt_path": mount_
-0000d350: 7061 7468 2c20 0d0a 2020 2020 2020 2020  path, ..        
-0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d370: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000d380: 6e61 6d65 223a 206e 616d 652c 0d0a 2020  name": name,..  
-0000d390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa50: 2020 2020 2020 2020 2020 2020 6622 6465              f"de
+0000aa60: 7374 726f 7965 642c 2063 616e 6e6f 7420  stroyed, cannot 
+0000aa70: 6265 2075 6e64 656c 6574 6564 2229 0d0a  be undeleted")..
+0000aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa90: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000aaa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000aab0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000aac0: 2020 2020 6465 6c65 7465 6420 3d20 616c      deleted = al
+0000aad0: 6c5f 7665 7273 696f 6e73 5b73 7472 2876  l_versions[str(v
+0000aae0: 295d 5b22 6465 6c65 7465 6422 5d0d 0a20  )]["deleted"].. 
+0000aaf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ab00: 6620 6e6f 7420 6465 6c65 7465 643a 0d0a  f not deleted:..
+0000ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab20: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0000ab30: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+0000ab40: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2075  __.__name__} - u
+0000ab50: 6e64 656c 6574 6520 7365 6372 6574 2065  ndelete secret e
+0000ab60: 7272 6f72 3a20 7665 7273 696f 6e20 277b  rror: version '{
+0000ab70: 767d 2720 6973 2061 6c72 6561 6479 2022  v}' is already "
+0000ab80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aba0: 2020 2020 2020 2020 6622 756e 6465 6c65          f"undele
+0000abb0: 7465 642c 2063 616e 6e6f 7420 6265 2075  ted, cannot be u
+0000abc0: 6e64 656c 6574 6564 2229 0d0a 2020 2020  ndeleted")..    
+0000abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abe0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+0000abf0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000ac00: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
+0000ac10: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
+0000ac20: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
+0000ac30: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
+0000ac40: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
+0000ac50: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
+0000ac60: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
+0000ac70: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
+0000ac80: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
+0000ac90: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
+0000aca0: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
+0000acb0: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
+0000acc0: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
+0000acd0: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
+0000ace0: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
+0000acf0: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
+0000ad00: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
+0000ad10: 7473 2e70 6f73 7428 7572 6c2b 6622 7b6d  ts.post(url+f"{m
+0000ad20: 6f75 6e74 5f70 6174 687d 2f75 6e64 656c  ount_path}/undel
+0000ad30: 6574 652f 7b70 6174 687d 222c 200d 0a20  ete/{path}", .. 
+0000ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad50: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000ad60: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
+0000ad70: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d2c  -Token": token},
+0000ad80: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ada0: 2020 2064 6174 613d 6a73 6f6e 2e64 756d     data=json.dum
+0000adb0: 7073 2864 6963 7428 7665 7273 696f 6e73  ps(dict(versions
+0000adc0: 3d76 6572 7369 6f6e 2929 290d 0a20 2020  =version)))..   
+0000add0: 2020 2020 2020 2020 2069 6620 7265 732e           if res.
+0000ade0: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
+0000adf0: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
+0000ae00: 5f63 6f64 6520 3d3d 2032 3034 3a0d 0a20  _code == 204:.. 
+0000ae10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ae20: 6574 7572 6e20 5472 7565 0d0a 2020 2020  eturn True..    
+0000ae30: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0000ae40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ae50: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
+0000ae60: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
+0000ae70: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
+0000ae80: 2022 756e 6465 6c65 7465 2073 6563 7265   "undelete secre
+0000ae90: 7420 6572 726f 7222 290d 0a20 2020 2020  t error")..     
+0000aea0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000aeb0: 6e20 4661 6c73 650d 0a0d 0a20 2020 2020  n False....     
+0000aec0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+0000aed0: 0a20 2020 200d 0a20 2020 2064 6566 2064  .    ..    def d
+0000aee0: 6573 7472 6f79 5f73 6563 7265 7428 7365  estroy_secret(se
+0000aef0: 6c66 2c20 6d6f 756e 745f 7061 7468 3a20  lf, mount_path: 
+0000af00: 7374 722c 2070 6174 683a 2073 7472 2c20  str, path: str, 
+0000af10: 7665 7273 696f 6e3a 2055 6e69 6f6e 5b69  version: Union[i
+0000af20: 6e74 2c20 4c69 7374 5b69 6e74 5d5d 293a  nt, List[int]]):
+0000af30: 0d0a 2020 2020 2020 2020 2222 2264 6573  ..        """des
+0000af40: 7472 6f79 2073 6563 7265 7473 2069 6e20  troy secrets in 
+0000af50: 226d 6f75 6e74 5f70 6174 682f 7061 7468  "mount_path/path
+0000af60: 220d 0a0d 0a20 2020 2020 2020 2041 7267  "....        Arg
+0000af70: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0000af80: 6d6f 756e 745f 7061 7468 2028 7374 7229  mount_path (str)
+0000af90: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0000afa0: 7468 2028 7374 7229 0d0a 2020 2020 2020  th (str)..      
+0000afb0: 2020 2020 2020 7665 7273 696f 6e20 2855        version (U
+0000afc0: 6e69 6f6e 5b69 6e74 2c20 4c69 7374 5b69  nion[int, List[i
+0000afd0: 6e74 5d5d 290d 0a0d 0a20 2020 2020 2020  nt]])....       
+0000afe0: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
+0000aff0: 2020 2020 2020 2062 6f6f 6c3a 2072 6574         bool: ret
+0000b000: 7572 6e20 5472 7565 2069 6620 7375 6363  urn True if succ
+0000b010: 6573 732c 206f 7468 6572 7769 7365 2072  ess, otherwise r
+0000b020: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+0000b030: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0000b040: 2020 6966 2073 656c 662e 6973 5f61 7574    if self.is_aut
+0000b050: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+0000b060: 616c 6c5f 7665 7273 696f 6e73 203d 2073  all_versions = s
+0000b070: 656c 662e 6765 745f 616c 6c5f 7365 6372  elf.get_all_secr
+0000b080: 6574 5f76 6572 7369 6f6e 7328 6d6f 756e  et_versions(moun
+0000b090: 745f 7061 7468 2c20 7061 7468 290d 0a20  t_path, path).. 
+0000b0a0: 2020 2020 2020 2020 2020 2069 6620 616c             if al
+0000b0b0: 6c5f 7665 7273 696f 6e73 2069 7320 4e6f  l_versions is No
+0000b0c0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0000b0d0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000b0e0: 650d 0a20 2020 2020 2020 2020 2020 200d  e..            .
+0000b0f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b100: 6e6f 7420 2869 735f 696e 7428 7665 7273  not (is_int(vers
+0000b110: 696f 6e29 206f 7220 6973 5f6c 6973 7428  ion) or is_list(
+0000b120: 7665 7273 696f 6e29 293a 0d0a 2020 2020  version)):..    
+0000b130: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b140: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
+0000b150: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
+0000b160: 655f 5f7d 202d 2064 6573 7472 6f79 2073  e__} - destroy s
+0000b170: 6563 7265 7420 6572 726f 723a 2076 6572  ecret error: ver
+0000b180: 7369 6f6e 206d 7573 7420 6265 2061 6e20  sion must be an 
+0000b190: 696e 7420 6f72 2061 206c 6973 7420 6f66  int or a list of
+0000b1a0: 2069 6e74 2229 0d0a 2020 2020 2020 2020   int")..        
+0000b1b0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0000b1c0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+0000b1d0: 2020 6966 2069 735f 696e 7428 7665 7273    if is_int(vers
+0000b1e0: 696f 6e29 3a0d 0a20 2020 2020 2020 2020  ion):..         
+0000b1f0: 2020 2020 2020 2076 6572 7369 6f6e 203d         version =
+0000b200: 205b 7665 7273 696f 6e5d 0d0a 2020 2020   [version]..    
+0000b210: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0000b220: 2020 2020 2020 2020 2020 666f 7220 7620            for v 
+0000b230: 696e 2076 6572 7369 6f6e 3a0d 0a20 2020  in version:..   
+0000b240: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000b250: 6e6f 7420 6973 5f69 6e74 2876 293a 0d0a  not is_int(v):..
+0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b270: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0000b280: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+0000b290: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2064  __.__name__} - d
+0000b2a0: 6573 7472 6f79 2073 6563 7265 7420 6572  estroy secret er
+0000b2b0: 726f 723a 2076 6572 7369 6f6e 2027 7b76  ror: version '{v
+0000b2c0: 7d27 206d 7573 7420 6265 2061 6e20 696e  }' must be an in
+0000b2d0: 7422 290d 0a20 2020 2020 2020 2020 2020  t")..           
+0000b2e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000b2f0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0000b300: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000b310: 2020 2020 2020 2020 2069 6620 7374 7228           if str(
+0000b320: 7629 206e 6f74 2069 6e20 616c 6c5f 7665  v) not in all_ve
+0000b330: 7273 696f 6e73 2e6b 6579 7328 293a 0d0a  rsions.keys():..
+0000b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b350: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0000b360: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+0000b370: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2064  __.__name__} - d
+0000b380: 6573 7472 6f79 2073 6563 7265 7420 6572  estroy secret er
+0000b390: 726f 723a 2076 6572 7369 6f6e 2027 7b76  ror: version '{v
+0000b3a0: 7d27 206e 6f74 2066 6f75 6e64 2229 0d0a  }' not found")..
+0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3c0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000b3d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b3e0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000b3f0: 2020 2020 6465 7374 726f 7965 6420 3d20      destroyed = 
+0000b400: 616c 6c5f 7665 7273 696f 6e73 5b73 7472  all_versions[str
+0000b410: 2876 295d 5b22 6465 7374 726f 7965 6422  (v)]["destroyed"
+0000b420: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000b430: 2020 2069 6620 6465 7374 726f 7965 643a     if destroyed:
+0000b440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b450: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0000b460: 722e 7761 726e 696e 6728 6622 7b5f 5f63  r.warning(f"{__c
+0000b470: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0000b480: 202d 2064 6573 7472 6f79 2073 6563 7265   - destroy secre
+0000b490: 7420 6572 726f 723a 2076 6572 7369 6f6e  t error: version
+0000b4a0: 2027 7b76 7d27 2069 7320 616c 7265 6164   '{v}' is alread
+0000b4b0: 7920 6465 7374 726f 7965 6422 290d 0a20  y destroyed").. 
+0000b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4d0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+0000b4e0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+0000b4f0: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+0000b500: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+0000b510: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
+0000b520: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+0000b530: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+0000b540: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+0000b550: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+0000b560: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+0000b570: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
+0000b580: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+0000b590: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
+0000b5a0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+0000b5b0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+0000b5c0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+0000b5d0: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+0000b5e0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+0000b5f0: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
+0000b600: 7565 7374 732e 7075 7428 7572 6c2b 6622  uests.put(url+f"
+0000b610: 7b6d 6f75 6e74 5f70 6174 687d 2f64 6573  {mount_path}/des
+0000b620: 7472 6f79 2f7b 7061 7468 7d22 2c20 0d0a  troy/{path}", ..
+0000b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b640: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000b650: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
+0000b660: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d2c  -Token": token},
+0000b670: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b690: 2020 6461 7461 3d6a 736f 6e2e 6475 6d70    data=json.dump
+0000b6a0: 7328 6469 6374 2876 6572 7369 6f6e 733d  s(dict(versions=
+0000b6b0: 7665 7273 696f 6e29 2929 0d0a 2020 2020  version)))..    
+0000b6c0: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
+0000b6d0: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+0000b6e0: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
+0000b6f0: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
+0000b700: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000b710: 7475 726e 2054 7275 650d 0a20 2020 2020  turn True..     
+0000b720: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000b730: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000b740: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+0000b750: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+0000b760: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+0000b770: 2264 6573 7472 6f79 2073 6563 7265 7420  "destroy secret 
+0000b780: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
+0000b790: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000b7a0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0000b7b0: 2020 200d 0a20 2020 2020 2020 2072 6574     ..        ret
+0000b7c0: 7572 6e20 4661 6c73 650d 0a20 2020 200d  urn False..    .
+0000b7d0: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+0000b7e0: 7365 6372 6574 5f70 6174 6828 7365 6c66  secret_path(self
+0000b7f0: 2c20 6d6f 756e 745f 7061 7468 3a20 7374  , mount_path: st
+0000b800: 722c 2070 6174 683a 2073 7472 293a 0d0a  r, path: str):..
+0000b810: 2020 2020 2020 2020 2222 2264 656c 6574          """delet
+0000b820: 6520 7468 6520 656e 7469 7265 2073 6563  e the entire sec
+0000b830: 7265 7420 7061 7468 206f 6620 226d 6f75  ret path of "mou
+0000b840: 6e74 5f70 6174 682f 7061 7468 220d 0a20  nt_path/path".. 
+0000b850: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000b860: 2054 6f20 6465 6c65 7465 2073 6563 7265   To delete secre
+0000b870: 7420 7061 7468 2066 6f72 204b 5620 7632  t path for KV v2
+0000b880: 2c20 796f 7520 6d75 7374 2068 6176 6520  , you must have 
+0000b890: 6120 706f 6c69 6379 2067 7261 6e74 696e  a policy grantin
+0000b8a0: 6720 796f 7520 7468 6520 6465 6c65 7465  g you the delete
+0000b8b0: 2063 6170 6162 696c 6974 7920 0d0a 2020   capability ..  
+0000b8c0: 2020 2020 2020 6f6e 2074 6869 7320 2f6d        on this /m
+0000b8d0: 6574 6164 6174 612f 2070 6174 682e 0d0a  etadata/ path...
+0000b8e0: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
+0000b8f0: 0a20 2020 2020 2020 2020 2020 206d 6f75  .            mou
+0000b900: 6e74 5f70 6174 6820 2873 7472 290d 0a20  nt_path (str).. 
+0000b910: 2020 2020 2020 2020 2020 2070 6174 6820             path 
+0000b920: 2873 7472 290d 0a0d 0a20 2020 2020 2020  (str)....       
+0000b930: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
+0000b940: 2020 2020 2020 2062 6f6f 6c3a 2072 6574         bool: ret
+0000b950: 7572 6e20 5472 7565 2069 6620 7375 6363  urn True if succ
+0000b960: 6573 732c 206f 7468 6572 7769 7365 2072  ess, otherwise r
+0000b970: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+0000b980: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0000b990: 2020 6966 2073 656c 662e 6973 5f61 7574    if self.is_aut
+0000b9a0: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+0000b9b0: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
+0000b9c0: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
+0000b9d0: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
+0000b9e0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
+0000b9f0: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
+0000ba00: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
+0000ba10: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
+0000ba20: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
+0000ba30: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
+0000ba40: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
+0000ba50: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
+0000ba60: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
+0000ba70: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
+0000ba80: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
+0000ba90: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
+0000baa0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+0000bab0: 3d20 7265 7175 6573 7473 2e64 656c 6574  = requests.delet
+0000bac0: 6528 7572 6c2b 6622 7b6d 6f75 6e74 5f70  e(url+f"{mount_p
+0000bad0: 6174 687d 2f6d 6574 6164 6174 612f 7b70  ath}/metadata/{p
+0000bae0: 6174 687d 222c 2068 6561 6465 7273 3d7b  ath}", headers={
+0000baf0: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
+0000bb00: 2074 6f6b 656e 7d29 0d0a 2020 2020 2020   token})..      
+0000bb10: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
+0000bb20: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
+0000bb30: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
+0000bb40: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
+0000bb50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000bb60: 726e 2054 7275 650d 0a20 2020 2020 2020  rn True..       
+0000bb70: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000bb80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bb90: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
+0000bba0: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
+0000bbb0: 5f6e 616d 655f 5f2c 2072 6573 2c20 2264  _name__, res, "d
+0000bbc0: 656c 6574 6520 7365 6372 6574 2070 6174  elete secret pat
+0000bbd0: 6820 6572 726f 7222 290d 0a20 2020 2020  h error")..     
+0000bbe0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000bbf0: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
+0000bc00: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+0000bc10: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+0000bc20: 200d 0a0d 0a40 5345 4352 4554 2e72 6567   ....@SECRET.reg
+0000bc30: 6973 7465 725f 6d6f 6475 6c65 2829 0d0a  ister_module()..
+0000bc40: 636c 6173 7320 5661 756c 7453 6563 7265  class VaultSecre
+0000bc50: 7445 6e67 696e 6554 4f54 5028 5f56 6175  tEngineTOTP(_Vau
+0000bc60: 6c74 4854 5450 4150 4929 3a0d 0a20 2020  ltHTTPAPI):..   
+0000bc70: 2022 2222 544f 5450 2053 6563 7265 7420   """TOTP Secret 
+0000bc80: 456e 6769 6e65 0d0a 2020 2020 0d0a 2020  Engine..    ..  
+0000bc90: 2020 5265 6665 7220 746f 2068 7474 7073    Refer to https
+0000bca0: 3a2f 2f64 6576 656c 6f70 6572 2e68 6173  ://developer.has
+0000bcb0: 6869 636f 7270 2e63 6f6d 2f76 6175 6c74  hicorp.com/vault
+0000bcc0: 2f61 7069 2d64 6f63 732f 7365 6372 6574  /api-docs/secret
+0000bcd0: 2f74 6f74 7020 666f 7220 6d6f 7265 2064  /totp for more d
+0000bce0: 6574 6169 6c73 2e0d 0a0d 0a20 2020 2049  etails.....    I
+0000bcf0: 6e69 743a 0d0a 2020 2020 2020 2020 636f  nit:..        co
+0000bd00: 6e6e 6563 7469 6e67 2077 6974 6820 746f  nnecting with to
+0000bd10: 6b65 6e3a 0d0a 2020 2020 2020 2020 3e3e  ken:..        >>
+0000bd20: 3e20 746f 7470 5f65 6e67 696e 6520 3d20  > totp_engine = 
+0000bd30: 5661 756c 7453 6563 7265 7445 6e67 696e  VaultSecretEngin
+0000bd40: 6554 4f54 5028 0d0a 2020 2020 2020 2020  eTOTP(..        
+0000bd50: 3e3e 3e20 2020 2020 7572 6c3d 2268 7474  >>>     url="htt
+0000bd60: 703a 2f2f 3132 372e 302e 302e 313a 3832  p://127.0.0.1:82
+0000bd70: 3030 222c 200d 0a20 2020 2020 2020 203e  00", ..        >
+0000bd80: 3e3e 2020 2020 2061 7574 685f 6366 673d  >>     auth_cfg=
+0000bd90: 6469 6374 286d 6574 686f 643d 2274 6f6b  dict(method="tok
+0000bda0: 656e 222c 2074 6f6b 656e 3d22 544f 4b45  en", token="TOKE
+0000bdb0: 4e22 290d 0a20 2020 2020 2020 203e 3e3e  N")..        >>>
+0000bdc0: 2029 0d0a 0d0a 2020 2020 2020 2020 636f   )....        co
+0000bdd0: 6e6e 6563 7469 6e67 2077 6974 6820 7573  nnecting with us
+0000bde0: 6572 6e61 6d65 2026 2070 6173 7377 6f72  ername & passwor
+0000bdf0: 643a 0d0a 2020 2020 2020 2020 3e3e 3e20  d:..        >>> 
+0000be00: 746f 7470 5f65 6e67 696e 6520 3d20 5661  totp_engine = Va
+0000be10: 756c 7453 6563 7265 7445 6e67 696e 6554  ultSecretEngineT
+0000be20: 4f54 5028 0d0a 2020 2020 2020 2020 3e3e  OTP(..        >>
+0000be30: 3e20 2020 2020 7572 6c3d 2268 7474 703a  >     url="http:
+0000be40: 2f2f 3132 372e 302e 302e 313a 3832 3030  //127.0.0.1:8200
+0000be50: 222c 0d0a 2020 2020 2020 2020 3e3e 3e20  ",..        >>> 
+0000be60: 2020 2020 6175 7468 5f63 6667 3d64 6963      auth_cfg=dic
+0000be70: 7428 6d65 7468 6f64 3d22 7573 6572 7061  t(method="userpa
+0000be80: 7373 222c 2075 7365 726e 616d 653d 2275  ss", username="u
+0000be90: 7365 726e 616d 6522 2c20 7061 7373 776f  sername", passwo
+0000bea0: 7264 3d22 7061 7373 776f 7264 2229 0d0a  rd="password")..
+0000beb0: 2020 2020 2020 2020 3e3e 3e20 290d 0a20          >>> ).. 
+0000bec0: 2020 2022 2222 0d0a 2020 2020 0d0a 2020     """..    ..  
+0000bed0: 2020 6465 6620 6372 6561 7465 5f6b 6579    def create_key
+0000bee0: 2873 656c 662c 200d 0a20 2020 2020 2020  (self, ..       
+0000bef0: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
+0000bf00: 745f 7061 7468 3a20 7374 722c 200d 0a20  t_path: str, .. 
+0000bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf20: 2020 6e61 6d65 3a20 7374 722c 0d0a 2020    name: str,..  
+0000bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf40: 2061 6363 6f75 6e74 5f6e 616d 653a 2073   account_name: s
+0000bf50: 7472 2c0d 0a20 2020 2020 2020 2020 2020  tr,..           
+0000bf60: 2020 2020 2020 2020 6578 706f 7274 6564          exported
+0000bf70: 3a20 626f 6f6c 203d 2054 7275 652c 0d0a  : bool = True,..
+0000bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf90: 2020 206b 6579 5f73 697a 653a 2069 6e74     key_size: int
+0000bfa0: 203d 2032 302c 0d0a 2020 2020 2020 2020   = 20,..        
+0000bfb0: 2020 2020 2020 2020 2020 2069 7373 7565             issue
+0000bfc0: 723a 2073 7472 203d 2022 4d75 4c69 6e67  r: str = "MuLing
+0000bfd0: 436c 6f75 6422 2c0d 0a20 2020 2020 2020  Cloud",..       
+0000bfe0: 2020 2020 2020 2020 2020 2020 7065 7269              peri
+0000bff0: 6f64 3a20 696e 7420 3d20 3330 2c0d 0a20  od: int = 30,.. 
+0000c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c010: 2020 616c 676f 7269 7468 6d3a 2073 7472    algorithm: str
+0000c020: 203d 2022 5348 4131 222c 0d0a 2020 2020   = "SHA1",..    
+0000c030: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000c040: 6967 6974 733a 2069 6e74 203d 2036 2c0d  igits: int = 6,.
+0000c050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c060: 2020 2020 736b 6577 3a20 696e 7420 3d20      skew: int = 
+0000c070: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+0000c080: 2020 2020 2020 2071 725f 7369 7a65 3a20         qr_size: 
+0000c090: 696e 7420 3d20 3230 302c 0d0a 2020 2020  int = 200,..    
+0000c0a0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000c0b0: 725f 7361 7665 5f70 6174 683a 204f 7074  r_save_path: Opt
+0000c0c0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000c0d0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000c0e0: 2020 2020 2020 2072 6574 7572 6e5f 7365         return_se
+0000c0f0: 6372 6574 3a20 626f 6f6c 203d 2046 616c  cret: bool = Fal
+0000c100: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+0000c110: 2020 2020 2020 2020 7265 7475 726e 5f71          return_q
+0000c120: 725f 636f 6465 3a20 626f 6f6c 203d 2054  r_code: bool = T
+0000c130: 7275 6529 3a0d 0a20 2020 2020 2020 2022  rue):..        "
+0000c140: 2222 6372 6561 7465 2061 206b 6579 2069  ""create a key i
+0000c150: 6e20 226d 6f75 6e74 5f70 6174 682f 220d  n "mount_path/".
+0000c160: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000c170: 2020 2052 6566 6572 2074 6f20 6874 7470     Refer to http
+0000c180: 733a 2f2f 6465 7665 6c6f 7065 722e 6861  s://developer.ha
+0000c190: 7368 6963 6f72 702e 636f 6d2f 7661 756c  shicorp.com/vaul
+0000c1a0: 742f 6170 692d 646f 6373 2f73 6563 7265  t/api-docs/secre
+0000c1b0: 742f 746f 7470 2363 7265 6174 652d 6b65  t/totp#create-ke
+0000c1c0: 7920 666f 7220 6d6f 7265 2064 6574 6169  y for more detai
+0000c1d0: 6c73 2e0d 0a0d 0a20 2020 2020 2020 2041  ls.....        A
+0000c1e0: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+0000c1f0: 2020 6d6f 756e 745f 7061 7468 2028 7374    mount_path (st
+0000c200: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+0000c210: 6e61 6d65 2028 7374 7229 3a20 5370 6563  name (str): Spec
+0000c220: 6966 6965 7320 7468 6520 6e61 6d65 206f  ifies the name o
+0000c230: 6620 7468 6520 6b65 7920 746f 2063 7265  f the key to cre
+0000c240: 6174 652e 2054 6869 7320 6973 2073 7065  ate. This is spe
+0000c250: 6369 6669 6564 2061 7320 7061 7274 206f  cified as part o
+0000c260: 6620 7468 6520 5552 4c2e 0d0a 2020 2020  f the URL...    
+0000c270: 2020 2020 2020 2020 6163 636f 756e 745f          account_
+0000c280: 6e61 6d65 2028 7374 7229 3a20 5370 6563  name (str): Spec
+0000c290: 6966 6965 7320 7468 6520 6e61 6d65 206f  ifies the name o
+0000c2a0: 6620 7468 6520 6163 636f 756e 7420 6173  f the account as
+0000c2b0: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
+0000c2c0: 6520 6b65 792e 2044 6566 6175 6c74 7320  e key. Defaults 
+0000c2d0: 746f 204e 6f6e 652e 0d0a 2020 2020 2020  to None...      
+0000c2e0: 2020 2020 2020 6b65 795f 7369 7a65 2028        key_size (
+0000c2f0: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
+0000c300: 5370 6563 6966 6965 7320 7468 6520 7369  Specifies the si
+0000c310: 7a65 2069 6e20 6279 7465 7320 6f66 2074  ze in bytes of t
+0000c320: 6865 2056 6175 6c74 2067 656e 6572 6174  he Vault generat
+0000c330: 6564 206b 6579 2e20 4465 6661 756c 7473  ed key. Defaults
+0000c340: 2074 6f20 3230 2e0d 0a20 2020 2020 2020   to 20...       
+0000c350: 2020 2020 2069 7373 7565 7220 2873 7472       issuer (str
+0000c360: 2c20 6f70 7469 6f6e 616c 293a 2053 7065  , optional): Spe
+0000c370: 6369 6669 6573 2074 6865 206e 616d 6520  cifies the name 
+0000c380: 6f66 2074 6865 206b 6579 2773 2069 7373  of the key's iss
+0000c390: 7569 6e67 206f 7267 616e 697a 6174 696f  uing organizatio
+0000c3a0: 6e2e 2044 6566 6175 6c74 7320 746f 204d  n. Defaults to M
+0000c3b0: 754c 696e 6743 6c6f 7564 2e0d 0a20 2020  uLingCloud...   
+0000c3c0: 2020 2020 2020 2020 2070 6572 696f 6420           period 
+0000c3d0: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
+0000c3e0: 2053 7065 6369 6669 6573 2074 6865 206c   Specifies the l
+0000c3f0: 656e 6774 6820 6f66 2074 696d 6520 696e  ength of time in
+0000c400: 2073 6563 6f6e 6473 2075 7365 6420 746f   seconds used to
+0000c410: 2067 656e 6572 6174 6520 6120 636f 756e   generate a coun
+0000c420: 7465 7220 666f 7220 7468 6520 0d0a 2020  ter for the ..  
+0000c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c450: 2020 544f 5450 2063 6f64 6520 6361 6c63    TOTP code calc
+0000c460: 756c 6174 696f 6e2e 2044 6566 6175 6c74  ulation. Default
+0000c470: 7320 746f 2033 302e 0d0a 2020 2020 2020  s to 30...      
+0000c480: 2020 2020 2020 616c 676f 7269 7468 6d20        algorithm 
+0000c490: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
+0000c4a0: 2053 7065 6369 6669 6573 2074 6865 2068   Specifies the h
+0000c4b0: 6173 6869 6e67 2061 6c67 6f72 6974 686d  ashing algorithm
+0000c4c0: 2075 7365 6420 746f 2067 656e 6572 6174   used to generat
+0000c4d0: 6520 7468 6520 544f 5450 2063 6f64 652e  e the TOTP code.
+0000c4e0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 2020 2020 2020 2020 2020 4f70 7469 6f6e            Option
+0000c510: 7320 696e 636c 7564 6520 2253 4841 3122  s include "SHA1"
+0000c520: 2c20 2253 4841 3235 3622 2061 6e64 2022  , "SHA256" and "
+0000c530: 5348 4135 3132 222e 2044 6566 6175 6c74  SHA512". Default
+0000c540: 7320 746f 2022 5348 4131 222e 0d0a 2020  s to "SHA1"...  
+0000c550: 2020 2020 2020 2020 2020 6469 6769 7473            digits
+0000c560: 2028 696e 742c 206f 7074 696f 6e61 6c29   (int, optional)
+0000c570: 3a20 5370 6563 6966 6965 7320 7468 6520  : Specifies the 
+0000c580: 6e75 6d62 6572 206f 6620 6469 6769 7473  number of digits
+0000c590: 2069 6e20 7468 6520 6765 6e65 7261 7465   in the generate
+0000c5a0: 6420 544f 5450 2063 6f64 652e 2054 6869  d TOTP code. Thi
+0000c5b0: 7320 7661 6c75 6520 6361 6e20 0d0a 2020  s value can ..  
+0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5e0: 2020 6265 2073 6574 2074 6f20 3620 6f72    be set to 6 or
+0000c5f0: 2038 2e20 4465 6661 756c 7473 2074 6f20   8. Defaults to 
+0000c600: 362e 0d0a 2020 2020 2020 2020 2020 2020  6...            
+0000c610: 736b 6577 2028 696e 742c 206f 7074 696f  skew (int, optio
+0000c620: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
+0000c630: 7468 6520 6e75 6d62 6572 206f 6620 6465  the number of de
+0000c640: 6c61 7920 7065 7269 6f64 7320 7468 6174  lay periods that
+0000c650: 2061 7265 2061 6c6c 6f77 6564 2077 6865   are allowed whe
+0000c660: 6e20 7661 6c69 6461 7469 6e67 2061 200d  n validating a .
+0000c670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c690: 2020 2054 4f54 5020 636f 6465 2e20 5468     TOTP code. Th
+0000c6a0: 6973 2076 616c 7565 2063 616e 2062 6520  is value can be 
+0000c6b0: 6569 7468 6572 2030 206f 7220 312e 2044  either 0 or 1. D
+0000c6c0: 6566 6175 6c74 7320 746f 2031 2e0d 0a20  efaults to 1... 
+0000c6d0: 2020 2020 2020 2020 2020 2071 725f 7369             qr_si
+0000c6e0: 7a65 2028 696e 742c 206f 7074 696f 6e61  ze (int, optiona
+0000c6f0: 6c29 3a20 5370 6563 6966 6965 7320 7468  l): Specifies th
+0000c700: 6520 7069 7865 6c20 7369 7a65 206f 6620  e pixel size of 
+0000c710: 7468 6520 7371 7561 7265 2051 5220 636f  the square QR co
+0000c720: 6465 2077 6865 6e20 6765 6e65 7261 7469  de when generati
+0000c730: 6e67 2061 206e 6577 206b 6579 2e20 0d0a  ng a new key. ..
+0000c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c760: 2020 2020 204f 6e6c 7920 7573 6564 2069       Only used i
+0000c770: 6620 6578 706f 7274 6564 2069 7320 7472  f exported is tr
+0000c780: 7565 2e20 4966 2074 6869 7320 7661 6c75  ue. If this valu
+0000c790: 6520 6973 2030 2c20 6120 5152 2063 6f64  e is 0, a QR cod
+0000c7a0: 6520 7769 6c6c 206e 6f74 2062 6520 0d0a  e will not be ..
+0000c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7d0: 2020 2020 2072 6574 7572 6e65 642e 2044       returned. D
+0000c7e0: 6566 6175 6c74 7320 746f 2032 3030 2e0d  efaults to 200..
+0000c7f0: 0a20 2020 2020 2020 2020 2020 2071 725f  .            qr_
+0000c800: 7361 7665 5f70 6174 6820 284f 7074 696f  save_path (Optio
+0000c810: 6e61 6c5b 7374 725d 2c20 6f70 7469 6f6e  nal[str], option
+0000c820: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
+0000c830: 6865 2070 6174 6820 746f 2073 6176 6520  he path to save 
+0000c840: 7468 6520 5152 2063 6f64 6520 696d 6167  the QR code imag
+0000c850: 6520 7768 6963 6820 7368 6f75 6c64 200d  e which should .
+0000c860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 2020 2020 2062 6520 6120 2e70 6e67 2066       be a .png f
+0000c8a0: 696c 652e 2044 6566 6175 6c74 7320 746f  ile. Defaults to
+0000c8b0: 204e 6f6e 652e 0d0a 2020 2020 2020 2020   None...        
+0000c8c0: 2020 2020 7265 7475 726e 5f73 6563 7265      return_secre
+0000c8d0: 7420 2862 6f6f 6c2c 206f 7074 696f 6e61  t (bool, optiona
+0000c8e0: 6c29 3a20 5370 6563 6966 6965 7320 6966  l): Specifies if
+0000c8f0: 2074 6865 2073 6563 7265 7420 7368 6f75   the secret shou
+0000c900: 6c64 2062 6520 7265 7475 726e 6564 2e20  ld be returned. 
+0000c910: 4465 6661 756c 7473 2074 6f20 4661 6c73  Defaults to Fals
+0000c920: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
+0000c930: 7265 7475 726e 5f71 725f 636f 6465 2028  return_qr_code (
+0000c940: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+0000c950: 2053 7065 6369 6669 6573 2069 6620 7468   Specifies if th
+0000c960: 6520 5152 2063 6f64 6520 7368 6f75 6c64  e QR code should
+0000c970: 2062 6520 7265 7475 726e 6564 2e20 4465   be returned. De
+0000c980: 6661 756c 7473 2074 6f20 5472 7565 2e0d  faults to True..
+0000c990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000c9c0: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
+0000c9d0: 2020 2020 2020 6469 6374 206f 7220 4e6f        dict or No
+0000c9e0: 6e65 3a20 7265 7475 726e 2061 2064 6963  ne: return a dic
+0000c9f0: 7420 6966 2073 7563 6365 7373 2c20 6f74  t if success, ot
+0000ca00: 6865 7277 6973 6520 7265 7475 726e 204e  herwise return N
+0000ca10: 6f6e 650d 0a20 2020 2020 2020 2022 2222  one..        """
+0000ca20: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000ca30: 662e 6973 5f61 7574 683a 0d0a 2020 2020  f.is_auth:..    
+0000ca40: 2020 2020 2020 2020 6578 6973 745f 6b65          exist_ke
+0000ca50: 7973 203d 2073 656c 662e 6c69 7374 5f6b  ys = self.list_k
+0000ca60: 6579 286d 6f75 6e74 5f70 6174 6829 0d0a  ey(mount_path)..
+0000ca70: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0000ca80: 7869 7374 5f6b 6579 7320 6973 206e 6f74  xist_keys is not
+0000ca90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0000caa0: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+0000cab0: 696e 2065 7869 7374 5f6b 6579 733a 0d0a  in exist_keys:..
+0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cad0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0000cae0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+0000caf0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2063  __.__name__} - c
+0000cb00: 7265 6174 6520 6b65 7920 6572 726f 723a  reate key error:
+0000cb10: 206b 6579 2027 7b6e 616d 657d 2720 616c   key '{name}' al
+0000cb20: 7265 6164 7920 6578 6973 7473 2229 0d0a  ready exists")..
+0000cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb40: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+0000cb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cb60: 200d 0a20 2020 2020 2020 2020 2020 2069   ..            i
+0000cb70: 6620 616c 676f 7269 7468 6d20 6e6f 7420  f algorithm not 
+0000cb80: 696e 205b 2253 4841 3122 2c20 2253 4841  in ["SHA1", "SHA
+0000cb90: 3235 3622 2c20 2253 4841 3531 3222 5d3a  256", "SHA512"]:
+0000cba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cbb0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+0000cbc0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+0000cbd0: 2e5f 5f6e 616d 655f 5f7d 202d 2063 7265  .__name__} - cre
+0000cbe0: 6174 6520 6b65 7920 6572 726f 723a 2061  ate key error: a
+0000cbf0: 6c67 6f72 6974 686d 206d 7573 7420 6265  lgorithm must be
+0000cc00: 206f 6e65 206f 6620 220d 0a20 2020 2020   one of "..     
+0000cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc20: 2020 2020 2020 2020 2020 2020 2066 2227               f"'
+0000cc30: 5348 4131 272c 2027 5348 4132 3536 2720  SHA1', 'SHA256' 
+0000cc40: 6f72 2027 5348 4135 3132 2722 290d 0a20  or 'SHA512'").. 
+0000cc50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000cc60: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
+0000cc70: 2020 2020 2020 2020 6966 2064 6967 6974          if digit
+0000cc80: 7320 6e6f 7420 696e 205b 362c 2038 5d3a  s not in [6, 8]:
+0000cc90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cca0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+0000ccb0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+0000ccc0: 2e5f 5f6e 616d 655f 5f7d 202d 2063 7265  .__name__} - cre
+0000ccd0: 6174 6520 6b65 7920 6572 726f 723a 2064  ate key error: d
+0000cce0: 6967 6974 7320 6d75 7374 2062 6520 6f6e  igits must be on
+0000ccf0: 6520 6f66 2036 206f 7220 3822 290d 0a20  e of 6 or 8").. 
+0000cd00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000cd10: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
+0000cd20: 2020 2020 2020 2020 6966 2073 6b65 7720          if skew 
+0000cd30: 6e6f 7420 696e 205b 302c 2031 5d3a 0d0a  not in [0, 1]:..
+0000cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd50: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+0000cd60: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+0000cd70: 5f6e 616d 655f 5f7d 202d 2063 7265 6174  _name__} - creat
+0000cd80: 6520 6b65 7920 6572 726f 723a 2073 6b65  e key error: ske
+0000cd90: 7720 6d75 7374 2062 6520 6f6e 6520 6f66  w must be one of
+0000cda0: 2030 206f 7220 3122 290d 0a20 2020 2020   0 or 1")..     
+0000cdb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000cdc0: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+0000cdd0: 2020 2020 6966 2071 725f 7369 7a65 203c      if qr_size <
+0000cde0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0000cdf0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000ce00: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+0000ce10: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+0000ce20: 6372 6561 7465 206b 6579 2065 7272 6f72  create key error
+0000ce30: 3a20 7172 5f73 697a 6520 6d75 7374 2062  : qr_size must b
+0000ce40: 6520 6120 706f 7369 7469 7665 2069 6e74  e a positive int
+0000ce50: 6567 6572 2229 0d0a 2020 2020 2020 2020  eger")..        
+0000ce60: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000ce70: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0000ce80: 200d 0a20 2020 2020 2020 2020 2020 2064   ..            d
+0000ce90: 6174 6120 3d20 7b22 6765 6e65 7261 7465  ata = {"generate
+0000cea0: 223a 2054 7275 652c 0d0a 2020 2020 2020  ": True,..      
+0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+0000cec0: 7373 7565 7222 3a20 6973 7375 6572 2c0d  ssuer": issuer,.
+0000ced0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cee0: 2020 2020 2022 6163 636f 756e 745f 6e61       "account_na
+0000cef0: 6d65 223a 2061 6363 6f75 6e74 5f6e 616d  me": account_nam
+0000cf00: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000cf10: 2020 2020 2020 2020 2265 7870 6f72 7465          "exporte
+0000cf20: 6422 3a20 6578 706f 7274 6564 2c0d 0a20  d": exported,.. 
+0000cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf40: 2020 2022 6b65 795f 7369 7a65 223a 206b     "key_size": k
+0000cf50: 6579 5f73 697a 652c 0d0a 2020 2020 2020  ey_size,..      
+0000cf60: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+0000cf70: 6572 696f 6422 3a20 7065 7269 6f64 2c0d  eriod": period,.
+0000cf80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cf90: 2020 2020 2022 616c 676f 7269 7468 6d22       "algorithm"
+0000cfa0: 3a20 616c 676f 7269 7468 6d2c 0d0a 2020  : algorithm,..  
+0000cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfc0: 2020 2264 6967 6974 7322 3a20 6469 6769    "digits": digi
+0000cfd0: 7473 2c0d 0a20 2020 2020 2020 2020 2020  ts,..           
+0000cfe0: 2020 2020 2020 2020 2022 736b 6577 223a           "skew":
+0000cff0: 2073 6b65 777d 0d0a 2020 2020 2020 2020   skew}..        
+0000d000: 2020 2020 6966 206e 6f74 2065 7870 6f72      if not expor
+0000d010: 7465 643a 0d0a 2020 2020 2020 2020 2020  ted:..          
+0000d020: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0000d030: 722e 7761 726e 696e 6728 6622 7b5f 5f63  r.warning(f"{__c
+0000d040: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0000d050: 202d 2063 7265 6174 6520 6b65 7920 7761   - create key wa
+0000d060: 726e 696e 673a 2065 7870 6f72 7465 6420  rning: exported 
+0000d070: 6973 2073 6574 2074 6f20 4661 6c73 652c  is set to False,
+0000d080: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0a0: 2020 2020 2020 2020 6622 6974 2077 6f6e          f"it won
+0000d0b0: 2774 2072 6574 7572 6e20 6120 5152 2063  't return a QR c
+0000d0c0: 6f64 6520 6f72 2075 726c 2229 0d0a 2020  ode or url")..  
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000d0e0: 7475 726e 5f73 6563 7265 7420 3d20 4661  turn_secret = Fa
+0000d0f0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+0000d100: 2020 2020 2072 6574 7572 6e5f 7172 5f63       return_qr_c
+0000d110: 6f64 6520 3d20 4661 6c73 650d 0a20 2020  ode = False..   
+0000d120: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0000d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d140: 6461 7461 5b22 7172 5f73 697a 6522 5d20  data["qr_size"] 
+0000d150: 3d20 7172 5f73 697a 650d 0a20 2020 2020  = qr_size..     
+0000d160: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000d170: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
+0000d180: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+0000d190: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
+0000d1a0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+0000d1b0: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+0000d1c0: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+0000d1d0: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+0000d1e0: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+0000d1f0: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
+0000d200: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
+0000d210: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
+0000d220: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+0000d230: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+0000d240: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+0000d250: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+0000d260: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+0000d270: 2072 6573 203d 2072 6571 7565 7374 732e   res = requests.
+0000d280: 706f 7374 2875 726c 2b66 227b 6d6f 756e  post(url+f"{moun
+0000d290: 745f 7061 7468 7d2f 6b65 7973 2f7b 6e61  t_path}/keys/{na
+0000d2a0: 6d65 7d22 2c20 6865 6164 6572 733d 7b22  me}", headers={"
+0000d2b0: 582d 5661 756c 742d 546f 6b65 6e22 3a20  X-Vault-Token": 
+0000d2c0: 746f 6b65 6e7d 2c20 6461 7461 3d6a 736f  token}, data=jso
+0000d2d0: 6e2e 6475 6d70 7328 6461 7461 2929 0d0a  n.dumps(data))..
+0000d2e0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0000d2f0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+0000d300: 3d20 3230 3020 6f72 2072 6573 2e73 7461  = 200 or res.sta
+0000d310: 7475 735f 636f 6465 203d 3d20 3230 343a  tus_code == 204:
+0000d320: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d330: 2020 7265 7370 6f6e 7365 5f64 6174 6120    response_data 
+0000d340: 3d20 7265 732e 6a73 6f6e 2829 5b22 6461  = res.json()["da
+0000d350: 7461 225d 0d0a 2020 2020 2020 2020 2020  ta"]..          
+0000d360: 2020 2020 2020 7265 7375 6c74 203d 207b        result = {
+0000d370: 226d 6574 6164 6174 6122 3a20 7b22 6d6f  "metadata": {"mo
+0000d380: 756e 745f 7061 7468 223a 206d 6f75 6e74  unt_path": mount
+0000d390: 5f70 6174 682c 200d 0a20 2020 2020 2020  _path, ..       
 0000d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3b0: 2020 2020 2022 6578 706f 7274 6564 223a       "exported":
-0000d3c0: 2065 7870 6f72 7465 642c 0d0a 2020 2020   exported,..    
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 226e 616d 6522 3a20 6e61 6d65 2c0d 0a20  "name": name,.. 
 0000d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3f0: 2020 2022 6b65 795f 7369 7a65 223a 206b     "key_size": k
-0000d400: 6579 5f73 697a 652c 0d0a 2020 2020 2020  ey_size,..      
+0000d3f0: 2020 2020 2020 2265 7870 6f72 7465 6422        "exported"
+0000d400: 3a20 6578 706f 7274 6564 2c0d 0a20 2020  : exported,..   
 0000d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d430: 2022 6973 7375 6572 223a 2069 7373 7565   "issuer": issue
-0000d440: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+0000d430: 2020 2020 226b 6579 5f73 697a 6522 3a20      "key_size": 
+0000d440: 6b65 795f 7369 7a65 2c0d 0a20 2020 2020  key_size,..     
 0000d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d460: 2020 2020 2020 2020 2020 2022 6163 636f             "acco
-0000d470: 756e 745f 6e61 6d65 223a 2061 6363 6f75  unt_name": accou
-0000d480: 6e74 5f6e 616d 652c 0d0a 2020 2020 2020  nt_name,..      
+0000d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d470: 2020 2269 7373 7565 7222 3a20 6973 7375    "issuer": issu
+0000d480: 6572 2c0d 0a20 2020 2020 2020 2020 2020  er,..           
 0000d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4b0: 2022 7065 7269 6f64 223a 2070 6572 696f   "period": perio
-0000d4c0: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
+0000d4a0: 2020 2020 2020 2020 2020 2020 2261 6363              "acc
+0000d4b0: 6f75 6e74 5f6e 616d 6522 3a20 6163 636f  ount_name": acco
+0000d4c0: 756e 745f 6e61 6d65 2c0d 0a20 2020 2020  unt_name,..     
 0000d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4e0: 2020 2020 2020 2020 2020 2022 616c 676f             "algo
-0000d4f0: 7269 7468 6d22 3a20 616c 676f 7269 7468  rithm": algorith
-0000d500: 6d2c 0d0a 2020 2020 2020 2020 2020 2020  m,..            
+0000d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4f0: 2020 2270 6572 696f 6422 3a20 7065 7269    "period": peri
+0000d500: 6f64 2c0d 0a20 2020 2020 2020 2020 2020  od,..           
 0000d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d520: 2020 2020 2020 2020 2020 2022 6469 6769             "digi
-0000d530: 7473 223a 2064 6967 6974 732c 0d0a 2020  ts": digits,..  
-0000d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d520: 2020 2020 2020 2020 2020 2020 2261 6c67              "alg
+0000d530: 6f72 6974 686d 223a 2061 6c67 6f72 6974  orithm": algorit
+0000d540: 686d 2c0d 0a20 2020 2020 2020 2020 2020  hm,..           
 0000d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d560: 2020 2020 2022 736b 6577 223a 2073 6b65       "skew": ske
-0000d570: 772c 0d0a 2020 2020 2020 2020 2020 2020  w,..            
+0000d560: 2020 2020 2020 2020 2020 2020 2264 6967              "dig
+0000d570: 6974 7322 3a20 6469 6769 7473 2c0d 0a20  its": digits,.. 
 0000d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d590: 2020 2020 2020 2020 2020 2022 7172 5f73             "qr_s
-0000d5a0: 697a 6522 3a20 7172 5f73 697a 657d 7d0d  ize": qr_size}}.
-0000d5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d5c0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0000d5d0: 2020 2069 6620 7265 7475 726e 5f73 6563     if return_sec
-0000d5e0: 7265 743a 0d0a 2020 2020 2020 2020 2020  ret:..          
-0000d5f0: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-0000d600: 7265 7370 6f6e 7365 5f64 6174 612e 6765  response_data.ge
-0000d610: 7428 2275 726c 222c 204e 6f6e 6529 0d0a  t("url", None)..
-0000d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d630: 2020 2020 6966 2075 726c 2069 7320 6e6f      if url is no
-0000d640: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0000d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d660: 205f 2c20 5f2c 2070 6172 616d 7320 3d20   _, _, params = 
-0000d670: 7365 6c66 2e5f 5f70 6172 7365 5f74 6f74  self.__parse_tot
-0000d680: 705f 7572 6c28 7572 6c29 0d0a 2020 2020  p_url(url)..    
+0000d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5a0: 2020 2020 2020 2273 6b65 7722 3a20 736b        "skew": sk
+0000d5b0: 6577 2c0d 0a20 2020 2020 2020 2020 2020  ew,..           
+0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5d0: 2020 2020 2020 2020 2020 2020 2271 725f              "qr_
+0000d5e0: 7369 7a65 223a 2071 725f 7369 7a65 7d7d  size": qr_size}}
+0000d5f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d600: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000d610: 2020 2020 6966 2072 6574 7572 6e5f 7365      if return_se
+0000d620: 6372 6574 3a0d 0a20 2020 2020 2020 2020  cret:..         
+0000d630: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+0000d640: 2072 6573 706f 6e73 655f 6461 7461 2e67   response_data.g
+0000d650: 6574 2822 7572 6c22 2c20 4e6f 6e65 290d  et("url", None).
+0000d660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d670: 2020 2020 2069 6620 7572 6c20 6973 206e       if url is n
+0000d680: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
 0000d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6a0: 2020 2020 7365 6372 6574 203d 2070 6172      secret = par
-0000d6b0: 616d 735b 2273 6563 7265 7422 5d0d 0a20  ams["secret"].. 
-0000d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6d0: 2020 2020 2020 2072 6573 756c 745b 2273         result["s
-0000d6e0: 6563 7265 7422 5d20 3d20 7365 6372 6574  ecret"] = secret
-0000d6f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d700: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-0000d710: 2020 2020 7172 5f63 6f64 6520 3d20 7265      qr_code = re
-0000d720: 7370 6f6e 7365 5f64 6174 612e 6765 7428  sponse_data.get(
-0000d730: 2262 6172 636f 6465 222c 204e 6f6e 6529  "barcode", None)
-0000d740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d750: 2020 6966 2071 725f 636f 6465 2069 7320    if qr_code is 
-0000d760: 6e6f 7420 4e6f 6e65 2061 6e64 2071 725f  not None and qr_
-0000d770: 7361 7665 5f70 6174 6820 6973 206e 6f74  save_path is not
-0000d780: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000d790: 2020 2020 2020 2020 2020 2020 7172 5f69              qr_i
-0000d7a0: 6d61 6765 203d 2062 6173 6536 342e 6236  mage = base64.b6
-0000d7b0: 3464 6563 6f64 6528 7172 5f63 6f64 6529  4decode(qr_code)
-0000d7c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d7d0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-0000d7e0: 7172 5f73 6176 655f 7061 7468 2c20 2277  qr_save_path, "w
-0000d7f0: 6222 2920 6173 2066 3a0d 0a20 2020 2020  b") as f:..     
-0000d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d810: 2020 2066 2e77 7269 7465 2871 725f 696d     f.write(qr_im
-0000d820: 6167 6529 0d0a 2020 2020 2020 2020 2020  age)..          
-0000d830: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000d840: 6f67 6765 722e 696e 666f 2866 227b 5f5f  ogger.info(f"{__
-0000d850: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0000d860: 7d20 2d20 5152 2063 6f64 6520 696d 6167  } - QR code imag
-0000d870: 6520 6973 2073 6176 6564 2074 6f20 7b71  e is saved to {q
-0000d880: 725f 7361 7665 5f70 6174 687d 2229 0d0a  r_save_path}")..
-0000d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8a0: 6966 2072 6574 7572 6e5f 7172 5f63 6f64  if return_qr_cod
-0000d8b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000d8c0: 2020 2020 2020 2020 7265 7375 6c74 5b22          result["
-0000d8d0: 7172 5f63 6f64 6522 5d20 3d20 7172 5f63  qr_code"] = qr_c
-0000d8e0: 6f64 650d 0a20 2020 2020 2020 2020 2020  ode..           
-0000d8f0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-0000d900: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000d910: 7375 6c74 0d0a 2020 2020 2020 2020 2020  sult..          
-0000d920: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0000d930: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-0000d940: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
-0000d950: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
-0000d960: 6d65 5f5f 2c20 7265 732c 2022 6372 6561  me__, res, "crea
-0000d970: 7465 206b 6579 2065 7272 6f72 2229 0d0a  te key error")..
-0000d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d990: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-0000d9a0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-0000d9b0: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-0000d9c0: 2020 2020 0d0a 2020 2020 6465 6620 7570      ..    def up
-0000d9d0: 6461 7465 5f6b 6579 2873 656c 662c 200d  date_key(self, .
-0000d9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d9f0: 2020 2020 6d6f 756e 745f 7061 7468 3a20      mount_path: 
-0000da00: 7374 722c 200d 0a20 2020 2020 2020 2020  str, ..         
-0000da10: 2020 2020 2020 2020 2020 6e61 6d65 3a20            name: 
-0000da20: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
-0000da30: 2020 2020 2020 2020 206b 6579 3a20 4f70           key: Op
-0000da40: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0000da50: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-0000da60: 2020 2020 2020 2020 6163 636f 756e 745f          account_
-0000da70: 6e61 6d65 3a20 4f70 7469 6f6e 616c 5b73  name: Optional[s
-0000da80: 7472 5d20 3d20 4e6f 6e65 2c0d 0a20 2020  tr] = None,..   
-0000da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000daa0: 6973 7375 6572 3a20 4f70 7469 6f6e 616c  issuer: Optional
-0000dab0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0d 0a20  [str] = None,.. 
-0000dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dad0: 2020 7065 7269 6f64 3a20 4f70 7469 6f6e    period: Option
-0000dae0: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0d  al[int] = None,.
-0000daf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000db00: 2020 2020 616c 676f 7269 7468 6d3a 204f      algorithm: O
-0000db10: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000db20: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-0000db30: 2020 2020 2020 2020 2064 6967 6974 733a           digits:
-0000db40: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-0000db50: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-0000db60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000db70: 6e5f 7365 6372 6574 5f6b 6579 3a20 626f  n_secret_key: bo
-0000db80: 6f6c 203d 2046 616c 7365 293a 0d0a 2020  ol = False):..  
-0000db90: 2020 2020 2020 2222 2275 7064 6174 6520        """update 
-0000dba0: 6120 6b65 7920 696e 2022 6d6f 756e 7420  a key in "mount 
-0000dbb0: 7061 7468 2f22 0d0a 0d0a 2020 2020 2020  path/"....      
-0000dbc0: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-0000dbd0: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
-0000dbe0: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
-0000dbf0: 2020 206e 616d 6520 2873 7472 290d 0a20     name (str).. 
-0000dc00: 2020 2020 2020 2020 2020 206b 6579 2028             key (
-0000dc10: 4f70 7469 6f6e 616c 5b73 7472 5d2c 206f  Optional[str], o
-0000dc20: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
-0000dc30: 6965 7320 7468 6520 726f 6f74 206b 6579  ies the root key
-0000dc40: 2075 7365 6420 746f 2067 656e 6572 6174   used to generat
-0000dc50: 6520 6120 544f 5450 2063 6f64 652e 2049  e a TOTP code. I
-0000dc60: 6620 4e6f 6e65 2c20 6974 200d 0a20 2020  f None, it ..   
-0000dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc90: 2020 2020 2020 2020 7769 6c6c 2072 616e          will ran
-0000dca0: 646f 6d6c 7920 6765 6e65 7261 7465 2061  domly generate a
-0000dcb0: 206e 6577 2073 6563 7265 7420 6b65 792e   new secret key.
-0000dcc0: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-0000dcd0: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
-0000dce0: 6163 636f 756e 745f 6e61 6d65 2028 4f70  account_name (Op
-0000dcf0: 7469 6f6e 616c 5b73 7472 5d2c 206f 7074  tional[str], opt
-0000dd00: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
-0000dd10: 7320 7468 6520 6163 636f 756e 745f 6e61  s the account_na
-0000dd20: 6d65 2069 6620 796f 7520 7761 6e74 2074  me if you want t
-0000dd30: 6f20 6368 616e 6765 2069 742c 200d 0a20  o change it, .. 
-0000dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd70: 2020 206f 7468 6572 7769 7365 2072 656d     otherwise rem
-0000dd80: 6169 6e20 6173 204e 6f6e 652e 2044 6566  ain as None. Def
-0000dd90: 6175 6c74 7320 746f 204e 6f6e 652e 0d0a  aults to None...
-0000dda0: 2020 2020 2020 2020 2020 2020 6973 7375              issu
-0000ddb0: 6572 2028 4f70 7469 6f6e 616c 5b73 7472  er (Optional[str
-0000ddc0: 5d2c 206f 7074 696f 6e61 6c29 3a20 5370  ], optional): Sp
-0000ddd0: 6563 6966 6965 7320 7468 6520 6973 7375  ecifies the issu
-0000dde0: 6572 2069 6620 796f 7520 7761 6e74 2074  er if you want t
-0000ddf0: 6f20 6368 616e 6765 2069 742c 206f 7468  o change it, oth
-0000de00: 6572 7769 7365 2072 656d 6169 6e20 0d0a  erwise remain ..
-0000de10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de30: 2020 2020 2020 2020 2020 2020 2020 6173                as
-0000de40: 204e 6f6e 652e 2044 6566 6175 6c74 7320   None. Defaults 
-0000de50: 746f 204e 6f6e 652e 0d0a 2020 2020 2020  to None...      
-0000de60: 2020 2020 2020 7065 7269 6f64 2028 4f70        period (Op
-0000de70: 7469 6f6e 616c 5b69 6e74 5d2c 206f 7074  tional[int], opt
-0000de80: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
-0000de90: 7320 7468 6520 7065 7269 6f64 2069 6620  s the period if 
-0000dea0: 796f 7520 7761 6e74 2074 6f20 6368 616e  you want to chan
-0000deb0: 6765 2069 742c 206f 7468 6572 7769 7365  ge it, otherwise
-0000dec0: 2072 656d 6169 6e20 0d0a 2020 2020 2020   remain ..      
-0000ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000def0: 2020 2020 2020 2020 6173 204e 6f6e 652e          as None.
-0000df00: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-0000df10: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
-0000df20: 616c 676f 7269 7468 6d20 284f 7074 696f  algorithm (Optio
-0000df30: 6e61 6c5b 7374 725d 2c20 6f70 7469 6f6e  nal[str], option
-0000df40: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
-0000df50: 6865 2061 6c67 6f72 6974 686d 2069 6620  he algorithm if 
-0000df60: 796f 7520 7761 6e74 2074 6f20 6368 616e  you want to chan
-0000df70: 6765 2069 742c 206f 7468 6572 7769 7365  ge it, otherwise
-0000df80: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0000df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfb0: 2020 2020 7265 6d61 696e 2061 7320 4e6f      remain as No
-0000dfc0: 6e65 2e20 4465 6661 756c 7473 2074 6f20  ne. Defaults to 
-0000dfd0: 4e6f 6e65 2e0d 0a20 2020 2020 2020 2020  None...         
-0000dfe0: 2020 2064 6967 6974 7320 284f 7074 696f     digits (Optio
-0000dff0: 6e61 6c5b 696e 745d 2c20 6f70 7469 6f6e  nal[int], option
-0000e000: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
-0000e010: 6865 2064 6967 6974 7320 6966 2079 6f75  he digits if you
-0000e020: 2077 616e 7420 746f 2063 6861 6e67 6520   want to change 
-0000e030: 6974 2c20 6f74 6865 7277 6973 6520 7265  it, otherwise re
-0000e040: 6d61 696e 200d 0a20 2020 2020 2020 2020  main ..         
-0000e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e070: 2020 2020 2061 7320 4e6f 6e65 2e20 4465       as None. De
-0000e080: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0d  faults to None..
-0000e090: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e0a0: 7572 6e5f 7365 6372 6574 5f6b 6579 2028  urn_secret_key (
-0000e0b0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
-0000e0c0: 2053 7065 6369 6669 6573 2077 6865 7468   Specifies wheth
-0000e0d0: 6572 2074 6f20 7265 7475 726e 2074 6865  er to return the
-0000e0e0: 2073 6563 7265 7420 6b65 792e 2044 6566   secret key. Def
-0000e0f0: 6175 6c74 7320 746f 2046 616c 7365 2e0d  aults to False..
-0000e100: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0000e110: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-0000e120: 2062 6f6f 6c20 6f72 2073 7472 3a20 7265   bool or str: re
-0000e130: 7475 726e 2054 7275 6520 6966 2073 7563  turn True if suc
-0000e140: 6365 7373 2061 6e64 2072 6574 7572 6e5f  cess and return_
-0000e150: 7365 6372 6574 5f6b 6579 2069 7320 4661  secret_key is Fa
-0000e160: 6c73 652c 2072 6574 7572 6e20 7468 6520  lse, return the 
-0000e170: 7365 6372 6574 206b 6579 2069 6620 7375  secret key if su
-0000e180: 6363 6573 7320 0d0a 2020 2020 2020 2020  ccess ..        
-0000e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1a0: 2061 6e64 2072 6574 7572 6e5f 7365 6372   and return_secr
-0000e1b0: 6574 5f6b 6579 2069 7320 5472 7565 2c20  et_key is True, 
-0000e1c0: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
-0000e1d0: 2046 616c 7365 2e0d 0a20 2020 2020 2020   False...       
-0000e1e0: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-0000e1f0: 2073 656c 662e 6973 5f61 7574 683a 0d0a   self.is_auth:..
-0000e200: 2020 2020 2020 2020 2020 2020 6578 6973              exis
-0000e210: 745f 6b65 7973 203d 2073 656c 662e 6c69  t_keys = self.li
-0000e220: 7374 5f6b 6579 286d 6f75 6e74 5f70 6174  st_key(mount_pat
-0000e230: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
-0000e240: 6966 2065 7869 7374 5f6b 6579 7320 6973  if exist_keys is
-0000e250: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000e260: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000e270: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-0000e280: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0000e290: 202d 2075 7064 6174 6520 6b65 7920 6572   - update key er
-0000e2a0: 726f 723a 206b 6579 2027 7b6e 616d 657d  ror: key '{name}
-0000e2b0: 2720 6e6f 7420 666f 756e 6422 290d 0a20  ' not found").. 
-0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e2d0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-0000e2e0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e300: 6966 206e 616d 6520 6e6f 7420 696e 2065  if name not in e
-0000e310: 7869 7374 5f6b 6579 733a 0d0a 2020 2020  xist_keys:..    
-0000e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e330: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
-0000e340: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
-0000e350: 5f6e 616d 655f 5f7d 202d 2072 6561 7570  _name__} - reaup
-0000e360: 6461 7465 6420 6b65 7920 6572 726f 723a  dated key error:
-0000e370: 206b 6579 2027 7b6e 616d 657d 2720 6e6f   key '{name}' no
-0000e380: 7420 666f 756e 6422 290d 0a20 2020 2020  t found")..     
-0000e390: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e3a0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-0000e3b0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-0000e3c0: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
-0000e3d0: 6c66 2e72 6561 645f 6b65 7928 6d6f 756e  lf.read_key(moun
-0000e3e0: 745f 7061 7468 2c20 6e61 6d65 290d 0a20  t_path, name).. 
-0000e3f0: 2020 2020 2020 2020 2020 2069 6620 6461             if da
-0000e400: 7461 2069 7320 4e6f 6e65 3a0d 0a20 2020  ta is None:..   
-0000e410: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000e420: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-0000e430: 2020 2020 2020 2069 6620 6b65 7920 6973         if key is
-0000e440: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000e450: 2020 2020 2020 2020 6b65 7920 3d20 7079          key = py
-0000e460: 6f74 702e 7261 6e64 6f6d 5f62 6173 6533  otp.random_base3
-0000e470: 3228 290d 0a0d 0a20 2020 2020 2020 2020  2()....         
-0000e480: 2020 2074 6f74 705f 7572 6c20 3d20 7365     totp_url = se
-0000e490: 6c66 2e5f 5f67 656e 6572 6174 655f 746f  lf.__generate_to
-0000e4a0: 7470 5f75 726c 2861 6363 6f75 6e74 5f6e  tp_url(account_n
-0000e4b0: 616d 653d 6461 7461 5b22 6163 636f 756e  ame=data["accoun
-0000e4c0: 745f 6e61 6d65 225d 2069 6620 6163 636f  t_name"] if acco
-0000e4d0: 756e 745f 6e61 6d65 2069 7320 4e6f 6e65  unt_name is None
-0000e4e0: 2065 6c73 6520 6163 636f 756e 745f 6e61   else account_na
-0000e4f0: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
-0000e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e520: 2020 2020 2069 7373 7565 723d 6461 7461       issuer=data
-0000e530: 5b22 6973 7375 6572 225d 2069 6620 6973  ["issuer"] if is
-0000e540: 7375 6572 2069 7320 4e6f 6e65 2065 6c73  suer is None els
-0000e550: 6520 6973 7375 6572 2c0d 0a20 2020 2020  e issuer,..     
-0000e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e580: 2020 2020 2020 2020 2020 2061 6c67 6f72             algor
-0000e590: 6974 686d 3d64 6174 615b 2261 6c67 6f72  ithm=data["algor
-0000e5a0: 6974 686d 225d 2069 6620 616c 676f 7269  ithm"] if algori
-0000e5b0: 7468 6d20 6973 204e 6f6e 6520 656c 7365  thm is None else
-0000e5c0: 2061 6c67 6f72 6974 686d 2c0d 0a20 2020   algorithm,..   
-0000e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5f0: 2020 2020 2020 2020 2020 2020 2064 6967               dig
-0000e600: 6974 733d 6461 7461 5b22 6469 6769 7473  its=data["digits
-0000e610: 225d 2069 6620 6469 6769 7473 2069 7320  "] if digits is 
-0000e620: 4e6f 6e65 2065 6c73 6520 6469 6769 7473  None else digits
-0000e630: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e660: 2020 2070 6572 696f 643d 6461 7461 5b22     period=data["
-0000e670: 7065 7269 6f64 225d 2069 6620 7065 7269  period"] if peri
-0000e680: 6f64 2069 7320 4e6f 6e65 2065 6c73 6520  od is None else 
-0000e690: 7065 7269 6f64 2c0d 0a20 2020 2020 2020  period,..       
-0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6c0: 2020 2020 2020 2020 2073 6563 7265 743d           secret=
-0000e6d0: 6b65 7929 0d0a 2020 2020 2020 2020 2020  key)..          
-0000e6e0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-0000e6f0: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-0000e700: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-0000e710: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-0000e720: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-0000e730: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-0000e740: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-0000e750: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-0000e760: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-0000e770: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
-0000e780: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
-0000e790: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-0000e7a0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-0000e7b0: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-0000e7c0: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-0000e7d0: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-0000e7e0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-0000e7f0: 3d20 7265 7175 6573 7473 2e70 6f73 7428  = requests.post(
-0000e800: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
-0000e810: 687d 2f6b 6579 732f 7b6e 616d 657d 222c  h}/keys/{name}",
-0000e820: 2068 6561 6465 7273 3d7b 2258 2d56 6175   headers={"X-Vau
-0000e830: 6c74 2d54 6f6b 656e 223a 2074 6f6b 656e  lt-Token": token
-0000e840: 7d2c 2064 6174 613d 6a73 6f6e 2e64 756d  }, data=json.dum
-0000e850: 7073 287b 2275 726c 223a 2074 6f74 705f  ps({"url": totp_
-0000e860: 7572 6c7d 2929 0d0a 2020 2020 2020 2020  url}))..        
-0000e870: 2020 2020 6966 2072 6573 2e73 7461 7475      if res.statu
-0000e880: 735f 636f 6465 203d 3d20 3230 3020 6f72  s_code == 200 or
-0000e890: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-0000e8a0: 203d 3d20 3230 343a 0d0a 2020 2020 2020   == 204:..      
-0000e8b0: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
-0000e8c0: 7572 6e5f 7365 6372 6574 5f6b 6579 3a0d  urn_secret_key:.
-0000e8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e8e0: 2020 2020 2072 6574 7572 6e20 6b65 790d       return key.
-0000e8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e900: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000e910: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e920: 726e 2054 7275 650d 0a20 2020 2020 2020  rn True..       
-0000e930: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0000e940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e950: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
-0000e960: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
-0000e970: 5f6e 616d 655f 5f2c 2072 6573 2c20 2275  _name__, res, "u
-0000e980: 7064 6174 6520 6b65 7920 6572 726f 7222  pdate key error"
-0000e990: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000e9a0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-0000e9b0: 0a0d 0a20 2020 2064 6566 2072 6561 645f  ...    def read_
-0000e9c0: 6b65 7928 7365 6c66 2c20 6d6f 756e 745f  key(self, mount_
-0000e9d0: 7061 7468 3a20 7374 722c 206e 616d 653a  path: str, name:
-0000e9e0: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
-0000e9f0: 2222 2271 7565 7269 6573 2074 6865 206b  """queries the k
-0000ea00: 6579 2064 6566 696e 6974 696f 6e20 696e  ey definition in
-0000ea10: 2022 6d6f 756e 7420 7061 7468 2f22 0d0a   "mount path/"..
-0000ea20: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
-0000ea30: 0a20 2020 2020 2020 2020 2020 206d 6f75  .            mou
-0000ea40: 6e74 5f70 6174 6820 2873 7472 290d 0a20  nt_path (str).. 
-0000ea50: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-0000ea60: 2873 7472 290d 0a0d 0a20 2020 2020 2020  (str)....       
-0000ea70: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
-0000ea80: 2020 2020 2020 2064 6963 7420 6f72 204e         dict or N
-0000ea90: 6f6e 653a 2072 6574 7572 6e20 6120 6469  one: return a di
-0000eaa0: 6374 2069 6620 7375 6363 6573 732c 206f  ct if success, o
-0000eab0: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
-0000eac0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2222  None..        ""
-0000ead0: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
-0000eae0: 6c66 2e69 735f 6175 7468 3a0d 0a20 2020  lf.is_auth:..   
-0000eaf0: 2020 2020 2020 2020 2065 7869 7374 5f6b           exist_k
-0000eb00: 6579 7320 3d20 7365 6c66 2e6c 6973 745f  eys = self.list_
-0000eb10: 6b65 7928 6d6f 756e 745f 7061 7468 290d  key(mount_path).
-0000eb20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000eb30: 6578 6973 745f 6b65 7973 2069 7320 4e6f  exist_keys is No
-0000eb40: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0000eb50: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-0000eb60: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
-0000eb70: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-0000eb80: 7265 6164 206b 6579 2065 7272 6f72 3a20  read key error: 
-0000eb90: 6b65 7920 277b 6e61 6d65 7d27 206e 6f74  key '{name}' not
-0000eba0: 2066 6f75 6e64 2229 0d0a 2020 2020 2020   found")..      
-0000ebb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000ebc0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0000ebd0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0000ebe0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-0000ebf0: 6520 6e6f 7420 696e 2065 7869 7374 5f6b  e not in exist_k
-0000ec00: 6579 733a 0d0a 2020 2020 2020 2020 2020  eys:..          
-0000ec10: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000ec20: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
-0000ec30: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0000ec40: 5f7d 202d 2072 6561 6420 6b65 7920 6572  _} - read key er
-0000ec50: 726f 723a 206b 6579 2027 7b6e 616d 657d  ror: key '{name}
-0000ec60: 2720 6e6f 7420 666f 756e 6422 290d 0a20  ' not found").. 
-0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec80: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eca0: 0d0a 2020 2020 2020 2020 2020 2020 7572  ..            ur
-0000ecb0: 6c20 3d20 6165 735f 6465 6372 7970 745f  l = aes_decrypt_
-0000ecc0: 7465 7874 2873 656c 662e 7572 6c2c 206b  text(self.url, k
-0000ecd0: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
-0000ece0: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
-0000ecf0: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
-0000ed00: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
-0000ed10: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
-0000ed20: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
-0000ed30: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
-0000ed40: 7874 2873 656c 662e 746f 6b65 6e2c 206b  xt(self.token, k
-0000ed50: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
-0000ed60: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
-0000ed70: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
-0000ed80: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
-0000ed90: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
-0000eda0: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
-0000edb0: 7265 7175 6573 7473 2e67 6574 2875 726c  requests.get(url
-0000edc0: 2b66 227b 6d6f 756e 745f 7061 7468 7d2f  +f"{mount_path}/
-0000edd0: 6b65 7973 2f7b 6e61 6d65 7d22 2c20 6865  keys/{name}", he
-0000ede0: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
-0000edf0: 546f 6b65 6e22 3a20 746f 6b65 6e7d 290d  Token": token}).
-0000ee00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000ee10: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-0000ee20: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
-0000ee30: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
-0000ee40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000ee50: 2020 2072 6574 7572 6e20 7265 732e 6a73     return res.js
-0000ee60: 6f6e 2829 5b22 6461 7461 225d 0d0a 2020  on()["data"]..  
-0000ee70: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000ee80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ee90: 2073 656c 662e 5f6c 6f67 5f65 7272 6f72   self._log_error
-0000eea0: 5f72 6573 706f 6e73 6528 5f5f 636c 6173  _response(__clas
-0000eeb0: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265  s__.__name__, re
-0000eec0: 732c 2022 7265 6164 206b 6579 2065 7272  s, "read key err
-0000eed0: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
-0000eee0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0000eef0: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
-0000ef00: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000ef10: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6c69  ......    def li
-0000ef20: 7374 5f6b 6579 2873 656c 662c 206d 6f75  st_key(self, mou
-0000ef30: 6e74 5f70 6174 683a 2073 7472 293a 0d0a  nt_path: str):..
-0000ef40: 2020 2020 2020 2020 2222 226c 6973 7420          """list 
-0000ef50: 6b65 7973 2069 6e20 226d 6f75 6e74 2070  keys in "mount p
-0000ef60: 6174 682f 220d 0a0d 0a20 2020 2020 2020  ath/"....       
-0000ef70: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-0000ef80: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-0000ef90: 7374 7229 0d0a 0d0a 2020 2020 2020 2020  str)....        
-0000efa0: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
-0000efb0: 2020 2020 2020 6c69 7374 206f 7220 4e6f        list or No
-0000efc0: 6e65 3a20 7265 7475 726e 2061 206c 6973  ne: return a lis
-0000efd0: 7420 6f66 2061 7661 696c 6162 6c65 206b  t of available k
-0000efe0: 6579 7320 6966 2073 7563 6365 7373 2c20  eys if success, 
-0000eff0: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
-0000f000: 204e 6f6e 650d 0a20 2020 2020 2020 2022   None..        "
-0000f010: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
-0000f020: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
-0000f030: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-0000f040: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
-0000f050: 2873 656c 662e 7572 6c2c 206b 6579 3d72  (self.url, key=r
-0000f060: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-0000f070: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-0000f080: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-0000f090: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-0000f0a0: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-0000f0b0: 2020 2020 2020 746f 6b65 6e20 3d20 6165        token = ae
-0000f0c0: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-0000f0d0: 656c 662e 746f 6b65 6e2c 206b 6579 3d72  elf.token, key=r
-0000f0e0: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-0000f0f0: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-0000f100: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-0000f110: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-0000f120: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-0000f130: 2020 2020 2020 7265 7320 3d20 7265 7175        res = requ
-0000f140: 6573 7473 2e67 6574 2875 726c 2b66 227b  ests.get(url+f"{
-0000f150: 6d6f 756e 745f 7061 7468 7d2f 6b65 7973  mount_path}/keys
-0000f160: 3f6c 6973 743d 7472 7565 222c 2068 6561  ?list=true", hea
-0000f170: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
-0000f180: 6f6b 656e 223a 2074 6f6b 656e 7d29 0d0a  oken": token})..
-0000f190: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0000f1a0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-0000f1b0: 3d20 3230 3020 6f72 2072 6573 2e73 7461  = 200 or res.sta
-0000f1c0: 7475 735f 636f 6465 203d 3d20 3230 343a  tus_code == 204:
-0000f1d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f1e0: 2020 7265 7475 726e 2072 6573 2e6a 736f    return res.jso
-0000f1f0: 6e28 295b 2264 6174 6122 5d5b 226b 6579  n()["data"]["key
-0000f200: 7322 5d0d 0a20 2020 2020 2020 2020 2020  s"]..           
-0000f210: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000f220: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-0000f230: 675f 6572 726f 725f 7265 7370 6f6e 7365  g_error_response
-0000f240: 285f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  (__class__.__nam
-0000f250: 655f 5f2c 2072 6573 2c20 226c 6973 7420  e__, res, "list 
-0000f260: 6b65 7920 6572 726f 7222 290d 0a20 2020  key error")..   
-0000f270: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000f280: 7572 6e20 4e6f 6e65 0d0a 0d0a 2020 2020  urn None....    
-0000f290: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-0000f2a0: 0a20 2020 200d 0a20 2020 2064 6566 2064  .    ..    def d
-0000f2b0: 656c 6574 655f 6b65 7928 7365 6c66 2c20  elete_key(self, 
-0000f2c0: 6d6f 756e 745f 7061 7468 3a20 7374 722c  mount_path: str,
-0000f2d0: 206e 616d 653a 2073 7472 293a 0d0a 2020   name: str):..  
-0000f2e0: 2020 2020 2020 2222 2264 656c 6574 6520        """delete 
-0000f2f0: 6120 6b65 7920 6672 6f6d 2022 6d6f 756e  a key from "moun
-0000f300: 7420 7061 7468 2f22 0d0a 0d0a 2020 2020  t path/"....    
-0000f310: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-0000f320: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
-0000f330: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
-0000f340: 2020 2020 206e 616d 6520 2873 7472 290d       name (str).
-0000f350: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0000f360: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-0000f370: 2062 6f6f 6c3a 2072 6574 7572 6e20 5472   bool: return Tr
-0000f380: 7565 2069 6620 7375 6363 6573 732c 206f  ue if success, o
-0000f390: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
-0000f3a0: 4661 6c73 650d 0a20 2020 2020 2020 2022  False..        "
-0000f3b0: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
-0000f3c0: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
-0000f3d0: 2020 2020 2020 2020 2020 6578 6973 745f            exist_
-0000f3e0: 6b65 7973 203d 2073 656c 662e 6c69 7374  keys = self.list
-0000f3f0: 5f6b 6579 286d 6f75 6e74 5f70 6174 6829  _key(mount_path)
-0000f400: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000f410: 2065 7869 7374 5f6b 6579 7320 6973 204e   exist_keys is N
-0000f420: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0000f430: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-0000f440: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-0000f450: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-0000f460: 2064 656c 6574 6520 6b65 7920 6572 726f   delete key erro
-0000f470: 723a 206b 6579 2027 7b6e 616d 657d 2720  r: key '{name}' 
-0000f480: 6e6f 7420 666f 756e 6422 290d 0a20 2020  not found")..   
-0000f490: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000f4a0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-0000f4b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000f4c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000f4d0: 206e 616d 6520 6e6f 7420 696e 2065 7869   name not in exi
-0000f4e0: 7374 5f6b 6579 733a 0d0a 2020 2020 2020  st_keys:..      
-0000f4f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000f500: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-0000f510: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-0000f520: 616d 655f 5f7d 202d 2064 656c 6574 6520  ame__} - delete 
-0000f530: 6b65 7920 6572 726f 723a 206b 6579 2027  key error: key '
-0000f540: 7b6e 616d 657d 2720 6e6f 7420 666f 756e  {name}' not foun
-0000f550: 6422 290d 0a20 2020 2020 2020 2020 2020  d")..           
-0000f560: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000f570: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-0000f580: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000f590: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
-0000f5a0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-0000f5b0: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
-0000f5c0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
-0000f5d0: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
-0000f5e0: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
-0000f5f0: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
-0000f600: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
-0000f610: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
-0000f620: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
-0000f630: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
-0000f640: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
-0000f650: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
-0000f660: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
-0000f670: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
-0000f680: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
-0000f690: 2072 6573 203d 2072 6571 7565 7374 732e   res = requests.
-0000f6a0: 6465 6c65 7465 2875 726c 2b66 227b 6d6f  delete(url+f"{mo
-0000f6b0: 756e 745f 7061 7468 7d2f 6b65 7973 2f7b  unt_path}/keys/{
-0000f6c0: 6e61 6d65 7d22 2c20 6865 6164 6572 733d  name}", headers=
-0000f6d0: 7b22 582d 5661 756c 742d 546f 6b65 6e22  {"X-Vault-Token"
-0000f6e0: 3a20 746f 6b65 6e7d 290d 0a20 2020 2020  : token})..     
-0000f6f0: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
-0000f700: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
-0000f710: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
-0000f720: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
-0000f730: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000f740: 7572 6e20 5472 7565 0d0a 2020 2020 2020  urn True..      
-0000f750: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000f760: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f770: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
-0000f780: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
-0000f790: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
-0000f7a0: 6465 6c65 7465 206b 6579 2065 7272 6f72  delete key error
-0000f7b0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0000f7c0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0000f7d0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-0000f7e0: 726e 2046 616c 7365 0d0a 2020 2020 0d0a  rn False..    ..
-0000f7f0: 2020 2020 6465 6620 6765 6e65 7261 7465      def generate
-0000f800: 5f63 6f64 6528 7365 6c66 2c20 6d6f 756e  _code(self, moun
-0000f810: 745f 7061 7468 3a20 7374 722c 206e 616d  t_path: str, nam
-0000f820: 653a 2073 7472 293a 0d0a 2020 2020 2020  e: str):..      
-0000f830: 2020 2222 2267 656e 6572 6174 6520 6120    """generate a 
-0000f840: 6e65 7720 7469 6d65 2d62 6173 6564 206f  new time-based o
-0000f850: 6e65 2d74 696d 6520 7573 6520 7061 7373  ne-time use pass
-0000f860: 776f 7264 2062 6173 6564 206f 6e20 7468  word based on th
-0000f870: 6520 6e61 6d65 6420 6b65 790d 0a0d 0a20  e named key.... 
-0000f880: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-0000f890: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
-0000f8a0: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
-0000f8b0: 2020 2020 2020 2020 6e61 6d65 2028 7374          name (st
-0000f8c0: 7229 0d0a 0d0a 2020 2020 2020 2020 5265  r)....        Re
-0000f8d0: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-0000f8e0: 2020 2020 7374 723a 2072 6574 7572 6e20      str: return 
-0000f8f0: 7468 6520 6765 6e65 7261 7465 6420 636f  the generated co
-0000f900: 6465 2069 6620 7375 6363 6573 732c 206f  de if success, o
-0000f910: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
-0000f920: 4e6f 6e65 0d0a 2020 2020 2020 2020 2222  None..        ""
-0000f930: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
-0000f940: 6c66 2e69 735f 6175 7468 3a0d 0a20 2020  lf.is_auth:..   
-0000f950: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-0000f960: 7365 6c66 2e72 6561 645f 6b65 7928 6d6f  self.read_key(mo
-0000f970: 756e 745f 7061 7468 2c20 6e61 6d65 290d  unt_path, name).
-0000f980: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000f990: 6461 7461 2069 7320 4e6f 6e65 3a0d 0a20  data is None:.. 
-0000f9a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f9b0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-0000f9c0: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-0000f9d0: 6e61 6d65 5f5f 7d20 2d20 6765 6e65 7261  name__} - genera
-0000f9e0: 7465 2063 6f64 6520 6572 726f 723a 206b  te code error: k
-0000f9f0: 6579 2027 7b6e 616d 657d 2720 6e6f 7420  ey '{name}' not 
-0000fa00: 666f 756e 6422 290d 0a20 2020 2020 2020  found")..       
-0000fa10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000fa20: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-0000fa30: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-0000fa40: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-0000fa50: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-0000fa60: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-0000fa70: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-0000fa80: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-0000fa90: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-0000faa0: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-0000fab0: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-0000fac0: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
-0000fad0: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
-0000fae0: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-0000faf0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-0000fb00: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-0000fb10: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-0000fb20: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-0000fb30: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-0000fb40: 3d20 7265 7175 6573 7473 2e67 6574 2875  = requests.get(u
-0000fb50: 726c 2b66 227b 6d6f 756e 745f 7061 7468  rl+f"{mount_path
-0000fb60: 7d2f 636f 6465 2f7b 6e61 6d65 7d22 2c20  }/code/{name}", 
-0000fb70: 6865 6164 6572 733d 7b22 582d 5661 756c  headers={"X-Vaul
-0000fb80: 742d 546f 6b65 6e22 3a20 746f 6b65 6e7d  t-Token": token}
-0000fb90: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0000fba0: 6620 7265 732e 7374 6174 7573 5f63 6f64  f res.status_cod
-0000fbb0: 6520 3d3d 2032 3030 206f 7220 7265 732e  e == 200 or res.
-0000fbc0: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
-0000fbd0: 3034 3a0d 0a20 2020 2020 2020 2020 2020  04:..           
-0000fbe0: 2020 2020 2072 6574 7572 6e20 7265 732e       return res.
-0000fbf0: 6a73 6f6e 2829 5b22 6461 7461 225d 5b22  json()["data"]["
-0000fc00: 636f 6465 225d 0d0a 2020 2020 2020 2020  code"]..        
-0000fc10: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000fc20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000fc30: 5f6c 6f67 5f65 7272 6f72 5f72 6573 706f  _log_error_respo
-0000fc40: 6e73 6528 5f5f 636c 6173 735f 5f2e 5f5f  nse(__class__.__
-0000fc50: 6e61 6d65 5f5f 2c20 7265 732c 2022 6765  name__, res, "ge
-0000fc60: 6e65 7261 7465 2063 6f64 6520 6572 726f  nerate code erro
-0000fc70: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
-0000fc80: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000fc90: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0000fca0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-0000fcb0: 0a20 2020 200d 0a20 2020 2064 6566 2076  .    ..    def v
-0000fcc0: 616c 6964 6174 655f 636f 6465 2873 656c  alidate_code(sel
-0000fcd0: 662c 206d 6f75 6e74 5f70 6174 683a 2073  f, mount_path: s
-0000fce0: 7472 2c20 6e61 6d65 3a20 7374 722c 2063  tr, name: str, c
-0000fcf0: 6f64 653a 2073 7472 293a 0d0a 2020 2020  ode: str):..    
-0000fd00: 2020 2020 2222 2276 616c 6964 6174 6520      """validate 
-0000fd10: 6120 636f 6465 0d0a 0d0a 2020 2020 2020  a code....      
-0000fd20: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-0000fd30: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
-0000fd40: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
-0000fd50: 2020 206e 616d 6520 2873 7472 290d 0a20     name (str).. 
-0000fd60: 2020 2020 2020 2020 2020 2063 6f64 6520             code 
-0000fd70: 2873 7472 290d 0a0d 0a20 2020 2020 2020  (str)....       
-0000fd80: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
-0000fd90: 2020 2020 2020 2062 6f6f 6c3a 2072 6574         bool: ret
-0000fda0: 7572 6e20 5472 7565 2069 6620 7468 6520  urn True if the 
-0000fdb0: 636f 6465 206d 6174 6368 6564 2c20 6f74  code matched, ot
-0000fdc0: 6865 7277 6973 6520 7265 7475 726e 2046  herwise return F
-0000fdd0: 616c 7365 0d0a 2020 2020 2020 2020 2222  alse..        ""
-0000fde0: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
-0000fdf0: 6c66 2e69 735f 6175 7468 3a0d 0a20 2020  lf.is_auth:..   
-0000fe00: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-0000fe10: 7365 6c66 2e72 6561 645f 6b65 7928 6d6f  self.read_key(mo
-0000fe20: 756e 745f 7061 7468 2c20 6e61 6d65 290d  unt_path, name).
-0000fe30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000fe40: 6461 7461 2069 7320 4e6f 6e65 3a0d 0a20  data is None:.. 
-0000fe50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000fe60: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-0000fe70: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-0000fe80: 6e61 6d65 5f5f 7d20 2d20 7661 6c69 6461  name__} - valida
-0000fe90: 7465 2063 6f64 6520 6572 726f 723a 206b  te code error: k
-0000fea0: 6579 2027 7b6e 616d 657d 2720 6e6f 7420  ey '{name}' not 
-0000feb0: 666f 756e 6422 290d 0a20 2020 2020 2020  found")..       
-0000fec0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000fed0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-0000fee0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-0000fef0: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-0000ff00: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-0000ff10: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-0000ff20: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-0000ff30: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-0000ff40: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-0000ff50: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-0000ff60: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-0000ff70: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
-0000ff80: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
-0000ff90: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-0000ffa0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-0000ffb0: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-0000ffc0: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-0000ffd0: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-0000ffe0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-0000fff0: 3d20 7265 7175 6573 7473 2e70 6f73 7428  = requests.post(
-00010000: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
-00010010: 687d 2f63 6f64 652f 7b6e 616d 657d 222c  h}/code/{name}",
-00010020: 2068 6561 6465 7273 3d7b 2258 2d56 6175   headers={"X-Vau
-00010030: 6c74 2d54 6f6b 656e 223a 2074 6f6b 656e  lt-Token": token
-00010040: 7d2c 2064 6174 613d 6a73 6f6e 2e64 756d  }, data=json.dum
-00010050: 7073 287b 2263 6f64 6522 3a20 636f 6465  ps({"code": code
-00010060: 7d29 290d 0a20 2020 2020 2020 2020 2020  }))..           
-00010070: 2069 6620 7265 732e 7374 6174 7573 5f63   if res.status_c
-00010080: 6f64 6520 3d3d 2032 3030 206f 7220 7265  ode == 200 or re
-00010090: 732e 7374 6174 7573 5f63 6f64 6520 3d3d  s.status_code ==
-000100a0: 2032 3034 3a0d 0a20 2020 2020 2020 2020   204:..         
-000100b0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000100c0: 732e 6a73 6f6e 2829 5b22 6461 7461 225d  s.json()["data"]
-000100d0: 5b22 7661 6c69 6422 5d0d 0a20 2020 2020  ["valid"]..     
-000100e0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000100f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010100: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
-00010110: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
-00010120: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
-00010130: 2276 616c 6964 6174 6520 636f 6465 2065  "validate code e
-00010140: 7272 6f72 2229 0d0a 2020 2020 2020 2020  rror")..        
-00010150: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00010160: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
-00010170: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00010180: 2020 0d0a 2020 2020 4073 7461 7469 636d    ..    @staticm
-00010190: 6574 686f 640d 0a20 2020 2064 6566 205f  ethod..    def _
-000101a0: 5f70 6172 7365 5f74 6f74 705f 7572 6c28  _parse_totp_url(
-000101b0: 7572 6c3a 2073 7472 2c20 7469 746c 653a  url: str, title:
-000101c0: 2073 7472 203d 2022 6f74 7061 7574 683a   str = "otpauth:
-000101d0: 2f2f 746f 7470 2f22 293a 0d0a 2020 2020  //totp/"):..    
-000101e0: 2020 2020 7572 6c20 3d20 7572 6c2e 7265      url = url.re
-000101f0: 706c 6163 6528 7469 746c 652c 2022 2229  place(title, "")
-00010200: 0d0a 2020 2020 2020 2020 6973 7375 6572  ..        issuer
-00010210: 203d 2075 726c 2e73 706c 6974 2822 3a22   = url.split(":"
-00010220: 295b 305d 0d0a 2020 2020 2020 2020 6163  )[0]..        ac
-00010230: 636f 756e 745f 6e61 6d65 203d 2075 726c  count_name = url
-00010240: 2e73 706c 6974 2822 3a22 295b 315d 2e73  .split(":")[1].s
-00010250: 706c 6974 2822 3f22 295b 305d 0d0a 2020  plit("?")[0]..  
-00010260: 2020 2020 2020 7061 7261 6d73 203d 2075        params = u
-00010270: 726c 2e73 706c 6974 2822 3a22 295b 315d  rl.split(":")[1]
-00010280: 2e73 706c 6974 2822 3f22 295b 315d 2e73  .split("?")[1].s
-00010290: 706c 6974 2822 2622 290d 0a20 2020 2020  plit("&")..     
-000102a0: 2020 2070 6172 616d 735f 6469 6374 203d     params_dict =
-000102b0: 207b 7d0d 0a20 2020 2020 2020 2066 6f72   {}..        for
-000102c0: 2070 6172 616d 2069 6e20 7061 7261 6d73   param in params
-000102d0: 3a0d 0a20 2020 2020 2020 2020 2020 206b  :..            k
-000102e0: 6579 2c20 7661 6c75 6520 3d20 7061 7261  ey, value = para
-000102f0: 6d2e 7370 6c69 7428 223d 2229 0d0a 2020  m.split("=")..  
-00010300: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-00010310: 5f64 6963 745b 6b65 795d 203d 2076 616c  _dict[key] = val
-00010320: 7565 0d0a 2020 2020 2020 2020 7265 7475  ue..        retu
-00010330: 726e 2069 7373 7565 722c 2061 6363 6f75  rn issuer, accou
-00010340: 6e74 5f6e 616d 652c 2070 6172 616d 735f  nt_name, params_
-00010350: 6469 6374 0d0a 2020 2020 0d0a 2020 2020  dict..    ..    
-00010360: 6465 6620 5f5f 6765 6e65 7261 7465 5f74  def __generate_t
-00010370: 6f74 705f 7572 6c28 7365 6c66 2c0d 0a20  otp_url(self,.. 
-00010380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010390: 2020 2020 2020 2020 2020 2061 6363 6f75             accou
-000103a0: 6e74 5f6e 616d 653a 2073 7472 2c20 0d0a  nt_name: str, ..
-000103b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103c0: 2020 2020 2020 2020 2020 2020 6973 7375              issu
-000103d0: 6572 3a20 7374 722c 200d 0a20 2020 2020  er: str, ..     
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103f0: 2020 2020 2020 2061 6c67 6f72 6974 686d         algorithm
-00010400: 3a20 7374 722c 0d0a 2020 2020 2020 2020  : str,..        
-00010410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010420: 2020 2020 6469 6769 7473 3a20 696e 742c      digits: int,
-00010430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010440: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-00010450: 7269 6f64 3a20 696e 742c 0d0a 2020 2020  riod: int,..    
-00010460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010470: 2020 2020 2020 2020 7365 6372 6574 3a20          secret: 
-00010480: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
-00010490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104a0: 2020 7469 746c 653d 226f 7470 6175 7468    title="otpauth
-000104b0: 3a2f 2f74 6f74 702f 2229 3a0d 0a20 2020  ://totp/"):..   
-000104c0: 2020 2020 2069 6620 6e6f 7420 6973 5f73       if not is_s
-000104d0: 7472 2861 6363 6f75 6e74 5f6e 616d 6529  tr(account_name)
-000104e0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-000104f0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-00010500: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-00010510: 6e61 6d65 5f5f 7d20 2d20 6765 6e65 7261  name__} - genera
-00010520: 7465 2074 6f74 7020 7572 6c20 6572 726f  te totp url erro
-00010530: 723a 2061 6363 6f75 6e74 5f6e 616d 6520  r: account_name 
-00010540: 6d75 7374 2062 6520 6120 7374 7269 6e67  must be a string
-00010550: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00010560: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-00010570: 2020 2020 2069 6620 6e6f 7420 6973 5f73       if not is_s
-00010580: 7472 2869 7373 7565 7229 3a0d 0a20 2020  tr(issuer):..   
-00010590: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-000105a0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
-000105b0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-000105c0: 7d20 2d20 6765 6e65 7261 7465 2074 6f74  } - generate tot
-000105d0: 7020 7572 6c20 6572 726f 723a 2069 7373  p url error: iss
-000105e0: 7565 7220 6d75 7374 2062 6520 6120 7374  uer must be a st
-000105f0: 7269 6e67 2229 0d0a 2020 2020 2020 2020  ring")..        
-00010600: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-00010610: 0a20 2020 2020 2020 2069 6620 616c 676f  .        if algo
-00010620: 7269 7468 6d20 6e6f 7420 696e 205b 2253  rithm not in ["S
-00010630: 4841 3122 2c20 2253 4841 3235 3622 2c20  HA1", "SHA256", 
-00010640: 2253 4841 3531 3222 5d3a 0d0a 2020 2020  "SHA512"]:..    
-00010650: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00010660: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-00010670: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00010680: 202d 2067 656e 6572 6174 6520 746f 7470   - generate totp
-00010690: 2075 726c 2065 7272 6f72 3a20 616c 676f   url error: algo
-000106a0: 7269 7468 6d20 6d75 7374 2062 6520 6f6e  rithm must be on
-000106b0: 6520 6f66 2022 0d0a 2020 2020 2020 2020  e of "..        
-000106c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000106d0: 2020 2020 2020 6622 2753 4841 3127 2c20        f"'SHA1', 
-000106e0: 2753 4841 3235 3627 206f 7220 2753 4841  'SHA256' or 'SHA
-000106f0: 3531 3227 2229 0d0a 2020 2020 2020 2020  512'")..        
-00010700: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-00010710: 0a20 2020 2020 2020 2069 6620 6469 6769  .        if digi
-00010720: 7473 206e 6f74 2069 6e20 5b36 2c20 385d  ts not in [6, 8]
-00010730: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00010740: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-00010750: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-00010760: 6e61 6d65 5f5f 7d20 2d20 6765 6e65 7261  name__} - genera
-00010770: 7465 2074 6f74 7020 7572 6c20 6572 726f  te totp url erro
-00010780: 723a 2064 6967 6974 7320 6d75 7374 2062  r: digits must b
-00010790: 6520 6f6e 6520 6f66 2036 206f 7220 3822  e one of 6 or 8"
-000107a0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-000107b0: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-000107c0: 2020 2020 6966 206e 6f74 2069 735f 696e      if not is_in
-000107d0: 7428 7065 7269 6f64 293a 0d0a 2020 2020  t(period):..    
-000107e0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-000107f0: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-00010800: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00010810: 202d 2067 656e 6572 6174 6520 746f 7470   - generate totp
-00010820: 2075 726c 2065 7272 6f72 3a20 7065 7269   url error: peri
-00010830: 6f64 206d 7573 7420 6265 2061 6e20 696e  od must be an in
-00010840: 7422 290d 0a20 2020 2020 2020 2020 2020  t")..           
-00010850: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-00010860: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00010870: 7572 6c20 3d20 6622 7b74 6974 6c65 7d7b  url = f"{title}{
-00010880: 6973 7375 6572 7d3a 7b61 6363 6f75 6e74  issuer}:{account
-00010890: 5f6e 616d 657d 3f61 6c67 6f72 6974 686d  _name}?algorithm
-000108a0: 3d7b 616c 676f 7269 7468 6d7d 2664 6967  ={algorithm}&dig
-000108b0: 6974 733d 7b64 6967 6974 737d 2669 7373  its={digits}&iss
-000108c0: 7565 723d 7b69 7373 7565 727d 2220 5c0d  uer={issuer}" \.
-000108d0: 0a20 2020 2020 2020 2020 2020 2020 2066  .              f
-000108e0: 2226 7065 7269 6f64 3d7b 7065 7269 6f64  "&period={period
-000108f0: 7d26 7365 6372 6574 3d7b 7365 6372 6574  }&secret={secret
-00010900: 7d22 0d0a 0d0a 2020 2020 2020 2020 7265  }"....        re
-00010910: 7475 726e 2075 726c 0d0a 2020 2020 0d0a  turn url..    ..
-00010920: 0d0a 2320 544f 444f 3a20 696d 706c 656d  ..# TODO: implem
-00010930: 656e 7420 696e 2074 6865 2066 7574 7572  ent in the futur
-00010940: 650d 0a63 6c61 7373 2056 6175 6c74 5365  e..class VaultSe
-00010950: 6372 6574 456e 6769 6e65 5472 616e 7369  cretEngineTransi
-00010960: 7428 5f56 6175 6c74 4854 5450 4150 4929  t(_VaultHTTPAPI)
-00010970: 3a0d 0a20 2020 2022 2222 5472 616e 7369  :..    """Transi
-00010980: 7420 5365 6372 6574 2045 6e67 696e 650d  t Secret Engine.
-00010990: 0a0d 0a20 2020 2057 6520 6861 7665 2069  ...    We have i
-000109a0: 676e 6f72 6564 2074 6865 2065 6e74 6572  gnored the enter
-000109b0: 7072 6973 6520 6f6e 6c79 206b 6579 2074  prise only key t
-000109c0: 7970 6520 226d 616e 6167 6564 5f6b 6579  ype "managed_key
-000109d0: 222e 0d0a 2020 2020 5265 6665 7220 746f  "...    Refer to
-000109e0: 2068 7474 7073 3a2f 2f64 6576 656c 6f70   https://develop
-000109f0: 6572 2e68 6173 6869 636f 7270 2e63 6f6d  er.hashicorp.com
-00010a00: 2f76 6175 6c74 2f61 7069 2d64 6f63 732f  /vault/api-docs/
-00010a10: 7365 6372 6574 2f74 7261 6e73 6974 2066  secret/transit f
-00010a20: 6f72 206d 6f72 6520 6465 7461 696c 732e  or more details.
-00010a30: 0d0a 0d0a 2020 2020 496e 6974 3a0d 0a20  ....    Init:.. 
-00010a40: 2020 2020 2020 2063 6f6e 6e65 6374 696e         connectin
-00010a50: 6720 7769 7468 2074 6f6b 656e 3a0d 0a20  g with token:.. 
-00010a60: 2020 2020 2020 203e 3e3e 2074 7261 6e73         >>> trans
-00010a70: 6974 5f65 6e67 696e 6520 3d20 5661 756c  it_engine = Vaul
-00010a80: 7453 6563 7265 7445 6e67 696e 6554 7261  tSecretEngineTra
-00010a90: 6e73 6974 280d 0a20 2020 2020 2020 203e  nsit(..        >
-00010aa0: 3e3e 2020 2020 2075 726c 3d22 6874 7470  >>     url="http
-00010ab0: 3a2f 2f31 3237 2e30 2e30 2e31 3a38 3230  ://127.0.0.1:820
-00010ac0: 3022 2c20 0d0a 2020 2020 2020 2020 3e3e  0", ..        >>
-00010ad0: 3e20 2020 2020 6175 7468 5f63 6667 3d64  >     auth_cfg=d
-00010ae0: 6963 7428 6d65 7468 6f64 3d22 746f 6b65  ict(method="toke
-00010af0: 6e22 2c20 746f 6b65 6e3d 2268 7673 2e53  n", token="hvs.S
-00010b00: 4d46 306e 4630 6e64 7432 645a 3364 5243  MF0nF0ndt2dZ3dRC
-00010b10: 6665 366f 4856 3622 290d 0a20 2020 2020  fe6oHV6")..     
-00010b20: 2020 203e 3e3e 2029 0d0a 0d0a 2020 2020     >>> )....    
-00010b30: 2020 2020 636f 6e6e 6563 7469 6e67 2077      connecting w
-00010b40: 6974 6820 7573 6572 6e61 6d65 2026 2070  ith username & p
-00010b50: 6173 7377 6f72 643a 0d0a 2020 2020 2020  assword:..      
-00010b60: 2020 3e3e 3e20 7472 616e 7369 745f 656e    >>> transit_en
-00010b70: 6769 6e65 203d 2056 6175 6c74 5365 6372  gine = VaultSecr
-00010b80: 6574 456e 6769 6e65 5472 616e 7369 7428  etEngineTransit(
-00010b90: 0d0a 2020 2020 2020 2020 3e3e 3e20 2020  ..        >>>   
-00010ba0: 2020 7572 6c3d 2268 7474 703a 2f2f 3132    url="http://12
-00010bb0: 372e 302e 302e 313a 3832 3030 222c 0d0a  7.0.0.1:8200",..
-00010bc0: 2020 2020 2020 2020 3e3e 3e20 2020 2020          >>>     
-00010bd0: 6175 7468 5f63 6667 3d64 6963 7428 6d65  auth_cfg=dict(me
-00010be0: 7468 6f64 3d22 7573 6572 7061 7373 222c  thod="userpass",
-00010bf0: 2075 7365 726e 616d 653d 2275 7365 726e   username="usern
-00010c00: 616d 6522 2c20 7061 7373 776f 7264 3d22  ame", password="
-00010c10: 7061 7373 776f 7264 2229 0d0a 2020 2020  password")..    
-00010c20: 2020 2020 3e3e 3e20 290d 0a20 2020 2022      >>> )..    "
-00010c30: 2222 0d0a 2020 2020 0d0a 2020 2020 4b45  ""..    ..    KE
-00010c40: 595f 5459 5045 5320 3d20 5b0d 0a20 2020  Y_TYPES = [..   
-00010c50: 2020 2020 2022 6165 7331 3238 2d67 636d       "aes128-gcm
-00010c60: 3936 222c 2020 2020 2020 2023 2041 4553  96",       # AES
-00010c70: 2d31 3238 2077 7261 7070 6564 2077 6974  -128 wrapped wit
-00010c80: 6820 4743 4d20 7573 696e 6720 6120 3936  h GCM using a 96
-00010c90: 2d62 6974 206e 6f6e 6365 2073 697a 6520  -bit nonce size 
-00010ca0: 4145 4144 200d 0a20 2020 2020 2020 2020  AEAD ..         
-00010cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cc0: 2020 2020 2023 2028 7379 6d6d 6574 7269       # (symmetri
-00010cd0: 632c 2073 7570 706f 7274 7320 6465 7269  c, supports deri
-00010ce0: 7661 7469 6f6e 2061 6e64 2063 6f6e 7665  vation and conve
-00010cf0: 7267 656e 7420 656e 6372 7970 7469 6f6e  rgent encryption
-00010d00: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00010d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d20: 200d 0a20 2020 2020 2020 2022 6165 7332   ..        "aes2
-00010d30: 3536 2d67 636d 3936 222c 2020 2020 2020  56-gcm96",      
-00010d40: 2023 2041 4553 2d32 3536 2077 7261 7070   # AES-256 wrapp
-00010d50: 6564 2077 6974 6820 4743 4d20 7573 696e  ed with GCM usin
-00010d60: 6720 6120 3936 2d62 6974 206e 6f6e 6365  g a 96-bit nonce
-00010d70: 2073 697a 6520 4145 4144 200d 0a20 2020   size AEAD ..   
-00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d90: 2020 2020 2020 2020 2020 2023 2028 7379             # (sy
-00010da0: 6d6d 6574 7269 632c 2073 7570 706f 7274  mmetric, support
-00010db0: 7320 6465 7269 7661 7469 6f6e 2061 6e64  s derivation and
-00010dc0: 2063 6f6e 7665 7267 656e 7420 656e 6372   convergent encr
-00010dd0: 7970 7469 6f6e 2c20 6465 6661 756c 7429  yption, default)
-00010de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e00: 0d0a 2020 2020 2020 2020 2263 6861 6368  ..        "chach
-00010e10: 6132 302d 706f 6c79 3133 3035 222c 2020  a20-poly1305",  
-00010e20: 2320 4368 6143 6861 3230 2d50 6f6c 7931  # ChaCha20-Poly1
-00010e30: 3330 3520 4145 4144 2028 7379 6d6d 6574  305 AEAD (symmet
-00010e40: 7269 632c 2073 7570 706f 7274 7320 6465  ric, supports de
-00010e50: 7269 7661 7469 6f6e 2061 6e64 2063 6f6e  rivation and con
-00010e60: 7665 7267 656e 7420 656e 6372 7970 7469  vergent encrypti
-00010e70: 6f6e 290d 0a20 2020 2020 2020 200d 0a20  on)..        .. 
-00010e80: 2020 2020 2020 2022 6564 3235 3531 3922         "ed25519"
-00010e90: 2c20 2020 2020 2020 2020 2020 2023 2045  ,            # E
-00010ea0: 4432 3535 3139 2028 6173 796d 6d65 7472  D25519 (asymmetr
-00010eb0: 6963 2c20 7375 7070 6f72 7473 2064 6572  ic, supports der
-00010ec0: 6976 6174 696f 6e29 2e20 5768 656e 2075  ivation). When u
-00010ed0: 7369 6e67 2064 6572 6976 6174 696f 6e2c  sing derivation,
-00010ee0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00010ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f00: 2023 2061 2073 6967 6e20 6f70 6572 6174   # a sign operat
-00010f10: 696f 6e20 7769 7468 2074 6865 2073 616d  ion with the sam
-00010f20: 6520 636f 6e74 6578 7420 7769 6c6c 2064  e context will d
-00010f30: 6572 6976 6520 7468 6520 7361 6d65 206b  erive the same k
-00010f40: 6579 2061 6e64 2073 6967 6e61 7475 7265  ey and signature
-00010f50: 3b20 0d0a 2020 2020 2020 2020 2020 2020  ; ..            
-00010f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f70: 2020 2320 7468 6973 2069 7320 6120 7369    # this is a si
-00010f80: 676e 696e 6720 616e 616c 6f67 7565 2074  gning analogue t
-00010f90: 6f20 636f 6e76 6572 6765 6e74 5f65 6e63  o convergent_enc
-00010fa0: 7279 7074 696f 6e0d 0a20 2020 2020 2020  ryption..       
-00010fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fc0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00010fd0: 2022 6563 6473 612d 7032 3536 222c 2020   "ecdsa-p256",  
-00010fe0: 2020 2020 2020 2023 2045 4344 5341 2075         # ECDSA u
-00010ff0: 7369 6e67 2074 6865 2050 2d32 3536 2065  sing the P-256 e
-00011000: 6c6c 6970 7469 6320 6375 7276 6520 2861  lliptic curve (a
-00011010: 7379 6d6d 6574 7269 6329 0d0a 2020 2020  symmetric)..    
-00011020: 2020 2020 2265 6364 7361 2d70 3338 3422      "ecdsa-p384"
-00011030: 2c20 2020 2020 2020 2020 2320 4543 4453  ,         # ECDS
-00011040: 4120 7573 696e 6720 7468 6520 502d 3338  A using the P-38
-00011050: 3420 656c 6c69 7074 6963 2063 7572 7665  4 elliptic curve
-00011060: 2028 6173 796d 6d65 7472 6963 290d 0a20   (asymmetric).. 
-00011070: 2020 2020 2020 2022 6563 6473 612d 7035         "ecdsa-p5
-00011080: 3231 222c 2020 2020 2020 2020 2023 2045  21",         # E
-00011090: 4344 5341 2075 7369 6e67 2074 6865 2050  CDSA using the P
-000110a0: 2d35 3231 2065 6c6c 6970 7469 6320 6375  -521 elliptic cu
-000110b0: 7276 6520 2861 7379 6d6d 6574 7269 6329  rve (asymmetric)
-000110c0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000110d0: 2020 2020 2272 7361 2d32 3034 3822 2c20      "rsa-2048", 
-000110e0: 2020 2020 2020 2020 2020 2320 5253 4120            # RSA 
-000110f0: 7769 7468 2062 6974 2073 697a 6520 6f66  with bit size of
-00011100: 2032 3034 3820 2861 7379 6d6d 6574 7269   2048 (asymmetri
-00011110: 6329 0d0a 2020 2020 2020 2020 2272 7361  c)..        "rsa
-00011120: 2d33 3037 3222 2c20 2020 2020 2020 2020  -3072",         
-00011130: 2020 2320 5253 4120 7769 7468 2062 6974    # RSA with bit
-00011140: 2073 697a 6520 6f66 2033 3037 3220 2861   size of 3072 (a
-00011150: 7379 6d6d 6574 7269 6329 0d0a 2020 2020  symmetric)..    
-00011160: 2020 2020 2272 7361 2d34 3039 3622 2c20      "rsa-4096", 
-00011170: 2020 2020 2020 2020 2020 2320 5253 4120            # RSA 
-00011180: 7769 7468 2062 6974 2073 697a 6520 6f66  with bit size of
-00011190: 2034 3039 3620 2861 7379 6d6d 6574 7269   4096 (asymmetri
-000111a0: 6329 0d0a 2020 2020 2020 2020 0d0a 2020  c)..        ..  
-000111b0: 2020 2020 2020 2268 6d61 6322 2020 2020        "hmac"    
-000111c0: 2020 2020 2020 2020 2020 2020 2320 484d              # HM
-000111d0: 4143 2028 484d 4143 2067 656e 6572 6174  AC (HMAC generat
-000111e0: 696f 6e2c 2076 6572 6966 6963 6174 696f  ion, verificatio
-000111f0: 6e29 0d0a 2020 2020 5d0d 0a20 2020 200d  n)..    ]..    .
-00011200: 0a20 2020 2023 2054 4f44 4f3a 2070 6172  .    # TODO: par
-00011210: 6974 616c 2074 6573 7465 642c 2077 6169  ital tested, wai
-00011220: 7420 666f 7220 7465 7374 696e 670d 0a20  t for testing.. 
-00011230: 2020 2064 6566 2063 7265 6174 655f 6b65     def create_ke
-00011240: 7928 7365 6c66 2c20 0d0a 2020 2020 2020  y(self, ..      
-00011250: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
-00011260: 6e74 5f70 6174 683a 2073 7472 2c20 0d0a  nt_path: str, ..
+0000d6a0: 2020 5f2c 205f 2c20 7061 7261 6d73 203d    _, _, params =
+0000d6b0: 2073 656c 662e 5f5f 7061 7273 655f 746f   self.__parse_to
+0000d6c0: 7470 5f75 726c 2875 726c 290d 0a20 2020  tp_url(url)..   
+0000d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6e0: 2020 2020 2073 6563 7265 7420 3d20 7061       secret = pa
+0000d6f0: 7261 6d73 5b22 7365 6372 6574 225d 0d0a  rams["secret"]..
+0000d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d710: 2020 2020 2020 2020 7265 7375 6c74 5b22          result["
+0000d720: 7365 6372 6574 225d 203d 2073 6563 7265  secret"] = secre
+0000d730: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+0000d740: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0000d750: 2020 2020 2071 725f 636f 6465 203d 2072       qr_code = r
+0000d760: 6573 706f 6e73 655f 6461 7461 2e67 6574  esponse_data.get
+0000d770: 2822 6261 7263 6f64 6522 2c20 4e6f 6e65  ("barcode", None
+0000d780: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000d790: 2020 2069 6620 7172 5f63 6f64 6520 6973     if qr_code is
+0000d7a0: 206e 6f74 204e 6f6e 6520 616e 6420 7172   not None and qr
+0000d7b0: 5f73 6176 655f 7061 7468 2069 7320 6e6f  _save_path is no
+0000d7c0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0000d7d0: 2020 2020 2020 2020 2020 2020 2071 725f               qr_
+0000d7e0: 696d 6167 6520 3d20 6261 7365 3634 2e62  image = base64.b
+0000d7f0: 3634 6465 636f 6465 2871 725f 636f 6465  64decode(qr_code
+0000d800: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000d810: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0000d820: 2871 725f 7361 7665 5f70 6174 682c 2022  (qr_save_path, "
+0000d830: 7762 2229 2061 7320 663a 0d0a 2020 2020  wb") as f:..    
+0000d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d850: 2020 2020 662e 7772 6974 6528 7172 5f69      f.write(qr_i
+0000d860: 6d61 6765 290d 0a20 2020 2020 2020 2020  mage)..         
+0000d870: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d880: 6c6f 6767 6572 2e69 6e66 6f28 6622 7b5f  logger.info(f"{_
+0000d890: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+0000d8a0: 5f7d 202d 2051 5220 636f 6465 2069 6d61  _} - QR code ima
+0000d8b0: 6765 2069 7320 7361 7665 6420 746f 207b  ge is saved to {
+0000d8c0: 7172 5f73 6176 655f 7061 7468 7d22 290d  qr_save_path}").
+0000d8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d8e0: 2069 6620 7265 7475 726e 5f71 725f 636f   if return_qr_co
+0000d8f0: 6465 3a0d 0a20 2020 2020 2020 2020 2020  de:..           
+0000d900: 2020 2020 2020 2020 2072 6573 756c 745b           result[
+0000d910: 2271 725f 636f 6465 225d 203d 2071 725f  "qr_code"] = qr_
+0000d920: 636f 6465 0d0a 2020 2020 2020 2020 2020  code..          
+0000d930: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000d940: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000d950: 6573 756c 740d 0a20 2020 2020 2020 2020  esult..         
+0000d960: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000d970: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000d980: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
+0000d990: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
+0000d9a0: 616d 655f 5f2c 2072 6573 2c20 2263 7265  ame__, res, "cre
+0000d9b0: 6174 6520 6b65 7920 6572 726f 7222 290d  ate key error").
+0000d9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d9d0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+0000d9e0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000d9f0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+0000da00: 0a20 2020 200d 0a20 2020 2064 6566 2075  .    ..    def u
+0000da10: 7064 6174 655f 6b65 7928 7365 6c66 2c20  pdate_key(self, 
+0000da20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000da30: 2020 2020 206d 6f75 6e74 5f70 6174 683a       mount_path:
+0000da40: 2073 7472 2c20 0d0a 2020 2020 2020 2020   str, ..        
+0000da50: 2020 2020 2020 2020 2020 206e 616d 653a             name:
+0000da60: 2073 7472 2c0d 0a20 2020 2020 2020 2020   str,..         
+0000da70: 2020 2020 2020 2020 2020 6b65 793a 204f            key: O
+0000da80: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+0000da90: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+0000daa0: 2020 2020 2020 2020 2061 6363 6f75 6e74           account
+0000dab0: 5f6e 616d 653a 204f 7074 696f 6e61 6c5b  _name: Optional[
+0000dac0: 7374 725d 203d 204e 6f6e 652c 0d0a 2020  str] = None,..  
+0000dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dae0: 2069 7373 7565 723a 204f 7074 696f 6e61   issuer: Optiona
+0000daf0: 6c5b 7374 725d 203d 204e 6f6e 652c 0d0a  l[str] = None,..
+0000db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db10: 2020 2070 6572 696f 643a 204f 7074 696f     period: Optio
+0000db20: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
+0000db30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000db40: 2020 2020 2061 6c67 6f72 6974 686d 3a20       algorithm: 
+0000db50: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+0000db60: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+0000db70: 2020 2020 2020 2020 2020 6469 6769 7473            digits
+0000db80: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+0000db90: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
+0000dba0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000dbb0: 726e 5f73 6563 7265 745f 6b65 793a 2062  rn_secret_key: b
+0000dbc0: 6f6f 6c20 3d20 4661 6c73 6529 3a0d 0a20  ool = False):.. 
+0000dbd0: 2020 2020 2020 2022 2222 7570 6461 7465         """update
+0000dbe0: 2061 206b 6579 2069 6e20 226d 6f75 6e74   a key in "mount
+0000dbf0: 2070 6174 682f 220d 0a0d 0a20 2020 2020   path/"....     
+0000dc00: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+0000dc10: 2020 2020 2020 6d6f 756e 745f 7061 7468        mount_path
+0000dc20: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
+0000dc30: 2020 2020 6e61 6d65 2028 7374 7229 0d0a      name (str)..
+0000dc40: 2020 2020 2020 2020 2020 2020 6b65 7920              key 
+0000dc50: 284f 7074 696f 6e61 6c5b 7374 725d 2c20  (Optional[str], 
+0000dc60: 6f70 7469 6f6e 616c 293a 2053 7065 6369  optional): Speci
+0000dc70: 6669 6573 2074 6865 2072 6f6f 7420 6b65  fies the root ke
+0000dc80: 7920 7573 6564 2074 6f20 6765 6e65 7261  y used to genera
+0000dc90: 7465 2061 2054 4f54 5020 636f 6465 2e20  te a TOTP code. 
+0000dca0: 4966 204e 6f6e 652c 2069 7420 0d0a 2020  If None, it ..  
+0000dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcd0: 2020 2020 2020 2020 2077 696c 6c20 7261           will ra
+0000dce0: 6e64 6f6d 6c79 2067 656e 6572 6174 6520  ndomly generate 
+0000dcf0: 6120 6e65 7720 7365 6372 6574 206b 6579  a new secret key
+0000dd00: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
+0000dd10: 6e65 2e0d 0a20 2020 2020 2020 2020 2020  ne...           
+0000dd20: 2061 6363 6f75 6e74 5f6e 616d 6520 284f   account_name (O
+0000dd30: 7074 696f 6e61 6c5b 7374 725d 2c20 6f70  ptional[str], op
+0000dd40: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
+0000dd50: 6573 2074 6865 2061 6363 6f75 6e74 5f6e  es the account_n
+0000dd60: 616d 6520 6966 2079 6f75 2077 616e 7420  ame if you want 
+0000dd70: 746f 2063 6861 6e67 6520 6974 2c20 0d0a  to change it, ..
+0000dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddb0: 2020 2020 6f74 6865 7277 6973 6520 7265      otherwise re
+0000ddc0: 6d61 696e 2061 7320 4e6f 6e65 2e20 4465  main as None. De
+0000ddd0: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0d  faults to None..
+0000dde0: 0a20 2020 2020 2020 2020 2020 2069 7373  .            iss
+0000ddf0: 7565 7220 284f 7074 696f 6e61 6c5b 7374  uer (Optional[st
+0000de00: 725d 2c20 6f70 7469 6f6e 616c 293a 2053  r], optional): S
+0000de10: 7065 6369 6669 6573 2074 6865 2069 7373  pecifies the iss
+0000de20: 7565 7220 6966 2079 6f75 2077 616e 7420  uer if you want 
+0000de30: 746f 2063 6861 6e67 6520 6974 2c20 6f74  to change it, ot
+0000de40: 6865 7277 6973 6520 7265 6d61 696e 200d  herwise remain .
+0000de50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de70: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000de80: 7320 4e6f 6e65 2e20 4465 6661 756c 7473  s None. Defaults
+0000de90: 2074 6f20 4e6f 6e65 2e0d 0a20 2020 2020   to None...     
+0000dea0: 2020 2020 2020 2070 6572 696f 6420 284f         period (O
+0000deb0: 7074 696f 6e61 6c5b 696e 745d 2c20 6f70  ptional[int], op
+0000dec0: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
+0000ded0: 6573 2074 6865 2070 6572 696f 6420 6966  es the period if
+0000dee0: 2079 6f75 2077 616e 7420 746f 2063 6861   you want to cha
+0000def0: 6e67 6520 6974 2c20 6f74 6865 7277 6973  nge it, otherwis
+0000df00: 6520 7265 6d61 696e 200d 0a20 2020 2020  e remain ..     
+0000df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df30: 2020 2020 2020 2020 2061 7320 4e6f 6e65           as None
+0000df40: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
+0000df50: 6e65 2e0d 0a20 2020 2020 2020 2020 2020  ne...           
+0000df60: 2061 6c67 6f72 6974 686d 2028 4f70 7469   algorithm (Opti
+0000df70: 6f6e 616c 5b73 7472 5d2c 206f 7074 696f  onal[str], optio
+0000df80: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
+0000df90: 7468 6520 616c 676f 7269 7468 6d20 6966  the algorithm if
+0000dfa0: 2079 6f75 2077 616e 7420 746f 2063 6861   you want to cha
+0000dfb0: 6e67 6520 6974 2c20 6f74 6865 7277 6973  nge it, otherwis
+0000dfc0: 6520 0d0a 2020 2020 2020 2020 2020 2020  e ..            
+0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dff0: 2020 2020 2072 656d 6169 6e20 6173 204e       remain as N
+0000e000: 6f6e 652e 2044 6566 6175 6c74 7320 746f  one. Defaults to
+0000e010: 204e 6f6e 652e 0d0a 2020 2020 2020 2020   None...        
+0000e020: 2020 2020 6469 6769 7473 2028 4f70 7469      digits (Opti
+0000e030: 6f6e 616c 5b69 6e74 5d2c 206f 7074 696f  onal[int], optio
+0000e040: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
+0000e050: 7468 6520 6469 6769 7473 2069 6620 796f  the digits if yo
+0000e060: 7520 7761 6e74 2074 6f20 6368 616e 6765  u want to change
+0000e070: 2069 742c 206f 7468 6572 7769 7365 2072   it, otherwise r
+0000e080: 656d 6169 6e20 0d0a 2020 2020 2020 2020  emain ..        
+0000e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0b0: 2020 2020 2020 6173 204e 6f6e 652e 2044        as None. D
+0000e0c0: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
+0000e0d0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000e0e0: 7475 726e 5f73 6563 7265 745f 6b65 7920  turn_secret_key 
+0000e0f0: 2862 6f6f 6c2c 206f 7074 696f 6e61 6c29  (bool, optional)
+0000e100: 3a20 5370 6563 6966 6965 7320 7768 6574  : Specifies whet
+0000e110: 6865 7220 746f 2072 6574 7572 6e20 7468  her to return th
+0000e120: 6520 7365 6372 6574 206b 6579 2e20 4465  e secret key. De
+0000e130: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
+0000e140: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0000e150: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+0000e160: 2020 626f 6f6c 206f 7220 7374 723a 2072    bool or str: r
+0000e170: 6574 7572 6e20 5472 7565 2069 6620 7375  eturn True if su
+0000e180: 6363 6573 7320 616e 6420 7265 7475 726e  ccess and return
+0000e190: 5f73 6563 7265 745f 6b65 7920 6973 2046  _secret_key is F
+0000e1a0: 616c 7365 2c20 7265 7475 726e 2074 6865  alse, return the
+0000e1b0: 2073 6563 7265 7420 6b65 7920 6966 2073   secret key if s
+0000e1c0: 7563 6365 7373 200d 0a20 2020 2020 2020  uccess ..       
+0000e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1e0: 2020 616e 6420 7265 7475 726e 5f73 6563    and return_sec
+0000e1f0: 7265 745f 6b65 7920 6973 2054 7275 652c  ret_key is True,
+0000e200: 206f 7468 6572 7769 7365 2072 6574 7572   otherwise retur
+0000e210: 6e20 4661 6c73 652e 0d0a 2020 2020 2020  n False...      
+0000e220: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+0000e230: 6620 7365 6c66 2e69 735f 6175 7468 3a0d  f self.is_auth:.
+0000e240: 0a20 2020 2020 2020 2020 2020 2065 7869  .            exi
+0000e250: 7374 5f6b 6579 7320 3d20 7365 6c66 2e6c  st_keys = self.l
+0000e260: 6973 745f 6b65 7928 6d6f 756e 745f 7061  ist_key(mount_pa
+0000e270: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
+0000e280: 2069 6620 6578 6973 745f 6b65 7973 2069   if exist_keys i
+0000e290: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0000e2a0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0000e2b0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+0000e2c0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0000e2d0: 7d20 2d20 7570 6461 7465 206b 6579 2065  } - update key e
+0000e2e0: 7272 6f72 3a20 6b65 7920 277b 6e61 6d65  rror: key '{name
+0000e2f0: 7d27 206e 6f74 2066 6f75 6e64 2229 0d0a  }' not found")..
+0000e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e310: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+0000e320: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0000e330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e340: 2069 6620 6e61 6d65 206e 6f74 2069 6e20   if name not in 
+0000e350: 6578 6973 745f 6b65 7973 3a0d 0a20 2020  exist_keys:..   
+0000e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e370: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+0000e380: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+0000e390: 5f5f 6e61 6d65 5f5f 7d20 2d20 7265 6175  __name__} - reau
+0000e3a0: 7064 6174 6564 206b 6579 2065 7272 6f72  pdated key error
+0000e3b0: 3a20 6b65 7920 277b 6e61 6d65 7d27 206e  : key '{name}' n
+0000e3c0: 6f74 2066 6f75 6e64 2229 0d0a 2020 2020  ot found")..    
+0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3e0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+0000e3f0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000e400: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
+0000e410: 656c 662e 7265 6164 5f6b 6579 286d 6f75  elf.read_key(mou
+0000e420: 6e74 5f70 6174 682c 206e 616d 6529 0d0a  nt_path, name)..
+0000e430: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+0000e440: 6174 6120 6973 204e 6f6e 653a 0d0a 2020  ata is None:..  
+0000e450: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000e460: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+0000e470: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
+0000e480: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0000e490: 2020 2020 2020 2020 206b 6579 203d 2070           key = p
+0000e4a0: 796f 7470 2e72 616e 646f 6d5f 6261 7365  yotp.random_base
+0000e4b0: 3332 2829 0d0a 0d0a 2020 2020 2020 2020  32()....        
+0000e4c0: 2020 2020 746f 7470 5f75 726c 203d 2073      totp_url = s
+0000e4d0: 656c 662e 5f5f 6765 6e65 7261 7465 5f74  elf.__generate_t
+0000e4e0: 6f74 705f 7572 6c28 6163 636f 756e 745f  otp_url(account_
+0000e4f0: 6e61 6d65 3d64 6174 615b 2261 6363 6f75  name=data["accou
+0000e500: 6e74 5f6e 616d 6522 5d20 6966 2061 6363  nt_name"] if acc
+0000e510: 6f75 6e74 5f6e 616d 6520 6973 204e 6f6e  ount_name is Non
+0000e520: 6520 656c 7365 2061 6363 6f75 6e74 5f6e  e else account_n
+0000e530: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0000e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e560: 2020 2020 2020 6973 7375 6572 3d64 6174        issuer=dat
+0000e570: 615b 2269 7373 7565 7222 5d20 6966 2069  a["issuer"] if i
+0000e580: 7373 7565 7220 6973 204e 6f6e 6520 656c  ssuer is None el
+0000e590: 7365 2069 7373 7565 722c 0d0a 2020 2020  se issuer,..    
+0000e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5c0: 2020 2020 2020 2020 2020 2020 616c 676f              algo
+0000e5d0: 7269 7468 6d3d 6461 7461 5b22 616c 676f  rithm=data["algo
+0000e5e0: 7269 7468 6d22 5d20 6966 2061 6c67 6f72  rithm"] if algor
+0000e5f0: 6974 686d 2069 7320 4e6f 6e65 2065 6c73  ithm is None els
+0000e600: 6520 616c 676f 7269 7468 6d2c 0d0a 2020  e algorithm,..  
+0000e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e630: 2020 2020 2020 2020 2020 2020 2020 6469                di
+0000e640: 6769 7473 3d64 6174 615b 2264 6967 6974  gits=data["digit
+0000e650: 7322 5d20 6966 2064 6967 6974 7320 6973  s"] if digits is
+0000e660: 204e 6f6e 6520 656c 7365 2064 6967 6974   None else digit
+0000e670: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6a0: 2020 2020 7065 7269 6f64 3d64 6174 615b      period=data[
+0000e6b0: 2270 6572 696f 6422 5d20 6966 2070 6572  "period"] if per
+0000e6c0: 696f 6420 6973 204e 6f6e 6520 656c 7365  iod is None else
+0000e6d0: 2070 6572 696f 642c 0d0a 2020 2020 2020   period,..      
+0000e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e700: 2020 2020 2020 2020 2020 7365 6372 6574            secret
+0000e710: 3d6b 6579 290d 0a20 2020 2020 2020 2020  =key)..         
+0000e720: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0000e730: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
+0000e740: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
+0000e750: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0000e760: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0000e770: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+0000e780: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+0000e790: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+0000e7a0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+0000e7b0: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
+0000e7c0: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
+0000e7d0: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0000e7e0: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0000e7f0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+0000e800: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+0000e810: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+0000e820: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000e830: 203d 2072 6571 7565 7374 732e 706f 7374   = requests.post
+0000e840: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
+0000e850: 7468 7d2f 6b65 7973 2f7b 6e61 6d65 7d22  th}/keys/{name}"
+0000e860: 2c20 6865 6164 6572 733d 7b22 582d 5661  , headers={"X-Va
+0000e870: 756c 742d 546f 6b65 6e22 3a20 746f 6b65  ult-Token": toke
+0000e880: 6e7d 2c20 6461 7461 3d6a 736f 6e2e 6475  n}, data=json.du
+0000e890: 6d70 7328 7b22 7572 6c22 3a20 746f 7470  mps({"url": totp
+0000e8a0: 5f75 726c 7d29 290d 0a20 2020 2020 2020  _url}))..       
+0000e8b0: 2020 2020 2069 6620 7265 732e 7374 6174       if res.stat
+0000e8c0: 7573 5f63 6f64 6520 3d3d 2032 3030 206f  us_code == 200 o
+0000e8d0: 7220 7265 732e 7374 6174 7573 5f63 6f64  r res.status_cod
+0000e8e0: 6520 3d3d 2032 3034 3a0d 0a20 2020 2020  e == 204:..     
+0000e8f0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0000e900: 7475 726e 5f73 6563 7265 745f 6b65 793a  turn_secret_key:
+0000e910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e920: 2020 2020 2020 7265 7475 726e 206b 6579        return key
+0000e930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e940: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000e950: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000e960: 7572 6e20 5472 7565 0d0a 2020 2020 2020  urn True..      
+0000e970: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000e980: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000e990: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
+0000e9a0: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
+0000e9b0: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
+0000e9c0: 7570 6461 7465 206b 6579 2065 7272 6f72  update key error
+0000e9d0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0000e9e0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000e9f0: 0d0a 0d0a 2020 2020 6465 6620 7265 6164  ....    def read
+0000ea00: 5f6b 6579 2873 656c 662c 206d 6f75 6e74  _key(self, mount
+0000ea10: 5f70 6174 683a 2073 7472 2c20 6e61 6d65  _path: str, name
+0000ea20: 3a20 7374 7229 3a0d 0a20 2020 2020 2020  : str):..       
+0000ea30: 2022 2222 7175 6572 6965 7320 7468 6520   """queries the 
+0000ea40: 6b65 7920 6465 6669 6e69 7469 6f6e 2069  key definition i
+0000ea50: 6e20 226d 6f75 6e74 2070 6174 682f 220d  n "mount path/".
+0000ea60: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+0000ea70: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+0000ea80: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
+0000ea90: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0000eaa0: 2028 7374 7229 0d0a 0d0a 2020 2020 2020   (str)....      
+0000eab0: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+0000eac0: 2020 2020 2020 2020 6469 6374 206f 7220          dict or 
+0000ead0: 4e6f 6e65 3a20 7265 7475 726e 2061 2064  None: return a d
+0000eae0: 6963 7420 6966 2073 7563 6365 7373 2c20  ict if success, 
+0000eaf0: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+0000eb00: 204e 6f6e 650d 0a20 2020 2020 2020 2022   None..        "
+0000eb10: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0000eb20: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
+0000eb30: 2020 2020 2020 2020 2020 6578 6973 745f            exist_
+0000eb40: 6b65 7973 203d 2073 656c 662e 6c69 7374  keys = self.list
+0000eb50: 5f6b 6579 286d 6f75 6e74 5f70 6174 6829  _key(mount_path)
+0000eb60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000eb70: 2065 7869 7374 5f6b 6579 7320 6973 204e   exist_keys is N
+0000eb80: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0000eb90: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0000eba0: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
+0000ebb0: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+0000ebc0: 2072 6561 6420 6b65 7920 6572 726f 723a   read key error:
+0000ebd0: 206b 6579 2027 7b6e 616d 657d 2720 6e6f   key '{name}' no
+0000ebe0: 7420 666f 756e 6422 290d 0a20 2020 2020  t found")..     
+0000ebf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ec00: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+0000ec10: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000ec20: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
+0000ec30: 6d65 206e 6f74 2069 6e20 6578 6973 745f  me not in exist_
+0000ec40: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
+0000ec50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ec60: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
+0000ec70: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0000ec80: 5f5f 7d20 2d20 7265 6164 206b 6579 2065  __} - read key e
+0000ec90: 7272 6f72 3a20 6b65 7920 277b 6e61 6d65  rror: key '{name
+0000eca0: 7d27 206e 6f74 2066 6f75 6e64 2229 0d0a  }' not found")..
+0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecc0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+0000ecd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ece0: 200d 0a20 2020 2020 2020 2020 2020 2075   ..            u
+0000ecf0: 726c 203d 2061 6573 5f64 6563 7279 7074  rl = aes_decrypt
+0000ed00: 5f74 6578 7428 7365 6c66 2e75 726c 2c20  _text(self.url, 
+0000ed10: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
+0000ed20: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
+0000ed30: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
+0000ed40: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
+0000ed50: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
+0000ed60: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+0000ed70: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
+0000ed80: 6578 7428 7365 6c66 2e74 6f6b 656e 2c20  ext(self.token, 
+0000ed90: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
+0000eda0: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
+0000edb0: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
+0000edc0: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
+0000edd0: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
+0000ede0: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+0000edf0: 2072 6571 7565 7374 732e 6765 7428 7572   requests.get(ur
+0000ee00: 6c2b 6622 7b6d 6f75 6e74 5f70 6174 687d  l+f"{mount_path}
+0000ee10: 2f6b 6579 732f 7b6e 616d 657d 222c 2068  /keys/{name}", h
+0000ee20: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
+0000ee30: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d29  -Token": token})
+0000ee40: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000ee50: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
+0000ee60: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
+0000ee70: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+0000ee80: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
+0000ee90: 2020 2020 7265 7475 726e 2072 6573 2e6a      return res.j
+0000eea0: 736f 6e28 295b 2264 6174 6122 5d0d 0a20  son()["data"].. 
+0000eeb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000eec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000eed0: 2020 7365 6c66 2e5f 6c6f 675f 6572 726f    self._log_erro
+0000eee0: 725f 7265 7370 6f6e 7365 285f 5f63 6c61  r_response(__cla
+0000eef0: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
+0000ef00: 6573 2c20 2272 6561 6420 6b65 7920 6572  es, "read key er
+0000ef10: 726f 7222 290d 0a20 2020 2020 2020 2020  ror")..         
+0000ef20: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0000ef30: 6e65 0d0a 2020 2020 2020 2020 0d0a 2020  ne..        ..  
+0000ef40: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0000ef50: 650d 0a0d 0a0d 0a20 2020 2064 6566 206c  e......    def l
+0000ef60: 6973 745f 6b65 7928 7365 6c66 2c20 6d6f  ist_key(self, mo
+0000ef70: 756e 745f 7061 7468 3a20 7374 7229 3a0d  unt_path: str):.
+0000ef80: 0a20 2020 2020 2020 2022 2222 6c69 7374  .        """list
+0000ef90: 206b 6579 7320 696e 2022 6d6f 756e 7420   keys in "mount 
+0000efa0: 7061 7468 2f22 0d0a 0d0a 2020 2020 2020  path/"....      
+0000efb0: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+0000efc0: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
+0000efd0: 2873 7472 290d 0a0d 0a20 2020 2020 2020  (str)....       
+0000efe0: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
+0000eff0: 2020 2020 2020 206c 6973 7420 6f72 204e         list or N
+0000f000: 6f6e 653a 2072 6574 7572 6e20 6120 6c69  one: return a li
+0000f010: 7374 206f 6620 6176 6169 6c61 626c 6520  st of available 
+0000f020: 6b65 7973 2069 6620 7375 6363 6573 732c  keys if success,
+0000f030: 206f 7468 6572 7769 7365 2072 6574 7572   otherwise retur
+0000f040: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+0000f050: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+0000f060: 7365 6c66 2e69 735f 6175 7468 3a0d 0a20  self.is_auth:.. 
+0000f070: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+0000f080: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+0000f090: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
+0000f0a0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+0000f0b0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+0000f0c0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+0000f0d0: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+0000f0e0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+0000f0f0: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
+0000f100: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+0000f110: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
+0000f120: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+0000f130: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+0000f140: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+0000f150: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+0000f160: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+0000f170: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
+0000f180: 7565 7374 732e 6765 7428 7572 6c2b 6622  uests.get(url+f"
+0000f190: 7b6d 6f75 6e74 5f70 6174 687d 2f6b 6579  {mount_path}/key
+0000f1a0: 733f 6c69 7374 3d74 7275 6522 2c20 6865  s?list=true", he
+0000f1b0: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+0000f1c0: 546f 6b65 6e22 3a20 746f 6b65 6e7d 290d  Token": token}).
+0000f1d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000f1e0: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+0000f1f0: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
+0000f200: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
+0000f210: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000f220: 2020 2072 6574 7572 6e20 7265 732e 6a73     return res.js
+0000f230: 6f6e 2829 5b22 6461 7461 225d 5b22 6b65  on()["data"]["ke
+0000f240: 7973 225d 0d0a 2020 2020 2020 2020 2020  ys"]..          
+0000f250: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000f260: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+0000f270: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
+0000f280: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
+0000f290: 6d65 5f5f 2c20 7265 732c 2022 6c69 7374  me__, res, "list
+0000f2a0: 206b 6579 2065 7272 6f72 2229 0d0a 2020   key error")..  
+0000f2b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000f2c0: 7475 726e 204e 6f6e 650d 0a0d 0a20 2020  turn None....   
+0000f2d0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0000f2e0: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
+0000f2f0: 6465 6c65 7465 5f6b 6579 2873 656c 662c  delete_key(self,
+0000f300: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
+0000f310: 2c20 6e61 6d65 3a20 7374 7229 3a0d 0a20  , name: str):.. 
+0000f320: 2020 2020 2020 2022 2222 6465 6c65 7465         """delete
+0000f330: 2061 206b 6579 2066 726f 6d20 226d 6f75   a key from "mou
+0000f340: 6e74 2070 6174 682f 220d 0a0d 0a20 2020  nt path/"....   
+0000f350: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
+0000f360: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+0000f370: 7468 2028 7374 7229 0d0a 2020 2020 2020  th (str)..      
+0000f380: 2020 2020 2020 6e61 6d65 2028 7374 7229        name (str)
+0000f390: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0000f3a0: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+0000f3b0: 2020 626f 6f6c 3a20 7265 7475 726e 2054    bool: return T
+0000f3c0: 7275 6520 6966 2073 7563 6365 7373 2c20  rue if success, 
+0000f3d0: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+0000f3e0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0000f3f0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+0000f400: 7365 6c66 2e69 735f 6175 7468 3a0d 0a20  self.is_auth:.. 
+0000f410: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+0000f420: 5f6b 6579 7320 3d20 7365 6c66 2e6c 6973  _keys = self.lis
+0000f430: 745f 6b65 7928 6d6f 756e 745f 7061 7468  t_key(mount_path
+0000f440: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000f450: 6620 6578 6973 745f 6b65 7973 2069 7320  f exist_keys is 
+0000f460: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000f470: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+0000f480: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+0000f490: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+0000f4a0: 2d20 6465 6c65 7465 206b 6579 2065 7272  - delete key err
+0000f4b0: 6f72 3a20 6b65 7920 277b 6e61 6d65 7d27  or: key '{name}'
+0000f4c0: 206e 6f74 2066 6f75 6e64 2229 0d0a 2020   not found")..  
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000f4e0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+0000f4f0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0000f500: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000f510: 6620 6e61 6d65 206e 6f74 2069 6e20 6578  f name not in ex
+0000f520: 6973 745f 6b65 7973 3a0d 0a20 2020 2020  ist_keys:..     
+0000f530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f540: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+0000f550: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+0000f560: 6e61 6d65 5f5f 7d20 2d20 6465 6c65 7465  name__} - delete
+0000f570: 206b 6579 2065 7272 6f72 3a20 6b65 7920   key error: key 
+0000f580: 277b 6e61 6d65 7d27 206e 6f74 2066 6f75  '{name}' not fou
+0000f590: 6e64 2229 0d0a 2020 2020 2020 2020 2020  nd")..          
+0000f5a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f5b0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0000f5c0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000f5d0: 2020 2020 2020 7572 6c20 3d20 6165 735f        url = aes_
+0000f5e0: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
+0000f5f0: 662e 7572 6c2c 206b 6579 3d72 616e 646f  f.url, key=rando
+0000f600: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
+0000f610: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
+0000f620: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
+0000f630: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
+0000f640: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
+0000f650: 2020 746f 6b65 6e20 3d20 6165 735f 6465    token = aes_de
+0000f660: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
+0000f670: 746f 6b65 6e2c 206b 6579 3d72 616e 646f  token, key=rando
+0000f680: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
+0000f690: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
+0000f6a0: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
+0000f6b0: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
+0000f6c0: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
+0000f6d0: 2020 7265 7320 3d20 7265 7175 6573 7473    res = requests
+0000f6e0: 2e64 656c 6574 6528 7572 6c2b 6622 7b6d  .delete(url+f"{m
+0000f6f0: 6f75 6e74 5f70 6174 687d 2f6b 6579 732f  ount_path}/keys/
+0000f700: 7b6e 616d 657d 222c 2068 6561 6465 7273  {name}", headers
+0000f710: 3d7b 2258 2d56 6175 6c74 2d54 6f6b 656e  ={"X-Vault-Token
+0000f720: 223a 2074 6f6b 656e 7d29 0d0a 2020 2020  ": token})..    
+0000f730: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
+0000f740: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+0000f750: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
+0000f760: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
+0000f770: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000f780: 7475 726e 2054 7275 650d 0a20 2020 2020  turn True..     
+0000f790: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000f7a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000f7b0: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+0000f7c0: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+0000f7d0: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+0000f7e0: 2264 656c 6574 6520 6b65 7920 6572 726f  "delete key erro
+0000f7f0: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
+0000f800: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000f810: 650d 0a0d 0a20 2020 2020 2020 2072 6574  e....        ret
+0000f820: 7572 6e20 4661 6c73 650d 0a20 2020 200d  urn False..    .
+0000f830: 0a20 2020 2064 6566 2067 656e 6572 6174  .    def generat
+0000f840: 655f 636f 6465 2873 656c 662c 206d 6f75  e_code(self, mou
+0000f850: 6e74 5f70 6174 683a 2073 7472 2c20 6e61  nt_path: str, na
+0000f860: 6d65 3a20 7374 7229 3a0d 0a20 2020 2020  me: str):..     
+0000f870: 2020 2022 2222 6765 6e65 7261 7465 2061     """generate a
+0000f880: 206e 6577 2074 696d 652d 6261 7365 6420   new time-based 
+0000f890: 6f6e 652d 7469 6d65 2075 7365 2070 6173  one-time use pas
+0000f8a0: 7377 6f72 6420 6261 7365 6420 6f6e 2074  sword based on t
+0000f8b0: 6865 206e 616d 6564 206b 6579 0d0a 0d0a  he named key....
+0000f8c0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
+0000f8d0: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
+0000f8e0: 5f70 6174 6820 2873 7472 290d 0a20 2020  _path (str)..   
+0000f8f0: 2020 2020 2020 2020 206e 616d 6520 2873           name (s
+0000f900: 7472 290d 0a0d 0a20 2020 2020 2020 2052  tr)....        R
+0000f910: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
+0000f920: 2020 2020 2073 7472 3a20 7265 7475 726e       str: return
+0000f930: 2074 6865 2067 656e 6572 6174 6564 2063   the generated c
+0000f940: 6f64 6520 6966 2073 7563 6365 7373 2c20  ode if success, 
+0000f950: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+0000f960: 204e 6f6e 650d 0a20 2020 2020 2020 2022   None..        "
+0000f970: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0000f980: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
+0000f990: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0000f9a0: 2073 656c 662e 7265 6164 5f6b 6579 286d   self.read_key(m
+0000f9b0: 6f75 6e74 5f70 6174 682c 206e 616d 6529  ount_path, name)
+0000f9c0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000f9d0: 2064 6174 6120 6973 204e 6f6e 653a 0d0a   data is None:..
+0000f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9f0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+0000fa00: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+0000fa10: 5f6e 616d 655f 5f7d 202d 2067 656e 6572  _name__} - gener
+0000fa20: 6174 6520 636f 6465 2065 7272 6f72 3a20  ate code error: 
+0000fa30: 6b65 7920 277b 6e61 6d65 7d27 206e 6f74  key '{name}' not
+0000fa40: 2066 6f75 6e64 2229 0d0a 2020 2020 2020   found")..      
+0000fa50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000fa60: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+0000fa70: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0000fa80: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
+0000fa90: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
+0000faa0: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0000fab0: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0000fac0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+0000fad0: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+0000fae0: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+0000faf0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+0000fb00: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
+0000fb10: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
+0000fb20: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0000fb30: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0000fb40: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+0000fb50: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+0000fb60: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+0000fb70: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000fb80: 203d 2072 6571 7565 7374 732e 6765 7428   = requests.get(
+0000fb90: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
+0000fba0: 687d 2f63 6f64 652f 7b6e 616d 657d 222c  h}/code/{name}",
+0000fbb0: 2068 6561 6465 7273 3d7b 2258 2d56 6175   headers={"X-Vau
+0000fbc0: 6c74 2d54 6f6b 656e 223a 2074 6f6b 656e  lt-Token": token
+0000fbd0: 7d29 0d0a 2020 2020 2020 2020 2020 2020  })..            
+0000fbe0: 6966 2072 6573 2e73 7461 7475 735f 636f  if res.status_co
+0000fbf0: 6465 203d 3d20 3230 3020 6f72 2072 6573  de == 200 or res
+0000fc00: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
+0000fc10: 3230 343a 0d0a 2020 2020 2020 2020 2020  204:..          
+0000fc20: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0000fc30: 2e6a 736f 6e28 295b 2264 6174 6122 5d5b  .json()["data"][
+0000fc40: 2263 6f64 6522 5d0d 0a20 2020 2020 2020  "code"]..       
+0000fc50: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000fc60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fc70: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
+0000fc80: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
+0000fc90: 5f6e 616d 655f 5f2c 2072 6573 2c20 2267  _name__, res, "g
+0000fca0: 656e 6572 6174 6520 636f 6465 2065 7272  enerate code err
+0000fcb0: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
+0000fcc0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0000fcd0: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
+0000fce0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0000fcf0: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
+0000fd00: 7661 6c69 6461 7465 5f63 6f64 6528 7365  validate_code(se
+0000fd10: 6c66 2c20 6d6f 756e 745f 7061 7468 3a20  lf, mount_path: 
+0000fd20: 7374 722c 206e 616d 653a 2073 7472 2c20  str, name: str, 
+0000fd30: 636f 6465 3a20 7374 7229 3a0d 0a20 2020  code: str):..   
+0000fd40: 2020 2020 2022 2222 7661 6c69 6461 7465       """validate
+0000fd50: 2061 2063 6f64 650d 0a0d 0a20 2020 2020   a code....     
+0000fd60: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+0000fd70: 2020 2020 2020 6d6f 756e 745f 7061 7468        mount_path
+0000fd80: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
+0000fd90: 2020 2020 6e61 6d65 2028 7374 7229 0d0a      name (str)..
+0000fda0: 2020 2020 2020 2020 2020 2020 636f 6465              code
+0000fdb0: 2028 7374 7229 0d0a 0d0a 2020 2020 2020   (str)....      
+0000fdc0: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+0000fdd0: 2020 2020 2020 2020 626f 6f6c 3a20 7265          bool: re
+0000fde0: 7475 726e 2054 7275 6520 6966 2074 6865  turn True if the
+0000fdf0: 2063 6f64 6520 6d61 7463 6865 642c 206f   code matched, o
+0000fe00: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
+0000fe10: 4661 6c73 650d 0a20 2020 2020 2020 2022  False..        "
+0000fe20: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0000fe30: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
+0000fe40: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0000fe50: 2073 656c 662e 7265 6164 5f6b 6579 286d   self.read_key(m
+0000fe60: 6f75 6e74 5f70 6174 682c 206e 616d 6529  ount_path, name)
+0000fe70: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000fe80: 2064 6174 6120 6973 204e 6f6e 653a 0d0a   data is None:..
+0000fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fea0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+0000feb0: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+0000fec0: 5f6e 616d 655f 5f7d 202d 2076 616c 6964  _name__} - valid
+0000fed0: 6174 6520 636f 6465 2065 7272 6f72 3a20  ate code error: 
+0000fee0: 6b65 7920 277b 6e61 6d65 7d27 206e 6f74  key '{name}' not
+0000fef0: 2066 6f75 6e64 2229 0d0a 2020 2020 2020   found")..      
+0000ff00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ff10: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+0000ff20: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0000ff30: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
+0000ff40: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
+0000ff50: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0000ff60: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0000ff70: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+0000ff80: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+0000ff90: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+0000ffa0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+0000ffb0: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
+0000ffc0: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
+0000ffd0: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0000ffe0: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0000fff0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00010000: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00010010: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+00010020: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00010030: 203d 2072 6571 7565 7374 732e 706f 7374   = requests.post
+00010040: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
+00010050: 7468 7d2f 636f 6465 2f7b 6e61 6d65 7d22  th}/code/{name}"
+00010060: 2c20 6865 6164 6572 733d 7b22 582d 5661  , headers={"X-Va
+00010070: 756c 742d 546f 6b65 6e22 3a20 746f 6b65  ult-Token": toke
+00010080: 6e7d 2c20 6461 7461 3d6a 736f 6e2e 6475  n}, data=json.du
+00010090: 6d70 7328 7b22 636f 6465 223a 2063 6f64  mps({"code": cod
+000100a0: 657d 2929 0d0a 2020 2020 2020 2020 2020  e}))..          
+000100b0: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
+000100c0: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
+000100d0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+000100e0: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
+000100f0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00010100: 6573 2e6a 736f 6e28 295b 2264 6174 6122  es.json()["data"
+00010110: 5d5b 2276 616c 6964 225d 0d0a 2020 2020  ]["valid"]..    
+00010120: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00010130: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010140: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
+00010150: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
+00010160: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
+00010170: 2022 7661 6c69 6461 7465 2063 6f64 6520   "validate code 
+00010180: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
+00010190: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000101a0: 4661 6c73 650d 0a0d 0a20 2020 2020 2020  False....       
+000101b0: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+000101c0: 2020 200d 0a20 2020 2040 7374 6174 6963     ..    @static
+000101d0: 6d65 7468 6f64 0d0a 2020 2020 6465 6620  method..    def 
+000101e0: 5f5f 7061 7273 655f 746f 7470 5f75 726c  __parse_totp_url
+000101f0: 2875 726c 3a20 7374 722c 2074 6974 6c65  (url: str, title
+00010200: 3a20 7374 7220 3d20 226f 7470 6175 7468  : str = "otpauth
+00010210: 3a2f 2f74 6f74 702f 2229 3a0d 0a20 2020  ://totp/"):..   
+00010220: 2020 2020 2075 726c 203d 2075 726c 2e72       url = url.r
+00010230: 6570 6c61 6365 2874 6974 6c65 2c20 2222  eplace(title, ""
+00010240: 290d 0a20 2020 2020 2020 2069 7373 7565  )..        issue
+00010250: 7220 3d20 7572 6c2e 7370 6c69 7428 223a  r = url.split(":
+00010260: 2229 5b30 5d0d 0a20 2020 2020 2020 2061  ")[0]..        a
+00010270: 6363 6f75 6e74 5f6e 616d 6520 3d20 7572  ccount_name = ur
+00010280: 6c2e 7370 6c69 7428 223a 2229 5b31 5d2e  l.split(":")[1].
+00010290: 7370 6c69 7428 223f 2229 5b30 5d0d 0a20  split("?")[0].. 
+000102a0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+000102b0: 7572 6c2e 7370 6c69 7428 223a 2229 5b31  url.split(":")[1
+000102c0: 5d2e 7370 6c69 7428 223f 2229 5b31 5d2e  ].split("?")[1].
+000102d0: 7370 6c69 7428 2226 2229 0d0a 2020 2020  split("&")..    
+000102e0: 2020 2020 7061 7261 6d73 5f64 6963 7420      params_dict 
+000102f0: 3d20 7b7d 0d0a 2020 2020 2020 2020 666f  = {}..        fo
+00010300: 7220 7061 7261 6d20 696e 2070 6172 616d  r param in param
+00010310: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00010320: 6b65 792c 2076 616c 7565 203d 2070 6172  key, value = par
+00010330: 616d 2e73 706c 6974 2822 3d22 290d 0a20  am.split("=").. 
+00010340: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00010350: 735f 6469 6374 5b6b 6579 5d20 3d20 7661  s_dict[key] = va
+00010360: 6c75 650d 0a20 2020 2020 2020 2072 6574  lue..        ret
+00010370: 7572 6e20 6973 7375 6572 2c20 6163 636f  urn issuer, acco
+00010380: 756e 745f 6e61 6d65 2c20 7061 7261 6d73  unt_name, params
+00010390: 5f64 6963 740d 0a20 2020 200d 0a20 2020  _dict..    ..   
+000103a0: 2064 6566 205f 5f67 656e 6572 6174 655f   def __generate_
+000103b0: 746f 7470 5f75 726c 2873 656c 662c 0d0a  totp_url(self,..
+000103c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103d0: 2020 2020 2020 2020 2020 2020 6163 636f              acco
+000103e0: 756e 745f 6e61 6d65 3a20 7374 722c 200d  unt_name: str, .
+000103f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010400: 2020 2020 2020 2020 2020 2020 2069 7373               iss
+00010410: 7565 723a 2073 7472 2c20 0d0a 2020 2020  uer: str, ..    
+00010420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010430: 2020 2020 2020 2020 616c 676f 7269 7468          algorith
+00010440: 6d3a 2073 7472 2c0d 0a20 2020 2020 2020  m: str,..       
+00010450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010460: 2020 2020 2064 6967 6974 733a 2069 6e74       digits: int
+00010470: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00010480: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00010490: 6572 696f 643a 2069 6e74 2c0d 0a20 2020  eriod: int,..   
+000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104b0: 2020 2020 2020 2020 2073 6563 7265 743a           secret:
+000104c0: 2073 7472 2c0d 0a20 2020 2020 2020 2020   str,..         
+000104d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104e0: 2020 2074 6974 6c65 3d22 6f74 7061 7574     title="otpaut
+000104f0: 683a 2f2f 746f 7470 2f22 293a 0d0a 2020  h://totp/"):..  
+00010500: 2020 2020 2020 6966 206e 6f74 2069 735f        if not is_
+00010510: 7374 7228 6163 636f 756e 745f 6e61 6d65  str(account_name
+00010520: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00010530: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+00010540: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+00010550: 5f6e 616d 655f 5f7d 202d 2067 656e 6572  _name__} - gener
+00010560: 6174 6520 746f 7470 2075 726c 2065 7272  ate totp url err
+00010570: 6f72 3a20 6163 636f 756e 745f 6e61 6d65  or: account_name
+00010580: 206d 7573 7420 6265 2061 2073 7472 696e   must be a strin
+00010590: 6722 290d 0a20 2020 2020 2020 2020 2020  g")..           
+000105a0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+000105b0: 2020 2020 2020 6966 206e 6f74 2069 735f        if not is_
+000105c0: 7374 7228 6973 7375 6572 293a 0d0a 2020  str(issuer):..  
+000105d0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+000105e0: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
+000105f0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00010600: 5f7d 202d 2067 656e 6572 6174 6520 746f  _} - generate to
+00010610: 7470 2075 726c 2065 7272 6f72 3a20 6973  tp url error: is
+00010620: 7375 6572 206d 7573 7420 6265 2061 2073  suer must be a s
+00010630: 7472 696e 6722 290d 0a20 2020 2020 2020  tring")..       
+00010640: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00010650: 0d0a 2020 2020 2020 2020 6966 2061 6c67  ..        if alg
+00010660: 6f72 6974 686d 206e 6f74 2069 6e20 5b22  orithm not in ["
+00010670: 5348 4131 222c 2022 5348 4132 3536 222c  SHA1", "SHA256",
+00010680: 2022 5348 4135 3132 225d 3a0d 0a20 2020   "SHA512"]:..   
+00010690: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+000106a0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+000106b0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+000106c0: 7d20 2d20 6765 6e65 7261 7465 2074 6f74  } - generate tot
+000106d0: 7020 7572 6c20 6572 726f 723a 2061 6c67  p url error: alg
+000106e0: 6f72 6974 686d 206d 7573 7420 6265 206f  orithm must be o
+000106f0: 6e65 206f 6620 220d 0a20 2020 2020 2020  ne of "..       
+00010700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010710: 2020 2020 2020 2066 2227 5348 4131 272c         f"'SHA1',
+00010720: 2027 5348 4132 3536 2720 6f72 2027 5348   'SHA256' or 'SH
+00010730: 4135 3132 2722 290d 0a20 2020 2020 2020  A512'")..       
+00010740: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00010750: 0d0a 2020 2020 2020 2020 6966 2064 6967  ..        if dig
+00010760: 6974 7320 6e6f 7420 696e 205b 362c 2038  its not in [6, 8
+00010770: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00010780: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+00010790: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+000107a0: 5f6e 616d 655f 5f7d 202d 2067 656e 6572  _name__} - gener
+000107b0: 6174 6520 746f 7470 2075 726c 2065 7272  ate totp url err
+000107c0: 6f72 3a20 6469 6769 7473 206d 7573 7420  or: digits must 
+000107d0: 6265 206f 6e65 206f 6620 3620 6f72 2038  be one of 6 or 8
+000107e0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+000107f0: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+00010800: 2020 2020 2069 6620 6e6f 7420 6973 5f69       if not is_i
+00010810: 6e74 2870 6572 696f 6429 3a0d 0a20 2020  nt(period):..   
+00010820: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00010830: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+00010840: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00010850: 7d20 2d20 6765 6e65 7261 7465 2074 6f74  } - generate tot
+00010860: 7020 7572 6c20 6572 726f 723a 2070 6572  p url error: per
+00010870: 696f 6420 6d75 7374 2062 6520 616e 2069  iod must be an i
+00010880: 6e74 2229 0d0a 2020 2020 2020 2020 2020  nt")..          
+00010890: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
+000108a0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000108b0: 2075 726c 203d 2066 227b 7469 746c 657d   url = f"{title}
+000108c0: 7b69 7373 7565 727d 3a7b 6163 636f 756e  {issuer}:{accoun
+000108d0: 745f 6e61 6d65 7d3f 616c 676f 7269 7468  t_name}?algorith
+000108e0: 6d3d 7b61 6c67 6f72 6974 686d 7d26 6469  m={algorithm}&di
+000108f0: 6769 7473 3d7b 6469 6769 7473 7d26 6973  gits={digits}&is
+00010900: 7375 6572 3d7b 6973 7375 6572 7d22 205c  suer={issuer}" \
+00010910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010920: 6622 2670 6572 696f 643d 7b70 6572 696f  f"&period={perio
+00010930: 647d 2673 6563 7265 743d 7b73 6563 7265  d}&secret={secre
+00010940: 747d 220d 0a0d 0a20 2020 2020 2020 2072  t}"....        r
+00010950: 6574 7572 6e20 7572 6c0d 0a20 2020 200d  eturn url..    .
+00010960: 0a0d 0a40 5345 4352 4554 2e72 6567 6973  ...@SECRET.regis
+00010970: 7465 725f 6d6f 6475 6c65 2829 0d0a 636c  ter_module()..cl
+00010980: 6173 7320 5661 756c 7453 6563 7265 7445  ass VaultSecretE
+00010990: 6e67 696e 6554 7261 6e73 6974 285f 5661  ngineTransit(_Va
+000109a0: 756c 7448 5454 5041 5049 293a 0d0a 2020  ultHTTPAPI):..  
+000109b0: 2020 2222 2254 7261 6e73 6974 2053 6563    """Transit Sec
+000109c0: 7265 7420 456e 6769 6e65 0d0a 0d0a 2020  ret Engine....  
+000109d0: 2020 5765 2068 6176 6520 6967 6e6f 7265    We have ignore
+000109e0: 6420 7468 6520 656e 7465 7270 7269 7365  d the enterprise
+000109f0: 206f 6e6c 7920 6b65 7920 7479 7065 2022   only key type "
+00010a00: 6d61 6e61 6765 645f 6b65 7922 2e0d 0a20  managed_key"... 
+00010a10: 2020 2052 6566 6572 2074 6f20 6874 7470     Refer to http
+00010a20: 733a 2f2f 6465 7665 6c6f 7065 722e 6861  s://developer.ha
+00010a30: 7368 6963 6f72 702e 636f 6d2f 7661 756c  shicorp.com/vaul
+00010a40: 742f 6170 692d 646f 6373 2f73 6563 7265  t/api-docs/secre
+00010a50: 742f 7472 616e 7369 7420 666f 7220 6d6f  t/transit for mo
+00010a60: 7265 2064 6574 6169 6c73 2e0d 0a0d 0a20  re details..... 
+00010a70: 2020 2049 6e69 743a 0d0a 2020 2020 2020     Init:..      
+00010a80: 2020 636f 6e6e 6563 7469 6e67 2077 6974    connecting wit
+00010a90: 6820 746f 6b65 6e3a 0d0a 2020 2020 2020  h token:..      
+00010aa0: 2020 3e3e 3e20 7472 616e 7369 745f 656e    >>> transit_en
+00010ab0: 6769 6e65 203d 2056 6175 6c74 5365 6372  gine = VaultSecr
+00010ac0: 6574 456e 6769 6e65 5472 616e 7369 7428  etEngineTransit(
+00010ad0: 0d0a 2020 2020 2020 2020 3e3e 3e20 2020  ..        >>>   
+00010ae0: 2020 7572 6c3d 2268 7474 703a 2f2f 3132    url="http://12
+00010af0: 372e 302e 302e 313a 3832 3030 222c 200d  7.0.0.1:8200", .
+00010b00: 0a20 2020 2020 2020 203e 3e3e 2020 2020  .        >>>    
+00010b10: 2061 7574 685f 6366 673d 6469 6374 286d   auth_cfg=dict(m
+00010b20: 6574 686f 643d 2274 6f6b 656e 222c 2074  ethod="token", t
+00010b30: 6f6b 656e 3d22 544f 4b45 4e22 290d 0a20  oken="TOKEN").. 
+00010b40: 2020 2020 2020 203e 3e3e 2029 0d0a 0d0a         >>> )....
+00010b50: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00010b60: 6e67 2077 6974 6820 7573 6572 6e61 6d65  ng with username
+00010b70: 2026 2070 6173 7377 6f72 643a 0d0a 2020   & password:..  
+00010b80: 2020 2020 2020 3e3e 3e20 7472 616e 7369        >>> transi
+00010b90: 745f 656e 6769 6e65 203d 2056 6175 6c74  t_engine = Vault
+00010ba0: 5365 6372 6574 456e 6769 6e65 5472 616e  SecretEngineTran
+00010bb0: 7369 7428 0d0a 2020 2020 2020 2020 3e3e  sit(..        >>
+00010bc0: 3e20 2020 2020 7572 6c3d 2268 7474 703a  >     url="http:
+00010bd0: 2f2f 3132 372e 302e 302e 313a 3832 3030  //127.0.0.1:8200
+00010be0: 222c 0d0a 2020 2020 2020 2020 3e3e 3e20  ",..        >>> 
+00010bf0: 2020 2020 6175 7468 5f63 6667 3d64 6963      auth_cfg=dic
+00010c00: 7428 6d65 7468 6f64 3d22 7573 6572 7061  t(method="userpa
+00010c10: 7373 222c 2075 7365 726e 616d 653d 2275  ss", username="u
+00010c20: 7365 726e 616d 6522 2c20 7061 7373 776f  sername", passwo
+00010c30: 7264 3d22 7061 7373 776f 7264 2229 0d0a  rd="password")..
+00010c40: 2020 2020 2020 2020 3e3e 3e20 290d 0a20          >>> ).. 
+00010c50: 2020 2022 2222 0d0a 2020 2020 0d0a 2020     """..    ..  
+00010c60: 2020 4b45 595f 5459 5045 5320 3d20 5b0d    KEY_TYPES = [.
+00010c70: 0a20 2020 2020 2020 2022 6165 7331 3238  .        "aes128
+00010c80: 2d67 636d 3936 222c 2020 2020 2020 2023  -gcm96",       #
+00010c90: 2041 4553 2d31 3238 2077 7261 7070 6564   AES-128 wrapped
+00010ca0: 2077 6974 6820 4743 4d20 7573 696e 6720   with GCM using 
+00010cb0: 6120 3936 2d62 6974 206e 6f6e 6365 2073  a 96-bit nonce s
+00010cc0: 697a 6520 4145 4144 200d 0a20 2020 2020  ize AEAD ..     
+00010cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ce0: 2020 2020 2020 2020 2023 2028 7379 6d6d           # (symm
+00010cf0: 6574 7269 632c 2073 7570 706f 7274 7320  etric, supports 
+00010d00: 6465 7269 7661 7469 6f6e 2061 6e64 2063  derivation and c
+00010d10: 6f6e 7665 7267 656e 7420 656e 6372 7970  onvergent encryp
+00010d20: 7469 6f6e 290d 0a20 2020 2020 2020 2020  tion)..         
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d40: 2020 2020 200d 0a20 2020 2020 2020 2022       ..        "
+00010d50: 6165 7332 3536 2d67 636d 3936 222c 2020  aes256-gcm96",  
+00010d60: 2020 2020 2023 2041 4553 2d32 3536 2077       # AES-256 w
+00010d70: 7261 7070 6564 2077 6974 6820 4743 4d20  rapped with GCM 
+00010d80: 7573 696e 6720 6120 3936 2d62 6974 206e  using a 96-bit n
+00010d90: 6f6e 6365 2073 697a 6520 4145 4144 200d  once size AEAD .
+00010da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010db0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00010dc0: 2028 7379 6d6d 6574 7269 632c 2073 7570   (symmetric, sup
+00010dd0: 706f 7274 7320 6465 7269 7661 7469 6f6e  ports derivation
+00010de0: 2061 6e64 2063 6f6e 7665 7267 656e 7420   and convergent 
+00010df0: 656e 6372 7970 7469 6f6e 2c20 6465 6661  encryption, defa
+00010e00: 756c 7429 0d0a 2020 2020 2020 2020 2020  ult)..          
+00010e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e20: 2020 2020 0d0a 2020 2020 2020 2020 2263      ..        "c
+00010e30: 6861 6368 6132 302d 706f 6c79 3133 3035  hacha20-poly1305
+00010e40: 222c 2020 2320 4368 6143 6861 3230 2d50  ",  # ChaCha20-P
+00010e50: 6f6c 7931 3330 3520 4145 4144 2028 7379  oly1305 AEAD (sy
+00010e60: 6d6d 6574 7269 632c 2073 7570 706f 7274  mmetric, support
+00010e70: 7320 6465 7269 7661 7469 6f6e 2061 6e64  s derivation and
+00010e80: 2063 6f6e 7665 7267 656e 7420 656e 6372   convergent encr
+00010e90: 7970 7469 6f6e 290d 0a20 2020 2020 2020  yption)..       
+00010ea0: 200d 0a20 2020 2020 2020 2022 6564 3235   ..        "ed25
+00010eb0: 3531 3922 2c20 2020 2020 2020 2020 2020  519",           
+00010ec0: 2023 2045 4432 3535 3139 2028 6173 796d   # ED25519 (asym
+00010ed0: 6d65 7472 6963 2c20 7375 7070 6f72 7473  metric, supports
+00010ee0: 2064 6572 6976 6174 696f 6e29 2e20 5768   derivation). Wh
+00010ef0: 656e 2075 7369 6e67 2064 6572 6976 6174  en using derivat
+00010f00: 696f 6e2c 200d 0a20 2020 2020 2020 2020  ion, ..         
+00010f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f20: 2020 2020 2023 2061 2073 6967 6e20 6f70       # a sign op
+00010f30: 6572 6174 696f 6e20 7769 7468 2074 6865  eration with the
+00010f40: 2073 616d 6520 636f 6e74 6578 7420 7769   same context wi
+00010f50: 6c6c 2064 6572 6976 6520 7468 6520 7361  ll derive the sa
+00010f60: 6d65 206b 6579 2061 6e64 2073 6967 6e61  me key and signa
+00010f70: 7475 7265 3b20 0d0a 2020 2020 2020 2020  ture; ..        
+00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f90: 2020 2020 2020 2320 7468 6973 2069 7320        # this is 
+00010fa0: 6120 7369 676e 696e 6720 616e 616c 6f67  a signing analog
+00010fb0: 7565 2074 6f20 636f 6e76 6572 6765 6e74  ue to convergent
+00010fc0: 5f65 6e63 7279 7074 696f 6e0d 0a20 2020  _encryption..   
+00010fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fe0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00010ff0: 2020 2020 2022 6563 6473 612d 7032 3536       "ecdsa-p256
+00011000: 222c 2020 2020 2020 2020 2023 2045 4344  ",         # ECD
+00011010: 5341 2075 7369 6e67 2074 6865 2050 2d32  SA using the P-2
+00011020: 3536 2065 6c6c 6970 7469 6320 6375 7276  56 elliptic curv
+00011030: 6520 2861 7379 6d6d 6574 7269 6329 0d0a  e (asymmetric)..
+00011040: 2020 2020 2020 2020 2265 6364 7361 2d70          "ecdsa-p
+00011050: 3338 3422 2c20 2020 2020 2020 2020 2320  384",         # 
+00011060: 4543 4453 4120 7573 696e 6720 7468 6520  ECDSA using the 
+00011070: 502d 3338 3420 656c 6c69 7074 6963 2063  P-384 elliptic c
+00011080: 7572 7665 2028 6173 796d 6d65 7472 6963  urve (asymmetric
+00011090: 290d 0a20 2020 2020 2020 2022 6563 6473  )..        "ecds
+000110a0: 612d 7035 3231 222c 2020 2020 2020 2020  a-p521",        
+000110b0: 2023 2045 4344 5341 2075 7369 6e67 2074   # ECDSA using t
+000110c0: 6865 2050 2d35 3231 2065 6c6c 6970 7469  he P-521 ellipti
+000110d0: 6320 6375 7276 6520 2861 7379 6d6d 6574  c curve (asymmet
+000110e0: 7269 6329 0d0a 2020 2020 2020 2020 0d0a  ric)..        ..
+000110f0: 2020 2020 2020 2020 2272 7361 2d32 3034          "rsa-204
+00011100: 3822 2c20 2020 2020 2020 2020 2020 2320  8",           # 
+00011110: 5253 4120 7769 7468 2062 6974 2073 697a  RSA with bit siz
+00011120: 6520 6f66 2032 3034 3820 2861 7379 6d6d  e of 2048 (asymm
+00011130: 6574 7269 6329 0d0a 2020 2020 2020 2020  etric)..        
+00011140: 2272 7361 2d33 3037 3222 2c20 2020 2020  "rsa-3072",     
+00011150: 2020 2020 2020 2320 5253 4120 7769 7468        # RSA with
+00011160: 2062 6974 2073 697a 6520 6f66 2033 3037   bit size of 307
+00011170: 3220 2861 7379 6d6d 6574 7269 6329 0d0a  2 (asymmetric)..
+00011180: 2020 2020 2020 2020 2272 7361 2d34 3039          "rsa-409
+00011190: 3622 2c20 2020 2020 2020 2020 2020 2320  6",           # 
+000111a0: 5253 4120 7769 7468 2062 6974 2073 697a  RSA with bit siz
+000111b0: 6520 6f66 2034 3039 3620 2861 7379 6d6d  e of 4096 (asymm
+000111c0: 6574 7269 6329 0d0a 2020 2020 2020 2020  etric)..        
+000111d0: 0d0a 2020 2020 2020 2020 2268 6d61 6322  ..        "hmac"
+000111e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111f0: 2320 484d 4143 2028 484d 4143 2067 656e  # HMAC (HMAC gen
+00011200: 6572 6174 696f 6e2c 2076 6572 6966 6963  eration, verific
+00011210: 6174 696f 6e29 0d0a 2020 2020 5d0d 0a20  ation)..    ].. 
+00011220: 2020 200d 0a20 2020 2023 2054 4f44 4f3a     ..    # TODO:
+00011230: 2070 6172 6974 616c 2074 6573 7465 642c   parital tested,
+00011240: 2077 6169 7420 666f 7220 7465 7374 696e   wait for testin
+00011250: 670d 0a20 2020 2064 6566 2063 7265 6174  g..    def creat
+00011260: 655f 6b65 7928 7365 6c66 2c20 0d0a 2020  e_key(self, ..  
 00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011280: 2020 206e 616d 653a 2073 7472 2c0d 0a20     name: str,.. 
-00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112a0: 2020 636f 6e76 6572 6765 6e74 5f65 6e63    convergent_enc
-000112b0: 7279 7074 696f 6e3a 2062 6f6f 6c20 3d20  ryption: bool = 
-000112c0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
-000112d0: 2020 2020 2020 2020 2020 2064 6572 6976             deriv
-000112e0: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
-000112f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00011300: 2020 2020 2020 6578 706f 7274 6162 6c65        exportable
-00011310: 3a20 626f 6f6c 203d 2046 616c 7365 2c0d  : bool = False,.
-00011320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011330: 2020 2020 616c 6c6f 775f 706c 6169 6e74      allow_plaint
-00011340: 6578 745f 6261 636b 7570 3a20 626f 6f6c  ext_backup: bool
-00011350: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-00011360: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00011370: 795f 7479 7065 3a20 7374 7220 3d20 2261  y_type: str = "a
-00011380: 6573 3235 362d 6763 6d39 3622 2c0d 0a20  es256-gcm96",.. 
-00011390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113a0: 2020 6b65 795f 7369 7a65 3a20 696e 7420    key_size: int 
-000113b0: 3d20 302c 0d0a 2020 2020 2020 2020 2020  = 0,..          
-000113c0: 2020 2020 2020 2020 2061 7574 6f5f 726f           auto_ro
-000113d0: 7461 7465 5f70 6572 696f 643a 2073 7472  tate_period: str
-000113e0: 203d 2022 3022 293a 0d0a 2020 2020 2020   = "0"):..      
-000113f0: 2020 2222 2263 7265 6174 6520 6120 6e65    """create a ne
-00011400: 7720 6e61 6d65 6420 656e 6372 7970 7469  w named encrypti
-00011410: 6f6e 206b 6579 206f 6620 7468 6520 7370  on key of the sp
-00011420: 6563 6966 6965 6420 7479 7065 0d0a 0d0a  ecified type....
-00011430: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
-00011440: 2068 7474 7073 3a2f 2f64 6576 656c 6f70   https://develop
-00011450: 6572 2e68 6173 6869 636f 7270 2e63 6f6d  er.hashicorp.com
-00011460: 2f76 6175 6c74 2f61 7069 2d64 6f63 732f  /vault/api-docs/
-00011470: 7365 6372 6574 2f74 7261 6e73 6974 2363  secret/transit#c
-00011480: 7265 6174 652d 6b65 7920 666f 7220 6d6f  reate-key for mo
-00011490: 7265 2064 6574 6169 6c73 2e0d 0a0d 0a20  re details..... 
-000114a0: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-000114b0: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
-000114c0: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
-000114d0: 2020 2020 2020 2020 6e61 6d65 2028 7374          name (st
-000114e0: 7229 3a20 5370 6563 6966 6965 7320 7468  r): Specifies th
-000114f0: 6520 6e61 6d65 206f 6620 7468 6520 656e  e name of the en
-00011500: 6372 7970 7469 6f6e 206b 6579 2074 6f20  cryption key to 
-00011510: 6372 6561 7465 2e20 5468 6973 2069 7320  create. This is 
-00011520: 7370 6563 6966 6965 6420 6173 2070 6172  specified as par
-00011530: 7420 6f66 2074 6865 2055 524c 2e0d 0a20  t of the URL... 
-00011540: 2020 2020 2020 2020 2020 2063 6f6e 7665             conve
-00011550: 7267 656e 745f 656e 6372 7970 7469 6f6e  rgent_encryption
-00011560: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
-00011570: 293a 2049 6620 656e 6162 6c65 642c 2074  ): If enabled, t
-00011580: 6865 206b 6579 2077 696c 6c20 7375 7070  he key will supp
-00011590: 6f72 7420 636f 6e76 6572 6765 6e74 2065  ort convergent e
-000115a0: 6e63 7279 7074 696f 6e2c 200d 0a20 2020  ncryption, ..   
-000115b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115e0: 2077 6865 7265 2074 6865 2073 616d 6520   where the same 
-000115f0: 706c 6169 6e74 6578 7420 6372 6561 7465  plaintext create
-00011600: 7320 7468 6520 7361 6d65 2063 6970 6865  s the same ciphe
-00011610: 7274 6578 742e 200d 0a20 2020 2020 2020  rtext. ..       
-00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011640: 2020 2020 2020 2020 2020 2020 2054 6869               Thi
-00011650: 7320 7265 7175 6972 6573 2064 6572 6976  s requires deriv
-00011660: 6564 2074 6f20 6265 2073 6574 2074 6f20  ed to be set to 
-00011670: 6074 7275 6560 2e20 5768 656e 2065 6e61  `true`. When ena
-00011680: 626c 6564 2c20 0d0a 2020 2020 2020 2020  bled, ..        
-00011690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116b0: 2020 2020 2020 2020 2020 2020 6561 6368              each
-000116c0: 2065 6e63 7279 7074 696f 6e28 2f64 6563   encryption(/dec
-000116d0: 7279 7074 696f 6e2f 7265 7772 6170 2f64  ryption/rewrap/d
-000116e0: 6174 616b 6579 2920 6f70 6572 6174 696f  atakey) operatio
-000116f0: 6e20 7769 6c6c 200d 0a20 2020 2020 2020  n will ..       
-00011700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011720: 2020 2020 2020 2020 2020 2020 2064 6572               der
-00011730: 6976 6520 6120 606e 6f6e 6365 6020 7661  ive a `nonce` va
-00011740: 6c75 6520 7261 7468 6572 2074 6861 6e20  lue rather than 
-00011750: 7261 6e64 6f6d 6c79 2067 656e 6572 6174  randomly generat
-00011760: 6520 6974 2e20 0d0a 2020 2020 2020 2020  e it. ..        
-00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011790: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
-000117a0: 756c 7473 2074 6f20 4661 6c73 652e 0d0a  ults to False...
-000117b0: 2020 2020 2020 2020 2020 2020 6465 7269              deri
-000117c0: 7665 6420 2862 6f6f 6c2c 206f 7074 696f  ved (bool, optio
-000117d0: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
-000117e0: 6966 206b 6579 2064 6572 6976 6174 696f  if key derivatio
-000117f0: 6e20 6973 2074 6f20 6265 2075 7365 642e  n is to be used.
-00011800: 2049 6620 656e 6162 6c65 642c 2061 6c6c   If enabled, all
-00011810: 2065 6e63 7279 7074 2f64 6563 7279 7074   encrypt/decrypt
-00011820: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00011830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011840: 2020 2020 2020 2020 2072 6571 7565 7374           request
-00011850: 7320 746f 2074 6869 7320 6e61 6d65 6420  s to this named 
-00011860: 6b65 7920 6d75 7374 2070 726f 7669 6465  key must provide
-00011870: 2061 2063 6f6e 7465 7874 2077 6869 6368   a context which
-00011880: 2069 7320 7573 6564 2066 6f72 206b 6579   is used for key
-00011890: 2064 6572 6976 6174 696f 6e2e 200d 0a20   derivation. .. 
-000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118c0: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
-000118d0: 2046 616c 7365 2e0d 0a20 2020 2020 2020   False...       
-000118e0: 2020 2020 2065 7870 6f72 7461 626c 6520       exportable 
-000118f0: 2862 6f6f 6c2c 206f 7074 696f 6e61 6c29  (bool, optional)
-00011900: 3a20 456e 6162 6c65 7320 6b65 7973 2074  : Enables keys t
-00011910: 6f20 6265 2065 7870 6f72 7461 626c 652e  o be exportable.
-00011920: 2054 6869 7320 616c 6c6f 7773 2066 6f72   This allows for
-00011930: 2061 6c6c 2074 6865 2076 616c 6964 206b   all the valid k
-00011940: 6579 7320 696e 2074 6865 206b 6579 200d  eys in the key .
-00011950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011970: 2020 2020 2020 2020 2020 7269 6e67 2074            ring t
-00011980: 6f20 6265 2065 7870 6f72 7465 642e 204f  o be exported. O
-00011990: 6e63 6520 7365 742c 2074 6869 7320 6361  nce set, this ca
-000119a0: 6e6e 6f74 2062 6520 6469 7361 626c 6564  nnot be disabled
-000119b0: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
-000119c0: 6c73 652e 0d0a 2020 2020 2020 2020 2020  lse...          
-000119d0: 2020 616c 6c6f 775f 706c 6169 6e74 6578    allow_plaintex
-000119e0: 745f 6261 636b 7570 2028 626f 6f6c 2c20  t_backup (bool, 
-000119f0: 6f70 7469 6f6e 616c 293a 2049 6620 7365  optional): If se
-00011a00: 742c 2065 6e61 626c 6573 2074 616b 696e  t, enables takin
-00011a10: 6720 6261 636b 7570 206f 6620 6e61 6d65  g backup of name
-00011a20: 6420 6b65 7920 696e 2074 6865 2070 6c61  d key in the pla
-00011a30: 696e 7465 7874 2066 6f72 6d61 742e 200d  intext format. .
-00011a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a70: 2020 2020 2020 4f6e 6365 2073 6574 2c20        Once set, 
-00011a80: 7468 6973 2063 616e 6e6f 7420 6265 2064  this cannot be d
-00011a90: 6973 6162 6c65 642e 2044 6566 6175 6c74  isabled. Default
-00011aa0: 7320 746f 2046 616c 7365 2e0d 0a20 2020  s to False...   
-00011ab0: 2020 2020 2020 2020 206b 6579 5f74 7970           key_typ
-00011ac0: 6520 2873 7472 2c20 6f70 7469 6f6e 616c  e (str, optional
-00011ad0: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
-00011ae0: 2074 7970 6520 6f66 206b 6579 2074 6f20   type of key to 
-00011af0: 6372 6561 7465 2e20 4465 6661 756c 7473  create. Defaults
-00011b00: 2074 6f20 2261 6573 3235 362d 6763 6d39   to "aes256-gcm9
-00011b10: 3622 2e0d 0a20 2020 2020 2020 2020 2020  6"...           
-00011b20: 206b 6579 5f73 697a 6520 2869 6e74 2c20   key_size (int, 
-00011b30: 6f70 7469 6f6e 616c 293a 2054 6865 206b  optional): The k
-00011b40: 6579 2073 697a 6520 696e 2062 7974 6573  ey size in bytes
-00011b50: 2066 6f72 2061 6c67 6f72 6974 686d 7320   for algorithms 
-00011b60: 7468 6174 2061 6c6c 6f77 2076 6172 6961  that allow varia
-00011b70: 626c 6520 6b65 7920 7369 7a65 732e 200d  ble key sizes. .
-00011b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ba0: 2020 2020 2020 2043 7572 7265 6e74 6c79         Currently
-00011bb0: 206f 6e6c 7920 6170 706c 6963 6162 6c65   only applicable
-00011bc0: 2074 6f20 484d 4143 2c20 7768 6572 6520   to HMAC, where 
-00011bd0: 6974 206d 7573 7420 6265 2062 6574 7765  it must be betwe
-00011be0: 656e 2033 3220 616e 6420 3531 3220 6279  en 32 and 512 by
-00011bf0: 7465 732e 200d 0a20 2020 2020 2020 2020  tes. ..         
-00011c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c10: 2020 2020 2020 2020 2020 2020 2044 6566               Def
-00011c20: 6175 6c74 7320 746f 2030 2e0d 0a20 2020  aults to 0...   
-00011c30: 2020 2020 2020 2020 2061 7574 6f5f 726f           auto_ro
-00011c40: 7461 7465 5f70 6572 696f 6420 2873 7472  tate_period (str
-00011c50: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
-00011c60: 2070 6572 696f 6420 6174 2077 6869 6368   period at which
-00011c70: 2074 6869 7320 6b65 7920 7368 6f75 6c64   this key should
-00011c80: 2062 6520 726f 7461 7465 6420 6175 746f   be rotated auto
-00011c90: 6d61 7469 6361 6c6c 792e 200d 0a20 2020  matically. ..   
-00011ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cc0: 2020 2020 2020 2020 2020 2020 2053 6574               Set
-00011cd0: 7469 6e67 2074 6869 7320 746f 2022 3022  ting this to "0"
-00011ce0: 2028 7468 6520 6465 6661 756c 7429 2077   (the default) w
-00011cf0: 696c 6c20 6469 7361 626c 6520 6175 746f  ill disable auto
-00011d00: 6d61 7469 6320 6b65 7920 726f 7461 7469  matic key rotati
-00011d10: 6f6e 2e20 0d0a 2020 2020 2020 2020 2020  on. ..          
-00011d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d40: 2020 2020 2020 5468 6973 2076 616c 7565        This value
-00011d50: 2063 616e 6e6f 7420 6265 2073 686f 7274   cannot be short
-00011d60: 6572 2074 6861 6e20 6f6e 6520 686f 7572  er than one hour
-00011d70: 2e20 4465 6661 756c 7473 2074 6f20 2230  . Defaults to "0
-00011d80: 222e 0d0a 0d0a 2020 2020 2020 2020 5265  ".....        Re
-00011d90: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-00011da0: 2020 2020 626f 6f6c 3a20 7265 7475 726e      bool: return
-00011db0: 2054 7275 6520 6966 2073 7563 6365 7373   True if success
-00011dc0: 2c20 6f74 6865 7277 6973 6520 7265 7475  , otherwise retu
-00011dd0: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-00011de0: 2020 2222 220d 0a20 2020 2020 2020 200d    """..        .
-00011df0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00011e00: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-00011e10: 2020 2020 2020 2065 7869 7374 5f6b 6579         exist_key
-00011e20: 7320 3d20 7365 6c66 2e6c 6973 745f 6b65  s = self.list_ke
-00011e30: 7928 6d6f 756e 745f 7061 7468 290d 0a20  y(mount_path).. 
-00011e40: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-00011e50: 6d65 2069 6e20 6578 6973 745f 6b65 7973  me in exist_keys
-00011e60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011e70: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-00011e80: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-00011e90: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6372  _.__name__} - cr
-00011ea0: 6561 7465 206b 6579 2065 7272 6f72 3a20  eate key error: 
-00011eb0: 6b65 7920 277b 6e61 6d65 7d27 2061 6c72  key '{name}' alr
-00011ec0: 6561 6479 2065 7869 7374 7322 290d 0a20  eady exists").. 
-00011ed0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00011ee0: 6574 7572 6e20 4661 6c73 650d 0a0d 0a20  eturn False.... 
-00011ef0: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
-00011f00: 6164 203d 2043 6f6e 6669 6744 6963 7428  ad = ConfigDict(
-00011f10: 290d 0a20 2020 2020 2020 2020 2020 200d  )..            .
-00011f20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00011f30: 636f 6e76 6572 6765 6e74 5f65 6e63 7279  convergent_encry
-00011f40: 7074 696f 6e3a 0d0a 2020 2020 2020 2020  ption:..        
-00011f50: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-00011f60: 6572 6976 6564 3a0d 0a20 2020 2020 2020  erived:..       
-00011f70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011f80: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-00011f90: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-00011fa0: 6d65 5f5f 7d20 2d20 6372 6561 7465 206b  me__} - create k
-00011fb0: 6579 2065 7272 6f72 3a20 7768 656e 2063  ey error: when c
-00011fc0: 6f6e 7665 7267 656e 745f 656e 6372 7970  onvergent_encryp
-00011fd0: 7469 6f6e 2069 7320 5472 7565 2c22 0d0a  tion is True,"..
-00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012000: 2020 2020 2020 6622 2069 7420 7265 7175        f" it requ
-00012010: 6972 6573 2064 6572 6976 6564 2074 6f20  ires derived to 
-00012020: 6265 2073 6574 2074 6f20 5472 7565 2229  be set to True")
-00012030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012040: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00012050: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00012060: 2020 2020 7061 796c 6f61 645b 2263 6f6e      payload["con
-00012070: 7665 7267 656e 745f 656e 6372 7970 7469  vergent_encrypti
-00012080: 6f6e 225d 203d 2063 6f6e 7665 7267 656e  on"] = convergen
-00012090: 745f 656e 6372 7970 7469 6f6e 0d0a 2020  t_encryption..  
-000120a0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000120b0: 2020 2020 2020 2020 6966 2064 6572 6976          if deriv
-000120c0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-000120d0: 2020 2020 2070 6179 6c6f 6164 5b22 6465       payload["de
-000120e0: 7269 7665 6422 5d20 3d20 6465 7269 7665  rived"] = derive
-000120f0: 640d 0a20 2020 2020 2020 2020 2020 200d  d..            .
-00012100: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00012110: 6578 706f 7274 6162 6c65 3a0d 0a20 2020  exportable:..   
-00012120: 2020 2020 2020 2020 2020 2020 2070 6179               pay
-00012130: 6c6f 6164 5b22 6578 706f 7274 6162 6c65  load["exportable
-00012140: 225d 203d 2065 7870 6f72 7461 626c 650d  "] = exportable.
-00012150: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00012160: 6620 616c 6c6f 775f 706c 6169 6e74 6578  f allow_plaintex
-00012170: 745f 6261 636b 7570 3a0d 0a20 2020 2020  t_backup:..     
-00012180: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
-00012190: 6164 5b22 616c 6c6f 775f 706c 6169 6e74  ad["allow_plaint
-000121a0: 6578 745f 6261 636b 7570 225d 203d 2061  ext_backup"] = a
-000121b0: 6c6c 6f77 5f70 6c61 696e 7465 7874 5f62  llow_plaintext_b
-000121c0: 6163 6b75 700d 0a0d 0a20 2020 2020 2020  ackup....       
-000121d0: 2020 2020 2069 6620 6b65 795f 7479 7065       if key_type
-000121e0: 2e6c 6f77 6572 2829 206e 6f74 2069 6e20  .lower() not in 
-000121f0: 7365 6c66 2e4b 4559 5f54 5950 4553 3a0d  self.KEY_TYPES:.
-00012200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012210: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-00012220: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-00012230: 5f5f 6e61 6d65 5f5f 7d20 2d20 6372 6561  __name__} - crea
-00012240: 7465 206b 6579 2065 7272 6f72 3a20 6b65  te key error: ke
-00012250: 795f 7479 7065 206d 7573 7420 6265 206f  y_type must be o
-00012260: 6e65 206f 6620 7b73 656c 662e 4b45 595f  ne of {self.KEY_
-00012270: 5459 5045 537d 2229 0d0a 2020 2020 2020  TYPES}")..      
-00012280: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012290: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000122a0: 2020 2020 7061 796c 6f61 645b 2274 7970      payload["typ
-000122b0: 6522 5d20 3d20 6b65 795f 7479 7065 2e6c  e"] = key_type.l
-000122c0: 6f77 6572 2829 0d0a 0d0a 2020 2020 2020  ower()....      
-000122d0: 2020 2020 2020 6966 206b 6579 5f73 697a        if key_siz
-000122e0: 6520 3e20 303a 0d0a 2020 2020 2020 2020  e > 0:..        
-000122f0: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
-00012300: 226b 6579 5f73 697a 6522 5d20 3d20 6b65  "key_size"] = ke
-00012310: 795f 7369 7a65 0d0a 2020 2020 2020 2020  y_size..        
-00012320: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00012330: 2020 726f 7461 7465 5f70 6572 696f 6420    rotate_period 
-00012340: 3d20 5661 756c 7444 7572 6174 696f 6e28  = VaultDuration(
-00012350: 6175 746f 5f72 6f74 6174 655f 7065 7269  auto_rotate_peri
-00012360: 6f64 290d 0a20 2020 2020 2020 2020 2020  od)..           
-00012370: 2069 6620 726f 7461 7465 5f70 6572 696f   if rotate_perio
-00012380: 642e 7661 6c75 6520 3e20 303a 0d0a 2020  d.value > 0:..  
-00012390: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000123a0: 7765 725f 7065 7269 6f64 203d 2056 6175  wer_period = Vau
-000123b0: 6c74 4475 7261 7469 6f6e 2822 3168 2229  ltDuration("1h")
-000123c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000123d0: 2020 6966 2072 6f74 6174 655f 7065 7269    if rotate_peri
-000123e0: 6f64 203c 206c 6f77 6572 5f70 6572 696f  od < lower_perio
-000123f0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00012400: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00012410: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-00012420: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00012430: 202d 2063 7265 6174 6520 6b65 7920 6572   - create key er
-00012440: 726f 723a 2054 6865 2076 616c 7565 206f  ror: The value o
-00012450: 6620 6175 746f 5f72 6f74 6174 655f 7065  f auto_rotate_pe
-00012460: 7269 6f64 2063 616e 6e6f 7420 6265 2073  riod cannot be s
-00012470: 686f 7274 6572 2074 6861 6e20 6f6e 6520  horter than one 
-00012480: 686f 7572 2229 0d0a 2020 2020 2020 2020  hour")..        
-00012490: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000124a0: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-000124b0: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-000124c0: 645b 2261 7574 6f5f 726f 7461 7465 5f70  d["auto_rotate_p
-000124d0: 6572 696f 6422 5d20 3d20 6175 746f 5f72  eriod"] = auto_r
-000124e0: 6f74 6174 655f 7065 7269 6f64 0d0a 2020  otate_period..  
-000124f0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00012500: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
-00012510: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-00012520: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
-00012530: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-00012540: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-00012550: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-00012560: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-00012570: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-00012580: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
-00012590: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
-000125a0: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
-000125b0: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-000125c0: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-000125d0: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-000125e0: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-000125f0: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-00012600: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
-00012610: 7473 2e70 6f73 7428 7572 6c2b 6622 7b6d  ts.post(url+f"{m
-00012620: 6f75 6e74 5f70 6174 687d 2f6b 6579 732f  ount_path}/keys/
-00012630: 7b6e 616d 657d 222c 2068 6561 6465 7273  {name}", headers
-00012640: 3d7b 2258 2d56 6175 6c74 2d54 6f6b 656e  ={"X-Vault-Token
-00012650: 223a 2074 6f6b 656e 7d2c 2064 6174 613d  ": token}, data=
-00012660: 6a73 6f6e 2e64 756d 7073 2870 6179 6c6f  json.dumps(paylo
-00012670: 6164 2929 0d0a 2020 2020 2020 2020 2020  ad))..          
-00012680: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
-00012690: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
-000126a0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-000126b0: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
-000126c0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-000126d0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-000126e0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000126f0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-00012700: 675f 6572 726f 725f 7265 7370 6f6e 7365  g_error_response
-00012710: 285f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  (__class__.__nam
-00012720: 655f 5f2c 2072 6573 2c20 2263 7265 6174  e__, res, "creat
-00012730: 6520 6b65 7920 6572 726f 7222 290d 0a20  e key error").. 
-00012740: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00012750: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-00012760: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
-00012770: 6574 7572 6e20 4661 6c73 650d 0a0d 0a20  eturn False.... 
-00012780: 2020 2064 6566 2069 6d70 6f72 745f 6b65     def import_ke
-00012790: 7928 7365 6c66 2c20 0d0a 2020 2020 2020  y(self, ..      
-000127a0: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
-000127b0: 6e74 5f70 6174 683a 2073 7472 2c0d 0a20  nt_path: str,.. 
+00011280: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
+00011290: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+000112a0: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
+000112b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000112c0: 2020 2020 2020 636f 6e76 6572 6765 6e74        convergent
+000112d0: 5f65 6e63 7279 7074 696f 6e3a 2062 6f6f  _encryption: boo
+000112e0: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
+000112f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011300: 6572 6976 6564 3a20 626f 6f6c 203d 2046  erived: bool = F
+00011310: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
+00011320: 2020 2020 2020 2020 2020 6578 706f 7274            export
+00011330: 6162 6c65 3a20 626f 6f6c 203d 2046 616c  able: bool = Fal
+00011340: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+00011350: 2020 2020 2020 2020 616c 6c6f 775f 706c          allow_pl
+00011360: 6169 6e74 6578 745f 6261 636b 7570 3a20  aintext_backup: 
+00011370: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+00011380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011390: 2020 6b65 795f 7479 7065 3a20 7374 7220    key_type: str 
+000113a0: 3d20 2261 6573 3235 362d 6763 6d39 3622  = "aes256-gcm96"
+000113b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000113c0: 2020 2020 2020 6b65 795f 7369 7a65 3a20        key_size: 
+000113d0: 696e 7420 3d20 302c 0d0a 2020 2020 2020  int = 0,..      
+000113e0: 2020 2020 2020 2020 2020 2020 2061 7574               aut
+000113f0: 6f5f 726f 7461 7465 5f70 6572 696f 643a  o_rotate_period:
+00011400: 2073 7472 203d 2022 3022 293a 0d0a 2020   str = "0"):..  
+00011410: 2020 2020 2020 2222 2263 7265 6174 6520        """create 
+00011420: 6120 6e65 7720 6e61 6d65 6420 656e 6372  a new named encr
+00011430: 7970 7469 6f6e 206b 6579 206f 6620 7468  yption key of th
+00011440: 6520 7370 6563 6966 6965 6420 7479 7065  e specified type
+00011450: 0d0a 0d0a 2020 2020 2020 2020 5265 6665  ....        Refe
+00011460: 7220 746f 2068 7474 7073 3a2f 2f64 6576  r to https://dev
+00011470: 656c 6f70 6572 2e68 6173 6869 636f 7270  eloper.hashicorp
+00011480: 2e63 6f6d 2f76 6175 6c74 2f61 7069 2d64  .com/vault/api-d
+00011490: 6f63 732f 7365 6372 6574 2f74 7261 6e73  ocs/secret/trans
+000114a0: 6974 2363 7265 6174 652d 6b65 7920 666f  it#create-key fo
+000114b0: 7220 6d6f 7265 2064 6574 6169 6c73 2e0d  r more details..
+000114c0: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+000114d0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+000114e0: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
+000114f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00011500: 2028 7374 7229 3a20 5370 6563 6966 6965   (str): Specifie
+00011510: 7320 7468 6520 6e61 6d65 206f 6620 7468  s the name of th
+00011520: 6520 656e 6372 7970 7469 6f6e 206b 6579  e encryption key
+00011530: 2074 6f20 6372 6561 7465 2e20 5468 6973   to create. This
+00011540: 2069 7320 7370 6563 6966 6965 6420 6173   is specified as
+00011550: 2070 6172 7420 6f66 2074 6865 2055 524c   part of the URL
+00011560: 2e0d 0a20 2020 2020 2020 2020 2020 2063  ...            c
+00011570: 6f6e 7665 7267 656e 745f 656e 6372 7970  onvergent_encryp
+00011580: 7469 6f6e 2028 626f 6f6c 2c20 6f70 7469  tion (bool, opti
+00011590: 6f6e 616c 293a 2049 6620 656e 6162 6c65  onal): If enable
+000115a0: 642c 2074 6865 206b 6579 2077 696c 6c20  d, the key will 
+000115b0: 7375 7070 6f72 7420 636f 6e76 6572 6765  support converge
+000115c0: 6e74 2065 6e63 7279 7074 696f 6e2c 200d  nt encryption, .
+000115d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000115e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011600: 2020 2020 2077 6865 7265 2074 6865 2073       where the s
+00011610: 616d 6520 706c 6169 6e74 6578 7420 6372  ame plaintext cr
+00011620: 6561 7465 7320 7468 6520 7361 6d65 2063  eates the same c
+00011630: 6970 6865 7274 6578 742e 200d 0a20 2020  iphertext. ..   
+00011640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011670: 2054 6869 7320 7265 7175 6972 6573 2064   This requires d
+00011680: 6572 6976 6564 2074 6f20 6265 2073 6574  erived to be set
+00011690: 2074 6f20 6074 7275 6560 2e20 5768 656e   to `true`. When
+000116a0: 2065 6e61 626c 6564 2c20 0d0a 2020 2020   enabled, ..    
+000116b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116e0: 6561 6368 2065 6e63 7279 7074 696f 6e28  each encryption(
+000116f0: 2f64 6563 7279 7074 696f 6e2f 7265 7772  /decryption/rewr
+00011700: 6170 2f64 6174 616b 6579 2920 6f70 6572  ap/datakey) oper
+00011710: 6174 696f 6e20 7769 6c6c 200d 0a20 2020  ation will ..   
+00011720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011750: 2064 6572 6976 6520 6120 606e 6f6e 6365   derive a `nonce
+00011760: 6020 7661 6c75 6520 7261 7468 6572 2074  ` value rather t
+00011770: 6861 6e20 7261 6e64 6f6d 6c79 2067 656e  han randomly gen
+00011780: 6572 6174 6520 6974 2e20 0d0a 2020 2020  erate it. ..    
+00011790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117c0: 4465 6661 756c 7473 2074 6f20 4661 6c73  Defaults to Fals
+000117d0: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
+000117e0: 6465 7269 7665 6420 2862 6f6f 6c2c 206f  derived (bool, o
+000117f0: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
+00011800: 6965 7320 6966 206b 6579 2064 6572 6976  ies if key deriv
+00011810: 6174 696f 6e20 6973 2074 6f20 6265 2075  ation is to be u
+00011820: 7365 642e 2049 6620 656e 6162 6c65 642c  sed. If enabled,
+00011830: 2061 6c6c 2065 6e63 7279 7074 2f64 6563   all encrypt/dec
+00011840: 7279 7074 200d 0a20 2020 2020 2020 2020  rypt ..         
+00011850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011860: 2020 2020 2020 2020 2020 2020 2072 6571               req
+00011870: 7565 7374 7320 746f 2074 6869 7320 6e61  uests to this na
+00011880: 6d65 6420 6b65 7920 6d75 7374 2070 726f  med key must pro
+00011890: 7669 6465 2061 2063 6f6e 7465 7874 2077  vide a context w
+000118a0: 6869 6368 2069 7320 7573 6564 2066 6f72  hich is used for
+000118b0: 206b 6579 2064 6572 6976 6174 696f 6e2e   key derivation.
+000118c0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+000118d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118e0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+000118f0: 7320 746f 2046 616c 7365 2e0d 0a20 2020  s to False...   
+00011900: 2020 2020 2020 2020 2065 7870 6f72 7461           exporta
+00011910: 626c 6520 2862 6f6f 6c2c 206f 7074 696f  ble (bool, optio
+00011920: 6e61 6c29 3a20 456e 6162 6c65 7320 6b65  nal): Enables ke
+00011930: 7973 2074 6f20 6265 2065 7870 6f72 7461  ys to be exporta
+00011940: 626c 652e 2054 6869 7320 616c 6c6f 7773  ble. This allows
+00011950: 2066 6f72 2061 6c6c 2074 6865 2076 616c   for all the val
+00011960: 6964 206b 6579 7320 696e 2074 6865 206b  id keys in the k
+00011970: 6579 200d 0a20 2020 2020 2020 2020 2020  ey ..           
+00011980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011990: 2020 2020 2020 2020 2020 2020 2020 7269                ri
+000119a0: 6e67 2074 6f20 6265 2065 7870 6f72 7465  ng to be exporte
+000119b0: 642e 204f 6e63 6520 7365 742c 2074 6869  d. Once set, thi
+000119c0: 7320 6361 6e6e 6f74 2062 6520 6469 7361  s cannot be disa
+000119d0: 626c 6564 2e20 4465 6661 756c 7473 2074  bled. Defaults t
+000119e0: 6f20 4661 6c73 652e 0d0a 2020 2020 2020  o False...      
+000119f0: 2020 2020 2020 616c 6c6f 775f 706c 6169        allow_plai
+00011a00: 6e74 6578 745f 6261 636b 7570 2028 626f  ntext_backup (bo
+00011a10: 6f6c 2c20 6f70 7469 6f6e 616c 293a 2049  ol, optional): I
+00011a20: 6620 7365 742c 2065 6e61 626c 6573 2074  f set, enables t
+00011a30: 616b 696e 6720 6261 636b 7570 206f 6620  aking backup of 
+00011a40: 6e61 6d65 6420 6b65 7920 696e 2074 6865  named key in the
+00011a50: 2070 6c61 696e 7465 7874 2066 6f72 6d61   plaintext forma
+00011a60: 742e 200d 0a20 2020 2020 2020 2020 2020  t. ..           
+00011a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a90: 2020 2020 2020 2020 2020 4f6e 6365 2073            Once s
+00011aa0: 6574 2c20 7468 6973 2063 616e 6e6f 7420  et, this cannot 
+00011ab0: 6265 2064 6973 6162 6c65 642e 2044 6566  be disabled. Def
+00011ac0: 6175 6c74 7320 746f 2046 616c 7365 2e0d  aults to False..
+00011ad0: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
+00011ae0: 5f74 7970 6520 2873 7472 2c20 6f70 7469  _type (str, opti
+00011af0: 6f6e 616c 293a 2053 7065 6369 6669 6573  onal): Specifies
+00011b00: 2074 6865 2074 7970 6520 6f66 206b 6579   the type of key
+00011b10: 2074 6f20 6372 6561 7465 2e20 4465 6661   to create. Defa
+00011b20: 756c 7473 2074 6f20 2261 6573 3235 362d  ults to "aes256-
+00011b30: 6763 6d39 3622 2e0d 0a20 2020 2020 2020  gcm96"...       
+00011b40: 2020 2020 206b 6579 5f73 697a 6520 2869       key_size (i
+00011b50: 6e74 2c20 6f70 7469 6f6e 616c 293a 2054  nt, optional): T
+00011b60: 6865 206b 6579 2073 697a 6520 696e 2062  he key size in b
+00011b70: 7974 6573 2066 6f72 2061 6c67 6f72 6974  ytes for algorit
+00011b80: 686d 7320 7468 6174 2061 6c6c 6f77 2076  hms that allow v
+00011b90: 6172 6961 626c 6520 6b65 7920 7369 7a65  ariable key size
+00011ba0: 732e 200d 0a20 2020 2020 2020 2020 2020  s. ..           
+00011bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bc0: 2020 2020 2020 2020 2020 2043 7572 7265             Curre
+00011bd0: 6e74 6c79 206f 6e6c 7920 6170 706c 6963  ntly only applic
+00011be0: 6162 6c65 2074 6f20 484d 4143 2c20 7768  able to HMAC, wh
+00011bf0: 6572 6520 6974 206d 7573 7420 6265 2062  ere it must be b
+00011c00: 6574 7765 656e 2033 3220 616e 6420 3531  etween 32 and 51
+00011c10: 3220 6279 7465 732e 200d 0a20 2020 2020  2 bytes. ..     
+00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c40: 2044 6566 6175 6c74 7320 746f 2030 2e0d   Defaults to 0..
+00011c50: 0a20 2020 2020 2020 2020 2020 2061 7574  .            aut
+00011c60: 6f5f 726f 7461 7465 5f70 6572 696f 6420  o_rotate_period 
+00011c70: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
+00011c80: 2054 6865 2070 6572 696f 6420 6174 2077   The period at w
+00011c90: 6869 6368 2074 6869 7320 6b65 7920 7368  hich this key sh
+00011ca0: 6f75 6c64 2062 6520 726f 7461 7465 6420  ould be rotated 
+00011cb0: 6175 746f 6d61 7469 6361 6c6c 792e 200d  automatically. .
+00011cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cf0: 2053 6574 7469 6e67 2074 6869 7320 746f   Setting this to
+00011d00: 2022 3022 2028 7468 6520 6465 6661 756c   "0" (the defaul
+00011d10: 7429 2077 696c 6c20 6469 7361 626c 6520  t) will disable 
+00011d20: 6175 746f 6d61 7469 6320 6b65 7920 726f  automatic key ro
+00011d30: 7461 7469 6f6e 2e20 0d0a 2020 2020 2020  tation. ..      
+00011d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d60: 2020 2020 2020 2020 2020 5468 6973 2076            This v
+00011d70: 616c 7565 2063 616e 6e6f 7420 6265 2073  alue cannot be s
+00011d80: 686f 7274 6572 2074 6861 6e20 6f6e 6520  horter than one 
+00011d90: 686f 7572 2e20 4465 6661 756c 7473 2074  hour. Defaults t
+00011da0: 6f20 2230 222e 0d0a 0d0a 2020 2020 2020  o "0".....      
+00011db0: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+00011dc0: 2020 2020 2020 2020 626f 6f6c 3a20 7265          bool: re
+00011dd0: 7475 726e 2054 7275 6520 6966 2073 7563  turn True if suc
+00011de0: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
+00011df0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+00011e00: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00011e10: 2020 200d 0a20 2020 2020 2020 2069 6620     ..        if 
+00011e20: 7365 6c66 2e69 735f 6175 7468 3a0d 0a20  self.is_auth:.. 
+00011e30: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+00011e40: 5f6b 6579 7320 3d20 7365 6c66 2e6c 6973  _keys = self.lis
+00011e50: 745f 6b65 7928 6d6f 756e 745f 7061 7468  t_key(mount_path
+00011e60: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00011e70: 6620 6e61 6d65 2069 6e20 6578 6973 745f  f name in exist_
+00011e80: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
+00011e90: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+00011ea0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+00011eb0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+00011ec0: 2d20 6372 6561 7465 206b 6579 2065 7272  - create key err
+00011ed0: 6f72 3a20 6b65 7920 277b 6e61 6d65 7d27  or: key '{name}'
+00011ee0: 2061 6c72 6561 6479 2065 7869 7374 7322   already exists"
+00011ef0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00011f00: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00011f10: 0a0d 0a20 2020 2020 2020 2020 2020 2070  ...            p
+00011f20: 6179 6c6f 6164 203d 2043 6f6e 6669 6744  ayload = ConfigD
+00011f30: 6963 7428 290d 0a20 2020 2020 2020 2020  ict()..         
+00011f40: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00011f50: 2069 6620 636f 6e76 6572 6765 6e74 5f65   if convergent_e
+00011f60: 6e63 7279 7074 696f 6e3a 0d0a 2020 2020  ncryption:..    
+00011f70: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00011f80: 6f74 2064 6572 6976 6564 3a0d 0a20 2020  ot derived:..   
+00011f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fa0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+00011fb0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+00011fc0: 5f5f 6e61 6d65 5f5f 7d20 2d20 6372 6561  __name__} - crea
+00011fd0: 7465 206b 6579 2065 7272 6f72 3a20 7768  te key error: wh
+00011fe0: 656e 2063 6f6e 7665 7267 656e 745f 656e  en convergent_en
+00011ff0: 6372 7970 7469 6f6e 2069 7320 5472 7565  cryption is True
+00012000: 2c22 0d0a 2020 2020 2020 2020 2020 2020  ,"..            
+00012010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012020: 2020 2020 2020 2020 2020 6622 2069 7420            f" it 
+00012030: 7265 7175 6972 6573 2064 6572 6976 6564  requires derived
+00012040: 2074 6f20 6265 2073 6574 2074 6f20 5472   to be set to Tr
+00012050: 7565 2229 0d0a 2020 2020 2020 2020 2020  ue")..          
+00012060: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012070: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00012080: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
+00012090: 2263 6f6e 7665 7267 656e 745f 656e 6372  "convergent_encr
+000120a0: 7970 7469 6f6e 225d 203d 2063 6f6e 7665  yption"] = conve
+000120b0: 7267 656e 745f 656e 6372 7970 7469 6f6e  rgent_encryption
+000120c0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+000120d0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+000120e0: 6572 6976 6564 3a0d 0a20 2020 2020 2020  erived:..       
+000120f0: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+00012100: 5b22 6465 7269 7665 6422 5d20 3d20 6465  ["derived"] = de
+00012110: 7269 7665 640d 0a20 2020 2020 2020 2020  rived..         
+00012120: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00012130: 2069 6620 6578 706f 7274 6162 6c65 3a0d   if exportable:.
+00012140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012150: 2070 6179 6c6f 6164 5b22 6578 706f 7274   payload["export
+00012160: 6162 6c65 225d 203d 2065 7870 6f72 7461  able"] = exporta
+00012170: 626c 650d 0a0d 0a20 2020 2020 2020 2020  ble....         
+00012180: 2020 2069 6620 616c 6c6f 775f 706c 6169     if allow_plai
+00012190: 6e74 6578 745f 6261 636b 7570 3a0d 0a20  ntext_backup:.. 
+000121a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000121b0: 6179 6c6f 6164 5b22 616c 6c6f 775f 706c  ayload["allow_pl
+000121c0: 6169 6e74 6578 745f 6261 636b 7570 225d  aintext_backup"]
+000121d0: 203d 2061 6c6c 6f77 5f70 6c61 696e 7465   = allow_plainte
+000121e0: 7874 5f62 6163 6b75 700d 0a0d 0a20 2020  xt_backup....   
+000121f0: 2020 2020 2020 2020 2069 6620 6b65 795f           if key_
+00012200: 7479 7065 2e6c 6f77 6572 2829 206e 6f74  type.lower() not
+00012210: 2069 6e20 7365 6c66 2e4b 4559 5f54 5950   in self.KEY_TYP
+00012220: 4553 3a0d 0a20 2020 2020 2020 2020 2020  ES:..           
+00012230: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00012240: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+00012250: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+00012260: 6372 6561 7465 206b 6579 2065 7272 6f72  create key error
+00012270: 3a20 6b65 795f 7479 7065 206d 7573 7420  : key_type must 
+00012280: 6265 206f 6e65 206f 6620 7b73 656c 662e  be one of {self.
+00012290: 4b45 595f 5459 5045 537d 2229 0d0a 2020  KEY_TYPES}")..  
+000122a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000122b0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+000122c0: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
+000122d0: 2274 7970 6522 5d20 3d20 6b65 795f 7479  "type"] = key_ty
+000122e0: 7065 2e6c 6f77 6572 2829 0d0a 0d0a 2020  pe.lower()....  
+000122f0: 2020 2020 2020 2020 2020 6966 206b 6579            if key
+00012300: 5f73 697a 6520 3e20 303a 0d0a 2020 2020  _size > 0:..    
+00012310: 2020 2020 2020 2020 2020 2020 7061 796c              payl
+00012320: 6f61 645b 226b 6579 5f73 697a 6522 5d20  oad["key_size"] 
+00012330: 3d20 6b65 795f 7369 7a65 0d0a 2020 2020  = key_size..    
+00012340: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00012350: 2020 2020 2020 726f 7461 7465 5f70 6572        rotate_per
+00012360: 696f 6420 3d20 5661 756c 7444 7572 6174  iod = VaultDurat
+00012370: 696f 6e28 6175 746f 5f72 6f74 6174 655f  ion(auto_rotate_
+00012380: 7065 7269 6f64 290d 0a20 2020 2020 2020  period)..       
+00012390: 2020 2020 2069 6620 726f 7461 7465 5f70       if rotate_p
+000123a0: 6572 696f 642e 7661 6c75 6520 3e20 303a  eriod.value > 0:
+000123b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000123c0: 2020 6c6f 7765 725f 7065 7269 6f64 203d    lower_period =
+000123d0: 2056 6175 6c74 4475 7261 7469 6f6e 2822   VaultDuration("
+000123e0: 3168 2229 0d0a 2020 2020 2020 2020 2020  1h")..          
+000123f0: 2020 2020 2020 6966 2072 6f74 6174 655f        if rotate_
+00012400: 7065 7269 6f64 203c 206c 6f77 6572 5f70  period < lower_p
+00012410: 6572 696f 643a 0d0a 2020 2020 2020 2020  eriod:..        
+00012420: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012430: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
+00012440: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
+00012450: 655f 5f7d 202d 2063 7265 6174 6520 6b65  e__} - create ke
+00012460: 7920 6572 726f 723a 2054 6865 2076 616c  y error: The val
+00012470: 7565 206f 6620 6175 746f 5f72 6f74 6174  ue of auto_rotat
+00012480: 655f 7065 7269 6f64 2063 616e 6e6f 7420  e_period cannot 
+00012490: 6265 2073 686f 7274 6572 2074 6861 6e20  be shorter than 
+000124a0: 6f6e 6520 686f 7572 2229 0d0a 2020 2020  one hour")..    
+000124b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124c0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+000124d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000124e0: 796c 6f61 645b 2261 7574 6f5f 726f 7461  yload["auto_rota
+000124f0: 7465 5f70 6572 696f 6422 5d20 3d20 6175  te_period"] = au
+00012500: 746f 5f72 6f74 6174 655f 7065 7269 6f64  to_rotate_period
+00012510: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+00012520: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+00012530: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
+00012540: 7874 2873 656c 662e 7572 6c2c 206b 6579  xt(self.url, key
+00012550: 3d72 616e 646f 6d5f 6865 7828 7365 6c66  =random_hex(self
+00012560: 2e5f 6b65 795f 6c65 6e2c 2073 656c 662e  ._key_len, self.
+00012570: 5f73 6565 642a 3229 2c20 6976 3d72 616e  _seed*2), iv=ran
+00012580: 646f 6d5f 6865 7828 3136 2c20 7365 6c66  dom_hex(16, self
+00012590: 2e5f 7365 6564 2a33 2929 0d0a 2020 2020  ._seed*3))..    
+000125a0: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+000125b0: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
+000125c0: 2873 656c 662e 746f 6b65 6e2c 206b 6579  (self.token, key
+000125d0: 3d72 616e 646f 6d5f 6865 7828 7365 6c66  =random_hex(self
+000125e0: 2e5f 6b65 795f 6c65 6e2c 2073 656c 662e  ._key_len, self.
+000125f0: 5f73 6565 642a 3229 2c20 6976 3d72 616e  _seed*2), iv=ran
+00012600: 646f 6d5f 6865 7828 3136 2c20 7365 6c66  dom_hex(16, self
+00012610: 2e5f 7365 6564 2a33 2929 0d0a 2020 2020  ._seed*3))..    
+00012620: 2020 2020 2020 2020 7265 7320 3d20 7265          res = re
+00012630: 7175 6573 7473 2e70 6f73 7428 7572 6c2b  quests.post(url+
+00012640: 6622 7b6d 6f75 6e74 5f70 6174 687d 2f6b  f"{mount_path}/k
+00012650: 6579 732f 7b6e 616d 657d 222c 2068 6561  eys/{name}", hea
+00012660: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
+00012670: 6f6b 656e 223a 2074 6f6b 656e 7d2c 2064  oken": token}, d
+00012680: 6174 613d 6a73 6f6e 2e64 756d 7073 2870  ata=json.dumps(p
+00012690: 6179 6c6f 6164 2929 0d0a 2020 2020 2020  ayload))..      
+000126a0: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
+000126b0: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
+000126c0: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
+000126d0: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
+000126e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000126f0: 726e 2054 7275 650d 0a20 2020 2020 2020  rn True..       
+00012700: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00012710: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012720: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
+00012730: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
+00012740: 5f6e 616d 655f 5f2c 2072 6573 2c20 2263  _name__, res, "c
+00012750: 7265 6174 6520 6b65 7920 6572 726f 7222  reate key error"
+00012760: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00012770: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00012780: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00012790: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+000127a0: 0a0d 0a20 2020 2064 6566 2069 6d70 6f72  ...    def impor
+000127b0: 745f 6b65 7928 7365 6c66 2c20 0d0a 2020  t_key(self, ..  
 000127c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127d0: 2020 6e61 6d65 3a20 7374 722c 0d0a 2020    name: str,..  
-000127e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127f0: 2063 6970 6865 7274 6578 743a 2073 7472   ciphertext: str
-00012800: 203d 2022 222c 0d0a 2020 2020 2020 2020   = "",..        
-00012810: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00012820: 6675 6e63 7469 6f6e 3a20 7374 7220 3d20  function: str = 
-00012830: 2253 4841 3235 3622 2c0d 0a20 2020 2020  "SHA256",..     
-00012840: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00012850: 795f 7479 7065 3a20 7374 7220 3d20 2261  y_type: str = "a
-00012860: 6573 3235 362d 6763 6d39 3622 2c0d 0a20  es256-gcm96",.. 
-00012870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012880: 2020 7075 626c 6963 5f6b 6579 3a20 7374    public_key: st
-00012890: 7220 3d20 2222 2c0d 0a20 2020 2020 2020  r = "",..       
-000128a0: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
-000128b0: 775f 726f 7461 7469 6f6e 3a20 626f 6f6c  w_rotation: bool
-000128c0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-000128d0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000128e0: 7269 7665 643a 2062 6f6f 6c20 3d20 4661  rived: bool = Fa
-000128f0: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
-00012900: 2020 2020 2020 2020 2063 6f6e 7465 7874           context
-00012910: 3a20 7374 7220 3d20 2222 2c0d 0a20 2020  : str = "",..   
-00012920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012930: 6578 706f 7274 6162 6c65 3a20 626f 6f6c  exportable: bool
-00012940: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-00012950: 2020 2020 2020 2020 2020 2020 2020 616c                al
-00012960: 6c6f 775f 706c 6169 6e74 6578 745f 6261  low_plaintext_ba
-00012970: 636b 7570 3a20 626f 6f6c 203d 2046 616c  ckup: bool = Fal
-00012980: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
-00012990: 2020 2020 2020 2020 6175 746f 5f72 6f74          auto_rot
-000129a0: 6174 655f 7065 7269 6f64 3a20 7374 7220  ate_period: str 
-000129b0: 3d20 2230 2229 3a0d 0a20 2020 2020 2020  = "0"):..       
-000129c0: 2022 2222 696d 706f 7274 2065 7869 7374   """import exist
-000129d0: 696e 6720 6b65 7920 6d61 7465 7269 616c  ing key material
-000129e0: 2069 6e74 6f20 6120 6e65 7720 7472 616e   into a new tran
-000129f0: 7369 742d 6d61 6e61 6765 6420 656e 6372  sit-managed encr
-00012a00: 7970 7469 6f6e 206b 6579 0d0a 2020 2020  yption key..    
-00012a10: 2020 2020 0d0a 2020 2020 2020 2020 5468      ..        Th
-00012a20: 6973 2073 7570 706f 7274 7320 6f6e 6520  is supports one 
-00012a30: 6f66 2074 776f 2066 6f72 6d73 3a0d 0a20  of two forms:.. 
-00012a40: 2020 2020 2020 202d 2050 7269 7661 7465         - Private
-00012a50: 2f53 796d 6d65 7472 6963 204b 6579 2069  /Symmetric Key i
-00012a60: 6d70 6f72 742c 2072 6571 7569 7269 6e67  mport, requiring
-00012a70: 2074 6865 2063 6970 6865 7274 6578 742c   the ciphertext,
-00012a80: 2068 6173 685f 6675 6e63 7469 6f6e 2070   hash_function p
-00012a90: 6172 616d 6574 6572 7320 6265 2073 6574  arameters be set
-00012aa0: 200d 0a20 2020 2020 2020 2020 2028 616e   ..          (an
-00012ab0: 6420 6175 746f 6d61 7469 6361 6c6c 7920  d automatically 
-00012ac0: 6465 7269 7669 6e67 2074 6865 2070 7562  deriving the pub
-00012ad0: 6c69 6320 6b65 7929 2c20 6f72 0d0a 2020  lic key), or..  
-00012ae0: 2020 2020 2020 2d20 5075 626c 6963 204b        - Public K
-00012af0: 6579 2d6f 6e6c 7920 696d 706f 7274 2c20  ey-only import, 
-00012b00: 7265 7374 7269 6374 696e 6720 7468 6520  restricting the 
-00012b10: 6f70 6572 6174 696f 6e73 2074 6861 7420  operations that 
-00012b20: 6361 6e20 6265 2064 6f6e 6520 7769 7468  can be done with
-00012b30: 2074 6869 7320 6b65 792c 2061 6e64 200d   this key, and .
-00012b40: 0a20 2020 2020 2020 2020 2072 6571 7569  .          requi
-00012b50: 7269 6e67 206f 6e6c 7920 7468 6520 7075  ring only the pu
-00012b60: 626c 6963 5f6b 6579 2070 6172 616d 6574  blic_key paramet
-00012b70: 6572 2e0d 0a20 2020 2020 2020 2020 200d  er...          .
-00012b80: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-00012b90: 6f20 6874 7470 733a 2f2f 6465 7665 6c6f  o https://develo
-00012ba0: 7065 722e 6861 7368 6963 6f72 702e 636f  per.hashicorp.co
-00012bb0: 6d2f 7661 756c 742f 6170 692d 646f 6373  m/vault/api-docs
-00012bc0: 2f73 6563 7265 742f 7472 616e 7369 7423  /secret/transit#
-00012bd0: 696d 706f 7274 2d6b 6579 2066 6f72 206d  import-key for m
-00012be0: 6f72 6520 6465 7461 696c 730d 0a0d 0a20  ore details.... 
-00012bf0: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-00012c00: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
-00012c10: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
-00012c20: 2020 2020 2020 2020 6e61 6d65 2028 7374          name (st
-00012c30: 7229 3a20 5370 6563 6966 6965 7320 7468  r): Specifies th
-00012c40: 6520 6e61 6d65 206f 6620 7468 6520 656e  e name of the en
-00012c50: 6372 7970 7469 6f6e 206b 6579 2074 6f20  cryption key to 
-00012c60: 6372 6561 7465 2e20 5468 6973 2069 7320  create. This is 
-00012c70: 7370 6563 6966 6965 6420 6173 2070 6172  specified as par
-00012c80: 7420 6f66 2074 6865 2055 524c 2e0d 0a20  t of the URL... 
-00012c90: 2020 2020 2020 2020 2020 2063 6970 6865             ciphe
-00012ca0: 7274 6578 7420 2873 7472 2c20 6f70 7469  rtext (str, opti
-00012cb0: 6f6e 616c 293a 2041 2062 6173 6536 342d  onal): A base64-
-00012cc0: 656e 636f 6465 6420 7374 7269 6e67 2074  encoded string t
-00012cd0: 6861 7420 636f 6e74 6169 6e73 2074 776f  hat contains two
-00012ce0: 2076 616c 7565 733a 2061 6e20 6570 6865   values: an ephe
-00012cf0: 6d65 7261 6c20 0d0a 2020 2020 2020 2020  meral ..        
-00012d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d20: 3235 362d 6269 7420 4145 5320 6b65 7920  256-bit AES key 
-00012d30: 7772 6170 7065 6420 7573 696e 6720 7468  wrapped using th
-00012d40: 6520 7772 6170 7069 6e67 206b 6579 2072  e wrapping key r
-00012d50: 6574 7572 6e65 6420 6279 2056 6175 6c74  eturned by Vault
-00012d60: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d80: 2020 2020 2020 2020 2020 2061 6e64 2074             and t
-00012d90: 6865 2065 6e63 7279 7074 696f 6e20 6f66  he encryption of
-00012da0: 2074 6865 2069 6d70 6f72 7420 6b65 7920   the import key 
-00012db0: 6d61 7465 7269 616c 2075 6e64 6572 2074  material under t
-00012dc0: 6865 2070 726f 7669 6465 6420 0d0a 2020  he provided ..  
-00012dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012df0: 2020 2020 2020 4145 5320 6b65 792e 2054        AES key. T
-00012e00: 6865 2077 7261 7070 6564 2041 4553 206b  he wrapped AES k
-00012e10: 6579 2073 686f 756c 6420 6265 2074 6865  ey should be the
-00012e20: 2066 6972 7374 2035 3132 2062 7974 6573   first 512 bytes
-00012e30: 206f 6620 7468 6520 0d0a 2020 2020 2020   of the ..      
-00012e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e60: 2020 6369 7068 6572 7465 7874 2c20 616e    ciphertext, an
-00012e70: 6420 7468 6520 656e 6372 7970 7465 6420  d the encrypted 
-00012e80: 6b65 7920 6d61 7465 7269 616c 2073 686f  key material sho
-00012e90: 756c 6420 6265 2074 6865 2072 656d 6169  uld be the remai
-00012ea0: 6e69 6e67 200d 0a20 2020 2020 2020 2020  ning ..         
-00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00012ed0: 7974 6573 2e20 4966 2070 7562 6c69 635f  ytes. If public_
-00012ee0: 6b65 7920 6973 2073 6574 2c20 7468 6973  key is set, this
-00012ef0: 2066 6965 6c64 2069 7320 6e6f 7420 7265   field is not re
-00012f00: 7175 6972 6564 2e20 5365 6520 7468 6520  quired. See the 
-00012f10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f30: 2020 2020 2020 2020 2020 4259 4f4b 2028            BYOK (
-00012f40: 4272 696e 6720 796f 7572 206f 776e 206b  Bring your own k
-00012f50: 6579 2920 7365 6374 696f 6e20 6f66 2074  ey) section of t
-00012f60: 6865 2054 7261 6e73 6974 2073 6563 7265  he Transit secre
-00012f70: 7473 2065 6e67 696e 6520 0d0a 2020 2020  ts engine ..    
-00012f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fa0: 2020 2020 646f 6375 6d65 6e74 6174 696f      documentatio
-00012fb0: 6e20 666f 7220 6d6f 7265 2069 6e66 6f72  n for more infor
-00012fc0: 6d61 7469 6f6e 206f 6e20 636f 6e73 7472  mation on constr
-00012fd0: 7563 7469 6e67 2074 6865 2063 6970 6865  ucting the ciphe
-00012fe0: 7274 6578 742e 200d 0a20 2020 2020 2020  rtext. ..       
-00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013010: 2044 6566 6175 6c74 7320 746f 2022 222e   Defaults to "".
-00013020: 0d0a 2020 2020 2020 2020 2020 2020 6861  ..            ha
-00013030: 7368 5f66 756e 6374 696f 6e20 2873 7472  sh_function (str
-00013040: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
-00013050: 2068 6173 6820 6675 6e63 7469 6f6e 2075   hash function u
-00013060: 7365 6420 666f 7220 7468 6520 5253 412d  sed for the RSA-
-00013070: 4f41 4550 2073 7465 7020 6f66 2063 7265  OAEP step of cre
-00013080: 6174 696e 6720 7468 6520 0d0a 2020 2020  ating the ..    
-00013090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130b0: 2020 2020 2020 2063 6970 6865 7274 6578         ciphertex
-000130c0: 742e 2053 7570 706f 7274 6564 2068 6173  t. Supported has
-000130d0: 6820 6675 6e63 7469 6f6e 7320 6172 653a  h functions are:
-000130e0: 2053 4841 312c 2053 4841 3232 342c 2053   SHA1, SHA224, S
-000130f0: 4841 3235 362c 200d 0a20 2020 2020 2020  HA256, ..       
-00013100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013120: 2020 2020 5348 4133 3834 2c20 616e 6420      SHA384, and 
-00013130: 5348 4135 3132 2e20 4465 6661 756c 7473  SHA512. Defaults
-00013140: 2074 6f20 2253 4841 3235 3622 2e0d 0a20   to "SHA256"... 
-00013150: 2020 2020 2020 2020 2020 206b 6579 5f74             key_t
-00013160: 7970 6520 2873 7472 2c20 6f70 7469 6f6e  ype (str, option
-00013170: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
-00013180: 6865 2074 7970 6520 6f66 206b 6579 2074  he type of key t
-00013190: 6f20 6372 6561 7465 2e20 4465 6661 756c  o create. Defaul
-000131a0: 7473 2074 6f20 2261 6573 3235 362d 6763  ts to "aes256-gc
-000131b0: 6d39 3622 2e0d 0a20 2020 2020 2020 2020  m96"...         
-000131c0: 2020 2070 7562 6c69 635f 6b65 7920 2873     public_key (s
-000131d0: 7472 2c20 6f70 7469 6f6e 616c 293a 2041  tr, optional): A
-000131e0: 2070 6c61 696e 7465 7874 2050 454d 2070   plaintext PEM p
-000131f0: 7562 6c69 6320 6b65 7920 746f 2062 6520  ublic key to be 
-00013200: 696d 706f 7274 6564 2e20 5468 6973 206c  imported. This l
-00013210: 696d 6974 7320 7468 6520 6f70 6572 6174  imits the operat
-00013220: 696f 6e73 200d 0a20 2020 2020 2020 2020  ions ..         
-00013230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013240: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00013250: 7661 696c 6162 6c65 2075 6e64 6572 2074  vailable under t
-00013260: 6869 7320 6b65 7920 746f 2076 6572 6966  his key to verif
-00013270: 6963 6174 696f 6e20 616e 6420 656e 6372  ication and encr
-00013280: 7970 7469 6f6e 2c20 6465 7065 6e64 696e  yption, dependin
-00013290: 6720 0d0a 2020 2020 2020 2020 2020 2020  g ..            
-000132a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132b0: 2020 2020 2020 2020 2020 2020 6f6e 2074              on t
-000132c0: 6865 206b 6579 2074 7970 6520 616e 6420  he key type and 
-000132d0: 616c 676f 7269 7468 6d2c 2061 7320 6e6f  algorithm, as no
-000132e0: 2070 7269 7661 7465 206b 6579 2069 7320   private key is 
-000132f0: 6176 6169 6c61 626c 652e 200d 0a20 2020  available. ..   
-00013300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013320: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
-00013330: 2022 222e 0d0a 2020 2020 2020 2020 2020   ""...          
-00013340: 2020 616c 6c6f 775f 726f 7461 7469 6f6e    allow_rotation
-00013350: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
-00013360: 293a 2049 6620 7365 742c 2074 6865 2069  ): If set, the i
-00013370: 6d70 6f72 7465 6420 6b65 7920 6361 6e20  mported key can 
-00013380: 6265 2072 6f74 6174 6564 2077 6974 6869  be rotated withi
-00013390: 6e20 5661 756c 7420 6279 2075 7369 6e67  n Vault by using
-000133a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133d0: 7468 6520 726f 7461 7465 2065 6e64 706f  the rotate endpo
-000133e0: 696e 742e 2044 6566 6175 6c74 7320 746f  int. Defaults to
-000133f0: 2046 616c 7365 2e0d 0a20 2020 2020 2020   False...       
-00013400: 2020 2020 2064 6572 6976 6564 2028 626f       derived (bo
-00013410: 6f6c 2c20 6f70 7469 6f6e 616c 293a 2053  ol, optional): S
-00013420: 7065 6369 6669 6573 2069 6620 6b65 7920  pecifies if key 
-00013430: 6465 7269 7661 7469 6f6e 2069 7320 746f  derivation is to
-00013440: 2062 6520 7573 6564 2e20 4966 2065 6e61   be used. If ena
-00013450: 626c 6564 2c20 616c 6c20 656e 6372 7970  bled, all encryp
-00013460: 742f 6465 6372 7970 7420 0d0a 2020 2020  t/decrypt ..    
-00013470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013490: 2020 7265 7175 6573 7473 2074 6f20 7468    requests to th
-000134a0: 6973 206e 616d 6564 206b 6579 206d 7573  is named key mus
-000134b0: 7420 7072 6f76 6964 6520 6120 636f 6e74  t provide a cont
-000134c0: 6578 7420 7768 6963 6820 6973 2075 7365  ext which is use
-000134d0: 6420 666f 7220 6b65 7920 0d0a 2020 2020  d for key ..    
-000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013500: 2020 6465 7269 7661 7469 6f6e 2e20 4465    derivation. De
-00013510: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
-00013520: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00013530: 6e74 6578 7420 2873 7472 2c20 6f70 7469  ntext (str, opti
-00013540: 6f6e 616c 293a 2041 2062 6173 6536 342d  onal): A base64-
-00013550: 656e 636f 6465 6420 7374 7269 6e67 2070  encoded string p
-00013560: 726f 7669 6469 6e67 2061 2063 6f6e 7465  roviding a conte
-00013570: 7874 2066 6f72 206b 6579 2064 6572 6976  xt for key deriv
-00013580: 6174 696f 6e2e 2052 6571 7569 7265 6420  ation. Required 
-00013590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000135a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135b0: 2020 2020 2020 2069 6620 6465 7269 7665         if derive
-000135c0: 6420 6973 2073 6574 2074 6f20 7472 7565  d is set to true
-000135d0: 2e20 4465 6661 756c 7473 2074 6f20 2222  . Defaults to ""
-000135e0: 2e0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
-000135f0: 7870 6f72 7461 626c 6520 2862 6f6f 6c2c  xportable (bool,
-00013600: 206f 7074 696f 6e61 6c29 3a20 456e 6162   optional): Enab
-00013610: 6c65 7320 6b65 7973 2074 6f20 6265 2065  les keys to be e
-00013620: 7870 6f72 7461 626c 652e 2054 6869 7320  xportable. This 
-00013630: 616c 6c6f 7773 2066 6f72 2061 6c6c 2074  allows for all t
-00013640: 6865 2076 616c 6964 206b 6579 7320 696e  he valid keys in
-00013650: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00013660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013670: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00013680: 6b65 7920 7269 6e67 2074 6f20 6265 2065  key ring to be e
-00013690: 7870 6f72 7465 642e 204f 6e63 6520 7365  xported. Once se
-000136a0: 742c 2074 6869 7320 6361 6e6e 6f74 2062  t, this cannot b
-000136b0: 6520 6469 7361 626c 6564 2e20 4465 6661  e disabled. Defa
-000136c0: 756c 7473 200d 0a20 2020 2020 2020 2020  ults ..         
-000136d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136f0: 746f 2046 616c 7365 2e0d 0a20 2020 2020  to False...     
-00013700: 2020 2020 2020 2061 6c6c 6f77 5f70 6c61         allow_pla
-00013710: 696e 7465 7874 5f62 6163 6b75 7020 2862  intext_backup (b
-00013720: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
-00013730: 4966 2073 6574 2c20 656e 6162 6c65 7320  If set, enables 
-00013740: 7461 6b69 6e67 2062 6163 6b75 7020 6f66  taking backup of
-00013750: 206e 616d 6564 206b 6579 2069 6e20 7468   named key in th
-00013760: 6520 706c 6169 6e74 6578 7420 0d0a 2020  e plaintext ..  
-00013770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137a0: 2020 2066 6f72 6d61 742e 204f 6e63 6520     format. Once 
-000137b0: 7365 742c 2074 6869 7320 6361 6e6e 6f74  set, this cannot
-000137c0: 2062 6520 6469 7361 626c 6564 2e20 4465   be disabled. De
-000137d0: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
-000137e0: 0d0a 2020 2020 2020 2020 2020 2020 6175  ..            au
-000137f0: 746f 5f72 6f74 6174 655f 7065 7269 6f64  to_rotate_period
-00013800: 2028 7374 722c 206f 7074 696f 6e61 6c29   (str, optional)
-00013810: 3a20 5468 6520 7065 7269 6f64 2061 7420  : The period at 
-00013820: 7768 6963 6820 7468 6973 206b 6579 2073  which this key s
-00013830: 686f 756c 6420 6265 2072 6f74 6174 6564  hould be rotated
-00013840: 2061 7574 6f6d 6174 6963 616c 6c79 2e20   automatically. 
-00013850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013880: 2020 5365 7474 696e 6720 7468 6973 2074    Setting this t
-00013890: 6f20 2230 2220 2874 6865 2064 6566 6175  o "0" (the defau
-000138a0: 6c74 2920 7769 6c6c 2064 6973 6162 6c65  lt) will disable
-000138b0: 2061 7574 6f6d 6174 6963 206b 6579 200d   automatic key .
-000138c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138f0: 2072 6f74 6174 696f 6e2e 2054 6869 7320   rotation. This 
-00013900: 7661 6c75 6520 6361 6e6e 6f74 2062 6520  value cannot be 
-00013910: 7368 6f72 7465 7220 7468 616e 206f 6e65  shorter than one
-00013920: 2068 6f75 722e 2044 6566 6175 6c74 7320   hour. Defaults 
-00013930: 746f 2022 3022 2e0d 0a0d 0a20 2020 2020  to "0".....     
-00013940: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
-00013950: 2020 2020 2020 2020 2062 6f6f 6c3a 2072           bool: r
-00013960: 6574 7572 6e20 5472 7565 2069 6620 7375  eturn True if su
-00013970: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
-00013980: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00013990: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-000139a0: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
-000139b0: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
-000139c0: 2020 6578 6973 745f 6b65 7973 203d 2073    exist_keys = s
-000139d0: 656c 662e 6c69 7374 5f6b 6579 286d 6f75  elf.list_key(mou
-000139e0: 6e74 5f70 6174 6829 0d0a 2020 2020 2020  nt_path)..      
-000139f0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
-00013a00: 2065 7869 7374 5f6b 6579 733a 0d0a 2020   exist_keys:..  
-00013a10: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00013a20: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00013a30: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00013a40: 616d 655f 5f7d 202d 2069 6d70 6f72 7420  ame__} - import 
-00013a50: 6b65 7920 6572 726f 723a 206b 6579 2027  key error: key '
-00013a60: 7b6e 616d 657d 2720 616c 7265 6164 7920  {name}' already 
-00013a70: 6578 6973 7473 2229 0d0a 2020 2020 2020  exists")..      
-00013a80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013a90: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00013aa0: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00013ab0: 2020 7061 796c 6f61 6420 3d20 436f 6e66    payload = Conf
-00013ac0: 6967 4469 6374 2829 0d0a 2020 2020 2020  igDict()..      
-00013ad0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00013ae0: 2020 2020 6966 206b 6579 5f74 7970 652e      if key_type.
-00013af0: 6c6f 7765 7228 2920 6e6f 7420 696e 2073  lower() not in s
-00013b00: 656c 662e 4b45 595f 5459 5045 533a 0d0a  elf.KEY_TYPES:..
-00013b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b20: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
-00013b30: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
-00013b40: 5f6e 616d 655f 5f7d 202d 2069 6d70 6f72  _name__} - impor
-00013b50: 7420 6b65 7920 6572 726f 723a 206b 6579  t key error: key
-00013b60: 5f74 7970 6520 6d75 7374 2062 6520 6f6e  _type must be on
-00013b70: 6520 6f66 207b 7365 6c66 2e4b 4559 5f54  e of {self.KEY_T
-00013b80: 5950 4553 7d22 290d 0a20 2020 2020 2020  YPES}")..       
-00013b90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013ba0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-00013bb0: 2020 2070 6179 6c6f 6164 5b22 7479 7065     payload["type
-00013bc0: 225d 203d 206b 6579 5f74 7970 652e 6c6f  "] = key_type.lo
-00013bd0: 7765 7228 290d 0a20 2020 2020 2020 2020  wer()..         
-00013be0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-00013bf0: 2069 6620 7075 626c 6963 5f6b 6579 2021   if public_key !
-00013c00: 3d20 2222 3a0d 0a20 2020 2020 2020 2020  = "":..         
-00013c10: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
-00013c20: 7075 626c 6963 5f6b 6579 225d 203d 2070  public_key"] = p
-00013c30: 7562 6c69 635f 6b65 790d 0a20 2020 2020  ublic_key..     
-00013c40: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00013c50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00013c60: 2063 6970 6865 7274 6578 7420 3d3d 2022   ciphertext == "
-00013c70: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00013c80: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00013c90: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-00013ca0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00013cb0: 202d 2069 6d70 6f72 7420 6b65 7920 6572   - import key er
-00013cc0: 726f 723a 2063 6970 6865 7274 6578 7420  ror: ciphertext 
-00013cd0: 6361 6e6e 6f74 2062 6520 656d 7074 7920  cannot be empty 
-00013ce0: 7768 656e 2070 7562 6c69 635f 6b65 7920  when public_key 
-00013cf0: 6973 2065 6d70 7479 2229 0d0a 2020 2020  is empty")..    
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00013d20: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
-00013d30: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00013d40: 6970 6865 7274 6578 7420 213d 2022 223a  iphertext != "":
-00013d50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013d60: 2020 6966 206e 6f74 2069 735f 6261 7365    if not is_base
-00013d70: 3634 2863 6970 6865 7274 6578 7429 3a0d  64(ciphertext):.
-00013d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d90: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00013da0: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
-00013db0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-00013dc0: 696d 706f 7274 206b 6579 2065 7272 6f72  import key error
-00013dd0: 3a20 6369 7068 6572 7465 7874 206d 7573  : ciphertext mus
-00013de0: 7420 6265 2062 6173 6536 3420 656e 636f  t be base64 enco
-00013df0: 6465 6422 290d 0a20 2020 2020 2020 2020  ded")..         
-00013e00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013e10: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
-00013e20: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
-00013e30: 5b22 6369 7068 6572 7465 7874 225d 203d  ["ciphertext"] =
-00013e40: 2063 6970 6865 7274 6578 740d 0a20 2020   ciphertext..   
-00013e50: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00013e60: 2020 2020 2020 2069 6620 7061 796c 6f61         if payloa
-00013e70: 642e 6369 7068 6572 7465 7874 2069 7320  d.ciphertext is 
-00013e80: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00013e90: 2020 2020 2020 2020 2020 2073 7570 706f             suppo
-00013ea0: 7274 5f68 6173 685f 6675 6e63 7469 6f6e  rt_hash_function
-00013eb0: 203d 205b 2253 4841 3122 2c20 2253 4841   = ["SHA1", "SHA
-00013ec0: 3232 3422 2c20 2253 4841 3235 3622 2c20  224", "SHA256", 
-00013ed0: 2253 4841 3338 3422 2c20 2253 4841 3531  "SHA384", "SHA51
-00013ee0: 3222 5d0d 0a20 2020 2020 2020 2020 2020  2"]..           
-00013ef0: 2020 2020 2069 6620 6861 7368 5f66 756e       if hash_fun
-00013f00: 6374 696f 6e20 6e6f 7420 696e 2073 7570  ction not in sup
-00013f10: 706f 7274 5f68 6173 685f 6675 6e63 7469  port_hash_functi
-00013f20: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-00013f30: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00013f40: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
-00013f50: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00013f60: 7d20 2d20 696d 706f 7274 206b 6579 2065  } - import key e
-00013f70: 7272 6f72 3a20 6861 7368 5f66 756e 6374  rror: hash_funct
-00013f80: 696f 6e20 6d75 7374 2062 6520 6f6e 6520  ion must be one 
-00013f90: 6f66 207b 7375 7070 6f72 745f 6861 7368  of {support_hash
-00013fa0: 5f66 756e 6374 696f 6e7d 2229 0d0a 2020  _function}")..  
-00013fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fc0: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fe0: 7061 796c 6f61 645b 2268 6173 685f 6675  payload["hash_fu
-00013ff0: 6e63 7469 6f6e 225d 203d 2068 6173 685f  nction"] = hash_
-00014000: 6675 6e63 7469 6f6e 0d0a 2020 2020 2020  function..      
-00014010: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00014020: 2020 2020 2020 2020 6966 2061 6c6c 6f77          if allow
-00014030: 5f72 6f74 6174 696f 6e3a 0d0a 2020 2020  _rotation:..    
-00014040: 2020 2020 2020 2020 2020 2020 7061 796c              payl
-00014050: 6f61 645b 2261 6c6c 6f77 5f72 6f74 6174  oad["allow_rotat
-00014060: 696f 6e22 5d20 3d20 616c 6c6f 775f 726f  ion"] = allow_ro
-00014070: 7461 7469 6f6e 0d0a 2020 2020 2020 2020  tation..        
-00014080: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00014090: 2020 2020 2020 6966 2064 6572 6976 6564        if derived
-000140a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000140b0: 2020 2069 6620 636f 6e74 6578 7420 3d3d     if context ==
-000140c0: 2022 223a 0d0a 2020 2020 2020 2020 2020   "":..          
-000140d0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-000140e0: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
-000140f0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00014100: 5f7d 202d 2069 6d70 6f72 7420 6b65 7920  _} - import key 
-00014110: 6572 726f 723a 2063 6f6e 7465 7874 2063  error: context c
-00014120: 616e 6e6f 7420 6265 2065 6d70 7479 2077  annot be empty w
-00014130: 6865 6e20 6465 7269 7665 6420 6973 2074  hen derived is t
-00014140: 7275 6522 290d 0a20 2020 2020 2020 2020  rue")..         
-00014150: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014160: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
-00014170: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00014180: 6973 5f62 6173 6536 3428 636f 6e74 6578  is_base64(contex
-00014190: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-000141a0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-000141b0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
-000141c0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-000141d0: 7d20 2d20 696d 706f 7274 206b 6579 2065  } - import key e
-000141e0: 7272 6f72 3a20 636f 6e74 6578 7420 6d75  rror: context mu
-000141f0: 7374 2062 6520 6261 7365 3634 2065 6e63  st be base64 enc
-00014200: 6f64 6564 2229 0d0a 2020 2020 2020 2020  oded")..        
-00014210: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00014220: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-00014230: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-00014240: 645b 2264 6572 6976 6564 225d 203d 2064  d["derived"] = d
-00014250: 6572 6976 6564 0d0a 2020 2020 2020 2020  erived..        
-00014260: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
-00014270: 2263 6f6e 7465 7874 225d 203d 2063 6f6e  "context"] = con
-00014280: 7465 7874 0d0a 2020 2020 2020 2020 2020  text..          
-00014290: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000142a0: 2020 2020 6966 2065 7870 6f72 7461 626c      if exportabl
-000142b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000142c0: 2020 2020 7061 796c 6f61 645b 2265 7870      payload["exp
-000142d0: 6f72 7461 626c 6522 5d20 3d20 6578 706f  ortable"] = expo
-000142e0: 7274 6162 6c65 0d0a 2020 2020 2020 2020  rtable..        
-000142f0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00014300: 2020 2020 2020 6966 2061 6c6c 6f77 5f70        if allow_p
-00014310: 6c61 696e 7465 7874 5f62 6163 6b75 703a  laintext_backup:
-00014320: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014330: 2020 7061 796c 6f61 645b 2261 6c6c 6f77    payload["allow
-00014340: 5f70 6c61 696e 7465 7874 5f62 6163 6b75  _plaintext_backu
-00014350: 7022 5d20 3d20 616c 6c6f 775f 706c 6169  p"] = allow_plai
-00014360: 6e74 6578 745f 6261 636b 7570 0d0a 2020  ntext_backup..  
-00014370: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00014380: 2020 2020 2020 2020 726f 7461 7465 5f70          rotate_p
-00014390: 6572 696f 6420 3d20 5661 756c 7444 7572  eriod = VaultDur
-000143a0: 6174 696f 6e28 6175 746f 5f72 6f74 6174  ation(auto_rotat
-000143b0: 655f 7065 7269 6f64 290d 0a20 2020 2020  e_period)..     
-000143c0: 2020 2020 2020 2069 6620 726f 7461 7465         if rotate
-000143d0: 5f70 6572 696f 642e 7661 6c75 6520 3e20  _period.value > 
-000143e0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000143f0: 2020 2020 6c6f 7765 725f 7065 7269 6f64      lower_period
-00014400: 203d 2056 6175 6c74 4475 7261 7469 6f6e   = VaultDuration
-00014410: 2822 3168 2229 0d0a 2020 2020 2020 2020  ("1h")..        
-00014420: 2020 2020 2020 2020 6966 2072 6f74 6174          if rotat
-00014430: 655f 7065 7269 6f64 203c 206c 6f77 6572  e_period < lower
-00014440: 5f70 6572 696f 643a 0d0a 2020 2020 2020  _period:..      
-00014450: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00014460: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00014470: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00014480: 616d 655f 5f7d 202d 2069 6d70 6f72 7420  ame__} - import 
-00014490: 6b65 7920 6572 726f 723a 2054 6865 2076  key error: The v
-000144a0: 616c 7565 206f 6620 6175 746f 5f72 6f74  alue of auto_rot
-000144b0: 6174 655f 7065 7269 6f64 2063 616e 6e6f  ate_period canno
-000144c0: 7420 6265 2073 686f 7274 6572 2074 6861  t be shorter tha
-000144d0: 6e20 6f6e 6520 686f 7572 2229 0d0a 2020  n one hour")..  
-000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144f0: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014510: 7061 796c 6f61 645b 2261 7574 6f5f 726f  payload["auto_ro
-00014520: 7461 7465 5f70 6572 696f 6422 5d20 3d20  tate_period"] = 
-00014530: 6175 746f 5f72 6f74 6174 655f 7065 7269  auto_rotate_peri
-00014540: 6f64 0d0a 2020 2020 2020 2020 2020 2020  od..            
-00014550: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00014560: 2020 7572 6c20 3d20 6165 735f 6465 6372    url = aes_decr
-00014570: 7970 745f 7465 7874 2873 656c 662e 7572  ypt_text(self.ur
-00014580: 6c2c 206b 6579 3d72 616e 646f 6d5f 6865  l, key=random_he
-00014590: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
-000145a0: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
-000145b0: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
-000145c0: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
-000145d0: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-000145e0: 6b65 6e20 3d20 6165 735f 6465 6372 7970  ken = aes_decryp
-000145f0: 745f 7465 7874 2873 656c 662e 746f 6b65  t_text(self.toke
-00014600: 6e2c 206b 6579 3d72 616e 646f 6d5f 6865  n, key=random_he
-00014610: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
-00014620: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
-00014630: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
-00014640: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
-00014650: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00014660: 7320 3d20 7265 7175 6573 7473 2e70 6f73  s = requests.pos
-00014670: 7428 7572 6c2b 6622 7b6d 6f75 6e74 5f70  t(url+f"{mount_p
-00014680: 6174 687d 2f6b 6579 732f 7b6e 616d 657d  ath}/keys/{name}
-00014690: 2f69 6d70 6f72 7422 2c20 6865 6164 6572  /import", header
-000146a0: 733d 7b22 582d 5661 756c 742d 546f 6b65  s={"X-Vault-Toke
-000146b0: 6e22 3a20 746f 6b65 6e7d 2c20 6461 7461  n": token}, data
-000146c0: 3d6a 736f 6e2e 6475 6d70 7328 7061 796c  =json.dumps(payl
-000146d0: 6f61 6429 290d 0a20 2020 2020 2020 2020  oad))..         
-000146e0: 2020 2069 6620 7265 732e 7374 6174 7573     if res.status
-000146f0: 5f63 6f64 6520 3d3d 2032 3030 206f 7220  _code == 200 or 
-00014700: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-00014710: 3d3d 2032 3034 3a0d 0a20 2020 2020 2020  == 204:..       
-00014720: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014730: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-00014740: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00014750: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-00014760: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
-00014770: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
-00014780: 6d65 5f5f 2c20 7265 732c 2022 696d 706f  me__, res, "impo
-00014790: 7274 206b 6579 2065 7272 6f72 2229 0d0a  rt key error")..
-000147a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147b0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-000147c0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000147d0: 7265 7475 726e 2046 616c 7365 0d0a 0d0a  return False....
-000147e0: 2020 2020 6465 6620 696d 706f 7274 5f6b      def import_k
-000147f0: 6579 5f76 6572 7369 6f6e 2873 656c 662c  ey_version(self,
-00014800: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00014810: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00014820: 756e 745f 7061 7468 3a20 7374 722c 0d0a  unt_path: str,..
+000127d0: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
+000127e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000127f0: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
+00012800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012810: 2020 2020 2063 6970 6865 7274 6578 743a       ciphertext:
+00012820: 2073 7472 203d 2022 222c 0d0a 2020 2020   str = "",..    
+00012830: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00012840: 6173 685f 6675 6e63 7469 6f6e 3a20 7374  ash_function: st
+00012850: 7220 3d20 2253 4841 3235 3622 2c0d 0a20  r = "SHA256",.. 
+00012860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012870: 2020 6b65 795f 7479 7065 3a20 7374 7220    key_type: str 
+00012880: 3d20 2261 6573 3235 362d 6763 6d39 3622  = "aes256-gcm96"
+00012890: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000128a0: 2020 2020 2020 7075 626c 6963 5f6b 6579        public_key
+000128b0: 3a20 7374 7220 3d20 2222 2c0d 0a20 2020  : str = "",..   
+000128c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128d0: 616c 6c6f 775f 726f 7461 7469 6f6e 3a20  allow_rotation: 
+000128e0: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012900: 2020 6465 7269 7665 643a 2062 6f6f 6c20    derived: bool 
+00012910: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
+00012920: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00012930: 7465 7874 3a20 7374 7220 3d20 2222 2c0d  text: str = "",.
+00012940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012950: 2020 2020 6578 706f 7274 6162 6c65 3a20      exportable: 
+00012960: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012980: 2020 616c 6c6f 775f 706c 6169 6e74 6578    allow_plaintex
+00012990: 745f 6261 636b 7570 3a20 626f 6f6c 203d  t_backup: bool =
+000129a0: 2046 616c 7365 2c0d 0a20 2020 2020 2020   False,..       
+000129b0: 2020 2020 2020 2020 2020 2020 6175 746f              auto
+000129c0: 5f72 6f74 6174 655f 7065 7269 6f64 3a20  _rotate_period: 
+000129d0: 7374 7220 3d20 2230 2229 3a0d 0a20 2020  str = "0"):..   
+000129e0: 2020 2020 2022 2222 696d 706f 7274 2065       """import e
+000129f0: 7869 7374 696e 6720 6b65 7920 6d61 7465  xisting key mate
+00012a00: 7269 616c 2069 6e74 6f20 6120 6e65 7720  rial into a new 
+00012a10: 7472 616e 7369 742d 6d61 6e61 6765 6420  transit-managed 
+00012a20: 656e 6372 7970 7469 6f6e 206b 6579 0d0a  encryption key..
+00012a30: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00012a40: 2020 5468 6973 2073 7570 706f 7274 7320    This supports 
+00012a50: 6f6e 6520 6f66 2074 776f 2066 6f72 6d73  one of two forms
+00012a60: 3a0d 0a20 2020 2020 2020 202d 2050 7269  :..        - Pri
+00012a70: 7661 7465 2f53 796d 6d65 7472 6963 204b  vate/Symmetric K
+00012a80: 6579 2069 6d70 6f72 742c 2072 6571 7569  ey import, requi
+00012a90: 7269 6e67 2074 6865 2063 6970 6865 7274  ring the ciphert
+00012aa0: 6578 742c 2068 6173 685f 6675 6e63 7469  ext, hash_functi
+00012ab0: 6f6e 2070 6172 616d 6574 6572 7320 6265  on parameters be
+00012ac0: 2073 6574 200d 0a20 2020 2020 2020 2020   set ..         
+00012ad0: 2028 616e 6420 6175 746f 6d61 7469 6361   (and automatica
+00012ae0: 6c6c 7920 6465 7269 7669 6e67 2074 6865  lly deriving the
+00012af0: 2070 7562 6c69 6320 6b65 7929 2c20 6f72   public key), or
+00012b00: 0d0a 2020 2020 2020 2020 2d20 5075 626c  ..        - Publ
+00012b10: 6963 204b 6579 2d6f 6e6c 7920 696d 706f  ic Key-only impo
+00012b20: 7274 2c20 7265 7374 7269 6374 696e 6720  rt, restricting 
+00012b30: 7468 6520 6f70 6572 6174 696f 6e73 2074  the operations t
+00012b40: 6861 7420 6361 6e20 6265 2064 6f6e 6520  hat can be done 
+00012b50: 7769 7468 2074 6869 7320 6b65 792c 2061  with this key, a
+00012b60: 6e64 200d 0a20 2020 2020 2020 2020 2072  nd ..          r
+00012b70: 6571 7569 7269 6e67 206f 6e6c 7920 7468  equiring only th
+00012b80: 6520 7075 626c 6963 5f6b 6579 2070 6172  e public_key par
+00012b90: 616d 6574 6572 2e0d 0a20 2020 2020 2020  ameter...       
+00012ba0: 2020 200d 0a20 2020 2020 2020 2052 6566     ..        Ref
+00012bb0: 6572 2074 6f20 6874 7470 733a 2f2f 6465  er to https://de
+00012bc0: 7665 6c6f 7065 722e 6861 7368 6963 6f72  veloper.hashicor
+00012bd0: 702e 636f 6d2f 7661 756c 742f 6170 692d  p.com/vault/api-
+00012be0: 646f 6373 2f73 6563 7265 742f 7472 616e  docs/secret/tran
+00012bf0: 7369 7423 696d 706f 7274 2d6b 6579 2066  sit#import-key f
+00012c00: 6f72 206d 6f72 6520 6465 7461 696c 730d  or more details.
+00012c10: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00012c20: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00012c30: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
+00012c40: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00012c50: 2028 7374 7229 3a20 5370 6563 6966 6965   (str): Specifie
+00012c60: 7320 7468 6520 6e61 6d65 206f 6620 7468  s the name of th
+00012c70: 6520 656e 6372 7970 7469 6f6e 206b 6579  e encryption key
+00012c80: 2074 6f20 6372 6561 7465 2e20 5468 6973   to create. This
+00012c90: 2069 7320 7370 6563 6966 6965 6420 6173   is specified as
+00012ca0: 2070 6172 7420 6f66 2074 6865 2055 524c   part of the URL
+00012cb0: 2e0d 0a20 2020 2020 2020 2020 2020 2063  ...            c
+00012cc0: 6970 6865 7274 6578 7420 2873 7472 2c20  iphertext (str, 
+00012cd0: 6f70 7469 6f6e 616c 293a 2041 2062 6173  optional): A bas
+00012ce0: 6536 342d 656e 636f 6465 6420 7374 7269  e64-encoded stri
+00012cf0: 6e67 2074 6861 7420 636f 6e74 6169 6e73  ng that contains
+00012d00: 2074 776f 2076 616c 7565 733a 2061 6e20   two values: an 
+00012d10: 6570 6865 6d65 7261 6c20 0d0a 2020 2020  ephemeral ..    
+00012d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d40: 2020 2020 3235 362d 6269 7420 4145 5320      256-bit AES 
+00012d50: 6b65 7920 7772 6170 7065 6420 7573 696e  key wrapped usin
+00012d60: 6720 7468 6520 7772 6170 7069 6e67 206b  g the wrapping k
+00012d70: 6579 2072 6574 7572 6e65 6420 6279 2056  ey returned by V
+00012d80: 6175 6c74 200d 0a20 2020 2020 2020 2020  ault ..         
+00012d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012da0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00012db0: 6e64 2074 6865 2065 6e63 7279 7074 696f  nd the encryptio
+00012dc0: 6e20 6f66 2074 6865 2069 6d70 6f72 7420  n of the import 
+00012dd0: 6b65 7920 6d61 7465 7269 616c 2075 6e64  key material und
+00012de0: 6572 2074 6865 2070 726f 7669 6465 6420  er the provided 
+00012df0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e10: 2020 2020 2020 2020 2020 4145 5320 6b65            AES ke
+00012e20: 792e 2054 6865 2077 7261 7070 6564 2041  y. The wrapped A
+00012e30: 4553 206b 6579 2073 686f 756c 6420 6265  ES key should be
+00012e40: 2074 6865 2066 6972 7374 2035 3132 2062   the first 512 b
+00012e50: 7974 6573 206f 6620 7468 6520 0d0a 2020  ytes of the ..  
+00012e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e80: 2020 2020 2020 6369 7068 6572 7465 7874        ciphertext
+00012e90: 2c20 616e 6420 7468 6520 656e 6372 7970  , and the encryp
+00012ea0: 7465 6420 6b65 7920 6d61 7465 7269 616c  ted key material
+00012eb0: 2073 686f 756c 6420 6265 2074 6865 2072   should be the r
+00012ec0: 656d 6169 6e69 6e67 200d 0a20 2020 2020  emaining ..     
+00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ef0: 2020 2062 7974 6573 2e20 4966 2070 7562     bytes. If pub
+00012f00: 6c69 635f 6b65 7920 6973 2073 6574 2c20  lic_key is set, 
+00012f10: 7468 6973 2066 6965 6c64 2069 7320 6e6f  this field is no
+00012f20: 7420 7265 7175 6972 6564 2e20 5365 6520  t required. See 
+00012f30: 7468 6520 0d0a 2020 2020 2020 2020 2020  the ..          
+00012f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f50: 2020 2020 2020 2020 2020 2020 2020 4259                BY
+00012f60: 4f4b 2028 4272 696e 6720 796f 7572 206f  OK (Bring your o
+00012f70: 776e 206b 6579 2920 7365 6374 696f 6e20  wn key) section 
+00012f80: 6f66 2074 6865 2054 7261 6e73 6974 2073  of the Transit s
+00012f90: 6563 7265 7473 2065 6e67 696e 6520 0d0a  ecrets engine ..
+00012fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fc0: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
+00012fd0: 6174 696f 6e20 666f 7220 6d6f 7265 2069  ation for more i
+00012fe0: 6e66 6f72 6d61 7469 6f6e 206f 6e20 636f  nformation on co
+00012ff0: 6e73 7472 7563 7469 6e67 2074 6865 2063  nstructing the c
+00013000: 6970 6865 7274 6578 742e 200d 0a20 2020  iphertext. ..   
+00013010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013030: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
+00013040: 2022 222e 0d0a 2020 2020 2020 2020 2020   ""...          
+00013050: 2020 6861 7368 5f66 756e 6374 696f 6e20    hash_function 
+00013060: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
+00013070: 2054 6865 2068 6173 6820 6675 6e63 7469   The hash functi
+00013080: 6f6e 2075 7365 6420 666f 7220 7468 6520  on used for the 
+00013090: 5253 412d 4f41 4550 2073 7465 7020 6f66  RSA-OAEP step of
+000130a0: 2063 7265 6174 696e 6720 7468 6520 0d0a   creating the ..
+000130b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130d0: 2020 2020 2020 2020 2020 2063 6970 6865             ciphe
+000130e0: 7274 6578 742e 2053 7570 706f 7274 6564  rtext. Supported
+000130f0: 2068 6173 6820 6675 6e63 7469 6f6e 7320   hash functions 
+00013100: 6172 653a 2053 4841 312c 2053 4841 3232  are: SHA1, SHA22
+00013110: 342c 2053 4841 3235 362c 200d 0a20 2020  4, SHA256, ..   
+00013120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013140: 2020 2020 2020 2020 5348 4133 3834 2c20          SHA384, 
+00013150: 616e 6420 5348 4135 3132 2e20 4465 6661  and SHA512. Defa
+00013160: 756c 7473 2074 6f20 2253 4841 3235 3622  ults to "SHA256"
+00013170: 2e0d 0a20 2020 2020 2020 2020 2020 206b  ...            k
+00013180: 6579 5f74 7970 6520 2873 7472 2c20 6f70  ey_type (str, op
+00013190: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
+000131a0: 6573 2074 6865 2074 7970 6520 6f66 206b  es the type of k
+000131b0: 6579 2074 6f20 6372 6561 7465 2e20 4465  ey to create. De
+000131c0: 6661 756c 7473 2074 6f20 2261 6573 3235  faults to "aes25
+000131d0: 362d 6763 6d39 3622 2e0d 0a20 2020 2020  6-gcm96"...     
+000131e0: 2020 2020 2020 2070 7562 6c69 635f 6b65         public_ke
+000131f0: 7920 2873 7472 2c20 6f70 7469 6f6e 616c  y (str, optional
+00013200: 293a 2041 2070 6c61 696e 7465 7874 2050  ): A plaintext P
+00013210: 454d 2070 7562 6c69 6320 6b65 7920 746f  EM public key to
+00013220: 2062 6520 696d 706f 7274 6564 2e20 5468   be imported. Th
+00013230: 6973 206c 696d 6974 7320 7468 6520 6f70  is limits the op
+00013240: 6572 6174 696f 6e73 200d 0a20 2020 2020  erations ..     
+00013250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013270: 2020 2061 7661 696c 6162 6c65 2075 6e64     available und
+00013280: 6572 2074 6869 7320 6b65 7920 746f 2076  er this key to v
+00013290: 6572 6966 6963 6174 696f 6e20 616e 6420  erification and 
+000132a0: 656e 6372 7970 7469 6f6e 2c20 6465 7065  encryption, depe
+000132b0: 6e64 696e 6720 0d0a 2020 2020 2020 2020  nding ..        
+000132c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132e0: 6f6e 2074 6865 206b 6579 2074 7970 6520  on the key type 
+000132f0: 616e 6420 616c 676f 7269 7468 6d2c 2061  and algorithm, a
+00013300: 7320 6e6f 2070 7269 7661 7465 206b 6579  s no private key
+00013310: 2069 7320 6176 6169 6c61 626c 652e 200d   is available. .
+00013320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013340: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+00013350: 7320 746f 2022 222e 0d0a 2020 2020 2020  s to ""...      
+00013360: 2020 2020 2020 616c 6c6f 775f 726f 7461        allow_rota
+00013370: 7469 6f6e 2028 626f 6f6c 2c20 6f70 7469  tion (bool, opti
+00013380: 6f6e 616c 293a 2049 6620 7365 742c 2074  onal): If set, t
+00013390: 6865 2069 6d70 6f72 7465 6420 6b65 7920  he imported key 
+000133a0: 6361 6e20 6265 2072 6f74 6174 6564 2077  can be rotated w
+000133b0: 6974 6869 6e20 5661 756c 7420 6279 2075  ithin Vault by u
+000133c0: 7369 6e67 200d 0a20 2020 2020 2020 2020  sing ..         
+000133d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133f0: 2020 2020 7468 6520 726f 7461 7465 2065      the rotate e
+00013400: 6e64 706f 696e 742e 2044 6566 6175 6c74  ndpoint. Default
+00013410: 7320 746f 2046 616c 7365 2e0d 0a20 2020  s to False...   
+00013420: 2020 2020 2020 2020 2064 6572 6976 6564           derived
+00013430: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
+00013440: 293a 2053 7065 6369 6669 6573 2069 6620  ): Specifies if 
+00013450: 6b65 7920 6465 7269 7661 7469 6f6e 2069  key derivation i
+00013460: 7320 746f 2062 6520 7573 6564 2e20 4966  s to be used. If
+00013470: 2065 6e61 626c 6564 2c20 616c 6c20 656e   enabled, all en
+00013480: 6372 7970 742f 6465 6372 7970 7420 0d0a  crypt/decrypt ..
+00013490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134b0: 2020 2020 2020 7265 7175 6573 7473 2074        requests t
+000134c0: 6f20 7468 6973 206e 616d 6564 206b 6579  o this named key
+000134d0: 206d 7573 7420 7072 6f76 6964 6520 6120   must provide a 
+000134e0: 636f 6e74 6578 7420 7768 6963 6820 6973  context which is
+000134f0: 2075 7365 6420 666f 7220 6b65 7920 0d0a   used for key ..
+00013500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013520: 2020 2020 2020 6465 7269 7661 7469 6f6e        derivation
+00013530: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
+00013540: 6c73 652e 0d0a 2020 2020 2020 2020 2020  lse...          
+00013550: 2020 636f 6e74 6578 7420 2873 7472 2c20    context (str, 
+00013560: 6f70 7469 6f6e 616c 293a 2041 2062 6173  optional): A bas
+00013570: 6536 342d 656e 636f 6465 6420 7374 7269  e64-encoded stri
+00013580: 6e67 2070 726f 7669 6469 6e67 2061 2063  ng providing a c
+00013590: 6f6e 7465 7874 2066 6f72 206b 6579 2064  ontext for key d
+000135a0: 6572 6976 6174 696f 6e2e 2052 6571 7569  erivation. Requi
+000135b0: 7265 6420 0d0a 2020 2020 2020 2020 2020  red ..          
+000135c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135d0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+000135e0: 7269 7665 6420 6973 2073 6574 2074 6f20  rived is set to 
+000135f0: 7472 7565 2e20 4465 6661 756c 7473 2074  true. Defaults t
+00013600: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
+00013610: 2020 2065 7870 6f72 7461 626c 6520 2862     exportable (b
+00013620: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
+00013630: 456e 6162 6c65 7320 6b65 7973 2074 6f20  Enables keys to 
+00013640: 6265 2065 7870 6f72 7461 626c 652e 2054  be exportable. T
+00013650: 6869 7320 616c 6c6f 7773 2066 6f72 2061  his allows for a
+00013660: 6c6c 2074 6865 2076 616c 6964 206b 6579  ll the valid key
+00013670: 7320 696e 200d 0a20 2020 2020 2020 2020  s in ..         
+00013680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136a0: 7468 6520 6b65 7920 7269 6e67 2074 6f20  the key ring to 
+000136b0: 6265 2065 7870 6f72 7465 642e 204f 6e63  be exported. Onc
+000136c0: 6520 7365 742c 2074 6869 7320 6361 6e6e  e set, this cann
+000136d0: 6f74 2062 6520 6469 7361 626c 6564 2e20  ot be disabled. 
+000136e0: 4465 6661 756c 7473 200d 0a20 2020 2020  Defaults ..     
+000136f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013710: 2020 2020 746f 2046 616c 7365 2e0d 0a20      to False... 
+00013720: 2020 2020 2020 2020 2020 2061 6c6c 6f77             allow
+00013730: 5f70 6c61 696e 7465 7874 5f62 6163 6b75  _plaintext_backu
+00013740: 7020 2862 6f6f 6c2c 206f 7074 696f 6e61  p (bool, optiona
+00013750: 6c29 3a20 4966 2073 6574 2c20 656e 6162  l): If set, enab
+00013760: 6c65 7320 7461 6b69 6e67 2062 6163 6b75  les taking backu
+00013770: 7020 6f66 206e 616d 6564 206b 6579 2069  p of named key i
+00013780: 6e20 7468 6520 706c 6169 6e74 6578 7420  n the plaintext 
+00013790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137c0: 2020 2020 2020 2066 6f72 6d61 742e 204f         format. O
+000137d0: 6e63 6520 7365 742c 2074 6869 7320 6361  nce set, this ca
+000137e0: 6e6e 6f74 2062 6520 6469 7361 626c 6564  nnot be disabled
+000137f0: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
+00013800: 6c73 652e 0d0a 2020 2020 2020 2020 2020  lse...          
+00013810: 2020 6175 746f 5f72 6f74 6174 655f 7065    auto_rotate_pe
+00013820: 7269 6f64 2028 7374 722c 206f 7074 696f  riod (str, optio
+00013830: 6e61 6c29 3a20 5468 6520 7065 7269 6f64  nal): The period
+00013840: 2061 7420 7768 6963 6820 7468 6973 206b   at which this k
+00013850: 6579 2073 686f 756c 6420 6265 2072 6f74  ey should be rot
+00013860: 6174 6564 2061 7574 6f6d 6174 6963 616c  ated automatical
+00013870: 6c79 2e20 0d0a 2020 2020 2020 2020 2020  ly. ..          
+00013880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138a0: 2020 2020 2020 5365 7474 696e 6720 7468        Setting th
+000138b0: 6973 2074 6f20 2230 2220 2874 6865 2064  is to "0" (the d
+000138c0: 6566 6175 6c74 2920 7769 6c6c 2064 6973  efault) will dis
+000138d0: 6162 6c65 2061 7574 6f6d 6174 6963 206b  able automatic k
+000138e0: 6579 200d 0a20 2020 2020 2020 2020 2020  ey ..           
+000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013910: 2020 2020 2072 6f74 6174 696f 6e2e 2054       rotation. T
+00013920: 6869 7320 7661 6c75 6520 6361 6e6e 6f74  his value cannot
+00013930: 2062 6520 7368 6f72 7465 7220 7468 616e   be shorter than
+00013940: 206f 6e65 2068 6f75 722e 2044 6566 6175   one hour. Defau
+00013950: 6c74 7320 746f 2022 3022 2e0d 0a0d 0a20  lts to "0"..... 
+00013960: 2020 2020 2020 2052 6574 7572 6e73 3a0d         Returns:.
+00013970: 0a20 2020 2020 2020 2020 2020 2062 6f6f  .            boo
+00013980: 6c3a 2072 6574 7572 6e20 5472 7565 2069  l: return True i
+00013990: 6620 7375 6363 6573 732c 206f 7468 6572  f success, other
+000139a0: 7769 7365 2072 6574 7572 6e20 4661 6c73  wise return Fals
+000139b0: 650d 0a20 2020 2020 2020 2022 2222 0d0a  e..        """..
+000139c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000139d0: 6973 5f61 7574 683a 0d0a 2020 2020 2020  is_auth:..      
+000139e0: 2020 2020 2020 6578 6973 745f 6b65 7973        exist_keys
+000139f0: 203d 2073 656c 662e 6c69 7374 5f6b 6579   = self.list_key
+00013a00: 286d 6f75 6e74 5f70 6174 6829 0d0a 2020  (mount_path)..  
+00013a10: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00013a20: 6520 696e 2065 7869 7374 5f6b 6579 733a  e in exist_keys:
+00013a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013a40: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+00013a50: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+00013a60: 2e5f 5f6e 616d 655f 5f7d 202d 2069 6d70  .__name__} - imp
+00013a70: 6f72 7420 6b65 7920 6572 726f 723a 206b  ort key error: k
+00013a80: 6579 2027 7b6e 616d 657d 2720 616c 7265  ey '{name}' alre
+00013a90: 6164 7920 6578 6973 7473 2229 0d0a 2020  ady exists")..  
+00013aa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013ab0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00013ac0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00013ad0: 2020 2020 2020 7061 796c 6f61 6420 3d20        payload = 
+00013ae0: 436f 6e66 6967 4469 6374 2829 0d0a 2020  ConfigDict()..  
+00013af0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00013b00: 2020 2020 2020 2020 6966 206b 6579 5f74          if key_t
+00013b10: 7970 652e 6c6f 7765 7228 2920 6e6f 7420  ype.lower() not 
+00013b20: 696e 2073 656c 662e 4b45 595f 5459 5045  in self.KEY_TYPE
+00013b30: 533a 0d0a 2020 2020 2020 2020 2020 2020  S:..            
+00013b40: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00013b50: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+00013b60: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2069  __.__name__} - i
+00013b70: 6d70 6f72 7420 6b65 7920 6572 726f 723a  mport key error:
+00013b80: 206b 6579 5f74 7970 6520 6d75 7374 2062   key_type must b
+00013b90: 6520 6f6e 6520 6f66 207b 7365 6c66 2e4b  e one of {self.K
+00013ba0: 4559 5f54 5950 4553 7d22 290d 0a20 2020  EY_TYPES}")..   
+00013bb0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00013bc0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+00013bd0: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
+00013be0: 7479 7065 225d 203d 206b 6579 5f74 7970  type"] = key_typ
+00013bf0: 652e 6c6f 7765 7228 290d 0a20 2020 2020  e.lower()..     
+00013c00: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00013c10: 2020 2020 2069 6620 7075 626c 6963 5f6b       if public_k
+00013c20: 6579 2021 3d20 2222 3a0d 0a20 2020 2020  ey != "":..     
+00013c30: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
+00013c40: 6164 5b22 7075 626c 6963 5f6b 6579 225d  ad["public_key"]
+00013c50: 203d 2070 7562 6c69 635f 6b65 790d 0a20   = public_key.. 
+00013c60: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00013c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013c80: 2020 6966 2063 6970 6865 7274 6578 7420    if ciphertext 
+00013c90: 3d3d 2022 223a 0d0a 2020 2020 2020 2020  == "":..        
+00013ca0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013cb0: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
+00013cc0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
+00013cd0: 655f 5f7d 202d 2069 6d70 6f72 7420 6b65  e__} - import ke
+00013ce0: 7920 6572 726f 723a 2063 6970 6865 7274  y error: ciphert
+00013cf0: 6578 7420 6361 6e6e 6f74 2062 6520 656d  ext cannot be em
+00013d00: 7074 7920 7768 656e 2070 7562 6c69 635f  pty when public_
+00013d10: 6b65 7920 6973 2065 6d70 7479 2229 0d0a  key is empty")..
+00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d30: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00013d40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013d50: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+00013d60: 6966 2063 6970 6865 7274 6578 7420 213d  if ciphertext !=
+00013d70: 2022 223a 0d0a 2020 2020 2020 2020 2020   "":..          
+00013d80: 2020 2020 2020 6966 206e 6f74 2069 735f        if not is_
+00013d90: 6261 7365 3634 2863 6970 6865 7274 6578  base64(ciphertex
+00013da0: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00013db0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00013dc0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+00013dd0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00013de0: 7d20 2d20 696d 706f 7274 206b 6579 2065  } - import key e
+00013df0: 7272 6f72 3a20 6369 7068 6572 7465 7874  rror: ciphertext
+00013e00: 206d 7573 7420 6265 2062 6173 6536 3420   must be base64 
+00013e10: 656e 636f 6465 6422 290d 0a20 2020 2020  encoded")..     
+00013e20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00013e30: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+00013e40: 2020 2020 2020 2020 2020 2020 2070 6179               pay
+00013e50: 6c6f 6164 5b22 6369 7068 6572 7465 7874  load["ciphertext
+00013e60: 225d 203d 2063 6970 6865 7274 6578 740d  "] = ciphertext.
+00013e70: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00013e80: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+00013e90: 796c 6f61 642e 6369 7068 6572 7465 7874  yload.ciphertext
+00013ea0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00013eb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013ec0: 7570 706f 7274 5f68 6173 685f 6675 6e63  upport_hash_func
+00013ed0: 7469 6f6e 203d 205b 2253 4841 3122 2c20  tion = ["SHA1", 
+00013ee0: 2253 4841 3232 3422 2c20 2253 4841 3235  "SHA224", "SHA25
+00013ef0: 3622 2c20 2253 4841 3338 3422 2c20 2253  6", "SHA384", "S
+00013f00: 4841 3531 3222 5d0d 0a20 2020 2020 2020  HA512"]..       
+00013f10: 2020 2020 2020 2020 2069 6620 6861 7368           if hash
+00013f20: 5f66 756e 6374 696f 6e20 6e6f 7420 696e  _function not in
+00013f30: 2073 7570 706f 7274 5f68 6173 685f 6675   support_hash_fu
+00013f40: 6e63 7469 6f6e 3a0d 0a20 2020 2020 2020  nction:..       
+00013f50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00013f60: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
+00013f70: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
+00013f80: 6d65 5f5f 7d20 2d20 696d 706f 7274 206b  me__} - import k
+00013f90: 6579 2065 7272 6f72 3a20 6861 7368 5f66  ey error: hash_f
+00013fa0: 756e 6374 696f 6e20 6d75 7374 2062 6520  unction must be 
+00013fb0: 6f6e 6520 6f66 207b 7375 7070 6f72 745f  one of {support_
+00013fc0: 6861 7368 5f66 756e 6374 696f 6e7d 2229  hash_function}")
+00013fd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013fe0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00013ff0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00014000: 2020 2020 7061 796c 6f61 645b 2268 6173      payload["has
+00014010: 685f 6675 6e63 7469 6f6e 225d 203d 2068  h_function"] = h
+00014020: 6173 685f 6675 6e63 7469 6f6e 0d0a 2020  ash_function..  
+00014030: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00014040: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00014050: 6c6c 6f77 5f72 6f74 6174 696f 6e3a 0d0a  llow_rotation:..
+00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014070: 7061 796c 6f61 645b 2261 6c6c 6f77 5f72  payload["allow_r
+00014080: 6f74 6174 696f 6e22 5d20 3d20 616c 6c6f  otation"] = allo
+00014090: 775f 726f 7461 7469 6f6e 0d0a 2020 2020  w_rotation..    
+000140a0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+000140b0: 2020 2020 2020 2020 2020 6966 2064 6572            if der
+000140c0: 6976 6564 3a0d 0a20 2020 2020 2020 2020  ived:..         
+000140d0: 2020 2020 2020 2069 6620 636f 6e74 6578         if contex
+000140e0: 7420 3d3d 2022 223a 0d0a 2020 2020 2020  t == "":..      
+000140f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00014100: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00014110: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
+00014120: 616d 655f 5f7d 202d 2069 6d70 6f72 7420  ame__} - import 
+00014130: 6b65 7920 6572 726f 723a 2063 6f6e 7465  key error: conte
+00014140: 7874 2063 616e 6e6f 7420 6265 2065 6d70  xt cannot be emp
+00014150: 7479 2077 6865 6e20 6465 7269 7665 6420  ty when derived 
+00014160: 6973 2074 7275 6522 290d 0a20 2020 2020  is true")..     
+00014170: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014180: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+00014190: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000141a0: 6e6f 7420 6973 5f62 6173 6536 3428 636f  not is_base64(co
+000141b0: 6e74 6578 7429 3a0d 0a20 2020 2020 2020  ntext):..       
+000141c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000141d0: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
+000141e0: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
+000141f0: 6d65 5f5f 7d20 2d20 696d 706f 7274 206b  me__} - import k
+00014200: 6579 2065 7272 6f72 3a20 636f 6e74 6578  ey error: contex
+00014210: 7420 6d75 7374 2062 6520 6261 7365 3634  t must be base64
+00014220: 2065 6e63 6f64 6564 2229 0d0a 2020 2020   encoded")..    
+00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014240: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+00014250: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00014260: 796c 6f61 645b 2264 6572 6976 6564 225d  yload["derived"]
+00014270: 203d 2064 6572 6976 6564 0d0a 2020 2020   = derived..    
+00014280: 2020 2020 2020 2020 2020 2020 7061 796c              payl
+00014290: 6f61 645b 2263 6f6e 7465 7874 225d 203d  oad["context"] =
+000142a0: 2063 6f6e 7465 7874 0d0a 2020 2020 2020   context..      
+000142b0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+000142c0: 2020 2020 2020 2020 6966 2065 7870 6f72          if expor
+000142d0: 7461 626c 653a 0d0a 2020 2020 2020 2020  table:..        
+000142e0: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
+000142f0: 2265 7870 6f72 7461 626c 6522 5d20 3d20  "exportable"] = 
+00014300: 6578 706f 7274 6162 6c65 0d0a 2020 2020  exportable..    
+00014310: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00014320: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
+00014330: 6f77 5f70 6c61 696e 7465 7874 5f62 6163  ow_plaintext_bac
+00014340: 6b75 703a 0d0a 2020 2020 2020 2020 2020  kup:..          
+00014350: 2020 2020 2020 7061 796c 6f61 645b 2261        payload["a
+00014360: 6c6c 6f77 5f70 6c61 696e 7465 7874 5f62  llow_plaintext_b
+00014370: 6163 6b75 7022 5d20 3d20 616c 6c6f 775f  ackup"] = allow_
+00014380: 706c 6169 6e74 6578 745f 6261 636b 7570  plaintext_backup
+00014390: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+000143a0: 2020 2020 2020 2020 2020 2020 726f 7461              rota
+000143b0: 7465 5f70 6572 696f 6420 3d20 5661 756c  te_period = Vaul
+000143c0: 7444 7572 6174 696f 6e28 6175 746f 5f72  tDuration(auto_r
+000143d0: 6f74 6174 655f 7065 7269 6f64 290d 0a20  otate_period).. 
+000143e0: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
+000143f0: 7461 7465 5f70 6572 696f 642e 7661 6c75  tate_period.valu
+00014400: 6520 3e20 303a 0d0a 2020 2020 2020 2020  e > 0:..        
+00014410: 2020 2020 2020 2020 6c6f 7765 725f 7065          lower_pe
+00014420: 7269 6f64 203d 2056 6175 6c74 4475 7261  riod = VaultDura
+00014430: 7469 6f6e 2822 3168 2229 0d0a 2020 2020  tion("1h")..    
+00014440: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00014450: 6f74 6174 655f 7065 7269 6f64 203c 206c  otate_period < l
+00014460: 6f77 6572 5f70 6572 696f 643a 0d0a 2020  ower_period:..  
+00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014480: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+00014490: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+000144a0: 2e5f 5f6e 616d 655f 5f7d 202d 2069 6d70  .__name__} - imp
+000144b0: 6f72 7420 6b65 7920 6572 726f 723a 2054  ort key error: T
+000144c0: 6865 2076 616c 7565 206f 6620 6175 746f  he value of auto
+000144d0: 5f72 6f74 6174 655f 7065 7269 6f64 2063  _rotate_period c
+000144e0: 616e 6e6f 7420 6265 2073 686f 7274 6572  annot be shorter
+000144f0: 2074 6861 6e20 6f6e 6520 686f 7572 2229   than one hour")
+00014500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014510: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00014520: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00014530: 2020 2020 7061 796c 6f61 645b 2261 7574      payload["aut
+00014540: 6f5f 726f 7461 7465 5f70 6572 696f 6422  o_rotate_period"
+00014550: 5d20 3d20 6175 746f 5f72 6f74 6174 655f  ] = auto_rotate_
+00014560: 7065 7269 6f64 0d0a 2020 2020 2020 2020  period..        
+00014570: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00014580: 2020 2020 2020 7572 6c20 3d20 6165 735f        url = aes_
+00014590: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
+000145a0: 662e 7572 6c2c 206b 6579 3d72 616e 646f  f.url, key=rando
+000145b0: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
+000145c0: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
+000145d0: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
+000145e0: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
+000145f0: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
+00014600: 2020 746f 6b65 6e20 3d20 6165 735f 6465    token = aes_de
+00014610: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
+00014620: 746f 6b65 6e2c 206b 6579 3d72 616e 646f  token, key=rando
+00014630: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
+00014640: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
+00014650: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
+00014660: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
+00014670: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
+00014680: 2020 7265 7320 3d20 7265 7175 6573 7473    res = requests
+00014690: 2e70 6f73 7428 7572 6c2b 6622 7b6d 6f75  .post(url+f"{mou
+000146a0: 6e74 5f70 6174 687d 2f6b 6579 732f 7b6e  nt_path}/keys/{n
+000146b0: 616d 657d 2f69 6d70 6f72 7422 2c20 6865  ame}/import", he
+000146c0: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+000146d0: 546f 6b65 6e22 3a20 746f 6b65 6e7d 2c20  Token": token}, 
+000146e0: 6461 7461 3d6a 736f 6e2e 6475 6d70 7328  data=json.dumps(
+000146f0: 7061 796c 6f61 6429 290d 0a20 2020 2020  payload))..     
+00014700: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
+00014710: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
+00014720: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
+00014730: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
+00014740: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00014750: 7572 6e20 5472 7565 0d0a 2020 2020 2020  urn True..      
+00014760: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00014770: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00014780: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
+00014790: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
+000147a0: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
+000147b0: 696d 706f 7274 206b 6579 2065 7272 6f72  import key error
+000147c0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+000147d0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+000147e0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000147f0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00014800: 0d0a 0d0a 2020 2020 6465 6620 696d 706f  ....    def impo
+00014810: 7274 5f6b 6579 5f76 6572 7369 6f6e 2873  rt_key_version(s
+00014820: 656c 662c 200d 0a20 2020 2020 2020 2020  elf, ..         
 00014830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014840: 2020 2020 2020 2020 2020 206e 616d 653a             name:
-00014850: 2073 7472 2c0d 0a20 2020 2020 2020 2020   str,..         
-00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014870: 2020 6369 7068 6572 7465 7874 3a20 7374    ciphertext: st
-00014880: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-00014890: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000148a0: 6173 685f 6675 6e63 7469 6f6e 3a20 7374  ash_function: st
-000148b0: 7220 3d20 2253 4841 3235 3622 2c0d 0a20  r = "SHA256",.. 
-000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148d0: 2020 2020 2020 2020 2020 7075 626c 6963            public
-000148e0: 5f6b 6579 3a20 7374 7220 3d20 2222 2c0d  _key: str = "",.
-000148f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014900: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-00014910: 696f 6e3a 204f 7074 696f 6e61 6c5b 696e  ion: Optional[in
-00014920: 745d 203d 204e 6f6e 6529 3a0d 0a20 2020  t] = None):..   
-00014930: 2020 2020 2022 2222 696d 706f 7274 206e       """import n
-00014940: 6577 206b 6579 206d 6174 6572 6961 6c20  ew key material 
-00014950: 696e 746f 2061 6e20 6578 6973 7469 6e67  into an existing
-00014960: 2069 6d70 6f72 7465 6420 6b65 790d 0a20   imported key.. 
-00014970: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00014980: 204e 6f74 6162 6c79 2c20 7573 696e 6720   Notably, using 
-00014990: 7468 6973 206d 6574 686f 642c 2061 2070  this method, a p
-000149a0: 7269 7661 7465 206b 6579 206d 6174 6368  rivate key match
-000149b0: 696e 6720 6120 7075 626c 6963 206b 6579  ing a public key
-000149c0: 2063 616e 2062 6520 696d 706f 7274 6564   can be imported
-000149d0: 2061 7420 6120 6c61 7465 7220 6461 7465   at a later date
-000149e0: 2e0d 0a20 2020 2020 2020 200d 0a20 2020  ...        ..   
-000149f0: 2020 2020 204e 6f74 653a 204b 6579 7320       Note: Keys 
-00014a00: 7768 6f73 6520 6d61 7465 7269 616c 2077  whose material w
-00014a10: 6173 2067 656e 6572 6174 6564 2062 7920  as generated by 
-00014a20: 5661 756c 7420 646f 206e 6f74 2073 7570  Vault do not sup
-00014a30: 706f 7274 2069 6d70 6f72 7469 6e67 206b  port importing k
-00014a40: 6579 206d 6174 6572 6961 6c2e 200d 0a20  ey material. .. 
-00014a50: 2020 2020 2020 2020 2020 2020 204f 6e6c               Onl
-00014a60: 7920 6b65 7973 2074 6861 7420 7765 7265  y keys that were
-00014a70: 2070 7265 7669 6f75 736c 7920 696d 706f   previously impo
-00014a80: 7274 6564 2069 6e74 6f20 5661 756c 7420  rted into Vault 
-00014a90: 6361 6e20 696d 706f 7274 206e 6577 206b  can import new k
-00014aa0: 6579 206d 6174 6572 6961 6c20 6672 6f6d  ey material from
-00014ab0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00014ac0: 2061 6e20 6578 7465 726e 616c 2073 6f75   an external sou
-00014ad0: 7263 652e 0d0a 0d0a 2020 2020 2020 2020  rce.....        
-00014ae0: 5265 6665 7220 746f 2068 7474 7073 3a2f  Refer to https:/
-00014af0: 2f64 6576 656c 6f70 6572 2e68 6173 6869  /developer.hashi
-00014b00: 636f 7270 2e63 6f6d 2f76 6175 6c74 2f61  corp.com/vault/a
-00014b10: 7069 2d64 6f63 732f 7365 6372 6574 2f74  pi-docs/secret/t
-00014b20: 7261 6e73 6974 2369 6d70 6f72 742d 6b65  ransit#import-ke
-00014b30: 792d 7665 7273 696f 6e20 666f 7220 6d6f  y-version for mo
-00014b40: 7265 2064 6574 6169 6c73 0d0a 0d0a 2020  re details....  
-00014b50: 2020 2020 2020 4172 6773 3a0d 0a20 2020        Args:..   
-00014b60: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
-00014b70: 6174 6820 2873 7472 290d 0a20 2020 2020  ath (str)..     
-00014b80: 2020 2020 2020 206e 616d 6520 2873 7472         name (str
-00014b90: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
-00014ba0: 206e 616d 6520 6f66 2074 6865 2065 6e63   name of the enc
-00014bb0: 7279 7074 696f 6e20 6b65 7920 746f 2063  ryption key to c
-00014bc0: 7265 6174 652e 2054 6869 7320 6973 2073  reate. This is s
-00014bd0: 7065 6369 6669 6564 2061 7320 7061 7274  pecified as part
-00014be0: 206f 6620 7468 6520 5552 4c2e 0d0a 2020   of the URL...  
-00014bf0: 2020 2020 2020 2020 2020 6369 7068 6572            cipher
-00014c00: 7465 7874 2028 7374 7229 3a20 4120 6261  text (str): A ba
-00014c10: 7365 3634 2d65 6e63 6f64 6564 2073 7472  se64-encoded str
-00014c20: 696e 6720 7468 6174 2063 6f6e 7461 696e  ing that contain
-00014c30: 7320 7477 6f20 7661 6c75 6573 3a20 616e  s two values: an
-00014c40: 2065 7068 656d 6572 616c 2032 3536 2d62   ephemeral 256-b
-00014c50: 6974 2041 4553 206b 6579 200d 0a20 2020  it AES key ..   
-00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c70: 2020 2020 2020 2020 2020 2077 7261 7070             wrapp
-00014c80: 6564 2075 7369 6e67 2074 6865 2077 7261  ed using the wra
-00014c90: 7070 696e 6720 6b65 7920 7265 7475 726e  pping key return
-00014ca0: 6564 2062 7920 5661 756c 7420 616e 6420  ed by Vault and 
-00014cb0: 7468 6520 656e 6372 7970 7469 6f6e 206f  the encryption o
-00014cc0: 6620 7468 6520 696d 706f 7274 200d 0a20  f the import .. 
-00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ce0: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00014cf0: 206d 6174 6572 6961 6c20 756e 6465 7220   material under 
-00014d00: 7468 6520 7072 6f76 6964 6564 2041 4553  the provided AES
-00014d10: 206b 6579 2e20 5468 6520 7772 6170 7065   key. The wrappe
-00014d20: 6420 4145 5320 6b65 7920 7368 6f75 6c64  d AES key should
-00014d30: 2062 6520 7468 6520 6669 7273 7420 3531   be the first 51
-00014d40: 3220 0d0a 2020 2020 2020 2020 2020 2020  2 ..            
-00014d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d60: 2020 6279 7465 7320 6f66 2074 6865 2063    bytes of the c
-00014d70: 6970 6865 7274 6578 742c 2061 6e64 2074  iphertext, and t
-00014d80: 6865 2065 6e63 7279 7074 6564 206b 6579  he encrypted key
-00014d90: 206d 6174 6572 6961 6c20 7368 6f75 6c64   material should
-00014da0: 2062 6520 7468 6520 7265 6d61 696e 696e   be the remainin
-00014db0: 6720 6279 7465 732e 200d 0a20 2020 2020  g bytes. ..     
-00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dd0: 2020 2020 2020 2020 2053 6565 2074 6865           See the
-00014de0: 2042 594f 4b20 2842 7269 6e67 2079 6f75   BYOK (Bring you
-00014df0: 7220 6f77 6e20 6b65 7929 2073 6563 7469  r own key) secti
-00014e00: 6f6e 206f 6620 7468 6520 5472 616e 7369  on of the Transi
-00014e10: 7420 7365 6372 6574 7320 656e 6769 6e65  t secrets engine
-00014e20: 2064 6f63 756d 656e 7461 7469 6f6e 200d   documentation .
-00014e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014e40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00014e50: 6f72 206d 6f72 6520 696e 666f 726d 6174  or more informat
-00014e60: 696f 6e20 6f6e 2063 6f6e 7374 7275 6374  ion on construct
-00014e70: 696e 6720 7468 6520 6369 7068 6572 7465  ing the cipherte
-00014e80: 7874 2e0d 0a20 2020 2020 2020 2020 2020  xt...           
-00014e90: 2068 6173 685f 6675 6e63 7469 6f6e 2028   hash_function (
-00014ea0: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
-00014eb0: 5468 6520 6861 7368 2066 756e 6374 696f  The hash functio
-00014ec0: 6e20 7573 6564 2066 6f72 2074 6865 2052  n used for the R
-00014ed0: 5341 2d4f 4145 5020 7374 6570 206f 6620  SA-OAEP step of 
-00014ee0: 6372 6561 7469 6e67 2074 6865 200d 0a20  creating the .. 
-00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f10: 2020 2020 2020 2020 2020 6369 7068 6572            cipher
-00014f20: 7465 7874 2e20 5375 7070 6f72 7465 6420  text. Supported 
-00014f30: 6861 7368 2066 756e 6374 696f 6e73 2061  hash functions a
-00014f40: 7265 3a20 5348 4131 2c20 5348 4132 3234  re: SHA1, SHA224
-00014f50: 2c20 5348 4132 3536 2c20 0d0a 2020 2020  , SHA256, ..    
-00014f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f80: 2020 2020 2020 2053 4841 3338 342c 2061         SHA384, a
-00014f90: 6e64 2053 4841 3531 322e 2044 6566 6175  nd SHA512. Defau
-00014fa0: 6c74 7320 746f 2022 5348 4132 3536 222e  lts to "SHA256".
-00014fb0: 0d0a 2020 2020 2020 2020 2020 2020 7075  ..            pu
-00014fc0: 626c 6963 5f6b 6579 2028 7374 722c 206f  blic_key (str, o
-00014fd0: 7074 696f 6e61 6c29 3a20 4120 706c 6169  ptional): A plai
-00014fe0: 6e74 6578 7420 5045 4d20 7075 626c 6963  ntext PEM public
-00014ff0: 206b 6579 2074 6f20 6265 2069 6d70 6f72   key to be impor
-00015000: 7465 642e 2054 6869 7320 6c69 6d69 7473  ted. This limits
-00015010: 2074 6865 206f 7065 7261 7469 6f6e 7320   the operations 
-00015020: 6176 6169 6c61 626c 6520 0d0a 2020 2020  available ..    
-00015030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015050: 2020 2020 756e 6465 7220 7468 6973 206b      under this k
-00015060: 6579 2074 6f20 7665 7269 6669 6361 7469  ey to verificati
-00015070: 6f6e 2061 6e64 2065 6e63 7279 7074 696f  on and encryptio
-00015080: 6e2c 2064 6570 656e 6469 6e67 206f 6e20  n, depending on 
-00015090: 7468 6520 6b65 7920 7479 7065 2061 6e64  the key type and
-000150a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-000150b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150c0: 2020 2020 2020 2020 2020 2061 6c67 6f72             algor
-000150d0: 6974 686d 2c20 6173 206e 6f20 7072 6976  ithm, as no priv
-000150e0: 6174 6520 6b65 7920 6973 2061 7661 696c  ate key is avail
-000150f0: 6162 6c65 2e20 4465 6661 756c 7473 2074  able. Defaults t
-00015100: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-00015110: 2020 2076 6572 7369 6f6e 2028 4f70 7469     version (Opti
-00015120: 6f6e 616c 5b69 6e74 5d2c 206f 7074 696f  onal[int], optio
-00015130: 6e61 6c29 3a20 4b65 7920 7665 7273 696f  nal): Key versio
-00015140: 6e20 746f 2062 6520 7570 6461 7465 642c  n to be updated,
-00015150: 2069 6620 6c65 6674 2065 6d70 7479 2c20   if left empty, 
-00015160: 6120 6e65 7720 7665 7273 696f 6e20 7769  a new version wi
-00015170: 6c6c 2062 6520 6372 6561 7465 6420 0d0a  ll be created ..
-00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151a0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-000151b0: 6e6c 6573 7320 6120 7072 6976 6174 6520  nless a private 
-000151c0: 6b65 7920 6973 2073 7065 6369 6669 6564  key is specified
-000151d0: 2061 6e64 2074 6865 2027 4c61 7465 7374   and the 'Latest
-000151e0: 2720 6b65 7920 6973 206d 6973 7369 6e67  ' key is missing
-000151f0: 2061 200d 0a20 2020 2020 2020 2020 2020   a ..           
-00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015220: 2020 2020 7072 6976 6174 6520 6b65 792e      private key.
-00015230: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00015240: 652e 0d0a 0d0a 2020 2020 2020 2020 5265  e.....        Re
-00015250: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-00015260: 2020 2020 626f 6f6c 3a20 7265 7475 726e      bool: return
-00015270: 2054 7275 6520 6966 2073 7563 6365 7373   True if success
-00015280: 2c20 6f74 6865 7277 6973 6520 7265 7475  , otherwise retu
-00015290: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-000152a0: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-000152b0: 6620 7365 6c66 2e69 735f 6175 7468 3a0d  f self.is_auth:.
-000152c0: 0a20 2020 2020 2020 2020 2020 2065 7869  .            exi
-000152d0: 7374 5f6b 6579 7320 3d20 7365 6c66 2e6c  st_keys = self.l
-000152e0: 6973 745f 6b65 7928 6d6f 756e 745f 7061  ist_key(mount_pa
-000152f0: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
-00015300: 2069 6620 6e61 6d65 206e 6f74 2069 6e20   if name not in 
-00015310: 6578 6973 745f 6b65 7973 3a0d 0a20 2020  exist_keys:..   
-00015320: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00015330: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-00015340: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-00015350: 6d65 5f5f 7d20 2d20 696d 706f 7274 206b  me__} - import k
-00015360: 6579 2076 6572 7369 6f6e 2065 7272 6f72  ey version error
-00015370: 3a20 6b65 7920 277b 6e61 6d65 7d27 206e  : key '{name}' n
-00015380: 6f74 2066 6f75 6e64 2229 0d0a 2020 2020  ot found")..    
-00015390: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000153a0: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-000153b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000153c0: 2020 2020 7061 796c 6f61 6420 3d20 436f      payload = Co
-000153d0: 6e66 6967 4469 6374 2829 0d0a 2020 2020  nfigDict()..    
-000153e0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-000153f0: 2020 2020 2020 6966 206e 6f74 2069 735f        if not is_
-00015400: 6261 7365 3634 2863 6970 6865 7274 6578  base64(ciphertex
-00015410: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-00015420: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00015430: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
-00015440: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-00015450: 696d 706f 7274 206b 6579 2076 6572 7369  import key versi
-00015460: 6f6e 2065 7272 6f72 3a20 6369 7068 6572  on error: cipher
-00015470: 7465 7874 206d 7573 7420 6265 2062 6173  text must be bas
-00015480: 6536 3420 656e 636f 6465 6422 290d 0a20  e64 encoded").. 
-00015490: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000154a0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-000154b0: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
-000154c0: 5b22 6369 7068 6572 7465 7874 225d 203d  ["ciphertext"] =
-000154d0: 2063 6970 6865 7274 6578 740d 0a20 2020   ciphertext..   
-000154e0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-000154f0: 2020 2020 2020 2073 7570 706f 7274 5f68         support_h
-00015500: 6173 685f 6675 6e63 7469 6f6e 203d 205b  ash_function = [
-00015510: 2253 4841 3122 2c20 2253 4841 3232 3422  "SHA1", "SHA224"
-00015520: 2c20 2253 4841 3235 3622 2c20 2253 4841  , "SHA256", "SHA
-00015530: 3338 3422 2c20 2253 4841 3531 3222 5d0d  384", "SHA512"].
-00015540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015550: 6861 7368 5f66 756e 6374 696f 6e20 6e6f  hash_function no
-00015560: 7420 696e 2073 7570 706f 7274 5f68 6173  t in support_has
-00015570: 685f 6675 6e63 7469 6f6e 3a0d 0a20 2020  h_function:..   
-00015580: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00015590: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-000155a0: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-000155b0: 6d65 5f5f 7d20 2d20 696d 706f 7274 206b  me__} - import k
-000155c0: 6579 2076 6572 7369 6f6e 2065 7272 6f72  ey version error
-000155d0: 3a20 6861 7368 5f66 756e 6374 696f 6e20  : hash_function 
-000155e0: 6d75 7374 2062 6520 6f6e 6520 6f66 207b  must be one of {
-000155f0: 7375 7070 6f72 745f 6861 7368 5f66 756e  support_hash_fun
-00015600: 6374 696f 6e7d 2229 0d0a 2020 2020 2020  ction}")..      
-00015610: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00015620: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00015630: 2020 2020 7061 796c 6f61 645b 2268 6173      payload["has
-00015640: 685f 6675 6e63 7469 6f6e 225d 203d 2068  h_function"] = h
-00015650: 6173 685f 6675 6e63 7469 6f6e 0d0a 2020  ash_function..  
-00015660: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00015670: 2020 2020 2020 2020 6966 2070 7562 6c69          if publi
-00015680: 635f 6b65 7920 213d 2022 223a 0d0a 2020  c_key != "":..  
-00015690: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000156a0: 796c 6f61 645b 2270 7562 6c69 635f 6b65  yload["public_ke
-000156b0: 7922 5d20 3d20 7075 626c 6963 5f6b 6579  y"] = public_key
-000156c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000156d0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-000156e0: 6966 2076 6572 7369 6f6e 2069 7320 6e6f  if version is no
-000156f0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00015700: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00015710: 6973 5f69 6e74 2876 6572 7369 6f6e 293a  is_int(version):
-00015720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00015730: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00015740: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-00015750: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-00015760: 2069 6d70 6f72 7420 6b65 7920 7665 7273   import key vers
-00015770: 696f 6e20 6572 726f 723a 2076 6572 7369  ion error: versi
-00015780: 6f6e 206d 7573 7420 6265 2061 6e20 696e  on must be an in
-00015790: 7465 6765 7222 290d 0a20 2020 2020 2020  teger")..       
-000157a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000157b0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-000157c0: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
-000157d0: 6164 5b22 7665 7273 696f 6e22 5d20 3d20  ad["version"] = 
-000157e0: 7665 7273 696f 6e0d 0a20 2020 2020 2020  version..       
-000157f0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00015800: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
-00015810: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-00015820: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
-00015830: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-00015840: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-00015850: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-00015860: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-00015870: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00015880: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
-00015890: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-000158a0: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
-000158b0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-000158c0: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-000158d0: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-000158e0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-000158f0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00015900: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-00015910: 732e 706f 7374 2875 726c 2b66 227b 6d6f  s.post(url+f"{mo
-00015920: 756e 745f 7061 7468 7d2f 6b65 7973 2f7b  unt_path}/keys/{
-00015930: 6e61 6d65 7d2f 696d 706f 7274 5f76 6572  name}/import_ver
-00015940: 7369 6f6e 222c 2068 6561 6465 7273 3d7b  sion", headers={
-00015950: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
-00015960: 2074 6f6b 656e 7d2c 2064 6174 613d 6a73   token}, data=js
-00015970: 6f6e 2e64 756d 7073 2870 6179 6c6f 6164  on.dumps(payload
-00015980: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00015990: 6966 2072 6573 2e73 7461 7475 735f 636f  if res.status_co
-000159a0: 6465 203d 3d20 3230 3020 6f72 2072 6573  de == 200 or res
-000159b0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-000159c0: 3230 343a 0d0a 2020 2020 2020 2020 2020  204:..          
-000159d0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-000159e0: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
-000159f0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00015a00: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-00015a10: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
-00015a20: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00015a30: 5f2c 2072 6573 2c20 2269 6d70 6f72 7420  _, res, "import 
-00015a40: 6b65 7920 7665 7273 696f 6e20 6572 726f  key version erro
-00015a50: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
-00015a60: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00015a70: 650d 0a20 2020 2020 2020 2020 2020 200d  e..            .
-00015a80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015a90: 4661 6c73 650d 0a0d 0a20 2020 2064 6566  False....    def
-00015aa0: 2067 6574 5f77 7261 7070 696e 675f 6b65   get_wrapping_ke
-00015ab0: 7928 7365 6c66 2c20 6d6f 756e 745f 7061  y(self, mount_pa
-00015ac0: 7468 3a20 7374 7229 3a0d 0a20 2020 2020  th: str):..     
-00015ad0: 2020 2022 2222 7265 7472 6965 7665 2074     """retrieve t
-00015ae0: 6865 2077 7261 7070 696e 6720 6b65 7920  he wrapping key 
-00015af0: 746f 2075 7365 2066 6f72 2069 6d70 6f72  to use for impor
-00015b00: 7469 6e67 206b 6579 732e 200d 0a20 2020  ting keys. ..   
-00015b10: 2020 2020 200d 0a20 2020 2020 2020 2054       ..        T
-00015b20: 6865 2072 6574 7572 6e65 6420 6b65 7920  he returned key 
-00015b30: 7769 6c6c 2062 6520 6120 3430 3936 2d62  will be a 4096-b
-00015b40: 6974 2052 5341 2070 7562 6c69 6320 6b65  it RSA public ke
-00015b50: 792e 0d0a 0d0a 2020 2020 2020 2020 4172  y.....        Ar
-00015b60: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-00015b70: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
-00015b80: 290d 0a0d 0a20 2020 2020 2020 2052 6574  )....        Ret
-00015b90: 7572 6e73 3a0d 0a20 2020 2020 2020 2020  urns:..         
-00015ba0: 2020 2064 6963 7420 6f72 204e 6f6e 653a     dict or None:
-00015bb0: 2072 6574 7572 6e20 6469 6374 2069 6620   return dict if 
-00015bc0: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
-00015bd0: 7365 2072 6574 7572 6e20 4e6f 6e65 0d0a  se return None..
-00015be0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00015bf0: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
-00015c00: 6175 7468 3a0d 0a20 2020 2020 2020 2020  auth:..         
-00015c10: 2020 2075 726c 203d 2061 6573 5f64 6563     url = aes_dec
-00015c20: 7279 7074 5f74 6578 7428 7365 6c66 2e75  rypt_text(self.u
-00015c30: 726c 2c20 6b65 793d 7261 6e64 6f6d 5f68  rl, key=random_h
-00015c40: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
-00015c50: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
-00015c60: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
-00015c70: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
-00015c80: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
-00015c90: 6f6b 656e 203d 2061 6573 5f64 6563 7279  oken = aes_decry
-00015ca0: 7074 5f74 6578 7428 7365 6c66 2e74 6f6b  pt_text(self.tok
-00015cb0: 656e 2c20 6b65 793d 7261 6e64 6f6d 5f68  en, key=random_h
-00015cc0: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
-00015cd0: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
-00015ce0: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
-00015cf0: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
-00015d00: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00015d10: 6573 203d 2072 6571 7565 7374 732e 6765  es = requests.ge
-00015d20: 7428 7572 6c2b 6622 7b6d 6f75 6e74 5f70  t(url+f"{mount_p
-00015d30: 6174 687d 2f77 7261 7070 696e 675f 6b65  ath}/wrapping_ke
-00015d40: 7922 2c20 6865 6164 6572 733d 7b22 582d  y", headers={"X-
-00015d50: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
-00015d60: 6b65 6e7d 290d 0a20 2020 2020 2020 2020  ken})..         
-00015d70: 2020 2069 6620 7265 732e 7374 6174 7573     if res.status
-00015d80: 5f63 6f64 6520 3d3d 2032 3030 206f 7220  _code == 200 or 
-00015d90: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-00015da0: 3d3d 2032 3034 3a0d 0a20 2020 2020 2020  == 204:..       
-00015db0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00015dc0: 7265 732e 6a73 6f6e 2829 5b22 6461 7461  res.json()["data
-00015dd0: 225d 5b22 7075 626c 6963 5f6b 6579 225d  "]["public_key"]
-00015de0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00015df0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00015e00: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
-00015e10: 7272 6f72 5f72 6573 706f 6e73 6528 5f5f  rror_response(__
-00015e20: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00015e30: 2c20 7265 732c 2022 6765 7420 7772 6170  , res, "get wrap
-00015e40: 7069 6e67 206b 6579 2065 7272 6f72 2229  ping key error")
-00015e50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00015e60: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00015e70: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00015e80: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00015e90: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
-00015ea0: 2020 2064 6566 2072 6561 645f 6b65 7928     def read_key(
-00015eb0: 7365 6c66 2c20 6d6f 756e 745f 7061 7468  self, mount_path
-00015ec0: 3a20 7374 722c 206e 616d 653a 2073 7472  : str, name: str
-00015ed0: 293a 0d0a 2020 2020 2020 2020 2222 2272  ):..        """r
-00015ee0: 6561 6420 7468 6520 696e 666f 726d 6174  ead the informat
-00015ef0: 696f 6e20 6162 6f75 7420 6120 6e61 6d65  ion about a name
-00015f00: 6420 656e 6372 7970 7469 6f6e 206b 6579  d encryption key
-00015f10: 0d0a 0d0a 2020 2020 2020 2020 5265 6665  ....        Refe
-00015f20: 7220 746f 2068 7474 7073 3a2f 2f64 6576  r to https://dev
-00015f30: 656c 6f70 6572 2e68 6173 6869 636f 7270  eloper.hashicorp
-00015f40: 2e63 6f6d 2f76 6175 6c74 2f61 7069 2d64  .com/vault/api-d
-00015f50: 6f63 732f 7365 6372 6574 2f74 7261 6e73  ocs/secret/trans
-00015f60: 6974 2372 6561 642d 6b65 7920 666f 7220  it#read-key for 
-00015f70: 6d6f 7265 2064 6574 6169 6c73 2e0d 0a0d  more details....
-00015f80: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-00015f90: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-00015fa0: 745f 7061 7468 2028 7374 7229 0d0a 2020  t_path (str)..  
-00015fb0: 2020 2020 2020 2020 2020 6e61 6d65 2028            name (
-00015fc0: 7374 7229 3a20 5370 6563 6966 6965 7320  str): Specifies 
-00015fd0: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
-00015fe0: 656e 6372 7970 7469 6f6e 206b 6579 2074  encryption key t
-00015ff0: 6f20 7265 6164 2e0d 0a0d 0a20 2020 2020  o read.....     
-00016000: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
-00016010: 2020 2020 2020 2020 2064 6963 7420 6f72           dict or
-00016020: 204e 6f6e 653a 2072 6574 7572 6e20 7468   None: return th
-00016030: 6520 696e 666f 726d 6174 696f 6e20 6162  e information ab
-00016040: 6f75 7420 7468 6520 6b65 7920 696e 2064  out the key in d
-00016050: 6963 7420 6966 2073 7563 6365 7373 2c20  ict if success, 
-00016060: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
-00016070: 204e 6f6e 650d 0a20 2020 2020 2020 2022   None..        "
-00016080: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
-00016090: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
-000160a0: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-000160b0: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
-000160c0: 2873 656c 662e 7572 6c2c 206b 6579 3d72  (self.url, key=r
-000160d0: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-000160e0: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-000160f0: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-00016100: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-00016110: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-00016120: 2020 2020 2020 746f 6b65 6e20 3d20 6165        token = ae
-00016130: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-00016140: 656c 662e 746f 6b65 6e2c 206b 6579 3d72  elf.token, key=r
-00016150: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-00016160: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-00016170: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-00016180: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-00016190: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-000161a0: 2020 2020 2020 7265 7320 3d20 7265 7175        res = requ
-000161b0: 6573 7473 2e67 6574 2875 726c 2b66 227b  ests.get(url+f"{
-000161c0: 6d6f 756e 745f 7061 7468 7d2f 6b65 7973  mount_path}/keys
-000161d0: 2f7b 6e61 6d65 7d22 2c20 6865 6164 6572  /{name}", header
-000161e0: 733d 7b22 582d 5661 756c 742d 546f 6b65  s={"X-Vault-Toke
-000161f0: 6e22 3a20 746f 6b65 6e7d 290d 0a20 2020  n": token})..   
-00016200: 2020 2020 2020 2020 2069 6620 7265 732e           if res.
-00016210: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
-00016220: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
-00016230: 5f63 6f64 6520 3d3d 2032 3034 3a0d 0a20  _code == 204:.. 
-00016240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016250: 6574 7572 6e20 7265 732e 6a73 6f6e 2829  eturn res.json()
-00016260: 5b22 6461 7461 225d 0d0a 2020 2020 2020  ["data"]..      
-00016270: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00016280: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00016290: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
-000162a0: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
-000162b0: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
-000162c0: 7265 6164 206b 6579 2065 7272 6f72 2229  read key error")
-000162d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000162e0: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-000162f0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00016300: 2072 6574 7572 6e20 4e6f 6e65 0d0a 0d0a   return None....
-00016310: 2020 2020 6465 6620 6c69 7374 5f6b 6579      def list_key
-00016320: 2873 656c 662c 206d 6f75 6e74 5f70 6174  (self, mount_pat
-00016330: 683a 2073 7472 293a 0d0a 2020 2020 2020  h: str):..      
-00016340: 2020 2222 226c 6973 7420 6578 6973 7469    """list existi
-00016350: 6e67 206b 6579 206e 616d 6573 2069 6e20  ng key names in 
-00016360: 226d 6f75 6e74 5f70 6174 682f 220d 0a0d  "mount_path/"...
-00016370: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-00016380: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-00016390: 745f 7061 7468 2028 7374 7229 0d0a 0d0a  t_path (str)....
-000163a0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-000163b0: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
-000163c0: 7374 206f 7220 4e6f 6e65 3a20 7265 7475  st or None: retu
-000163d0: 726e 2061 206c 6973 7420 6f66 206b 6579  rn a list of key
-000163e0: 206e 616d 6573 2069 6620 7375 6363 6573   names if succes
-000163f0: 732c 206f 7468 6572 7769 7365 2072 6574  s, otherwise ret
-00016400: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
-00016410: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-00016420: 6620 7365 6c66 2e69 735f 6175 7468 3a0d  f self.is_auth:.
-00016430: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-00016440: 6865 636b 2069 6620 7468 6520 6d6f 756e  heck if the moun
-00016450: 745f 7061 7468 2065 7869 7374 730d 0a20  t_path exists.. 
-00016460: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00016470: 5f63 6f6e 6669 6720 3d20 7365 6c66 2e72  _config = self.r
-00016480: 6561 645f 7472 616e 7369 745f 6361 6368  ead_transit_cach
-00016490: 655f 636f 6e66 6967 286d 6f75 6e74 5f70  e_config(mount_p
-000164a0: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
-000164b0: 2020 6966 2063 6163 6865 5f63 6f6e 6669    if cache_confi
-000164c0: 6720 6973 204e 6f6e 653a 0d0a 2020 2020  g is None:..    
-000164d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000164e0: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
-000164f0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00016500: 2020 2075 726c 203d 2061 6573 5f64 6563     url = aes_dec
-00016510: 7279 7074 5f74 6578 7428 7365 6c66 2e75  rypt_text(self.u
-00016520: 726c 2c20 6b65 793d 7261 6e64 6f6d 5f68  rl, key=random_h
-00016530: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
-00016540: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
-00016550: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
-00016560: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
-00016570: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
-00016580: 6f6b 656e 203d 2061 6573 5f64 6563 7279  oken = aes_decry
-00016590: 7074 5f74 6578 7428 7365 6c66 2e74 6f6b  pt_text(self.tok
-000165a0: 656e 2c20 6b65 793d 7261 6e64 6f6d 5f68  en, key=random_h
-000165b0: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
-000165c0: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
-000165d0: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
-000165e0: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
-000165f0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00016600: 6573 203d 2072 6571 7565 7374 732e 6765  es = requests.ge
-00016610: 7428 7572 6c2b 6622 7b6d 6f75 6e74 5f70  t(url+f"{mount_p
-00016620: 6174 687d 2f6b 6579 733f 6c69 7374 3d74  ath}/keys?list=t
-00016630: 7275 6522 2c20 6865 6164 6572 733d 7b22  rue", headers={"
-00016640: 582d 5661 756c 742d 546f 6b65 6e22 3a20  X-Vault-Token": 
-00016650: 746f 6b65 6e7d 290d 0a20 2020 2020 2020  token})..       
-00016660: 2020 2020 2069 6620 7265 732e 7374 6174       if res.stat
-00016670: 7573 5f63 6f64 6520 3d3d 2032 3030 206f  us_code == 200 o
-00016680: 7220 7265 732e 7374 6174 7573 5f63 6f64  r res.status_cod
-00016690: 6520 3d3d 2032 3034 3a0d 0a20 2020 2020  e == 204:..     
-000166a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000166b0: 6e20 7265 732e 6a73 6f6e 2829 5b22 6461  n res.json()["da
-000166c0: 7461 225d 5b22 6b65 7973 225d 0d0a 2020  ta"]["keys"]..  
-000166d0: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
-000166e0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-000166f0: 3d20 3430 343a 0d0a 2020 2020 2020 2020  = 404:..        
-00016700: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00016710: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-00016720: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00016730: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-00016740: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
-00016750: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00016760: 5f2c 2072 6573 2c20 226c 6973 7420 6b65  _, res, "list ke
-00016770: 7920 6572 726f 7222 290d 0a20 2020 2020  y error")..     
-00016780: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00016790: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
-000167a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000167b0: 204e 6f6e 650d 0a0d 0a20 2020 2064 6566   None....    def
-000167c0: 2064 656c 6574 655f 6b65 7928 7365 6c66   delete_key(self
-000167d0: 2c20 6d6f 756e 745f 7061 7468 3a20 7374  , mount_path: st
-000167e0: 722c 206e 616d 653a 2073 7472 293a 0d0a  r, name: str):..
-000167f0: 2020 2020 2020 2020 2222 2264 656c 6574          """delet
-00016800: 6520 6b65 790d 0a0d 0a20 2020 2020 2020  e key....       
-00016810: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00016820: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-00016830: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-00016840: 2020 6e61 6d65 2028 7374 7229 0d0a 0d0a    name (str)....
-00016850: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00016860: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-00016870: 6f6c 3a20 7265 7475 726e 2054 7275 6520  ol: return True 
-00016880: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-00016890: 7277 6973 6520 7265 7475 726e 2046 616c  rwise return Fal
-000168a0: 7365 0d0a 2020 2020 2020 2020 2222 220d  se..        """.
-000168b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000168c0: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-000168d0: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
-000168e0: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-000168f0: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
-00016900: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-00016910: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-00016920: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-00016930: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-00016940: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00016950: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
-00016960: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-00016970: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
-00016980: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-00016990: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-000169a0: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-000169b0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-000169c0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-000169d0: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-000169e0: 732e 6465 6c65 7465 2875 726c 2b66 227b  s.delete(url+f"{
-000169f0: 6d6f 756e 745f 7061 7468 7d2f 6b65 7973  mount_path}/keys
-00016a00: 2f7b 6e61 6d65 7d22 2c20 6865 6164 6572  /{name}", header
-00016a10: 733d 7b22 582d 5661 756c 742d 546f 6b65  s={"X-Vault-Toke
-00016a20: 6e22 3a20 746f 6b65 6e7d 290d 0a20 2020  n": token})..   
-00016a30: 2020 2020 2020 2020 2069 6620 7265 732e           if res.
-00016a40: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
-00016a50: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
-00016a60: 5f63 6f64 6520 3d3d 2032 3034 3a0d 0a20  _code == 204:.. 
-00016a70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016a80: 6574 7572 6e20 5472 7565 0d0a 2020 2020  eturn True..    
-00016a90: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00016aa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00016ab0: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
-00016ac0: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
-00016ad0: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
-00016ae0: 2022 6465 6c65 7465 206b 6579 2065 7272   "delete key err
-00016af0: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
-00016b00: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00016b10: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00016b20: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00016b30: 2046 616c 7365 0d0a 2020 2020 0d0a 2020   False..    ..  
-00016b40: 2020 6465 6620 7570 6461 7465 5f6b 6579    def update_key
-00016b50: 5f63 6f6e 6669 6728 7365 6c66 2c20 0d0a  _config(self, ..
-00016b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b70: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
-00016b80: 7061 7468 3a20 7374 722c 0d0a 2020 2020  path: str,..    
-00016b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ba0: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
-00016bb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016bc0: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-00016bd0: 6465 6372 7970 7469 6f6e 5f76 6572 7369  decryption_versi
-00016be0: 6f6e 3a20 696e 7420 3d20 302c 0d0a 2020  on: int = 0,..  
-00016bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c00: 2020 2020 2020 2020 6d69 6e5f 656e 6372          min_encr
-00016c10: 7970 7469 6f6e 5f76 6572 7369 6f6e 3a20  yption_version: 
-00016c20: 696e 7420 3d20 302c 0d0a 2020 2020 2020  int = 0,..      
-00016c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c40: 2020 2020 6465 6c65 7469 6f6e 5f61 6c6c      deletion_all
-00016c50: 6f77 6564 3a20 626f 6f6c 203d 2046 616c  owed: bool = Fal
-00016c60: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
-00016c70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00016c80: 7870 6f72 7461 626c 653a 2062 6f6f 6c20  xportable: bool 
-00016c90: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
-00016ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cb0: 2020 2020 616c 6c6f 775f 706c 6169 6e74      allow_plaint
-00016cc0: 6578 745f 6261 636b 7570 3a20 626f 6f6c  ext_backup: bool
-00016cd0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cf0: 2020 2020 2061 7574 6f5f 726f 7461 7465       auto_rotate
-00016d00: 5f70 6572 696f 643a 2073 7472 203d 2022  _period: str = "
-00016d10: 2229 3a0d 0a20 2020 2020 2020 2022 2222  "):..        """
-00016d20: 7475 6e69 6e67 2063 6f6e 6669 6775 7261  tuning configura
-00016d30: 7469 6f6e 2076 616c 7565 7320 666f 7220  tion values for 
-00016d40: 6120 6769 7665 6e20 6b65 790d 0a0d 0a20  a given key.... 
-00016d50: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
-00016d60: 6874 7470 733a 2f2f 6465 7665 6c6f 7065  https://develope
-00016d70: 722e 6861 7368 6963 6f72 702e 636f 6d2f  r.hashicorp.com/
-00016d80: 7661 756c 742f 6170 692d 646f 6373 2f73  vault/api-docs/s
-00016d90: 6563 7265 742f 7472 616e 7369 7423 7570  ecret/transit#up
-00016da0: 6461 7465 2d6b 6579 2d63 6f6e 6669 6775  date-key-configu
-00016db0: 7261 7469 6f6e 2066 6f72 206d 6f72 6520  ration for more 
-00016dc0: 6465 7461 696c 732e 0d0a 0d0a 2020 2020  details.....    
-00016dd0: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-00016de0: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
-00016df0: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
-00016e00: 2020 2020 206e 616d 6520 2873 7472 293a       name (str):
-00016e10: 2053 7065 6369 6669 6573 2074 6865 206e   Specifies the n
-00016e20: 616d 6520 6f66 2074 6865 206b 6579 2074  ame of the key t
-00016e30: 6f20 7570 6461 7465 0d0a 2020 2020 2020  o update..      
-00016e40: 2020 2020 2020 6d69 6e5f 6465 6372 7970        min_decryp
-00016e50: 7469 6f6e 5f76 6572 7369 6f6e 2028 696e  tion_version (in
-00016e60: 742c 206f 7074 696f 6e61 6c29 3a20 5370  t, optional): Sp
-00016e70: 6563 6966 6965 7320 7468 6520 6d69 6e69  ecifies the mini
-00016e80: 6d75 6d20 7665 7273 696f 6e20 6f66 2063  mum version of c
-00016e90: 6970 6865 7274 6578 7420 616c 6c6f 7765  iphertext allowe
-00016ea0: 6420 746f 2062 6520 6465 6372 7970 7465  d to be decrypte
-00016eb0: 642e 200d 0a20 2020 2020 2020 2020 2020  d. ..           
-00016ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 2020 2020 2020 2020 2041 646a 7573 7469           Adjusti
-00016ef0: 6e67 2074 6869 7320 6173 2070 6172 7420  ng this as part 
-00016f00: 6f66 2061 206b 6579 2072 6f74 6174 696f  of a key rotatio
-00016f10: 6e20 706f 6c69 6379 2063 616e 2070 7265  n policy can pre
-00016f20: 7665 6e74 206f 6c64 200d 0a20 2020 2020  vent old ..     
-00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00016f60: 6f70 6965 7320 6f66 2063 6970 6865 7274  opies of ciphert
-00016f70: 6578 7420 6672 6f6d 2062 6569 6e67 2064  ext from being d
-00016f80: 6563 7279 7074 6564 2c20 7368 6f75 6c64  ecrypted, should
-00016f90: 2074 6865 7920 6661 6c6c 2069 6e74 6f20   they fall into 
-00016fa0: 7468 6520 0d0a 2020 2020 2020 2020 2020  the ..          
-00016fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fd0: 2020 2020 2020 2020 2020 7772 6f6e 6720            wrong 
-00016fe0: 6861 6e64 732e 2046 6f72 2073 6967 6e61  hands. For signa
-00016ff0: 7475 7265 732c 2074 6869 7320 7661 6c75  tures, this valu
-00017000: 6520 636f 6e74 726f 6c73 2074 6865 206d  e controls the m
-00017010: 696e 696d 756d 2076 6572 7369 6f6e 200d  inimum version .
-00017020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017050: 2020 2020 206f 6620 7369 676e 6174 7572       of signatur
-00017060: 6520 7468 6174 2063 616e 2062 6520 7665  e that can be ve
-00017070: 7269 6669 6564 2061 6761 696e 7374 2e20  rified against. 
-00017080: 466f 7220 484d 4143 732c 2074 6869 7320  For HMACs, this 
-00017090: 636f 6e74 726f 6c73 200d 0a20 2020 2020  controls ..     
-000170a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000170d0: 6865 206d 696e 696d 756d 2076 6572 7369  he minimum versi
-000170e0: 6f6e 206f 6620 6120 6b65 7920 616c 6c6f  on of a key allo
-000170f0: 7765 6420 746f 2062 6520 7573 6564 2061  wed to be used a
-00017100: 7320 7468 6520 6b65 7920 666f 7220 0d0a  s the key for ..
-00017110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017140: 2020 2020 7665 7269 6669 6361 7469 6f6e      verification
-00017150: 2e20 4465 6661 756c 7473 2074 6f20 302e  . Defaults to 0.
-00017160: 0d0a 2020 2020 2020 2020 2020 2020 6d69  ..            mi
-00017170: 6e5f 656e 6372 7970 7469 6f6e 5f76 6572  n_encryption_ver
-00017180: 7369 6f6e 2028 696e 742c 206f 7074 696f  sion (int, optio
-00017190: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
-000171a0: 7468 6520 6d69 6e69 6d75 6d20 7665 7273  the minimum vers
-000171b0: 696f 6e20 6f66 2074 6865 206b 6579 2074  ion of the key t
-000171c0: 6861 7420 6361 6e20 6265 2075 7365 6420  hat can be used 
-000171d0: 746f 2065 6e63 7279 7074 200d 0a20 2020  to encrypt ..   
-000171e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017210: 2070 6c61 696e 7465 7874 2c20 7369 676e   plaintext, sign
-00017220: 2070 6179 6c6f 6164 732c 206f 7220 6765   payloads, or ge
-00017230: 6e65 7261 7465 2048 4d41 4373 2e20 4d75  nerate HMACs. Mu
-00017240: 7374 2062 6520 3020 2877 6869 6368 2077  st be 0 (which w
-00017250: 696c 6c20 7573 6520 0d0a 2020 2020 2020  ill use ..      
-00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017280: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00017290: 6520 6c61 7465 7374 2076 6572 7369 6f6e  e latest version
-000172a0: 2920 6f72 2061 2076 616c 7565 2067 7265  ) or a value gre
-000172b0: 6174 6572 206f 7220 6571 7561 6c20 746f  ater or equal to
-000172c0: 206d 696e 5f64 6563 7279 7074 696f 6e5f   min_decryption_
-000172d0: 7665 7273 696f 6e2e 200d 0a20 2020 2020  version. ..     
-000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017300: 2020 2020 2020 2020 2020 2020 2020 2044                 D
-00017310: 6566 6175 6c74 7320 746f 2030 2e0d 0a20  efaults to 0... 
-00017320: 2020 2020 2020 2020 2020 2064 656c 6574             delet
-00017330: 696f 6e5f 616c 6c6f 7765 6420 2862 6f6f  ion_allowed (boo
-00017340: 6c2c 206f 7074 696f 6e61 6c29 3a20 5370  l, optional): Sp
-00017350: 6563 6966 6965 7320 6966 2074 6865 206b  ecifies if the k
-00017360: 6579 2069 7320 616c 6c6f 7765 6420 746f  ey is allowed to
-00017370: 2062 6520 6465 6c65 7465 642e 2044 6566   be deleted. Def
-00017380: 6175 6c74 7320 746f 2046 616c 7365 2e0d  aults to False..
-00017390: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-000173a0: 6f72 7461 626c 6520 2862 6f6f 6c2c 206f  ortable (bool, o
-000173b0: 7074 696f 6e61 6c29 3a20 456e 6162 6c65  ptional): Enable
-000173c0: 7320 6b65 7973 2074 6f20 6265 2065 7870  s keys to be exp
-000173d0: 6f72 7461 626c 652e 2054 6869 7320 616c  ortable. This al
-000173e0: 6c6f 7773 2066 6f72 2061 6c6c 2074 6865  lows for all the
-000173f0: 2076 616c 6964 206b 6579 7320 696e 2074   valid keys in t
-00017400: 6865 206b 6579 2072 696e 6720 0d0a 2020  he key ring ..  
-00017410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2020 2020 2020 2074 6f20 6265 2065 7870         to be exp
-00017440: 6f72 7465 642e 204f 6e63 6520 7365 742c  orted. Once set,
-00017450: 2074 6869 7320 6361 6e6e 6f74 2062 6520   this cannot be 
-00017460: 6469 7361 626c 6564 2e20 4465 6661 756c  disabled. Defaul
-00017470: 7473 2074 6f20 4661 6c73 652e 0d0a 2020  ts to False...  
-00017480: 2020 2020 2020 2020 2020 616c 6c6f 775f            allow_
-00017490: 706c 6169 6e74 6578 745f 6261 636b 7570  plaintext_backup
-000174a0: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
-000174b0: 293a 2049 6620 7365 742c 2065 6e61 626c  ): If set, enabl
-000174c0: 6573 2074 616b 696e 6720 6261 636b 7570  es taking backup
-000174d0: 206f 6620 6e61 6d65 6420 6b65 7920 696e   of named key in
-000174e0: 2074 6865 2070 6c61 696e 7465 7874 2066   the plaintext f
-000174f0: 6f72 6d61 742e 200d 0a20 2020 2020 2020  ormat. ..       
-00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017520: 2020 2020 2020 2020 2020 2020 2020 4f6e                On
-00017530: 6365 2073 6574 2c20 7468 6973 2063 616e  ce set, this can
-00017540: 6e6f 7420 6265 2064 6973 6162 6c65 642e  not be disabled.
-00017550: 2044 6566 6175 6c74 7320 746f 2046 616c   Defaults to Fal
-00017560: 7365 2e0d 0a20 2020 2020 2020 2020 2020  se...           
-00017570: 2061 7574 6f5f 726f 7461 7465 5f70 6572   auto_rotate_per
-00017580: 696f 6420 2873 7472 2c20 6f70 7469 6f6e  iod (str, option
-00017590: 616c 293a 2054 6865 2070 6572 696f 6420  al): The period 
-000175a0: 6174 2077 6869 6368 2074 6869 7320 6b65  at which this ke
-000175b0: 7920 7368 6f75 6c64 2062 6520 726f 7461  y should be rota
-000175c0: 7465 6420 6175 746f 6d61 7469 6361 6c6c  ted automaticall
-000175d0: 792e 2053 6574 7469 6e67 2074 6869 7320  y. Setting this 
-000175e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000175f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017610: 2020 746f 2022 3022 2077 696c 6c20 6469    to "0" will di
-00017620: 7361 626c 6520 6175 746f 6d61 7469 6320  sable automatic 
-00017630: 6b65 7920 726f 7461 7469 6f6e 2e20 5468  key rotation. Th
-00017640: 6973 2076 616c 7565 2063 616e 6e6f 7420  is value cannot 
-00017650: 6265 2073 686f 7274 6572 200d 0a20 2020  be shorter ..   
-00017660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017680: 2020 2020 2020 2020 2020 2020 2074 6861               tha
-00017690: 6e20 6f6e 6520 686f 7572 2e20 5768 656e  n one hour. When
-000176a0: 206e 6f20 7661 6c75 6520 6973 2070 726f   no value is pro
-000176b0: 7669 6465 642c 2074 6865 2070 6572 696f  vided, the perio
-000176c0: 6420 7265 6d61 696e 7320 756e 6368 616e  d remains unchan
-000176d0: 6765 642e 200d 0a20 2020 2020 2020 2020  ged. ..         
-000176e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017700: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
-00017710: 746f 2022 222e 0d0a 0d0a 2020 2020 2020  to "".....      
-00017720: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
-00017730: 2020 2020 2020 2020 626f 6f6c 3a20 7265          bool: re
-00017740: 7475 726e 2054 7275 6520 6966 2073 7563  turn True if suc
-00017750: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
-00017760: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00017770: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00017780: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
-00017790: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
-000177a0: 2063 7572 5f69 6e66 6f20 3d20 7365 6c66   cur_info = self
-000177b0: 2e72 6561 645f 6b65 7928 6d6f 756e 745f  .read_key(mount_
-000177c0: 7061 7468 2c20 6e61 6d65 290d 0a20 2020  path, name)..   
-000177d0: 2020 2020 2020 2020 2069 6620 6375 725f           if cur_
-000177e0: 696e 666f 2069 7320 4e6f 6e65 3a0d 0a20  info is None:.. 
-000177f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00017800: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-00017810: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00017820: 2020 2020 2020 2070 6179 6c6f 6164 203d         payload =
-00017830: 2064 6963 7428 290d 0a20 2020 2020 2020   dict()..       
-00017840: 2020 2020 2068 6173 5f63 6861 6e67 6520       has_change 
-00017850: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00017860: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00017870: 2020 2069 6620 6d69 6e5f 6465 6372 7970     if min_decryp
-00017880: 7469 6f6e 5f76 6572 7369 6f6e 2021 3d20  tion_version != 
-00017890: 6375 725f 696e 666f 5b22 6d69 6e5f 6465  cur_info["min_de
+00014840: 2020 6d6f 756e 745f 7061 7468 3a20 7374    mount_path: st
+00014850: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+00014860: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00014870: 616d 653a 2073 7472 2c0d 0a20 2020 2020  ame: str,..     
+00014880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014890: 2020 2020 2020 6369 7068 6572 7465 7874        ciphertext
+000148a0: 3a20 7374 722c 0d0a 2020 2020 2020 2020  : str,..        
+000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148c0: 2020 2068 6173 685f 6675 6e63 7469 6f6e     hash_function
+000148d0: 3a20 7374 7220 3d20 2253 4841 3235 3622  : str = "SHA256"
+000148e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000148f0: 2020 2020 2020 2020 2020 2020 2020 7075                pu
+00014900: 626c 6963 5f6b 6579 3a20 7374 7220 3d20  blic_key: str = 
+00014910: 2222 2c0d 0a20 2020 2020 2020 2020 2020  "",..           
+00014920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014930: 7665 7273 696f 6e3a 204f 7074 696f 6e61  version: Optiona
+00014940: 6c5b 696e 745d 203d 204e 6f6e 6529 3a0d  l[int] = None):.
+00014950: 0a20 2020 2020 2020 2022 2222 696d 706f  .        """impo
+00014960: 7274 206e 6577 206b 6579 206d 6174 6572  rt new key mater
+00014970: 6961 6c20 696e 746f 2061 6e20 6578 6973  ial into an exis
+00014980: 7469 6e67 2069 6d70 6f72 7465 6420 6b65  ting imported ke
+00014990: 790d 0a20 2020 2020 2020 200d 0a20 2020  y..        ..   
+000149a0: 2020 2020 204e 6f74 6162 6c79 2c20 7573       Notably, us
+000149b0: 696e 6720 7468 6973 206d 6574 686f 642c  ing this method,
+000149c0: 2061 2070 7269 7661 7465 206b 6579 206d   a private key m
+000149d0: 6174 6368 696e 6720 6120 7075 626c 6963  atching a public
+000149e0: 206b 6579 2063 616e 2062 6520 696d 706f   key can be impo
+000149f0: 7274 6564 2061 7420 6120 6c61 7465 7220  rted at a later 
+00014a00: 6461 7465 2e0d 0a20 2020 2020 2020 200d  date...        .
+00014a10: 0a20 2020 2020 2020 204e 6f74 653a 204b  .        Note: K
+00014a20: 6579 7320 7768 6f73 6520 6d61 7465 7269  eys whose materi
+00014a30: 616c 2077 6173 2067 656e 6572 6174 6564  al was generated
+00014a40: 2062 7920 5661 756c 7420 646f 206e 6f74   by Vault do not
+00014a50: 2073 7570 706f 7274 2069 6d70 6f72 7469   support importi
+00014a60: 6e67 206b 6579 206d 6174 6572 6961 6c2e  ng key material.
+00014a70: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00014a80: 204f 6e6c 7920 6b65 7973 2074 6861 7420   Only keys that 
+00014a90: 7765 7265 2070 7265 7669 6f75 736c 7920  were previously 
+00014aa0: 696d 706f 7274 6564 2069 6e74 6f20 5661  imported into Va
+00014ab0: 756c 7420 6361 6e20 696d 706f 7274 206e  ult can import n
+00014ac0: 6577 206b 6579 206d 6174 6572 6961 6c20  ew key material 
+00014ad0: 6672 6f6d 200d 0a20 2020 2020 2020 2020  from ..         
+00014ae0: 2020 2020 2061 6e20 6578 7465 726e 616c       an external
+00014af0: 2073 6f75 7263 652e 0d0a 0d0a 2020 2020   source.....    
+00014b00: 2020 2020 5265 6665 7220 746f 2068 7474      Refer to htt
+00014b10: 7073 3a2f 2f64 6576 656c 6f70 6572 2e68  ps://developer.h
+00014b20: 6173 6869 636f 7270 2e63 6f6d 2f76 6175  ashicorp.com/vau
+00014b30: 6c74 2f61 7069 2d64 6f63 732f 7365 6372  lt/api-docs/secr
+00014b40: 6574 2f74 7261 6e73 6974 2369 6d70 6f72  et/transit#impor
+00014b50: 742d 6b65 792d 7665 7273 696f 6e20 666f  t-key-version fo
+00014b60: 7220 6d6f 7265 2064 6574 6169 6c73 0d0a  r more details..
+00014b70: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
+00014b80: 0a20 2020 2020 2020 2020 2020 206d 6f75  .            mou
+00014b90: 6e74 5f70 6174 6820 2873 7472 290d 0a20  nt_path (str).. 
+00014ba0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+00014bb0: 2873 7472 293a 2053 7065 6369 6669 6573  (str): Specifies
+00014bc0: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+00014bd0: 2065 6e63 7279 7074 696f 6e20 6b65 7920   encryption key 
+00014be0: 746f 2063 7265 6174 652e 2054 6869 7320  to create. This 
+00014bf0: 6973 2073 7065 6369 6669 6564 2061 7320  is specified as 
+00014c00: 7061 7274 206f 6620 7468 6520 5552 4c2e  part of the URL.
+00014c10: 0d0a 2020 2020 2020 2020 2020 2020 6369  ..            ci
+00014c20: 7068 6572 7465 7874 2028 7374 7229 3a20  phertext (str): 
+00014c30: 4120 6261 7365 3634 2d65 6e63 6f64 6564  A base64-encoded
+00014c40: 2073 7472 696e 6720 7468 6174 2063 6f6e   string that con
+00014c50: 7461 696e 7320 7477 6f20 7661 6c75 6573  tains two values
+00014c60: 3a20 616e 2065 7068 656d 6572 616c 2032  : an ephemeral 2
+00014c70: 3536 2d62 6974 2041 4553 206b 6579 200d  56-bit AES key .
+00014c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c90: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00014ca0: 7261 7070 6564 2075 7369 6e67 2074 6865  rapped using the
+00014cb0: 2077 7261 7070 696e 6720 6b65 7920 7265   wrapping key re
+00014cc0: 7475 726e 6564 2062 7920 5661 756c 7420  turned by Vault 
+00014cd0: 616e 6420 7468 6520 656e 6372 7970 7469  and the encrypti
+00014ce0: 6f6e 206f 6620 7468 6520 696d 706f 7274  on of the import
+00014cf0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00014d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d10: 206b 6579 206d 6174 6572 6961 6c20 756e   key material un
+00014d20: 6465 7220 7468 6520 7072 6f76 6964 6564  der the provided
+00014d30: 2041 4553 206b 6579 2e20 5468 6520 7772   AES key. The wr
+00014d40: 6170 7065 6420 4145 5320 6b65 7920 7368  apped AES key sh
+00014d50: 6f75 6c64 2062 6520 7468 6520 6669 7273  ould be the firs
+00014d60: 7420 3531 3220 0d0a 2020 2020 2020 2020  t 512 ..        
+00014d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d80: 2020 2020 2020 6279 7465 7320 6f66 2074        bytes of t
+00014d90: 6865 2063 6970 6865 7274 6578 742c 2061  he ciphertext, a
+00014da0: 6e64 2074 6865 2065 6e63 7279 7074 6564  nd the encrypted
+00014db0: 206b 6579 206d 6174 6572 6961 6c20 7368   key material sh
+00014dc0: 6f75 6c64 2062 6520 7468 6520 7265 6d61  ould be the rema
+00014dd0: 696e 696e 6720 6279 7465 732e 200d 0a20  ining bytes. .. 
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 2020 2020 2020 2020 2020 2020 2053 6565               See
+00014e00: 2074 6865 2042 594f 4b20 2842 7269 6e67   the BYOK (Bring
+00014e10: 2079 6f75 7220 6f77 6e20 6b65 7929 2073   your own key) s
+00014e20: 6563 7469 6f6e 206f 6620 7468 6520 5472  ection of the Tr
+00014e30: 616e 7369 7420 7365 6372 6574 7320 656e  ansit secrets en
+00014e40: 6769 6e65 2064 6f63 756d 656e 7461 7469  gine documentati
+00014e50: 6f6e 200d 0a20 2020 2020 2020 2020 2020  on ..           
+00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e70: 2020 2066 6f72 206d 6f72 6520 696e 666f     for more info
+00014e80: 726d 6174 696f 6e20 6f6e 2063 6f6e 7374  rmation on const
+00014e90: 7275 6374 696e 6720 7468 6520 6369 7068  ructing the ciph
+00014ea0: 6572 7465 7874 2e0d 0a20 2020 2020 2020  ertext...       
+00014eb0: 2020 2020 2068 6173 685f 6675 6e63 7469       hash_functi
+00014ec0: 6f6e 2028 7374 722c 206f 7074 696f 6e61  on (str, optiona
+00014ed0: 6c29 3a20 5468 6520 6861 7368 2066 756e  l): The hash fun
+00014ee0: 6374 696f 6e20 7573 6564 2066 6f72 2074  ction used for t
+00014ef0: 6865 2052 5341 2d4f 4145 5020 7374 6570  he RSA-OAEP step
+00014f00: 206f 6620 6372 6561 7469 6e67 2074 6865   of creating the
+00014f10: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f30: 2020 2020 2020 2020 2020 2020 2020 6369                ci
+00014f40: 7068 6572 7465 7874 2e20 5375 7070 6f72  phertext. Suppor
+00014f50: 7465 6420 6861 7368 2066 756e 6374 696f  ted hash functio
+00014f60: 6e73 2061 7265 3a20 5348 4131 2c20 5348  ns are: SHA1, SH
+00014f70: 4132 3234 2c20 5348 4132 3536 2c20 0d0a  A224, SHA256, ..
+00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fa0: 2020 2020 2020 2020 2020 2053 4841 3338             SHA38
+00014fb0: 342c 2061 6e64 2053 4841 3531 322e 2044  4, and SHA512. D
+00014fc0: 6566 6175 6c74 7320 746f 2022 5348 4132  efaults to "SHA2
+00014fd0: 3536 222e 0d0a 2020 2020 2020 2020 2020  56"...          
+00014fe0: 2020 7075 626c 6963 5f6b 6579 2028 7374    public_key (st
+00014ff0: 722c 206f 7074 696f 6e61 6c29 3a20 4120  r, optional): A 
+00015000: 706c 6169 6e74 6578 7420 5045 4d20 7075  plaintext PEM pu
+00015010: 626c 6963 206b 6579 2074 6f20 6265 2069  blic key to be i
+00015020: 6d70 6f72 7465 642e 2054 6869 7320 6c69  mported. This li
+00015030: 6d69 7473 2074 6865 206f 7065 7261 7469  mits the operati
+00015040: 6f6e 7320 6176 6169 6c61 626c 6520 0d0a  ons available ..
+00015050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015070: 2020 2020 2020 2020 756e 6465 7220 7468          under th
+00015080: 6973 206b 6579 2074 6f20 7665 7269 6669  is key to verifi
+00015090: 6361 7469 6f6e 2061 6e64 2065 6e63 7279  cation and encry
+000150a0: 7074 696f 6e2c 2064 6570 656e 6469 6e67  ption, depending
+000150b0: 206f 6e20 7468 6520 6b65 7920 7479 7065   on the key type
+000150c0: 2061 6e64 200d 0a20 2020 2020 2020 2020   and ..         
+000150d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000150f0: 6c67 6f72 6974 686d 2c20 6173 206e 6f20  lgorithm, as no 
+00015100: 7072 6976 6174 6520 6b65 7920 6973 2061  private key is a
+00015110: 7661 696c 6162 6c65 2e20 4465 6661 756c  vailable. Defaul
+00015120: 7473 2074 6f20 2222 2e0d 0a20 2020 2020  ts to ""...     
+00015130: 2020 2020 2020 2076 6572 7369 6f6e 2028         version (
+00015140: 4f70 7469 6f6e 616c 5b69 6e74 5d2c 206f  Optional[int], o
+00015150: 7074 696f 6e61 6c29 3a20 4b65 7920 7665  ptional): Key ve
+00015160: 7273 696f 6e20 746f 2062 6520 7570 6461  rsion to be upda
+00015170: 7465 642c 2069 6620 6c65 6674 2065 6d70  ted, if left emp
+00015180: 7479 2c20 6120 6e65 7720 7665 7273 696f  ty, a new versio
+00015190: 6e20 7769 6c6c 2062 6520 6372 6561 7465  n will be create
+000151a0: 6420 0d0a 2020 2020 2020 2020 2020 2020  d ..            
+000151b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151d0: 2020 2075 6e6c 6573 7320 6120 7072 6976     unless a priv
+000151e0: 6174 6520 6b65 7920 6973 2073 7065 6369  ate key is speci
+000151f0: 6669 6564 2061 6e64 2074 6865 2027 4c61  fied and the 'La
+00015200: 7465 7374 2720 6b65 7920 6973 206d 6973  test' key is mis
+00015210: 7369 6e67 2061 200d 0a20 2020 2020 2020  sing a ..       
+00015220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015240: 2020 2020 2020 2020 7072 6976 6174 6520          private 
+00015250: 6b65 792e 2044 6566 6175 6c74 7320 746f  key. Defaults to
+00015260: 204e 6f6e 652e 0d0a 0d0a 2020 2020 2020   None.....      
+00015270: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+00015280: 2020 2020 2020 2020 626f 6f6c 3a20 7265          bool: re
+00015290: 7475 726e 2054 7275 6520 6966 2073 7563  turn True if suc
+000152a0: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
+000152b0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+000152c0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+000152d0: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
+000152e0: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
+000152f0: 2065 7869 7374 5f6b 6579 7320 3d20 7365   exist_keys = se
+00015300: 6c66 2e6c 6973 745f 6b65 7928 6d6f 756e  lf.list_key(moun
+00015310: 745f 7061 7468 290d 0a20 2020 2020 2020  t_path)..       
+00015320: 2020 2020 2069 6620 6e61 6d65 206e 6f74       if name not
+00015330: 2069 6e20 6578 6973 745f 6b65 7973 3a0d   in exist_keys:.
+00015340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015350: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+00015360: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+00015370: 5f5f 6e61 6d65 5f5f 7d20 2d20 696d 706f  __name__} - impo
+00015380: 7274 206b 6579 2076 6572 7369 6f6e 2065  rt key version e
+00015390: 7272 6f72 3a20 6b65 7920 277b 6e61 6d65  rror: key '{name
+000153a0: 7d27 206e 6f74 2066 6f75 6e64 2229 0d0a  }' not found")..
+000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153c0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+000153d0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+000153e0: 2020 2020 2020 2020 7061 796c 6f61 6420          payload 
+000153f0: 3d20 436f 6e66 6967 4469 6374 2829 0d0a  = ConfigDict()..
+00015400: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00015410: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00015420: 2069 735f 6261 7365 3634 2863 6970 6865   is_base64(ciphe
+00015430: 7274 6578 7429 3a0d 0a20 2020 2020 2020  rtext):..       
+00015440: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00015450: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+00015460: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00015470: 7d20 2d20 696d 706f 7274 206b 6579 2076  } - import key v
+00015480: 6572 7369 6f6e 2065 7272 6f72 3a20 6369  ersion error: ci
+00015490: 7068 6572 7465 7874 206d 7573 7420 6265  phertext must be
+000154a0: 2062 6173 6536 3420 656e 636f 6465 6422   base64 encoded"
+000154b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000154c0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+000154d0: 0a20 2020 2020 2020 2020 2020 2070 6179  .            pay
+000154e0: 6c6f 6164 5b22 6369 7068 6572 7465 7874  load["ciphertext
+000154f0: 225d 203d 2063 6970 6865 7274 6578 740d  "] = ciphertext.
+00015500: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00015510: 2020 2020 2020 2020 2020 2073 7570 706f             suppo
+00015520: 7274 5f68 6173 685f 6675 6e63 7469 6f6e  rt_hash_function
+00015530: 203d 205b 2253 4841 3122 2c20 2253 4841   = ["SHA1", "SHA
+00015540: 3232 3422 2c20 2253 4841 3235 3622 2c20  224", "SHA256", 
+00015550: 2253 4841 3338 3422 2c20 2253 4841 3531  "SHA384", "SHA51
+00015560: 3222 5d0d 0a20 2020 2020 2020 2020 2020  2"]..           
+00015570: 2069 6620 6861 7368 5f66 756e 6374 696f   if hash_functio
+00015580: 6e20 6e6f 7420 696e 2073 7570 706f 7274  n not in support
+00015590: 5f68 6173 685f 6675 6e63 7469 6f6e 3a0d  _hash_function:.
+000155a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000155b0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+000155c0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+000155d0: 5f5f 6e61 6d65 5f5f 7d20 2d20 696d 706f  __name__} - impo
+000155e0: 7274 206b 6579 2076 6572 7369 6f6e 2065  rt key version e
+000155f0: 7272 6f72 3a20 6861 7368 5f66 756e 6374  rror: hash_funct
+00015600: 696f 6e20 6d75 7374 2062 6520 6f6e 6520  ion must be one 
+00015610: 6f66 207b 7375 7070 6f72 745f 6861 7368  of {support_hash
+00015620: 5f66 756e 6374 696f 6e7d 2229 0d0a 2020  _function}")..  
+00015630: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00015640: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00015650: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
+00015660: 2268 6173 685f 6675 6e63 7469 6f6e 225d  "hash_function"]
+00015670: 203d 2068 6173 685f 6675 6e63 7469 6f6e   = hash_function
+00015680: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+00015690: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+000156a0: 7562 6c69 635f 6b65 7920 213d 2022 223a  ublic_key != "":
+000156b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000156c0: 2020 7061 796c 6f61 645b 2270 7562 6c69    payload["publi
+000156d0: 635f 6b65 7922 5d20 3d20 7075 626c 6963  c_key"] = public
+000156e0: 5f6b 6579 0d0a 2020 2020 2020 2020 2020  _key..          
+000156f0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00015700: 2020 2020 6966 2076 6572 7369 6f6e 2069      if version i
+00015710: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00015720: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00015730: 6e6f 7420 6973 5f69 6e74 2876 6572 7369  not is_int(versi
+00015740: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
+00015750: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00015760: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
+00015770: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00015780: 5f7d 202d 2069 6d70 6f72 7420 6b65 7920  _} - import key 
+00015790: 7665 7273 696f 6e20 6572 726f 723a 2076  version error: v
+000157a0: 6572 7369 6f6e 206d 7573 7420 6265 2061  ersion must be a
+000157b0: 6e20 696e 7465 6765 7222 290d 0a20 2020  n integer")..   
+000157c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157d0: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+000157e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000157f0: 6179 6c6f 6164 5b22 7665 7273 696f 6e22  ayload["version"
+00015800: 5d20 3d20 7665 7273 696f 6e0d 0a20 2020  ] = version..   
+00015810: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
+00015820: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+00015830: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+00015840: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
+00015850: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+00015860: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+00015870: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+00015880: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+00015890: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+000158a0: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
+000158b0: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+000158c0: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
+000158d0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+000158e0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+000158f0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+00015900: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+00015910: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+00015920: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
+00015930: 7565 7374 732e 706f 7374 2875 726c 2b66  uests.post(url+f
+00015940: 227b 6d6f 756e 745f 7061 7468 7d2f 6b65  "{mount_path}/ke
+00015950: 7973 2f7b 6e61 6d65 7d2f 696d 706f 7274  ys/{name}/import
+00015960: 5f76 6572 7369 6f6e 222c 2068 6561 6465  _version", heade
+00015970: 7273 3d7b 2258 2d56 6175 6c74 2d54 6f6b  rs={"X-Vault-Tok
+00015980: 656e 223a 2074 6f6b 656e 7d2c 2064 6174  en": token}, dat
+00015990: 613d 6a73 6f6e 2e64 756d 7073 2870 6179  a=json.dumps(pay
+000159a0: 6c6f 6164 2929 0d0a 2020 2020 2020 2020  load))..        
+000159b0: 2020 2020 6966 2072 6573 2e73 7461 7475      if res.statu
+000159c0: 735f 636f 6465 203d 3d20 3230 3020 6f72  s_code == 200 or
+000159d0: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
+000159e0: 203d 3d20 3230 343a 0d0a 2020 2020 2020   == 204:..      
+000159f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00015a00: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00015a10: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00015a20: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00015a30: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
+00015a40: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
+00015a50: 616d 655f 5f2c 2072 6573 2c20 2269 6d70  ame__, res, "imp
+00015a60: 6f72 7420 6b65 7920 7665 7273 696f 6e20  ort key version 
+00015a70: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
+00015a80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00015a90: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+00015aa0: 2020 200d 0a20 2020 2020 2020 2072 6574     ..        ret
+00015ab0: 7572 6e20 4661 6c73 650d 0a0d 0a20 2020  urn False....   
+00015ac0: 2064 6566 2067 6574 5f77 7261 7070 696e   def get_wrappin
+00015ad0: 675f 6b65 7928 7365 6c66 2c20 6d6f 756e  g_key(self, moun
+00015ae0: 745f 7061 7468 3a20 7374 7229 3a0d 0a20  t_path: str):.. 
+00015af0: 2020 2020 2020 2022 2222 7265 7472 6965         """retrie
+00015b00: 7665 2074 6865 2077 7261 7070 696e 6720  ve the wrapping 
+00015b10: 6b65 7920 746f 2075 7365 2066 6f72 2069  key to use for i
+00015b20: 6d70 6f72 7469 6e67 206b 6579 732e 200d  mporting keys. .
+00015b30: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00015b40: 2020 2054 6865 2072 6574 7572 6e65 6420     The returned 
+00015b50: 6b65 7920 7769 6c6c 2062 6520 6120 3430  key will be a 40
+00015b60: 3936 2d62 6974 2052 5341 2070 7562 6c69  96-bit RSA publi
+00015b70: 6320 6b65 792e 0d0a 0d0a 2020 2020 2020  c key.....      
+00015b80: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+00015b90: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
+00015ba0: 2873 7472 290d 0a0d 0a20 2020 2020 2020  (str)....       
+00015bb0: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
+00015bc0: 2020 2020 2020 2064 6963 7420 6f72 204e         dict or N
+00015bd0: 6f6e 653a 2072 6574 7572 6e20 6469 6374  one: return dict
+00015be0: 2069 6620 7375 6363 6573 732c 206f 7468   if success, oth
+00015bf0: 6572 7769 7365 2072 6574 7572 6e20 4e6f  erwise return No
+00015c00: 6e65 0d0a 2020 2020 2020 2020 2222 220d  ne..        """.
+00015c10: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00015c20: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
+00015c30: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
+00015c40: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
+00015c50: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
+00015c60: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
+00015c70: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
+00015c80: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
+00015c90: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
+00015ca0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
+00015cb0: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
+00015cc0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+00015cd0: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
+00015ce0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
+00015cf0: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
+00015d00: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
+00015d10: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
+00015d20: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
+00015d30: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
+00015d40: 732e 6765 7428 7572 6c2b 6622 7b6d 6f75  s.get(url+f"{mou
+00015d50: 6e74 5f70 6174 687d 2f77 7261 7070 696e  nt_path}/wrappin
+00015d60: 675f 6b65 7922 2c20 6865 6164 6572 733d  g_key", headers=
+00015d70: 7b22 582d 5661 756c 742d 546f 6b65 6e22  {"X-Vault-Token"
+00015d80: 3a20 746f 6b65 6e7d 290d 0a20 2020 2020  : token})..     
+00015d90: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
+00015da0: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
+00015db0: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
+00015dc0: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
+00015dd0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00015de0: 7572 6e20 7265 732e 6a73 6f6e 2829 5b22  urn res.json()["
+00015df0: 6461 7461 225d 5b22 7075 626c 6963 5f6b  data"]["public_k
+00015e00: 6579 225d 0d0a 2020 2020 2020 2020 2020  ey"]..          
+00015e10: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00015e20: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+00015e30: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
+00015e40: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
+00015e50: 6d65 5f5f 2c20 7265 732c 2022 6765 7420  me__, res, "get 
+00015e60: 7772 6170 7069 6e67 206b 6579 2065 7272  wrapping key err
+00015e70: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
+00015e80: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00015e90: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00015ea0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00015eb0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+00015ec0: 0a0d 0a20 2020 2064 6566 2072 6561 645f  ...    def read_
+00015ed0: 6b65 7928 7365 6c66 2c20 6d6f 756e 745f  key(self, mount_
+00015ee0: 7061 7468 3a20 7374 722c 206e 616d 653a  path: str, name:
+00015ef0: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
+00015f00: 2222 2272 6561 6420 7468 6520 696e 666f  """read the info
+00015f10: 726d 6174 696f 6e20 6162 6f75 7420 6120  rmation about a 
+00015f20: 6e61 6d65 6420 656e 6372 7970 7469 6f6e  named encryption
+00015f30: 206b 6579 0d0a 0d0a 2020 2020 2020 2020   key....        
+00015f40: 5265 6665 7220 746f 2068 7474 7073 3a2f  Refer to https:/
+00015f50: 2f64 6576 656c 6f70 6572 2e68 6173 6869  /developer.hashi
+00015f60: 636f 7270 2e63 6f6d 2f76 6175 6c74 2f61  corp.com/vault/a
+00015f70: 7069 2d64 6f63 732f 7365 6372 6574 2f74  pi-docs/secret/t
+00015f80: 7261 6e73 6974 2372 6561 642d 6b65 7920  ransit#read-key 
+00015f90: 666f 7220 6d6f 7265 2064 6574 6169 6c73  for more details
+00015fa0: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+00015fb0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00015fc0: 6d6f 756e 745f 7061 7468 2028 7374 7229  mount_path (str)
+00015fd0: 0d0a 2020 2020 2020 2020 2020 2020 6e61  ..            na
+00015fe0: 6d65 2028 7374 7229 3a20 5370 6563 6966  me (str): Specif
+00015ff0: 6965 7320 7468 6520 6e61 6d65 206f 6620  ies the name of 
+00016000: 7468 6520 656e 6372 7970 7469 6f6e 206b  the encryption k
+00016010: 6579 2074 6f20 7265 6164 2e0d 0a0d 0a20  ey to read..... 
+00016020: 2020 2020 2020 2052 6574 7572 6e73 3a0d         Returns:.
+00016030: 0a20 2020 2020 2020 2020 2020 2064 6963  .            dic
+00016040: 7420 6f72 204e 6f6e 653a 2072 6574 7572  t or None: retur
+00016050: 6e20 7468 6520 696e 666f 726d 6174 696f  n the informatio
+00016060: 6e20 6162 6f75 7420 7468 6520 6b65 7920  n about the key 
+00016070: 696e 2064 6963 7420 6966 2073 7563 6365  in dict if succe
+00016080: 7373 2c20 6f74 6865 7277 6973 6520 7265  ss, otherwise re
+00016090: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+000160a0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000160b0: 6966 2073 656c 662e 6973 5f61 7574 683a  if self.is_auth:
+000160c0: 0d0a 2020 2020 2020 2020 2020 2020 7572  ..            ur
+000160d0: 6c20 3d20 6165 735f 6465 6372 7970 745f  l = aes_decrypt_
+000160e0: 7465 7874 2873 656c 662e 7572 6c2c 206b  text(self.url, k
+000160f0: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
+00016100: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
+00016110: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
+00016120: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
+00016130: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
+00016140: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
+00016150: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
+00016160: 7874 2873 656c 662e 746f 6b65 6e2c 206b  xt(self.token, k
+00016170: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
+00016180: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
+00016190: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
+000161a0: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
+000161b0: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
+000161c0: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
+000161d0: 7265 7175 6573 7473 2e67 6574 2875 726c  requests.get(url
+000161e0: 2b66 227b 6d6f 756e 745f 7061 7468 7d2f  +f"{mount_path}/
+000161f0: 6b65 7973 2f7b 6e61 6d65 7d22 2c20 6865  keys/{name}", he
+00016200: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+00016210: 546f 6b65 6e22 3a20 746f 6b65 6e7d 290d  Token": token}).
+00016220: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016230: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+00016240: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
+00016250: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
+00016260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00016270: 2020 2072 6574 7572 6e20 7265 732e 6a73     return res.js
+00016280: 6f6e 2829 5b22 6461 7461 225d 0d0a 2020  on()["data"]..  
+00016290: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000162a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000162b0: 2073 656c 662e 5f6c 6f67 5f65 7272 6f72   self._log_error
+000162c0: 5f72 6573 706f 6e73 6528 5f5f 636c 6173  _response(__clas
+000162d0: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265  s__.__name__, re
+000162e0: 732c 2022 7265 6164 206b 6579 2065 7272  s, "read key err
+000162f0: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
+00016300: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00016310: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
+00016320: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00016330: 0d0a 0d0a 2020 2020 6465 6620 6c69 7374  ....    def list
+00016340: 5f6b 6579 2873 656c 662c 206d 6f75 6e74  _key(self, mount
+00016350: 5f70 6174 683a 2073 7472 293a 0d0a 2020  _path: str):..  
+00016360: 2020 2020 2020 2222 226c 6973 7420 6578        """list ex
+00016370: 6973 7469 6e67 206b 6579 206e 616d 6573  isting key names
+00016380: 2069 6e20 226d 6f75 6e74 5f70 6174 682f   in "mount_path/
+00016390: 220d 0a0d 0a20 2020 2020 2020 2041 7267  "....        Arg
+000163a0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000163b0: 6d6f 756e 745f 7061 7468 2028 7374 7229  mount_path (str)
+000163c0: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+000163d0: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+000163e0: 2020 6c69 7374 206f 7220 4e6f 6e65 3a20    list or None: 
+000163f0: 7265 7475 726e 2061 206c 6973 7420 6f66  return a list of
+00016400: 206b 6579 206e 616d 6573 2069 6620 7375   key names if su
+00016410: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
+00016420: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+00016430: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00016440: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
+00016450: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
+00016460: 2023 2063 6865 636b 2069 6620 7468 6520   # check if the 
+00016470: 6d6f 756e 745f 7061 7468 2065 7869 7374  mount_path exist
+00016480: 730d 0a20 2020 2020 2020 2020 2020 2063  s..            c
+00016490: 6163 6865 5f63 6f6e 6669 6720 3d20 7365  ache_config = se
+000164a0: 6c66 2e72 6561 645f 7472 616e 7369 745f  lf.read_transit_
+000164b0: 6361 6368 655f 636f 6e66 6967 286d 6f75  cache_config(mou
+000164c0: 6e74 5f70 6174 6829 0d0a 2020 2020 2020  nt_path)..      
+000164d0: 2020 2020 2020 6966 2063 6163 6865 5f63        if cache_c
+000164e0: 6f6e 6669 6720 6973 204e 6f6e 653a 0d0a  onfig is None:..
+000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016500: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+00016510: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00016520: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
+00016530: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
+00016540: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
+00016550: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
+00016560: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
+00016570: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
+00016580: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
+00016590: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
+000165a0: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
+000165b0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+000165c0: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
+000165d0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
+000165e0: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
+000165f0: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
+00016600: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
+00016610: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
+00016620: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
+00016630: 732e 6765 7428 7572 6c2b 6622 7b6d 6f75  s.get(url+f"{mou
+00016640: 6e74 5f70 6174 687d 2f6b 6579 733f 6c69  nt_path}/keys?li
+00016650: 7374 3d74 7275 6522 2c20 6865 6164 6572  st=true", header
+00016660: 733d 7b22 582d 5661 756c 742d 546f 6b65  s={"X-Vault-Toke
+00016670: 6e22 3a20 746f 6b65 6e7d 290d 0a20 2020  n": token})..   
+00016680: 2020 2020 2020 2020 2069 6620 7265 732e           if res.
+00016690: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
+000166a0: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
+000166b0: 5f63 6f64 6520 3d3d 2032 3034 3a0d 0a20  _code == 204:.. 
+000166c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000166d0: 6574 7572 6e20 7265 732e 6a73 6f6e 2829  eturn res.json()
+000166e0: 5b22 6461 7461 225d 5b22 6b65 7973 225d  ["data"]["keys"]
+000166f0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00016700: 6966 2072 6573 2e73 7461 7475 735f 636f  if res.status_co
+00016710: 6465 203d 3d20 3430 343a 0d0a 2020 2020  de == 404:..    
+00016720: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016730: 726e 205b 5d0d 0a20 2020 2020 2020 2020  rn []..         
+00016740: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00016750: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00016760: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
+00016770: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
+00016780: 616d 655f 5f2c 2072 6573 2c20 226c 6973  ame__, res, "lis
+00016790: 7420 6b65 7920 6572 726f 7222 290d 0a20  t key error").. 
+000167a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000167b0: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
+000167c0: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+000167d0: 7475 726e 204e 6f6e 650d 0a0d 0a20 2020  turn None....   
+000167e0: 2064 6566 2064 656c 6574 655f 6b65 7928   def delete_key(
+000167f0: 7365 6c66 2c20 6d6f 756e 745f 7061 7468  self, mount_path
+00016800: 3a20 7374 722c 206e 616d 653a 2073 7472  : str, name: str
+00016810: 293a 0d0a 2020 2020 2020 2020 2222 2264  ):..        """d
+00016820: 656c 6574 6520 6b65 790d 0a0d 0a20 2020  elete key....   
+00016830: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
+00016840: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+00016850: 7468 2028 7374 7229 0d0a 2020 2020 2020  th (str)..      
+00016860: 2020 2020 2020 6e61 6d65 2028 7374 7229        name (str)
+00016870: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+00016880: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+00016890: 2020 626f 6f6c 3a20 7265 7475 726e 2054    bool: return T
+000168a0: 7275 6520 6966 2073 7563 6365 7373 2c20  rue if success, 
+000168b0: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+000168c0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+000168d0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+000168e0: 7365 6c66 2e69 735f 6175 7468 3a0d 0a20  self.is_auth:.. 
+000168f0: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+00016900: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+00016910: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
+00016920: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+00016930: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+00016940: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+00016950: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+00016960: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+00016970: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
+00016980: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+00016990: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
+000169a0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+000169b0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+000169c0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+000169d0: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+000169e0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+000169f0: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
+00016a00: 7565 7374 732e 6465 6c65 7465 2875 726c  uests.delete(url
+00016a10: 2b66 227b 6d6f 756e 745f 7061 7468 7d2f  +f"{mount_path}/
+00016a20: 6b65 7973 2f7b 6e61 6d65 7d22 2c20 6865  keys/{name}", he
+00016a30: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+00016a40: 546f 6b65 6e22 3a20 746f 6b65 6e7d 290d  Token": token}).
+00016a50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016a60: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+00016a70: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
+00016a80: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
+00016a90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00016aa0: 2020 2072 6574 7572 6e20 5472 7565 0d0a     return True..
+00016ab0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00016ac0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00016ad0: 2020 2073 656c 662e 5f6c 6f67 5f65 7272     self._log_err
+00016ae0: 6f72 5f72 6573 706f 6e73 6528 5f5f 636c  or_response(__cl
+00016af0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
+00016b00: 7265 732c 2022 6465 6c65 7465 206b 6579  res, "delete key
+00016b10: 2065 7272 6f72 2229 0d0a 2020 2020 2020   error")..      
+00016b20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016b30: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00016b40: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+00016b50: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00016b60: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
+00016b70: 5f6b 6579 5f63 6f6e 6669 6728 7365 6c66  _key_config(self
+00016b80: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+00016b90: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+00016ba0: 756e 745f 7061 7468 3a20 7374 722c 0d0a  unt_path: str,..
+00016bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bc0: 2020 2020 2020 2020 2020 6e61 6d65 3a20            name: 
+00016bd0: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
+00016be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bf0: 6d69 6e5f 6465 6372 7970 7469 6f6e 5f76  min_decryption_v
+00016c00: 6572 7369 6f6e 3a20 696e 7420 3d20 302c  ersion: int = 0,
+00016c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016c20: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+00016c30: 656e 6372 7970 7469 6f6e 5f76 6572 7369  encryption_versi
+00016c40: 6f6e 3a20 696e 7420 3d20 302c 0d0a 2020  on: int = 0,..  
+00016c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c60: 2020 2020 2020 2020 6465 6c65 7469 6f6e          deletion
+00016c70: 5f61 6c6c 6f77 6564 3a20 626f 6f6c 203d  _allowed: bool =
+00016c80: 2046 616c 7365 2c0d 0a20 2020 2020 2020   False,..       
+00016c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ca0: 2020 2065 7870 6f72 7461 626c 653a 2062     exportable: b
+00016cb0: 6f6f 6c20 3d20 4661 6c73 652c 0d0a 2020  ool = False,..  
+00016cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cd0: 2020 2020 2020 2020 616c 6c6f 775f 706c          allow_pl
+00016ce0: 6169 6e74 6578 745f 6261 636b 7570 3a20  aintext_backup: 
+00016cf0: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+00016d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d10: 2020 2020 2020 2020 2061 7574 6f5f 726f           auto_ro
+00016d20: 7461 7465 5f70 6572 696f 643a 2073 7472  tate_period: str
+00016d30: 203d 2022 2229 3a0d 0a20 2020 2020 2020   = ""):..       
+00016d40: 2022 2222 7475 6e69 6e67 2063 6f6e 6669   """tuning confi
+00016d50: 6775 7261 7469 6f6e 2076 616c 7565 7320  guration values 
+00016d60: 666f 7220 6120 6769 7665 6e20 6b65 790d  for a given key.
+00016d70: 0a0d 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
+00016d80: 2074 6f20 6874 7470 733a 2f2f 6465 7665   to https://deve
+00016d90: 6c6f 7065 722e 6861 7368 6963 6f72 702e  loper.hashicorp.
+00016da0: 636f 6d2f 7661 756c 742f 6170 692d 646f  com/vault/api-do
+00016db0: 6373 2f73 6563 7265 742f 7472 616e 7369  cs/secret/transi
+00016dc0: 7423 7570 6461 7465 2d6b 6579 2d63 6f6e  t#update-key-con
+00016dd0: 6669 6775 7261 7469 6f6e 2066 6f72 206d  figuration for m
+00016de0: 6f72 6520 6465 7461 696c 732e 0d0a 0d0a  ore details.....
+00016df0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
+00016e00: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
+00016e10: 5f70 6174 6820 2873 7472 290d 0a20 2020  _path (str)..   
+00016e20: 2020 2020 2020 2020 206e 616d 6520 2873           name (s
+00016e30: 7472 293a 2053 7065 6369 6669 6573 2074  tr): Specifies t
+00016e40: 6865 206e 616d 6520 6f66 2074 6865 206b  he name of the k
+00016e50: 6579 2074 6f20 7570 6461 7465 0d0a 2020  ey to update..  
+00016e60: 2020 2020 2020 2020 2020 6d69 6e5f 6465            min_de
+00016e70: 6372 7970 7469 6f6e 5f76 6572 7369 6f6e  cryption_version
+00016e80: 2028 696e 742c 206f 7074 696f 6e61 6c29   (int, optional)
+00016e90: 3a20 5370 6563 6966 6965 7320 7468 6520  : Specifies the 
+00016ea0: 6d69 6e69 6d75 6d20 7665 7273 696f 6e20  minimum version 
+00016eb0: 6f66 2063 6970 6865 7274 6578 7420 616c  of ciphertext al
+00016ec0: 6c6f 7765 6420 746f 2062 6520 6465 6372  lowed to be decr
+00016ed0: 7970 7465 642e 200d 0a20 2020 2020 2020  ypted. ..       
+00016ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f00: 2020 2020 2020 2020 2020 2020 2041 646a               Adj
+00016f10: 7573 7469 6e67 2074 6869 7320 6173 2070  usting this as p
+00016f20: 6172 7420 6f66 2061 206b 6579 2072 6f74  art of a key rot
+00016f30: 6174 696f 6e20 706f 6c69 6379 2063 616e  ation policy can
+00016f40: 2070 7265 7665 6e74 206f 6c64 200d 0a20   prevent old .. 
+00016f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f80: 2020 2063 6f70 6965 7320 6f66 2063 6970     copies of cip
+00016f90: 6865 7274 6578 7420 6672 6f6d 2062 6569  hertext from bei
+00016fa0: 6e67 2064 6563 7279 7074 6564 2c20 7368  ng decrypted, sh
+00016fb0: 6f75 6c64 2074 6865 7920 6661 6c6c 2069  ould they fall i
+00016fc0: 6e74 6f20 7468 6520 0d0a 2020 2020 2020  nto the ..      
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ff0: 2020 2020 2020 2020 2020 2020 2020 7772                wr
+00017000: 6f6e 6720 6861 6e64 732e 2046 6f72 2073  ong hands. For s
+00017010: 6967 6e61 7475 7265 732c 2074 6869 7320  ignatures, this 
+00017020: 7661 6c75 6520 636f 6e74 726f 6c73 2074  value controls t
+00017030: 6865 206d 696e 696d 756d 2076 6572 7369  he minimum versi
+00017040: 6f6e 200d 0a20 2020 2020 2020 2020 2020  on ..           
+00017050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017070: 2020 2020 2020 2020 206f 6620 7369 676e           of sign
+00017080: 6174 7572 6520 7468 6174 2063 616e 2062  ature that can b
+00017090: 6520 7665 7269 6669 6564 2061 6761 696e  e verified again
+000170a0: 7374 2e20 466f 7220 484d 4143 732c 2074  st. For HMACs, t
+000170b0: 6869 7320 636f 6e74 726f 6c73 200d 0a20  his controls .. 
+000170c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170f0: 2020 2074 6865 206d 696e 696d 756d 2076     the minimum v
+00017100: 6572 7369 6f6e 206f 6620 6120 6b65 7920  ersion of a key 
+00017110: 616c 6c6f 7765 6420 746f 2062 6520 7573  allowed to be us
+00017120: 6564 2061 7320 7468 6520 6b65 7920 666f  ed as the key fo
+00017130: 7220 0d0a 2020 2020 2020 2020 2020 2020  r ..            
+00017140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017160: 2020 2020 2020 2020 7665 7269 6669 6361          verifica
+00017170: 7469 6f6e 2e20 4465 6661 756c 7473 2074  tion. Defaults t
+00017180: 6f20 302e 0d0a 2020 2020 2020 2020 2020  o 0...          
+00017190: 2020 6d69 6e5f 656e 6372 7970 7469 6f6e    min_encryption
+000171a0: 5f76 6572 7369 6f6e 2028 696e 742c 206f  _version (int, o
+000171b0: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
+000171c0: 6965 7320 7468 6520 6d69 6e69 6d75 6d20  ies the minimum 
+000171d0: 7665 7273 696f 6e20 6f66 2074 6865 206b  version of the k
+000171e0: 6579 2074 6861 7420 6361 6e20 6265 2075  ey that can be u
+000171f0: 7365 6420 746f 2065 6e63 7279 7074 200d  sed to encrypt .
+00017200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017230: 2020 2020 2070 6c61 696e 7465 7874 2c20       plaintext, 
+00017240: 7369 676e 2070 6179 6c6f 6164 732c 206f  sign payloads, o
+00017250: 7220 6765 6e65 7261 7465 2048 4d41 4373  r generate HMACs
+00017260: 2e20 4d75 7374 2062 6520 3020 2877 6869  . Must be 0 (whi
+00017270: 6368 2077 696c 6c20 7573 6520 0d0a 2020  ch will use ..  
+00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172b0: 2020 7468 6520 6c61 7465 7374 2076 6572    the latest ver
+000172c0: 7369 6f6e 2920 6f72 2061 2076 616c 7565  sion) or a value
+000172d0: 2067 7265 6174 6572 206f 7220 6571 7561   greater or equa
+000172e0: 6c20 746f 206d 696e 5f64 6563 7279 7074  l to min_decrypt
+000172f0: 696f 6e5f 7665 7273 696f 6e2e 200d 0a20  ion_version. .. 
+00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017330: 2020 2044 6566 6175 6c74 7320 746f 2030     Defaults to 0
+00017340: 2e0d 0a20 2020 2020 2020 2020 2020 2064  ...            d
+00017350: 656c 6574 696f 6e5f 616c 6c6f 7765 6420  eletion_allowed 
+00017360: 2862 6f6f 6c2c 206f 7074 696f 6e61 6c29  (bool, optional)
+00017370: 3a20 5370 6563 6966 6965 7320 6966 2074  : Specifies if t
+00017380: 6865 206b 6579 2069 7320 616c 6c6f 7765  he key is allowe
+00017390: 6420 746f 2062 6520 6465 6c65 7465 642e  d to be deleted.
+000173a0: 2044 6566 6175 6c74 7320 746f 2046 616c   Defaults to Fal
+000173b0: 7365 2e0d 0a20 2020 2020 2020 2020 2020  se...           
+000173c0: 2065 7870 6f72 7461 626c 6520 2862 6f6f   exportable (boo
+000173d0: 6c2c 206f 7074 696f 6e61 6c29 3a20 456e  l, optional): En
+000173e0: 6162 6c65 7320 6b65 7973 2074 6f20 6265  ables keys to be
+000173f0: 2065 7870 6f72 7461 626c 652e 2054 6869   exportable. Thi
+00017400: 7320 616c 6c6f 7773 2066 6f72 2061 6c6c  s allows for all
+00017410: 2074 6865 2076 616c 6964 206b 6579 7320   the valid keys 
+00017420: 696e 2074 6865 206b 6579 2072 696e 6720  in the key ring 
+00017430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017450: 2020 2020 2020 2020 2020 2074 6f20 6265             to be
+00017460: 2065 7870 6f72 7465 642e 204f 6e63 6520   exported. Once 
+00017470: 7365 742c 2074 6869 7320 6361 6e6e 6f74  set, this cannot
+00017480: 2062 6520 6469 7361 626c 6564 2e20 4465   be disabled. De
+00017490: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
+000174a0: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
+000174b0: 6c6f 775f 706c 6169 6e74 6578 745f 6261  low_plaintext_ba
+000174c0: 636b 7570 2028 626f 6f6c 2c20 6f70 7469  ckup (bool, opti
+000174d0: 6f6e 616c 293a 2049 6620 7365 742c 2065  onal): If set, e
+000174e0: 6e61 626c 6573 2074 616b 696e 6720 6261  nables taking ba
+000174f0: 636b 7570 206f 6620 6e61 6d65 6420 6b65  ckup of named ke
+00017500: 7920 696e 2074 6865 2070 6c61 696e 7465  y in the plainte
+00017510: 7874 2066 6f72 6d61 742e 200d 0a20 2020  xt format. ..   
+00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017550: 2020 4f6e 6365 2073 6574 2c20 7468 6973    Once set, this
+00017560: 2063 616e 6e6f 7420 6265 2064 6973 6162   cannot be disab
+00017570: 6c65 642e 2044 6566 6175 6c74 7320 746f  led. Defaults to
+00017580: 2046 616c 7365 2e0d 0a20 2020 2020 2020   False...       
+00017590: 2020 2020 2061 7574 6f5f 726f 7461 7465       auto_rotate
+000175a0: 5f70 6572 696f 6420 2873 7472 2c20 6f70  _period (str, op
+000175b0: 7469 6f6e 616c 293a 2054 6865 2070 6572  tional): The per
+000175c0: 696f 6420 6174 2077 6869 6368 2074 6869  iod at which thi
+000175d0: 7320 6b65 7920 7368 6f75 6c64 2062 6520  s key should be 
+000175e0: 726f 7461 7465 6420 6175 746f 6d61 7469  rotated automati
+000175f0: 6361 6c6c 792e 2053 6574 7469 6e67 2074  cally. Setting t
+00017600: 6869 7320 0d0a 2020 2020 2020 2020 2020  his ..          
+00017610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017630: 2020 2020 2020 746f 2022 3022 2077 696c        to "0" wil
+00017640: 6c20 6469 7361 626c 6520 6175 746f 6d61  l disable automa
+00017650: 7469 6320 6b65 7920 726f 7461 7469 6f6e  tic key rotation
+00017660: 2e20 5468 6973 2076 616c 7565 2063 616e  . This value can
+00017670: 6e6f 7420 6265 2073 686f 7274 6572 200d  not be shorter .
+00017680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176b0: 2074 6861 6e20 6f6e 6520 686f 7572 2e20   than one hour. 
+000176c0: 5768 656e 206e 6f20 7661 6c75 6520 6973  When no value is
+000176d0: 2070 726f 7669 6465 642c 2074 6865 2070   provided, the p
+000176e0: 6572 696f 6420 7265 6d61 696e 7320 756e  eriod remains un
+000176f0: 6368 616e 6765 642e 200d 0a20 2020 2020  changed. ..     
+00017700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017720: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00017730: 6c74 7320 746f 2022 222e 0d0a 0d0a 2020  lts to "".....  
+00017740: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
+00017750: 2020 2020 2020 2020 2020 2020 626f 6f6c              bool
+00017760: 3a20 7265 7475 726e 2054 7275 6520 6966  : return True if
+00017770: 2073 7563 6365 7373 2c20 6f74 6865 7277   success, otherw
+00017780: 6973 6520 7265 7475 726e 2046 616c 7365  ise return False
+00017790: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000177a0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+000177b0: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
+000177c0: 2020 2020 2063 7572 5f69 6e66 6f20 3d20       cur_info = 
+000177d0: 7365 6c66 2e72 6561 645f 6b65 7928 6d6f  self.read_key(mo
+000177e0: 756e 745f 7061 7468 2c20 6e61 6d65 290d  unt_path, name).
+000177f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017800: 6375 725f 696e 666f 2069 7320 4e6f 6e65  cur_info is None
+00017810: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00017820: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00017830: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00017840: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
+00017850: 6164 203d 2064 6963 7428 290d 0a20 2020  ad = dict()..   
+00017860: 2020 2020 2020 2020 2068 6173 5f63 6861           has_cha
+00017870: 6e67 6520 3d20 4661 6c73 650d 0a20 2020  nge = False..   
+00017880: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00017890: 2020 2020 2020 2069 6620 6d69 6e5f 6465         if min_de
 000178a0: 6372 7970 7469 6f6e 5f76 6572 7369 6f6e  cryption_version
-000178b0: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
-000178c0: 2020 2020 2070 6179 6c6f 6164 5b22 6d69       payload["mi
-000178d0: 6e5f 6465 6372 7970 7469 6f6e 5f76 6572  n_decryption_ver
-000178e0: 7369 6f6e 225d 203d 206d 696e 5f64 6563  sion"] = min_dec
-000178f0: 7279 7074 696f 6e5f 7665 7273 696f 6e0d  ryption_version.
-00017900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017910: 2068 6173 5f63 6861 6e67 6520 3d20 5472   has_change = Tr
-00017920: 7565 0d0a 0d0a 2020 2020 2020 2020 2020  ue....          
-00017930: 2020 6966 206d 696e 5f65 6e63 7279 7074    if min_encrypt
-00017940: 696f 6e5f 7665 7273 696f 6e20 213d 2063  ion_version != c
-00017950: 7572 5f69 6e66 6f5b 226d 696e 5f65 6e63  ur_info["min_enc
-00017960: 7279 7074 696f 6e5f 7665 7273 696f 6e22  ryption_version"
-00017970: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00017980: 2020 2020 7061 796c 6f61 645b 226d 696e      payload["min
-00017990: 5f65 6e63 7279 7074 696f 6e5f 7665 7273  _encryption_vers
-000179a0: 696f 6e22 5d20 3d20 6d69 6e5f 656e 6372  ion"] = min_encr
-000179b0: 7970 7469 6f6e 5f76 6572 7369 6f6e 0d0a  yption_version..
-000179c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179d0: 6861 735f 6368 616e 6765 203d 2054 7275  has_change = Tru
-000179e0: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-000179f0: 2069 6620 6465 6c65 7469 6f6e 5f61 6c6c   if deletion_all
-00017a00: 6f77 6564 2021 3d20 6375 725f 696e 666f  owed != cur_info
-00017a10: 5b22 6465 6c65 7469 6f6e 5f61 6c6c 6f77  ["deletion_allow
-00017a20: 6564 225d 3a0d 0a20 2020 2020 2020 2020  ed"]:..         
-00017a30: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
-00017a40: 6465 6c65 7469 6f6e 5f61 6c6c 6f77 6564  deletion_allowed
-00017a50: 225d 203d 2064 656c 6574 696f 6e5f 616c  "] = deletion_al
-00017a60: 6c6f 7765 640d 0a20 2020 2020 2020 2020  lowed..         
-00017a70: 2020 2020 2020 2068 6173 5f63 6861 6e67         has_chang
-00017a80: 6520 3d20 5472 7565 0d0a 0d0a 2020 2020  e = True....    
-00017a90: 2020 2020 2020 2020 6966 2065 7870 6f72          if expor
-00017aa0: 7461 626c 6520 213d 2063 7572 5f69 6e66  table != cur_inf
-00017ab0: 6f5b 2265 7870 6f72 7461 626c 6522 5d3a  o["exportable"]:
-00017ac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017ad0: 2020 6966 2063 7572 5f69 6e66 6f5b 2265    if cur_info["e
-00017ae0: 7870 6f72 7461 626c 6522 5d3a 0d0a 2020  xportable"]:..  
-00017af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b00: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-00017b10: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-00017b20: 2e5f 5f6e 616d 655f 5f7d 202d 2075 7064  .__name__} - upd
-00017b30: 6174 6520 6b65 7920 636f 6e66 6967 2065  ate key config e
-00017b40: 7272 6f72 3a20 6f6e 6365 2073 6574 2065  rror: once set e
-00017b50: 7870 6f72 7461 626c 653d 5472 7565 2c20  xportable=True, 
-00017b60: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00017b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b80: 2020 2020 2020 2020 2066 2274 6869 7320           f"this 
-00017b90: 6361 6e6e 6f74 2062 6520 6469 7361 626c  cannot be disabl
-00017ba0: 6564 2229 0d0a 2020 2020 2020 2020 2020  ed")..          
-00017bb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017bc0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00017bd0: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
-00017be0: 2265 7870 6f72 7461 626c 6522 5d20 3d20  "exportable"] = 
-00017bf0: 6578 706f 7274 6162 6c65 0d0a 2020 2020  exportable..    
-00017c00: 2020 2020 2020 2020 2020 2020 6861 735f              has_
-00017c10: 6368 616e 6765 203d 2054 7275 650d 0a0d  change = True...
-00017c20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017c30: 616c 6c6f 775f 706c 6169 6e74 6578 745f  allow_plaintext_
-00017c40: 6261 636b 7570 2021 3d20 6375 725f 696e  backup != cur_in
-00017c50: 666f 5b22 616c 6c6f 775f 706c 6169 6e74  fo["allow_plaint
-00017c60: 6578 745f 6261 636b 7570 225d 3a0d 0a20  ext_backup"]:.. 
-00017c70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017c80: 6620 6375 725f 696e 666f 5b22 616c 6c6f  f cur_info["allo
-00017c90: 775f 706c 6169 6e74 6578 745f 6261 636b  w_plaintext_back
-00017ca0: 7570 225d 3a0d 0a20 2020 2020 2020 2020  up"]:..         
-00017cb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017cc0: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-00017cd0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00017ce0: 5f5f 7d20 2d20 7570 6461 7465 206b 6579  __} - update key
-00017cf0: 2063 6f6e 6669 6720 6572 726f 723a 206f   config error: o
-00017d00: 6e63 6520 7365 7420 616c 6c6f 775f 706c  nce set allow_pl
-00017d10: 6169 6e74 6578 745f 6261 636b 7570 3d54  aintext_backup=T
-00017d20: 7275 652c 2022 0d0a 2020 2020 2020 2020  rue, "..        
-00017d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d40: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00017d50: 7468 6973 2063 616e 6e6f 7420 6265 2064  this cannot be d
-00017d60: 6973 6162 6c65 6422 290d 0a20 2020 2020  isabled")..     
-00017d70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00017d80: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-00017d90: 2020 2020 2020 2020 2020 2020 2070 6179               pay
-00017da0: 6c6f 6164 5b22 616c 6c6f 775f 706c 6169  load["allow_plai
-00017db0: 6e74 6578 745f 6261 636b 7570 225d 203d  ntext_backup"] =
-00017dc0: 2061 6c6c 6f77 5f70 6c61 696e 7465 7874   allow_plaintext
-00017dd0: 5f62 6163 6b75 700d 0a20 2020 2020 2020  _backup..       
-00017de0: 2020 2020 2020 2020 2068 6173 5f63 6861           has_cha
-00017df0: 6e67 6520 3d20 5472 7565 0d0a 0d0a 2020  nge = True....  
-00017e00: 2020 2020 2020 2020 2020 6966 2061 7574            if aut
-00017e10: 6f5f 726f 7461 7465 5f70 6572 696f 6420  o_rotate_period 
-00017e20: 213d 2022 223a 0d0a 2020 2020 2020 2020  != "":..        
-00017e30: 2020 2020 2020 2020 6966 2072 6f74 6174          if rotat
-00017e40: 655f 7065 7269 6f64 2e76 616c 7565 203e  e_period.value >
-00017e50: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00017e60: 2020 2020 2020 2020 2072 6f74 6174 655f           rotate_
-00017e70: 7065 7269 6f64 203d 2056 6175 6c74 4475  period = VaultDu
-00017e80: 7261 7469 6f6e 2861 7574 6f5f 726f 7461  ration(auto_rota
-00017e90: 7465 5f70 6572 696f 6429 0d0a 2020 2020  te_period)..    
-00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017eb0: 6c6f 7765 725f 7065 7269 6f64 203d 2056  lower_period = V
-00017ec0: 6175 6c74 4475 7261 7469 6f6e 2822 3168  aultDuration("1h
-00017ed0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00017ee0: 2020 2020 2020 2020 6966 2072 6f74 6174          if rotat
-00017ef0: 655f 7065 7269 6f64 203c 206c 6f77 6572  e_period < lower
-00017f00: 5f70 6572 696f 643a 0d0a 2020 2020 2020  _period:..      
-00017f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f20: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-00017f30: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-00017f40: 2e5f 5f6e 616d 655f 5f7d 202d 2075 7064  .__name__} - upd
-00017f50: 6174 6520 6b65 7920 636f 6e66 6967 2065  ate key config e
-00017f60: 7272 6f72 3a20 5468 6520 7661 6c75 6520  rror: The value 
-00017f70: 6f66 2061 7574 6f5f 726f 7461 7465 5f70  of auto_rotate_p
-00017f80: 6572 696f 6420 220d 0a20 2020 2020 2020  eriod "..       
-00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fb0: 2020 2066 2263 616e 6e6f 7420 6265 2073     f"cannot be s
-00017fc0: 686f 7274 6572 2074 6861 6e20 6f6e 6520  horter than one 
-00017fd0: 686f 7572 2229 0d0a 2020 2020 2020 2020  hour")..        
-00017fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ff0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00018000: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00018010: 796c 6f61 645b 2261 7574 6f5f 726f 7461  yload["auto_rota
-00018020: 7465 5f70 6572 696f 6422 5d20 3d20 6175  te_period"] = au
-00018030: 746f 5f72 6f74 6174 655f 7065 7269 6f64  to_rotate_period
-00018040: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00018050: 6966 2068 6173 5f63 6861 6e67 653a 0d0a  if has_change:..
-00018060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018070: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-00018080: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-00018090: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-000180a0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-000180b0: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-000180c0: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-000180d0: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-000180e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180f0: 746f 6b65 6e20 3d20 6165 735f 6465 6372  token = aes_decr
-00018100: 7970 745f 7465 7874 2873 656c 662e 746f  ypt_text(self.to
-00018110: 6b65 6e2c 206b 6579 3d72 616e 646f 6d5f  ken, key=random_
-00018120: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
-00018130: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
-00018140: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
-00018150: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
-00018160: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00018170: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
-00018180: 7473 2e70 6f73 7428 7572 6c2b 6622 7b6d  ts.post(url+f"{m
-00018190: 6f75 6e74 5f70 6174 687d 2f6b 6579 732f  ount_path}/keys/
-000181a0: 7b6e 616d 657d 2f63 6f6e 6669 6722 2c20  {name}/config", 
-000181b0: 6865 6164 6572 733d 7b22 582d 5661 756c  headers={"X-Vaul
-000181c0: 742d 546f 6b65 6e22 3a20 746f 6b65 6e7d  t-Token": token}
-000181d0: 2c20 6461 7461 3d6a 736f 6e2e 6475 6d70  , data=json.dump
-000181e0: 7328 7061 796c 6f61 6429 290d 0a20 2020  s(payload))..   
-000181f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018200: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-00018210: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
-00018220: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
-00018230: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00018240: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00018250: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00018260: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00018270: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00018280: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
-00018290: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
-000182a0: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
-000182b0: 2022 7570 6461 7465 206b 6579 2063 6f6e   "update key con
-000182c0: 6669 6720 6572 726f 7222 290d 0a20 2020  fig error")..   
-000182d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182e0: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-000182f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00018300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018310: 2020 7365 6c66 2e6c 6f67 6765 722e 7761    self.logger.wa
-00018320: 726e 696e 6728 6622 7b5f 5f63 6c61 7373  rning(f"{__class
-00018330: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2075  __.__name__} - u
-00018340: 7064 6174 6520 6b65 7920 636f 6e66 6967  pdate key config
-00018350: 2077 6172 6e69 6e67 3a20 6e6f 2063 6861   warning: no cha
-00018360: 6e67 6573 2229 0d0a 2020 2020 2020 2020  nges")..        
-00018370: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00018380: 7275 650d 0a0d 0a20 2020 2020 2020 2072  rue....        r
-00018390: 6574 7572 6e20 4661 6c73 650d 0a0d 0a20  eturn False.... 
-000183a0: 2020 2064 6566 2072 6f74 6174 655f 6b65     def rotate_ke
-000183b0: 7928 7365 6c66 2c20 6d6f 756e 745f 7061  y(self, mount_pa
-000183c0: 7468 3a20 7374 722c 206e 616d 653a 2073  th: str, name: s
-000183d0: 7472 293a 0d0a 2020 2020 2020 2020 2222  tr):..        ""
-000183e0: 2272 6f74 6174 6520 7468 6520 7665 7273  "rotate the vers
-000183f0: 696f 6e20 6f66 2074 6865 206e 616d 6564  ion of the named
-00018400: 206b 6579 0d0a 0d0a 2020 2020 2020 2020   key....        
-00018410: 4166 7465 7220 726f 7461 7469 6f6e 2c20  After rotation, 
-00018420: 6e65 7720 706c 6169 6e74 6578 7420 7265  new plaintext re
-00018430: 7175 6573 7473 2077 696c 6c20 6265 2065  quests will be e
-00018440: 6e63 7279 7074 6564 2077 6974 6820 7468  ncrypted with th
-00018450: 6520 6e65 7720 7665 7273 696f 6e20 6f66  e new version of
-00018460: 2074 6865 206b 6579 2e20 0d0a 2020 2020   the key. ..    
-00018470: 2020 2020 546f 2075 7067 7261 6465 2063      To upgrade c
-00018480: 6970 6865 7274 6578 7420 746f 2062 6520  iphertext to be 
-00018490: 656e 6372 7970 7465 6420 7769 7468 2074  encrypted with t
-000184a0: 6865 206c 6174 6573 7420 7665 7273 696f  he latest versio
-000184b0: 6e20 6f66 2074 6865 206b 6579 2c20 7573  n of the key, us
-000184c0: 6520 7468 6520 7265 7772 6170 200d 0a20  e the rewrap .. 
-000184d0: 2020 2020 2020 2065 6e64 706f 696e 742e         endpoint.
-000184e0: 2054 6869 7320 6973 206f 6e6c 7920 7375   This is only su
-000184f0: 7070 6f72 7465 6420 7769 7468 206b 6579  pported with key
-00018500: 7320 7468 6174 2073 7570 706f 7274 2065  s that support e
-00018510: 6e63 7279 7074 696f 6e20 616e 6420 6465  ncryption and de
-00018520: 6372 7970 7469 6f6e 206f 7065 7261 7469  cryption operati
-00018530: 6f6e 732e 0d0a 0d0a 2020 2020 2020 2020  ons.....        
-00018540: 5265 6665 7220 746f 2068 7474 7073 3a2f  Refer to https:/
-00018550: 2f64 6576 656c 6f70 6572 2e68 6173 6869  /developer.hashi
-00018560: 636f 7270 2e63 6f6d 2f76 6175 6c74 2f61  corp.com/vault/a
-00018570: 7069 2d64 6f63 732f 7365 6372 6574 2f74  pi-docs/secret/t
-00018580: 7261 6e73 6974 2372 6f74 6174 652d 6b65  ransit#rotate-ke
-00018590: 7920 666f 7220 6d6f 7265 2064 6574 6169  y for more detai
-000185a0: 6c73 2e0d 0a0d 0a20 2020 2020 2020 2041  ls.....        A
-000185b0: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
-000185c0: 2020 6d6f 756e 745f 7061 7468 2028 7374    mount_path (st
-000185d0: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-000185e0: 6e61 6d65 2028 7374 7229 3a20 5370 6563  name (str): Spec
-000185f0: 6966 6965 7320 7468 6520 6e61 6d65 206f  ifies the name o
-00018600: 6620 7468 6520 6b65 7920 746f 2072 6f74  f the key to rot
-00018610: 6174 650d 0a0d 0a20 2020 2020 2020 2052  ate....        R
-00018620: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-00018630: 2020 2020 2062 6f6f 6c3a 2072 6574 7572       bool: retur
-00018640: 6e20 5472 7565 2069 6620 7375 6363 6573  n True if succes
-00018650: 732c 206f 7468 6572 7769 7365 2072 6574  s, otherwise ret
-00018660: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-00018670: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00018680: 6966 2073 656c 662e 6973 5f61 7574 683a  if self.is_auth:
-00018690: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-000186a0: 6973 745f 6b65 7973 203d 2073 656c 662e  ist_keys = self.
-000186b0: 6c69 7374 5f6b 6579 286d 6f75 6e74 5f70  list_key(mount_p
-000186c0: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
-000186d0: 2020 6966 206e 616d 6520 6e6f 7420 696e    if name not in
-000186e0: 2065 7869 7374 5f6b 6579 733a 0d0a 2020   exist_keys:..  
-000186f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00018700: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00018710: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00018720: 616d 655f 5f7d 202d 2072 6f74 6174 6520  ame__} - rotate 
-00018730: 6b65 7920 6572 726f 723a 206b 6579 2027  key error: key '
-00018740: 7b6e 616d 657d 2720 6e6f 7420 666f 756e  {name}' not foun
-00018750: 6422 290d 0a20 2020 2020 2020 2020 2020  d")..           
-00018760: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00018770: 650d 0a20 2020 2020 2020 2020 2020 200d  e..            .
-00018780: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
-00018790: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
-000187a0: 6578 7428 7365 6c66 2e75 726c 2c20 6b65  ext(self.url, ke
-000187b0: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
-000187c0: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
-000187d0: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
-000187e0: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
-000187f0: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
-00018800: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
-00018810: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
-00018820: 7428 7365 6c66 2e74 6f6b 656e 2c20 6b65  t(self.token, ke
-00018830: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
-00018840: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
-00018850: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
-00018860: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
-00018870: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
-00018880: 2020 2020 2020 2020 2072 6573 203d 2072           res = r
-00018890: 6571 7565 7374 732e 706f 7374 2875 726c  equests.post(url
-000188a0: 2b66 227b 6d6f 756e 745f 7061 7468 7d2f  +f"{mount_path}/
-000188b0: 6b65 7973 2f7b 6e61 6d65 7d2f 726f 7461  keys/{name}/rota
-000188c0: 7465 222c 2068 6561 6465 7273 3d7b 2258  te", headers={"X
-000188d0: 2d56 6175 6c74 2d54 6f6b 656e 223a 2074  -Vault-Token": t
-000188e0: 6f6b 656e 7d29 0d0a 2020 2020 2020 2020  oken})..        
-000188f0: 2020 2020 6966 2072 6573 2e73 7461 7475      if res.statu
-00018900: 735f 636f 6465 203d 3d20 3230 3020 6f72  s_code == 200 or
-00018910: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-00018920: 203d 3d20 3230 343a 0d0a 2020 2020 2020   == 204:..      
-00018930: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00018940: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-00018950: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00018960: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00018970: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
-00018980: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
-00018990: 616d 655f 5f2c 2072 6573 2c20 2272 6f74  ame__, res, "rot
-000189a0: 6174 6520 6b65 7920 6572 726f 7222 290d  ate key error").
-000189b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000189c0: 2072 6574 7572 6e20 4661 6c73 650d 0a0d   return False...
-000189d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000189e0: 4661 6c73 650d 0a0d 0a20 2020 2023 2054  False....    # T
-000189f0: 4f44 4f3a 2077 6169 7420 666f 7220 7465  ODO: wait for te
-00018a00: 7374 696e 670d 0a20 2020 2064 6566 2073  sting..    def s
-00018a10: 6967 6e5f 6373 7228 7365 6c66 2c20 0d0a  ign_csr(self, ..
-00018a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a30: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
-00018a40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00018a50: 2020 2020 6e61 6d65 3a20 7374 722c 0d0a      name: str,..
-00018a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a70: 2076 6572 7369 6f6e 3a20 7374 7220 3d20   version: str = 
-00018a80: 2222 2c0d 0a20 2020 2020 2020 2020 2020  "",..           
-00018a90: 2020 2020 2020 6373 723a 2073 7472 203d        csr: str =
-00018aa0: 2022 2229 3a0d 0a20 2020 2020 2020 2022   ""):..        "
-00018ab0: 2222 7369 676e 7320 6120 4353 5220 7769  ""signs a CSR wi
-00018ac0: 7468 2074 6865 206e 616d 6564 206b 6579  th the named key
-00018ad0: 0d0a 0d0a 2020 2020 2020 2020 416c 6c6f  ....        Allo
-00018ae0: 7769 6e67 2074 6865 206b 6579 206d 6174  wing the key mat
-00018af0: 6572 6961 6c20 6e65 7665 7220 746f 206c  erial never to l
-00018b00: 6561 7665 2054 7261 6e73 6974 2e20 4966  eave Transit. If
-00018b10: 206e 6f20 7465 6d70 6c61 7465 2043 5352   no template CSR
-00018b20: 2069 7320 7370 6563 6966 6965 642c 200d   is specified, .
-00018b30: 0a20 2020 2020 2020 2061 6e20 656d 7074  .        an empt
-00018b40: 7920 4353 5220 6973 2073 6967 6e65 642c  y CSR is signed,
-00018b50: 206f 7468 6572 7769 7365 2c20 6120 636f   otherwise, a co
-00018b60: 7079 206f 6620 7468 6520 7370 6563 6966  py of the specif
-00018b70: 6965 6420 4353 5220 7769 7468 206b 6579  ied CSR with key
-00018b80: 206d 6174 6572 6961 6c20 0d0a 2020 2020   material ..    
-00018b90: 2020 2020 7265 706c 6163 6564 2077 6974      replaced wit
-00018ba0: 6820 7468 6973 206b 6579 206d 6174 6572  h this key mater
-00018bb0: 6961 6c20 6973 2073 6967 6e65 642e 0d0a  ial is signed...
-00018bc0: 0d0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
-00018bd0: 746f 2068 7474 7073 3a2f 2f64 6576 656c  to https://devel
-00018be0: 6f70 6572 2e68 6173 6869 636f 7270 2e63  oper.hashicorp.c
-00018bf0: 6f6d 2f76 6175 6c74 2f61 7069 2d64 6f63  om/vault/api-doc
-00018c00: 732f 7365 6372 6574 2f74 7261 6e73 6974  s/secret/transit
-00018c10: 2373 6967 6e2d 6373 7220 666f 7220 6d6f  #sign-csr for mo
-00018c20: 7265 2064 6574 6169 6c73 2e0d 0a0d 0a20  re details..... 
-00018c30: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-00018c40: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
-00018c50: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
-00018c60: 2020 2020 2020 2020 6e61 6d65 2028 7374          name (st
-00018c70: 7229 3a20 5370 6563 6966 6965 7320 7468  r): Specifies th
-00018c80: 6520 6e61 6d65 206f 6620 7468 6520 6b65  e name of the ke
-00018c90: 7920 746f 2073 6967 6e20 7468 6520 4353  y to sign the CS
-00018ca0: 5220 7769 7468 2e0d 0a20 2020 2020 2020  R with...       
-00018cb0: 2020 2020 2076 6572 7369 6f6e 2028 7374       version (st
-00018cc0: 722c 206f 7074 696f 6e61 6c29 3a20 5370  r, optional): Sp
-00018cd0: 6563 6966 6965 7320 7468 6520 7665 7273  ecifies the vers
-00018ce0: 696f 6e20 6f66 2074 6865 2043 5352 206b  ion of the CSR k
-00018cf0: 6579 2074 6f20 7573 6520 666f 7220 7369  ey to use for si
-00018d00: 676e 696e 672e 200d 0a20 2020 2020 2020  gning. ..       
-00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d20: 2020 2020 2020 2020 2020 2020 2020 4966                If
-00018d30: 2074 6865 2076 6572 7369 6f6e 2069 7320   the version is 
-00018d40: 7365 7420 746f 206c 6174 6573 7420 6f72  set to latest or
-00018d50: 2069 7320 6e6f 7420 7365 742c 2074 6865   is not set, the
-00018d60: 2063 7572 7265 6e74 200d 0a20 2020 2020   current ..     
-00018d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d90: 6b65 7920 7769 6c6c 2062 6520 7265 7475  key will be retu
-00018da0: 726e 6564 2e20 4465 6661 756c 7473 2074  rned. Defaults t
-00018db0: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-00018dc0: 2020 2063 7372 2028 7374 722c 206f 7074     csr (str, opt
-00018dd0: 696f 6e61 6c29 3a20 4f70 7469 6f6e 616c  ional): Optional
-00018de0: 2050 454d 2d65 6e63 6f64 6564 2043 5352   PEM-encoded CSR
-00018df0: 2074 656d 706c 6174 6520 746f 2075 7365   template to use
-00018e00: 2061 7320 6120 6261 7369 7320 666f 7220   as a basis for 
-00018e10: 7468 6520 6e65 7720 0d0a 2020 2020 2020  the new ..      
-00018e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e30: 2020 2020 2020 2020 2020 2043 5352 2073             CSR s
-00018e40: 6967 6e65 6420 6279 2074 6869 7320 6b65  igned by this ke
-00018e50: 792e 2049 6620 6e6f 7420 7365 742c 2061  y. If not set, a
-00018e60: 6e20 656d 7074 7920 4353 5220 6973 2075  n empty CSR is u
-00018e70: 7365 642e 2044 6566 6175 6c74 7320 746f  sed. Defaults to
-00018e80: 2022 222e 0d0a 0d0a 2020 2020 2020 2020   "".....        
-00018e90: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
-00018ea0: 2020 2020 2020 626f 6f6c 3a20 7265 7475        bool: retu
-00018eb0: 726e 2054 7275 6520 6966 2073 7563 6365  rn True if succe
-00018ec0: 7373 2c20 6f74 6865 7277 6973 6520 7265  ss, otherwise re
-00018ed0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-00018ee0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00018ef0: 2069 6620 7365 6c66 2e69 735f 6175 7468   if self.is_auth
-00018f00: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-00018f10: 7869 7374 5f6b 6579 7320 3d20 7365 6c66  xist_keys = self
-00018f20: 2e6c 6973 745f 6b65 7928 6d6f 756e 745f  .list_key(mount_
-00018f30: 7061 7468 290d 0a20 2020 2020 2020 2020  path)..         
-00018f40: 2020 2069 6620 6e61 6d65 206e 6f74 2069     if name not i
-00018f50: 6e20 6578 6973 745f 6b65 7973 3a0d 0a20  n exist_keys:.. 
-00018f60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00018f70: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-00018f80: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-00018f90: 6e61 6d65 5f5f 7d20 2d20 7369 676e 2063  name__} - sign c
-00018fa0: 7372 2065 7272 6f72 3a20 6b65 7920 277b  sr error: key '{
-00018fb0: 6e61 6d65 7d27 206e 6f74 2066 6f75 6e64  name}' not found
-00018fc0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00018fd0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00018fe0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-00018ff0: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00019000: 6d73 203d 205b 5d0d 0a0d 0a20 2020 2020  ms = []....     
-00019010: 2020 2020 2020 2069 6620 7665 7273 696f         if versio
-00019020: 6e20 213d 2022 223a 0d0a 2020 2020 2020  n != "":..      
-00019030: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-00019040: 2e61 7070 656e 6428 6622 7665 7273 696f  .append(f"versio
-00019050: 6e3d 7b76 6572 7369 6f6e 7d22 290d 0a20  n={version}").. 
-00019060: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-00019070: 2020 2020 2020 2020 2069 6620 6373 7220           if csr 
-00019080: 213d 2022 223a 0d0a 2020 2020 2020 2020  != "":..        
-00019090: 2020 2020 2020 2020 7061 7261 6d73 2e61          params.a
-000190a0: 7070 656e 6428 6622 6373 723d 7b63 7372  ppend(f"csr={csr
-000190b0: 7d22 290d 0a0d 0a20 2020 2020 2020 2020  }")....         
-000190c0: 2020 2069 6620 6c65 6e28 7061 7261 6d73     if len(params
-000190d0: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
-000190e0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-000190f0: 2022 3f22 202b 2022 2622 2e6a 6f69 6e28   "?" + "&".join(
-00019100: 7061 7261 6d73 290d 0a20 2020 2020 2020  params)..       
-00019110: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00019120: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00019130: 6d73 203d 2022 220d 0a0d 0a20 2020 2020  ms = ""....     
-00019140: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
-00019150: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-00019160: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
-00019170: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-00019180: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-00019190: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-000191a0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-000191b0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-000191c0: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
-000191d0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-000191e0: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
-000191f0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-00019200: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-00019210: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-00019220: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-00019230: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00019240: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-00019250: 732e 706f 7374 2875 726c 2b66 227b 6d6f  s.post(url+f"{mo
-00019260: 756e 745f 7061 7468 7d2f 6b65 7973 2f7b  unt_path}/keys/{
-00019270: 6e61 6d65 7d2f 6373 7222 2c20 6865 6164  name}/csr", head
-00019280: 6572 733d 7b22 582d 5661 756c 742d 546f  ers={"X-Vault-To
-00019290: 6b65 6e22 3a20 746f 6b65 6e7d 2c20 7061  ken": token}, pa
-000192a0: 7261 6d73 3d70 6172 616d 7329 0d0a 2020  rams=params)..  
-000192b0: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-000192c0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-000192d0: 3230 3020 6f72 2072 6573 2e73 7461 7475  200 or res.statu
-000192e0: 735f 636f 6465 203d 3d20 3230 343a 0d0a  s_code == 204:..
-000192f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019300: 7265 7475 726e 2054 7275 650d 0a20 2020  return True..   
-00019310: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019330: 7365 6c66 2e5f 6c6f 675f 6572 726f 725f  self._log_error_
-00019340: 7265 7370 6f6e 7365 285f 5f63 6c61 7373  response(__class
-00019350: 5f5f 2e5f 5f6e 616d 655f 5f2c 2072 6573  __.__name__, res
-00019360: 2c20 2272 6f74 6174 6520 6b65 7920 6572  , "rotate key er
-00019370: 726f 7222 290d 0a20 2020 2020 2020 2020  ror")..         
-00019380: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00019390: 6c73 650d 0a20 2020 2020 2020 200d 0a20  lse..        .. 
-000193a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000193b0: 6c73 650d 0a0d 0a20 2020 2023 2054 4f44  lse....    # TOD
-000193c0: 4f3a 2077 6169 7420 666f 7220 7465 7374  O: wait for test
-000193d0: 696e 670d 0a20 2020 2064 6566 2073 6574  ing..    def set
-000193e0: 5f63 6572 7469 6669 6361 7465 5f63 6861  _certificate_cha
-000193f0: 696e 2873 656c 662c 200d 0a20 2020 2020  in(self, ..     
-00019400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019410: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
-00019420: 6174 683a 2073 7472 2c0d 0a20 2020 2020  ath: str,..     
-00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019440: 2020 2020 2020 2020 206e 616d 653a 2073           name: s
-00019450: 7472 2c0d 0a20 2020 2020 2020 2020 2020  tr,..           
-00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019470: 2020 2063 6572 7469 6669 6361 7465 5f63     certificate_c
-00019480: 6861 696e 3a20 7374 722c 0d0a 2020 2020  hain: str,..    
-00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194a0: 2020 2020 2020 2020 2020 7665 7273 696f            versio
-000194b0: 6e3a 2073 7472 203d 2022 2229 3a0d 0a20  n: str = ""):.. 
-000194c0: 2020 2020 2020 2022 2222 7365 7420 7468         """set th
-000194d0: 6520 6365 7274 6966 6963 6174 6520 6368  e certificate ch
-000194e0: 6169 6e20 6173 736f 6369 6174 6564 2077  ain associated w
-000194f0: 6974 6820 7468 6520 6e61 6d65 6420 6b65  ith the named ke
-00019500: 790d 0a0d 0a20 2020 2020 2020 2052 6566  y....        Ref
-00019510: 6572 2074 6f20 6874 7470 733a 2f2f 6465  er to https://de
-00019520: 7665 6c6f 7065 722e 6861 7368 6963 6f72  veloper.hashicor
-00019530: 702e 636f 6d2f 7661 756c 742f 6170 692d  p.com/vault/api-
-00019540: 646f 6373 2f73 6563 7265 742f 7472 616e  docs/secret/tran
-00019550: 7369 7423 7365 742d 6365 7274 6966 6963  sit#set-certific
-00019560: 6174 652d 6368 6169 6e20 666f 7220 6d6f  ate-chain for mo
-00019570: 7265 2064 6574 6169 6c73 2e0d 0a0d 0a20  re details..... 
-00019580: 2020 2020 2020 2041 7267 733a 0d0a 2020         Args:..  
-00019590: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
-000195a0: 7061 7468 2028 7374 7229 0d0a 2020 2020  path (str)..    
-000195b0: 2020 2020 2020 2020 6e61 6d65 2028 7374          name (st
-000195c0: 7229 3a20 5370 6563 6966 6965 7320 7468  r): Specifies th
-000195d0: 6520 6e61 6d65 206f 6620 7468 6520 6b65  e name of the ke
-000195e0: 7920 746f 2069 6d70 6f72 7420 7468 6520  y to import the 
-000195f0: 6365 7274 6966 6963 6174 6520 6368 6169  certificate chai
-00019600: 6e20 6167 6169 6e73 740d 0a20 2020 2020  n against..     
-00019610: 2020 2020 2020 2063 6572 7469 6669 6361         certifica
-00019620: 7465 5f63 6861 696e 2028 7374 7229 3a20  te_chain (str): 
-00019630: 4120 5045 4d20 656e 636f 6465 6420 6365  A PEM encoded ce
-00019640: 7274 6966 6963 6174 6520 6368 6169 6e2e  rtificate chain.
-00019650: 2049 7420 7368 6f75 6c64 2062 6520 636f   It should be co
-00019660: 6d70 6f73 6564 2062 7920 6f6e 6520 6f72  mposed by one or
-00019670: 206d 6f72 6520 636f 6e63 6174 656e 6174   more concatenat
-00019680: 6564 200d 0a20 2020 2020 2020 2020 2020  ed ..           
-00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196a0: 2020 2020 2020 2020 2020 5045 4d20 626c            PEM bl
-000196b0: 6f63 6b73 2061 6e64 206f 7264 6572 6564  ocks and ordered
-000196c0: 2073 7461 7274 696e 6720 6672 6f6d 2074   starting from t
-000196d0: 6865 2065 6e64 2d65 6e74 6974 7920 6365  he end-entity ce
-000196e0: 7274 6966 6963 6174 652e 0d0a 2020 2020  rtificate...    
-000196f0: 2020 2020 2020 2020 7665 7273 696f 6e20          version 
-00019700: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
-00019710: 2053 7065 6369 6669 6573 2074 6865 2076   Specifies the v
-00019720: 6572 7369 6f6e 206f 6620 7468 6520 6b65  ersion of the ke
-00019730: 7920 746f 2069 6d70 6f72 7420 7468 6520  y to import the 
-00019740: 6368 6169 6e20 6167 6169 6e73 742e 2049  chain against. I
-00019750: 6620 7468 6520 7665 7273 696f 6e20 6973  f the version is
-00019760: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00019770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019780: 2020 2020 2020 2020 7365 7420 746f 206c          set to l
-00019790: 6174 6573 7420 6f72 2069 7320 6e6f 7420  atest or is not 
-000197a0: 7365 742c 2074 6865 2063 7572 7265 6e74  set, the current
-000197b0: 206b 6579 2077 696c 6c20 6265 2072 6574   key will be ret
-000197c0: 7572 6e65 642e 2044 6566 6175 6c74 7320  urned. Defaults 
-000197d0: 746f 2022 222e 0d0a 0d0a 2020 2020 2020  to "".....      
-000197e0: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
-000197f0: 2020 2020 2020 2020 626f 6f6c 3a20 7265          bool: re
-00019800: 7475 726e 2054 7275 6520 6966 2073 7563  turn True if suc
-00019810: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
-00019820: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00019830: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00019840: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
-00019850: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
-00019860: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
-00019870: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
-00019880: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00019890: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-000198a0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-000198b0: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-000198c0: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-000198d0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
-000198e0: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
-000198f0: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
-00019900: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00019910: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-00019920: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-00019930: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-00019940: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-00019950: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
-00019960: 202b 3d20 6622 7b6d 6f75 6e74 5f70 6174   += f"{mount_pat
-00019970: 687d 2f6b 6579 732f 7b6e 616d 657d 2f73  h}/keys/{name}/s
-00019980: 6574 2d63 6572 7469 6669 6361 7465 3f63  et-certificate?c
-00019990: 6572 7469 6669 6361 7465 5f63 6861 696e  ertificate_chain
-000199a0: 3d7b 6365 7274 6966 6963 6174 655f 6368  ={certificate_ch
-000199b0: 6169 6e7d 220d 0a20 2020 2020 2020 2020  ain}"..         
-000199c0: 2020 2069 6620 7665 7273 696f 6e20 213d     if version !=
-000199d0: 2022 223a 0d0a 2020 2020 2020 2020 2020   "":..          
-000199e0: 2020 2020 2020 7572 6c20 2b3d 2066 2226        url += f"&
-000199f0: 7665 7273 696f 6e3d 7b76 6572 7369 6f6e  version={version
-00019a00: 7d22 0d0a 2020 2020 2020 2020 2020 2020  }"..            
-00019a10: 7265 7320 3d20 7265 7175 6573 7473 2e70  res = requests.p
-00019a20: 6f73 7428 7572 6c2c 2068 6561 6465 7273  ost(url, headers
-00019a30: 3d7b 2258 2d56 6175 6c74 2d54 6f6b 656e  ={"X-Vault-Token
-00019a40: 223a 2074 6f6b 656e 7d29 0d0a 2020 2020  ": token})..    
-00019a50: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
-00019a60: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
-00019a70: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
-00019a80: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
-00019a90: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00019aa0: 7475 726e 2054 7275 650d 0a20 2020 2020  turn True..     
-00019ab0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00019ac0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00019ad0: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
-00019ae0: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
-00019af0: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
-00019b00: 2273 6574 2063 6572 7469 6669 6361 7465  "set certificate
-00019b10: 2063 6861 696e 2065 7272 6f72 2229 0d0a   chain error")..
-00019b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b30: 7265 7475 726e 2046 616c 7365 0d0a 0d0a  return False....
-00019b40: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00019b50: 616c 7365 0d0a 0d0a 2020 2020 2320 544f  alse....    # TO
-00019b60: 444f 3a20 7761 6974 2066 6f72 2074 6573  DO: wait for tes
-00019b70: 7469 6e67 0d0a 2020 2020 6465 6620 7365  ting..    def se
-00019b80: 6375 7265 6c79 5f65 7870 6f72 745f 6b65  curely_export_ke
-00019b90: 7928 7365 6c66 2c20 0d0a 2020 2020 2020  y(self, ..      
-00019ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bb0: 2020 2020 2020 6d6f 756e 745f 7061 7468        mount_path
-00019bc0: 3a20 7374 722c 0d0a 2020 2020 2020 2020  : str,..        
-00019bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019be0: 2020 2020 6465 7374 696e 6174 696f 6e3a      destination:
-00019bf0: 2073 7472 2c0d 0a20 2020 2020 2020 2020   str,..         
-00019c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c10: 2020 2073 6f75 7263 653a 2073 7472 2c0d     source: str,.
-00019c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019c30: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-00019c40: 7369 6f6e 3a20 7374 7220 3d20 2222 293a  sion: str = ""):
-00019c50: 0d0a 2020 2020 2020 2020 2222 2265 7870  ..        """exp
-00019c60: 6f72 7420 696d 706f 7274 6564 206b 6579  ort imported key
-00019c70: 2073 6563 7572 656c 790d 0a0d 0a20 2020   securely....   
-00019c80: 2020 2020 2054 6869 7320 656e 6470 6f69       This endpoi
-00019c90: 6e74 2072 6574 7572 6e73 2061 2077 7261  nt returns a wra
-00019ca0: 7070 6564 2063 6f70 7920 6f66 2074 6865  pped copy of the
-00019cb0: 2060 736f 7572 6365 6020 6b65 792c 2070   `source` key, p
-00019cc0: 726f 7465 6374 6564 2062 7920 7468 6520  rotected by the 
-00019cd0: 6064 6573 7469 6e61 7469 6f6e 6020 6b65  `destination` ke
-00019ce0: 7920 7573 696e 6720 7468 6520 4259 4f4b  y using the BYOK
-00019cf0: 206d 6574 686f 6420 0d0a 2020 2020 2020   method ..      
-00019d00: 2020 6163 6365 7074 6564 2062 7920 7468    accepted by th
-00019d10: 6520 602f 7472 616e 7369 742f 6b65 7973  e `/transit/keys
-00019d20: 2f3a 6e61 6d65 2f69 6d70 6f72 7460 2041  /:name/import` A
-00019d30: 5049 2e20 5468 6973 2061 6c6c 6f77 7320  PI. This allows 
-00019d40: 616e 206f 7065 7261 746f 7220 7573 696e  an operator usin
-00019d50: 6720 7477 6f20 7365 7061 7261 7465 2056  g two separate V
-00019d60: 6175 6c74 2069 6e73 7461 6e63 6573 2074  ault instances t
-00019d70: 6f20 0d0a 2020 2020 2020 2020 7365 6375  o ..        secu
-00019d80: 7265 2065 7374 6162 6c69 7368 6564 2073  re established s
-00019d90: 6861 7265 6420 6b65 7920 6d61 7465 7269  hared key materi
-00019da0: 616c 2c20 7769 7468 6f75 7420 6578 706f  al, without expo
-00019db0: 7369 6e67 2065 6974 6865 7220 6b65 7920  sing either key 
-00019dc0: 696e 2070 6c61 696e 7465 7874 2061 6e64  in plaintext and
-00019dd0: 206e 6565 6469 6e67 2074 6f20 7275 6e20   needing to run 
-00019de0: 6120 6d61 6e75 616c 2042 594f 4b20 0d0a  a manual BYOK ..
-00019df0: 2020 2020 2020 2020 696d 706f 7274 2075          import u
-00019e00: 7369 6e67 2074 6865 2043 4c49 2068 656c  sing the CLI hel
-00019e10: 7065 7220 7574 696c 6974 792e 0d0a 0d0a  per utility.....
-00019e20: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
-00019e30: 2068 7474 7073 3a2f 2f64 6576 656c 6f70   https://develop
-00019e40: 6572 2e68 6173 6869 636f 7270 2e63 6f6d  er.hashicorp.com
-00019e50: 2f76 6175 6c74 2f61 7069 2d64 6f63 732f  /vault/api-docs/
-00019e60: 7365 6372 6574 2f74 7261 6e73 6974 2373  secret/transit#s
-00019e70: 6563 7572 656c 792d 6578 706f 7274 2d6b  ecurely-export-k
-00019e80: 6579 2066 6f72 206d 6f72 6520 6465 7461  ey for more deta
-00019e90: 696c 732e 0d0a 0d0a 2020 2020 2020 2020  ils.....        
-00019ea0: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
-00019eb0: 2020 206d 6f75 6e74 5f70 6174 6820 2873     mount_path (s
-00019ec0: 7472 290d 0a20 2020 2020 2020 2020 2020  tr)..           
-00019ed0: 2064 6573 7469 6e61 7469 6f6e 2028 7374   destination (st
-00019ee0: 7229 3a20 5370 6563 6966 6965 7320 7468  r): Specifies th
-00019ef0: 6520 6e61 6d65 206f 6620 7468 6520 6b65  e name of the ke
-00019f00: 7920 746f 2065 6e63 7279 7074 2074 6865  y to encrypt the
-00019f10: 2060 736f 7572 6365 6020 6b65 7920 746f   `source` key to
-00019f20: 3a20 7468 6973 2069 7320 7573 7561 6c6c  : this is usuall
-00019f30: 7920 616e 6f74 6865 7220 6d6f 756e 7420  y another mount 
-00019f40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f60: 206f 7220 636c 7573 7465 7227 7320 7772   or cluster's wr
-00019f70: 6170 7069 6e67 206b 6579 2028 6672 6f6d  apping key (from
-00019f80: 2060 2f74 7261 6e73 6974 2f77 7261 7070   `/transit/wrapp
-00019f90: 696e 675f 6b65 7960 292e 0d0a 2020 2020  ing_key`)...    
-00019fa0: 2020 2020 2020 2020 736f 7572 6365 2028          source (
-00019fb0: 7374 7229 3a20 5370 6563 6966 6965 7320  str): Specifies 
-00019fc0: 7468 6520 736f 7572 6365 206b 6579 2074  the source key t
-00019fd0: 6f20 656e 6372 7970 742c 2074 6f20 636f  o encrypt, to co
-00019fe0: 7079 2028 656e 6372 7970 7465 6429 2074  py (encrypted) t
-00019ff0: 6f20 616e 6f74 6865 7220 636c 7573 7465  o another cluste
-0001a000: 722e 0d0a 2020 2020 2020 2020 2020 2020  r...            
-0001a010: 7665 7273 696f 6e20 2873 7472 2c20 6f70  version (str, op
-0001a020: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
-0001a030: 6573 2074 6865 2076 6572 7369 6f6e 206f  es the version o
-0001a040: 6620 7468 6520 736f 7572 6365 206b 6579  f the source key
-0001a050: 2074 6f20 7772 6170 2e20 4966 206f 6d69   to wrap. If omi
-0001a060: 7474 6564 2c20 616c 6c20 7665 7273 696f  tted, all versio
-0001a070: 6e73 206f 6620 7468 6520 6b65 7920 0d0a  ns of the key ..
-0001a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0a0: 2020 2020 2077 696c 6c20 6265 2072 6574       will be ret
-0001a0b0: 7572 6e65 642e 2054 6869 7320 6973 2073  urned. This is s
-0001a0c0: 7065 6369 6669 6564 2061 7320 7061 7274  pecified as part
-0001a0d0: 206f 6620 7468 6520 5552 4c2e 2049 6620   of the URL. If 
-0001a0e0: 7468 6520 7665 7273 696f 6e20 6973 2073  the version is s
-0001a0f0: 6574 2074 6f20 6c61 7465 7374 2c20 0d0a  et to latest, ..
-0001a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a120: 2020 2020 2074 6865 2063 7572 7265 6e74       the current
-0001a130: 206b 6579 2077 696c 6c20 6265 2072 6574   key will be ret
-0001a140: 7572 6e65 642e 2044 6566 6175 6c74 7320  urned. Defaults 
-0001a150: 746f 2022 222e 0d0a 0d0a 2020 2020 2020  to "".....      
-0001a160: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
-0001a170: 2020 2020 2020 2020 6469 6374 206f 7220          dict or 
-0001a180: 4e6f 6e65 3a20 7265 7475 726e 2074 6865  None: return the
-0001a190: 206b 6579 2069 6e20 6469 6374 2069 6620   key in dict if 
-0001a1a0: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
-0001a1b0: 7365 2072 6574 7572 6e20 4e6f 6e65 0d0a  se return None..
-0001a1c0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0001a1d0: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
-0001a1e0: 6175 7468 3a0d 0a20 2020 2020 2020 2020  auth:..         
-0001a1f0: 2020 2075 726c 203d 2061 6573 5f64 6563     url = aes_dec
-0001a200: 7279 7074 5f74 6578 7428 7365 6c66 2e75  rypt_text(self.u
-0001a210: 726c 2c20 6b65 793d 7261 6e64 6f6d 5f68  rl, key=random_h
-0001a220: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
-0001a230: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
-0001a240: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
-0001a250: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
-0001a260: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
-0001a270: 6f6b 656e 203d 2061 6573 5f64 6563 7279  oken = aes_decry
-0001a280: 7074 5f74 6578 7428 7365 6c66 2e74 6f6b  pt_text(self.tok
-0001a290: 656e 2c20 6b65 793d 7261 6e64 6f6d 5f68  en, key=random_h
-0001a2a0: 6578 2873 656c 662e 5f6b 6579 5f6c 656e  ex(self._key_len
-0001a2b0: 2c20 7365 6c66 2e5f 7365 6564 2a32 292c  , self._seed*2),
-0001a2c0: 2069 763d 7261 6e64 6f6d 5f68 6578 2831   iv=random_hex(1
-0001a2d0: 362c 2073 656c 662e 5f73 6565 642a 3329  6, self._seed*3)
-0001a2e0: 290d 0a20 2020 2020 2020 2020 2020 2075  )..            u
-0001a2f0: 726c 202b 3d20 6622 7b6d 6f75 6e74 5f70  rl += f"{mount_p
-0001a300: 6174 687d 2f62 796f 6b2d 6578 706f 7274  ath}/byok-export
-0001a310: 2f7b 6465 7374 696e 6174 696f 6e7d 2f7b  /{destination}/{
-0001a320: 736f 7572 6365 7d22 0d0a 2020 2020 2020  source}"..      
-0001a330: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
-0001a340: 2021 3d20 2222 3a0d 0a20 2020 2020 2020   != "":..       
-0001a350: 2020 2020 2020 2020 2075 726c 202b 3d20           url += 
-0001a360: 6622 2f7b 7665 7273 696f 6e7d 220d 0a20  f"/{version}".. 
-0001a370: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-0001a380: 2072 6571 7565 7374 732e 6765 7428 7572   requests.get(ur
-0001a390: 6c2c 2068 6561 6465 7273 3d7b 2258 2d56  l, headers={"X-V
-0001a3a0: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
-0001a3b0: 656e 7d29 0d0a 2020 2020 2020 2020 2020  en})..          
-0001a3c0: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
-0001a3d0: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
-0001a3e0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-0001a3f0: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
-0001a400: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0001a410: 6573 2e6a 736f 6e28 295b 2264 6174 6122  es.json()["data"
-0001a420: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-0001a430: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0001a440: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-0001a450: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
-0001a460: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0001a470: 5f2c 2072 6573 2c20 2273 6563 7572 656c  _, res, "securel
-0001a480: 7920 6578 706f 7274 206b 6579 2065 7272  y export key err
-0001a490: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
-0001a4a0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0001a4b0: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
-0001a4c0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001a4d0: 0d0a 0d0a 2020 2020 2320 544f 444f 3a20  ....    # TODO: 
-0001a4e0: 7761 6974 2066 6f72 2074 6573 7469 6e67  wait for testing
-0001a4f0: 0d0a 2020 2020 6465 6620 6578 706f 7274  ..    def export
-0001a500: 5f6b 6579 2873 656c 662c 200d 0a20 2020  _key(self, ..   
-0001a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a520: 6d6f 756e 745f 7061 7468 3a20 7374 722c  mount_path: str,
-0001a530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a540: 2020 2020 206b 6579 5f74 7970 653a 2073       key_type: s
-0001a550: 7472 2c0d 0a20 2020 2020 2020 2020 2020  tr,..           
-0001a560: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
-0001a570: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-0001a580: 2020 2020 2020 2076 6572 7369 6f6e 3a20         version: 
-0001a590: 7374 7220 3d20 2222 293a 0d0a 2020 2020  str = ""):..    
-0001a5a0: 2020 2020 2222 2265 7870 6f72 7420 7468      """export th
-0001a5b0: 6520 6e61 6d65 6420 6b65 790d 0a0d 0a20  e named key.... 
-0001a5c0: 2020 2020 2020 2054 6865 206b 6579 7320         The keys 
-0001a5d0: 6f62 6a65 6374 2073 686f 7773 2074 6865  object shows the
-0001a5e0: 2076 616c 7565 206f 6620 7468 6520 6b65   value of the ke
-0001a5f0: 7920 666f 7220 6561 6368 2076 6572 7369  y for each versi
-0001a600: 6f6e 2e20 4966 2076 6572 7369 6f6e 2069  on. If version i
-0001a610: 7320 7370 6563 6966 6965 642c 2074 6865  s specified, the
-0001a620: 2073 7065 6369 6669 6320 7665 7273 696f   specific versio
-0001a630: 6e20 7769 6c6c 2062 6520 7265 7475 726e  n will be return
-0001a640: 6564 2e20 0d0a 2020 2020 2020 2020 4966  ed. ..        If
-0001a650: 206c 6174 6573 7420 6973 2070 726f 7669   latest is provi
-0001a660: 6465 6420 6173 2074 6865 2076 6572 7369  ded as the versi
-0001a670: 6f6e 2c20 7468 6520 6375 7272 656e 7420  on, the current 
-0001a680: 6b65 7920 7769 6c6c 2062 6520 7072 6f76  key will be prov
-0001a690: 6964 6564 2e20 4465 7065 6e64 696e 6720  ided. Depending 
-0001a6a0: 6f6e 2074 6865 2074 7970 6520 6f66 206b  on the type of k
-0001a6b0: 6579 2c20 6469 6666 6572 656e 7420 696e  ey, different in
-0001a6c0: 666f 726d 6174 696f 6e20 0d0a 2020 2020  formation ..    
-0001a6d0: 2020 2020 6d61 7920 6265 2072 6574 7572      may be retur
-0001a6e0: 6e65 642e 2054 6865 206b 6579 206d 7573  ned. The key mus
-0001a6f0: 7420 6265 2065 7870 6f72 7461 626c 6520  t be exportable 
-0001a700: 746f 2073 7570 706f 7274 2074 6869 7320  to support this 
-0001a710: 6f70 6572 6174 696f 6e20 616e 6420 7468  operation and th
-0001a720: 6520 7665 7273 696f 6e20 6d75 7374 2073  e version must s
-0001a730: 7469 6c6c 2062 6520 7661 6c69 642e 0d0a  till be valid...
-0001a740: 0d0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
-0001a750: 746f 2068 7474 7073 3a2f 2f64 6576 656c  to https://devel
-0001a760: 6f70 6572 2e68 6173 6869 636f 7270 2e63  oper.hashicorp.c
-0001a770: 6f6d 2f76 6175 6c74 2f61 7069 2d64 6f63  om/vault/api-doc
-0001a780: 732f 7365 6372 6574 2f74 7261 6e73 6974  s/secret/transit
-0001a790: 2365 7870 6f72 742d 6b65 7920 666f 7220  #export-key for 
-0001a7a0: 6d6f 7265 2064 6574 6169 6c73 2e0d 0a0d  more details....
-0001a7b0: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-0001a7c0: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-0001a7d0: 745f 7061 7468 2028 7374 7229 0d0a 2020  t_path (str)..  
-0001a7e0: 2020 2020 2020 2020 2020 6b65 795f 7479            key_ty
-0001a7f0: 7065 2028 7374 7229 3a20 5370 6563 6966  pe (str): Specif
-0001a800: 6965 7320 7468 6520 7479 7065 206f 6620  ies the type of 
-0001a810: 7468 6520 6b65 7920 746f 2065 7870 6f72  the key to expor
-0001a820: 740d 0a20 2020 2020 2020 2020 2020 206e  t..            n
-0001a830: 616d 6520 2873 7472 293a 2053 7065 6369  ame (str): Speci
-0001a840: 6669 6573 2074 6865 206e 616d 6520 6f66  fies the name of
-0001a850: 2074 6865 206b 6579 2074 6f20 7265 6164   the key to read
-0001a860: 2069 6e66 6f72 6d61 7469 6f6e 2061 626f   information abo
-0001a870: 7574 0d0a 2020 2020 2020 2020 2020 2020  ut..            
-0001a880: 7665 7273 696f 6e20 2873 7472 2c20 6f70  version (str, op
-0001a890: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
-0001a8a0: 6573 2074 6865 2076 6572 7369 6f6e 206f  es the version o
-0001a8b0: 6620 7468 6520 6b65 7920 746f 2072 6561  f the key to rea
-0001a8c0: 642e 2049 6620 6f6d 6974 7465 642c 2061  d. If omitted, a
-0001a8d0: 6c6c 2076 6572 7369 6f6e 7320 6f66 2074  ll versions of t
-0001a8e0: 6865 206b 6579 2077 696c 6c20 6265 2072  he key will be r
-0001a8f0: 6574 7572 6e65 642e 200d 0a20 2020 2020  eturned. ..     
-0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a920: 5468 6973 2069 7320 7370 6563 6966 6965  This is specifie
-0001a930: 6420 6173 2070 6172 7420 6f66 2074 6865  d as part of the
-0001a940: 2055 524c 2e20 4966 2074 6865 2076 6572   URL. If the ver
-0001a950: 7369 6f6e 2069 7320 7365 7420 746f 206c  sion is set to l
-0001a960: 6174 6573 742c 2074 6865 2063 7572 7265  atest, the curre
-0001a970: 6e74 206b 6579 2077 696c 6c20 6265 200d  nt key will be .
-0001a980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9a0: 2020 2020 2020 7265 7475 726e 6564 2e20        returned. 
-0001a9b0: 4465 6661 756c 7473 2074 6f20 2222 2e0d  Defaults to ""..
-0001a9c0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0001a9d0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-0001a9e0: 2064 6963 7420 6f72 204e 6f6e 653a 2072   dict or None: r
-0001a9f0: 6574 7572 6e20 7468 6520 6b65 7920 696e  eturn the key in
-0001aa00: 2064 6963 7420 6966 2073 7563 6365 7373   dict if success
-0001aa10: 2c20 6f74 6865 7277 6973 6520 7265 7475  , otherwise retu
-0001aa20: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
-0001aa30: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-0001aa40: 2073 656c 662e 6973 5f61 7574 683a 0d0a   self.is_auth:..
-0001aa50: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
-0001aa60: 645f 6b65 795f 7479 7065 203d 205b 2265  d_key_type = ["e
-0001aa70: 6e63 7279 7074 696f 6e2d 6b65 7922 2c20  ncryption-key", 
-0001aa80: 2273 6967 6e69 6e67 2d6b 6579 222c 2022  "signing-key", "
-0001aa90: 686d 6163 2d6b 6579 222c 2022 7075 626c  hmac-key", "publ
-0001aaa0: 6963 2d6b 6579 222c 2022 6365 7274 6966  ic-key", "certif
-0001aab0: 6963 6174 652d 6368 6169 6e22 5d0d 0a20  icate-chain"].. 
-0001aac0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-0001aad0: 795f 7479 7065 206e 6f74 2069 6e20 7661  y_type not in va
-0001aae0: 6c69 645f 6b65 795f 7479 7065 3a0d 0a20  lid_key_type:.. 
-0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001ab00: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-0001ab10: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-0001ab20: 6e61 6d65 5f5f 7d20 2d20 6578 706f 7274  name__} - export
-0001ab30: 206b 6579 2065 7272 6f72 3a20 696e 7661   key error: inva
-0001ab40: 6c69 6420 6b65 795f 7479 7065 3a20 7b6b  lid key_type: {k
-0001ab50: 6579 5f74 7970 657d 2e20 5661 6c69 6420  ey_type}. Valid 
-0001ab60: 7661 6c75 6573 2061 7265 3a20 7b76 616c  values are: {val
-0001ab70: 6964 5f6b 6579 5f74 7970 657d 2229 0d0a  id_key_type}")..
-0001ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab90: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-0001aba0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-0001abb0: 2020 2020 2020 2065 7869 7374 5f6b 6579         exist_key
-0001abc0: 7320 3d20 7365 6c66 2e6c 6973 745f 6b65  s = self.list_ke
-0001abd0: 7928 6d6f 756e 745f 7061 7468 290d 0a20  y(mount_path).. 
-0001abe0: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-0001abf0: 6d65 206e 6f74 2069 6e20 6578 6973 745f  me not in exist_
-0001ac00: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
-0001ac10: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-0001ac20: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-0001ac30: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-0001ac40: 2d20 6578 706f 7274 206b 6579 2065 7272  - export key err
-0001ac50: 6f72 3a20 6b65 7920 277b 6e61 6d65 7d27  or: key '{name}'
-0001ac60: 206e 6f74 2066 6f75 6e64 2229 0d0a 2020   not found")..  
-0001ac70: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001ac80: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-0001ac90: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0001aca0: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
-0001acb0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-0001acc0: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
-0001acd0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
-0001ace0: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
-0001acf0: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
-0001ad00: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
-0001ad10: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
-0001ad20: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
-0001ad30: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
-0001ad40: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
-0001ad50: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
-0001ad60: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
-0001ad70: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
-0001ad80: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
-0001ad90: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
-0001ada0: 2075 726c 202b 3d20 6622 7b6d 6f75 6e74   url += f"{mount
-0001adb0: 5f70 6174 687d 2f65 7870 6f72 742f 7b6b  _path}/export/{k
-0001adc0: 6579 5f74 7970 657d 220d 0a20 2020 2020  ey_type}"..     
-0001add0: 2020 2020 2020 2069 6620 7665 7273 696f         if versio
-0001ade0: 6e20 213d 2022 223a 0d0a 2020 2020 2020  n != "":..      
-0001adf0: 2020 2020 2020 2020 2020 7572 6c20 2b3d            url +=
-0001ae00: 2066 222f 7b76 6572 7369 6f6e 7d22 0d0a   f"/{version}"..
-0001ae10: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-0001ae20: 3d20 7265 7175 6573 7473 2e67 6574 2875  = requests.get(u
-0001ae30: 726c 2c20 6865 6164 6572 733d 7b22 582d  rl, headers={"X-
-0001ae40: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
-0001ae50: 6b65 6e7d 290d 0a20 2020 2020 2020 2020  ken})..         
-0001ae60: 2020 2069 6620 7265 732e 7374 6174 7573     if res.status
-0001ae70: 5f63 6f64 6520 3d3d 2032 3030 206f 7220  _code == 200 or 
-0001ae80: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-0001ae90: 3d3d 2032 3034 3a0d 0a20 2020 2020 2020  == 204:..       
-0001aea0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001aeb0: 7265 732e 6a73 6f6e 2829 5b22 6461 7461  res.json()["data
-0001aec0: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
-0001aed0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0001aee0: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
-0001aef0: 5f65 7272 6f72 5f72 6573 706f 6e73 6528  _error_response(
-0001af00: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001af10: 5f5f 2c20 7265 732c 2022 6578 706f 7274  __, res, "export
-0001af20: 206b 6579 2065 7272 6f72 2229 0d0a 2020   key error")..  
-0001af30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001af40: 7475 726e 204e 6f6e 650d 0a0d 0a20 2020  turn None....   
-0001af50: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001af60: 0d0a 0d0a 2020 2020 6465 6620 7772 6974  ....    def writ
-0001af70: 655f 676c 6f62 616c 5f6b 6579 735f 636f  e_global_keys_co
-0001af80: 6e66 6967 2873 656c 662c 206d 6f75 6e74  nfig(self, mount
-0001af90: 5f70 6174 683a 2073 7472 2c20 6469 7361  _path: str, disa
-0001afa0: 626c 655f 7570 7365 7274 3a20 626f 6f6c  ble_upsert: bool
-0001afb0: 203d 2046 616c 7365 293a 0d0a 2020 2020   = False):..    
-0001afc0: 2020 2020 2222 2277 7269 7465 2067 6c6f      """write glo
-0001afd0: 6261 6c20 6b65 7920 636f 6e66 6967 7572  bal key configur
-0001afe0: 6174 696f 6e0d 0a0d 0a20 2020 2020 2020  ation....       
-0001aff0: 2052 6566 6572 2074 6f20 6874 7470 733a   Refer to https:
-0001b000: 2f2f 6465 7665 6c6f 7065 722e 6861 7368  //developer.hash
-0001b010: 6963 6f72 702e 636f 6d2f 7661 756c 742f  icorp.com/vault/
-0001b020: 6170 692d 646f 6373 2f73 6563 7265 742f  api-docs/secret/
-0001b030: 7472 616e 7369 7423 7772 6974 652d 6b65  transit#write-ke
-0001b040: 7973 2d63 6f6e 6669 6775 7261 7469 6f6e  ys-configuration
-0001b050: 2066 6f72 206d 6f72 6520 6465 7461 696c   for more detail
-0001b060: 732e 0d0a 0d0a 2020 2020 2020 2020 4172  s.....        Ar
-0001b070: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-0001b080: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
-0001b090: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-0001b0a0: 6973 6162 6c65 5f75 7073 6572 7420 2862  isable_upsert (b
-0001b0b0: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
-0001b0c0: 5370 6563 6966 6965 7320 7768 6574 6865  Specifies whethe
-0001b0d0: 7220 746f 2064 6973 6162 6c65 2075 7073  r to disable ups
-0001b0e0: 6572 7469 6e67 206f 6e20 656e 6372 7970  erting on encryp
-0001b0f0: 7469 6f6e 200d 0a20 2020 2020 2020 2020  tion ..         
-0001b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b120: 2020 2020 2861 7574 6f6d 6174 6963 2063      (automatic c
-0001b130: 7265 6174 696f 6e20 6f66 2075 6e6b 6e6f  reation of unkno
-0001b140: 776e 206b 6579 7329 2e20 4465 6661 756c  wn keys). Defaul
-0001b150: 7473 2074 6f20 4661 6c73 652e 0d0a 0d0a  ts to False.....
-0001b160: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-0001b170: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-0001b180: 6f6c 3a20 7265 7475 726e 2054 7275 6520  ol: return True 
-0001b190: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-0001b1a0: 7277 6973 6520 7265 7475 726e 2046 616c  rwise return Fal
-0001b1b0: 7365 0d0a 2020 2020 2020 2020 2222 220d  se..        """.
-0001b1c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0001b1d0: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-0001b1e0: 2020 2020 2020 2063 7572 7265 6e74 5f63         current_c
-0001b1f0: 6f6e 6669 6720 3d20 7365 6c66 2e72 6561  onfig = self.rea
-0001b200: 645f 676c 6f62 616c 5f6b 6579 735f 636f  d_global_keys_co
-0001b210: 6e66 6967 286d 6f75 6e74 5f70 6174 6829  nfig(mount_path)
-0001b220: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0001b230: 2063 7572 7265 6e74 5f63 6f6e 6669 6720   current_config 
-0001b240: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0001b250: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001b260: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0001b270: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0001b280: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
-0001b290: 7272 656e 745f 636f 6e66 6967 5b22 6469  rrent_config["di
-0001b2a0: 7361 626c 655f 7570 7365 7274 225d 203d  sable_upsert"] =
-0001b2b0: 3d20 6469 7361 626c 655f 7570 7365 7274  = disable_upsert
-0001b2c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001b2d0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-0001b2e0: 6572 2e77 6172 6e69 6e67 2866 227b 5f5f  er.warning(f"{__
-0001b2f0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0001b300: 7d20 2d20 7772 6974 6520 676c 6f62 616c  } - write global
-0001b310: 206b 6579 7320 636f 6e66 6967 2077 6172   keys config war
-0001b320: 6e69 6e67 3a20 6e6f 2063 6861 6e67 6520  ning: no change 
-0001b330: 6f6e 2064 6973 6162 6c65 5f75 7073 6572  on disable_upser
-0001b340: 7422 290d 0a20 2020 2020 2020 2020 2020  t")..           
-0001b350: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001b360: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-0001b370: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-0001b380: 2070 6179 6c6f 6164 203d 2064 6963 7428   payload = dict(
-0001b390: 6469 7361 626c 655f 7570 7365 7274 3d64  disable_upsert=d
-0001b3a0: 6973 6162 6c65 5f75 7073 6572 7429 0d0a  isable_upsert)..
-0001b3b0: 0d0a 2020 2020 2020 2020 2020 2020 7572  ..            ur
-0001b3c0: 6c20 3d20 6165 735f 6465 6372 7970 745f  l = aes_decrypt_
-0001b3d0: 7465 7874 2873 656c 662e 7572 6c2c 206b  text(self.url, k
-0001b3e0: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
-0001b3f0: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
-0001b400: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
-0001b410: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
-0001b420: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
-0001b430: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
-0001b440: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
-0001b450: 7874 2873 656c 662e 746f 6b65 6e2c 206b  xt(self.token, k
-0001b460: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
-0001b470: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
-0001b480: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
-0001b490: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
-0001b4a0: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
-0001b4b0: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
-0001b4c0: 7265 7175 6573 7473 2e70 6f73 7428 7572  requests.post(ur
-0001b4d0: 6c2b 6622 7b6d 6f75 6e74 5f70 6174 687d  l+f"{mount_path}
-0001b4e0: 2f63 6f6e 6669 672f 6b65 7973 2f22 2c20  /config/keys/", 
-0001b4f0: 6865 6164 6572 733d 7b22 582d 5661 756c  headers={"X-Vaul
-0001b500: 742d 546f 6b65 6e22 3a20 746f 6b65 6e7d  t-Token": token}
-0001b510: 2c20 6461 7461 3d6a 736f 6e2e 6475 6d70  , data=json.dump
-0001b520: 7328 7061 796c 6f61 6429 290d 0a20 2020  s(payload))..   
-0001b530: 2020 2020 2020 2020 2069 6620 7265 732e           if res.
-0001b540: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
-0001b550: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
-0001b560: 5f63 6f64 6520 3d3d 2032 3034 3a0d 0a20  _code == 204:.. 
-0001b570: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001b580: 6574 7572 6e20 5472 7565 0d0a 2020 2020  eturn True..    
-0001b590: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001b5b0: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
-0001b5c0: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
-0001b5d0: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
-0001b5e0: 2022 7772 6974 6520 676c 6f62 616c 206b   "write global k
-0001b5f0: 6579 7320 636f 6e66 6967 2065 7272 6f72  eys config error
-0001b600: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0001b610: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001b620: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-0001b630: 726e 2046 616c 7365 0d0a 0d0a 2020 2020  rn False....    
-0001b640: 6465 6620 7265 6164 5f67 6c6f 6261 6c5f  def read_global_
-0001b650: 6b65 7973 5f63 6f6e 6669 6728 7365 6c66  keys_config(self
-0001b660: 2c20 6d6f 756e 745f 7061 7468 3a20 7374  , mount_path: st
-0001b670: 7229 3a0d 0a20 2020 2020 2020 2022 2222  r):..        """
-0001b680: 7265 6164 2067 6c6f 6261 6c20 6b65 7920  read global key 
-0001b690: 636f 6e66 6967 7572 6174 696f 6e0d 0a0d  configuration...
-0001b6a0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-0001b6b0: 6f20 6874 7470 733a 2f2f 6465 7665 6c6f  o https://develo
-0001b6c0: 7065 722e 6861 7368 6963 6f72 702e 636f  per.hashicorp.co
-0001b6d0: 6d2f 7661 756c 742f 6170 692d 646f 6373  m/vault/api-docs
-0001b6e0: 2f73 6563 7265 742f 7472 616e 7369 7423  /secret/transit#
-0001b6f0: 7265 6164 2d6b 6579 732d 636f 6e66 6967  read-keys-config
-0001b700: 7572 6174 696f 6e20 666f 7220 6d6f 7265  uration for more
-0001b710: 2064 6574 6169 6c73 2e0d 0a0d 0a20 2020   details.....   
-0001b720: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
-0001b730: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
-0001b740: 7468 2028 7374 7229 0d0a 0d0a 2020 2020  th (str)....    
-0001b750: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
-0001b760: 2020 2020 2020 2020 2020 6469 6374 206f            dict o
-0001b770: 7220 4e6f 6e65 3a20 7265 7475 726e 2067  r None: return g
-0001b780: 6c6f 6261 6c20 6b65 7920 636f 6e66 6967  lobal key config
-0001b790: 7572 6174 696f 6e20 696e 2064 6963 7420  uration in dict 
-0001b7a0: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-0001b7b0: 7277 6973 6520 7265 7475 726e 204e 6f6e  rwise return Non
-0001b7c0: 650d 0a20 2020 2020 2020 2022 2222 0d0a  e..        """..
-0001b7d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001b7e0: 6973 5f61 7574 683a 0d0a 2020 2020 2020  is_auth:..      
-0001b7f0: 2020 2020 2020 7572 6c20 3d20 6165 735f        url = aes_
-0001b800: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
-0001b810: 662e 7572 6c2c 206b 6579 3d72 616e 646f  f.url, key=rando
-0001b820: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
-0001b830: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
-0001b840: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
-0001b850: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
-0001b860: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
-0001b870: 2020 746f 6b65 6e20 3d20 6165 735f 6465    token = aes_de
-0001b880: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
-0001b890: 746f 6b65 6e2c 206b 6579 3d72 616e 646f  token, key=rando
-0001b8a0: 6d5f 6865 7828 7365 6c66 2e5f 6b65 795f  m_hex(self._key_
-0001b8b0: 6c65 6e2c 2073 656c 662e 5f73 6565 642a  len, self._seed*
-0001b8c0: 3229 2c20 6976 3d72 616e 646f 6d5f 6865  2), iv=random_he
-0001b8d0: 7828 3136 2c20 7365 6c66 2e5f 7365 6564  x(16, self._seed
-0001b8e0: 2a33 2929 0d0a 2020 2020 2020 2020 2020  *3))..          
-0001b8f0: 2020 7265 7320 3d20 7265 7175 6573 7473    res = requests
-0001b900: 2e67 6574 2875 726c 2b66 227b 6d6f 756e  .get(url+f"{moun
-0001b910: 745f 7061 7468 7d2f 636f 6e66 6967 2f6b  t_path}/config/k
-0001b920: 6579 732f 222c 2068 6561 6465 7273 3d7b  eys/", headers={
-0001b930: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
-0001b940: 2074 6f6b 656e 7d29 0d0a 2020 2020 2020   token})..      
-0001b950: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
-0001b960: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
-0001b970: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
-0001b980: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
-0001b990: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001b9a0: 726e 2072 6573 2e6a 736f 6e28 295b 2264  rn res.json()["d
-0001b9b0: 6174 6122 5d0d 0a20 2020 2020 2020 2020  ata"]..         
-0001b9c0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0001b9d0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0001b9e0: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
-0001b9f0: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
-0001ba00: 616d 655f 5f2c 2072 6573 2c20 2272 6561  ame__, res, "rea
-0001ba10: 6420 676c 6f62 616c 206b 6579 7320 636f  d global keys co
-0001ba20: 6e66 6967 2065 7272 6f72 2229 0d0a 2020  nfig error")..  
-0001ba30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001ba40: 7475 726e 204e 6f6e 650d 0a0d 0a20 2020  turn None....   
-0001ba50: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001ba60: 0d0a 0d0a 2020 2020 2320 544f 444f 3a20  ....    # TODO: 
-0001ba70: 7761 6974 2066 6f72 2074 6573 7469 6e67  wait for testing
-0001ba80: 0d0a 2020 2020 6465 6620 656e 6372 7970  ..    def encryp
-0001ba90: 745f 6461 7461 2873 656c 662c 200d 0a20  t_data(self, .. 
-0001baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bab0: 2020 2020 6d6f 756e 745f 7061 7468 3a20      mount_path: 
-0001bac0: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
-0001bad0: 2020 2020 2020 2020 2020 206e 616d 653a             name:
-0001bae0: 2073 7472 2c0d 0a20 2020 2020 2020 2020   str,..         
-0001baf0: 2020 2020 2020 2020 2020 2020 706c 6169              plai
-0001bb00: 6e74 6578 743a 2073 7472 203d 2022 222c  ntext: str = "",
-0001bb10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001bb20: 2020 2020 2020 2061 7373 6f63 6961 7465         associate
-0001bb30: 645f 6461 7461 3a20 7374 7220 3d20 2222  d_data: str = ""
-0001bb40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001bb50: 2020 2020 2020 2020 636f 6e74 6578 743a          context:
-0001bb60: 2073 7472 203d 2022 222c 0d0a 2020 2020   str = "",..    
-0001bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb80: 206b 6579 5f76 6572 7369 6f6e 3a20 4f70   key_version: Op
-0001bb90: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
-0001bba0: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-0001bbb0: 2020 2020 2020 2020 2020 6e6f 6e63 653a            nonce:
-0001bbc0: 2073 7472 203d 2022 222c 0d0a 2020 2020   str = "",..    
-0001bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbe0: 2072 6566 6572 656e 6365 3a20 7374 7220   reference: str 
-0001bbf0: 3d20 2222 2c0d 0a20 2020 2020 2020 2020  = "",..         
-0001bc00: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-0001bc10: 685f 696e 7075 743a 204f 7074 696f 6e61  h_input: Optiona
-0001bc20: 6c5b 4c69 7374 5b64 6963 745d 5d20 3d20  l[List[dict]] = 
-0001bc30: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-0001bc40: 2020 2020 2020 2020 2020 2020 7061 7274              part
-0001bc50: 6961 6c5f 6661 696c 7572 655f 7265 7370  ial_failure_resp
-0001bc60: 6f6e 7365 5f63 6f64 653a 2069 6e74 203d  onse_code: int =
-0001bc70: 2034 3030 293a 0d0a 2020 2020 2020 2020   400):..        
-0001bc80: 2222 2265 6e63 7279 7074 2074 6865 2070  """encrypt the p
-0001bc90: 726f 7669 6465 6420 706c 6169 6e74 6578  rovided plaintex
-0001bca0: 7420 7573 696e 6720 7468 6520 6e61 6d65  t using the name
-0001bcb0: 6420 6b65 790d 0a0d 0a20 2020 2020 2020  d key....       
-0001bcc0: 204e 4f54 453a 2041 6c74 686f 7567 6820   NOTE: Although 
-0001bcd0: 7468 6520 4854 5450 2041 5049 206f 6620  the HTTP API of 
-0001bce0: 5661 756c 7420 616c 6c6f 7720 746f 2063  Vault allow to c
-0001bcf0: 7265 6174 6520 6b65 7920 7768 656e 2065  reate key when e
-0001bd00: 6e63 7279 7074 696e 6720 6461 7461 2c20  ncrypting data, 
-0001bd10: 7765 2068 6f70 6520 796f 7520 7573 6520  we hope you use 
-0001bd20: 6063 7265 6174 655f 6b65 7928 2960 2074  `create_key()` t
-0001bd30: 6f20 6372 6561 7465 206b 6579 2e20 0d0a  o create key. ..
-0001bd40: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-0001bd50: 7573 2c20 6974 2077 696c 6c20 7261 6973  us, it will rais
-0001bd60: 6520 6120 7761 726e 696e 6720 7768 656e  e a warning when
-0001bd70: 2073 7065 6369 6679 696e 6720 6120 6e6f   specifying a no
-0001bd80: 6e2d 6578 6973 7465 6e74 206b 6579 2e0d  n-existent key..
-0001bd90: 0a0d 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
-0001bda0: 2074 6f20 6874 7470 733a 2f2f 6465 7665   to https://deve
-0001bdb0: 6c6f 7065 722e 6861 7368 6963 6f72 702e  loper.hashicorp.
-0001bdc0: 636f 6d2f 7661 756c 742f 6170 692d 646f  com/vault/api-do
-0001bdd0: 6373 2f73 6563 7265 742f 7472 616e 7369  cs/secret/transi
-0001bde0: 7423 656e 6372 7970 742d 6461 7461 2066  t#encrypt-data f
-0001bdf0: 6f72 206d 6f72 6520 6465 7461 696c 732e  or more details.
-0001be00: 0d0a 0d0a 2020 2020 2020 2020 4172 6773  ....        Args
-0001be10: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-0001be20: 6f75 6e74 5f70 6174 6820 2873 7472 290d  ount_path (str).
-0001be30: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-0001be40: 6520 2873 7472 293a 2053 7065 6369 6669  e (str): Specifi
-0001be50: 6573 2074 6865 206e 616d 6520 6f66 2074  es the name of t
-0001be60: 6865 2065 6e63 7279 7074 696f 6e20 6b65  he encryption ke
-0001be70: 7920 746f 2065 6e63 7279 7074 2061 6761  y to encrypt aga
-0001be80: 696e 7374 0d0a 2020 2020 2020 2020 2020  inst..          
-0001be90: 2020 706c 6169 6e74 6578 7420 2873 7472    plaintext (str
-0001bea0: 2c20 6f70 7469 6f6e 616c 293a 2053 7065  , optional): Spe
-0001beb0: 6369 6669 6573 2062 6173 6536 3420 656e  cifies base64 en
-0001bec0: 636f 6465 6420 706c 6169 6e74 6578 7420  coded plaintext 
-0001bed0: 746f 2062 6520 656e 636f 6465 642e 2044  to be encoded. D
-0001bee0: 6566 6175 6c74 7320 746f 2022 222e 0d0a  efaults to ""...
-0001bef0: 2020 2020 2020 2020 2020 2020 6173 736f              asso
-0001bf00: 6369 6174 6564 5f64 6174 6120 2873 7472  ciated_data (str
-0001bf10: 2c20 6f70 7469 6f6e 616c 293a 2053 7065  , optional): Spe
-0001bf20: 6369 6669 6573 2062 6173 6536 3420 656e  cifies base64 en
-0001bf30: 636f 6465 6420 6173 736f 6369 6174 6564  coded associated
-0001bf40: 2064 6174 6120 2861 6c73 6f20 6b6e 6f77   data (also know
-0001bf50: 6e20 6173 2061 6464 6974 696f 6e61 6c20  n as additional 
-0001bf60: 6461 7461 206f 7220 4141 4429 200d 0a20  data or AAD) .. 
-0001bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf90: 2020 2020 2020 2020 2020 2020 746f 2061              to a
-0001bfa0: 6c73 6f20 6265 2061 7574 6865 6e74 6963  lso be authentic
-0001bfb0: 6174 6564 2077 6974 6820 4145 4144 2063  ated with AEAD c
-0001bfc0: 6970 6865 7273 2028 6061 6573 3132 382d  iphers (`aes128-
-0001bfd0: 6763 6d39 3660 2c20 6061 6573 3235 362d  gcm96`, `aes256-
-0001bfe0: 6763 6d60 2c20 616e 6420 0d0a 2020 2020  gcm`, and ..    
-0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c010: 2020 2020 2020 2020 2060 6368 6163 6861           `chacha
-0001c020: 3230 2d70 6f6c 7931 3330 3560 292e 2044  20-poly1305`). D
-0001c030: 6566 6175 6c74 7320 746f 2022 222e 0d0a  efaults to ""...
-0001c040: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001c050: 6578 7420 2873 7472 2c20 6f70 7469 6f6e  ext (str, option
-0001c060: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
-0001c070: 6865 2062 6173 6536 3420 656e 636f 6465  he base64 encode
-0001c080: 6420 636f 6e74 6578 7420 666f 7220 6b65  d context for ke
-0001c090: 7920 6465 7269 7661 7469 6f6e 2e20 5468  y derivation. Th
-0001c0a0: 6973 2069 7320 7265 7175 6972 6564 2069  is is required i
-0001c0b0: 6620 6b65 7920 6465 7269 7661 7469 6f6e  f key derivation
-0001c0c0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0001c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0e0: 2020 2020 2020 2020 6973 2065 6e61 626c          is enabl
-0001c0f0: 6564 2066 6f72 2074 6869 7320 6b65 792e  ed for this key.
-0001c100: 2044 6566 6175 6c74 7320 746f 2022 222e   Defaults to "".
-0001c110: 0d0a 2020 2020 2020 2020 2020 2020 6b65  ..            ke
-0001c120: 795f 7665 7273 696f 6e20 284f 7074 696f  y_version (Optio
-0001c130: 6e61 6c5b 696e 745d 2c20 6f70 7469 6f6e  nal[int], option
-0001c140: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
-0001c150: 6865 2076 6572 7369 6f6e 206f 6620 7468  he version of th
-0001c160: 6520 6b65 7920 746f 2075 7365 2066 6f72  e key to use for
-0001c170: 2065 6e63 7279 7074 696f 6e2e 2049 6620   encryption. If 
-0001c180: 6e6f 7420 7365 742c 2075 7365 7320 7468  not set, uses th
-0001c190: 6520 0d0a 2020 2020 2020 2020 2020 2020  e ..            
-0001c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1c0: 2020 2020 2020 206c 6174 6573 7420 7665         latest ve
-0001c1d0: 7273 696f 6e2e 204d 7573 7420 6265 2067  rsion. Must be g
-0001c1e0: 7265 6174 6572 2074 6861 6e20 6f72 2065  reater than or e
-0001c1f0: 7175 616c 2074 6f20 7468 6520 6b65 7927  qual to the key'
-0001c200: 7320 606d 696e 5f65 6e63 7279 7074 696f  s `min_encryptio
-0001c210: 6e5f 7665 7273 696f 6e60 2c20 0d0a 2020  n_version`, ..  
-0001c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c250: 2069 6620 7365 742e 2044 6566 6175 6c74   if set. Default
-0001c260: 7320 746f 204e 6f6e 652e 0d0a 2020 2020  s to None...    
-0001c270: 2020 2020 2020 2020 6e6f 6e63 6520 2873          nonce (s
-0001c280: 7472 2c20 6f70 7469 6f6e 616c 293a 2053  tr, optional): S
-0001c290: 7065 6369 6669 6573 2074 6865 2062 6173  pecifies the bas
-0001c2a0: 6536 3420 656e 636f 6465 6420 6e6f 6e63  e64 encoded nonc
-0001c2b0: 6520 7661 6c75 652e 2054 6869 7320 6d75  e value. This mu
-0001c2c0: 7374 2062 6520 7072 6f76 6964 6564 2069  st be provided i
-0001c2d0: 6620 636f 6e76 6572 6765 6e74 2065 6e63  f convergent enc
-0001c2e0: 7279 7074 696f 6e20 6973 200d 0a20 2020  ryption is ..   
-0001c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c310: 656e 6162 6c65 6420 666f 7220 7468 6973  enabled for this
-0001c320: 206b 6579 2061 6e64 2074 6865 206b 6579   key and the key
-0001c330: 2077 6173 2067 656e 6572 6174 6564 2077   was generated w
-0001c340: 6974 6820 5661 756c 7420 302e 362e 312e  ith Vault 0.6.1.
-0001c350: 204e 6f74 2072 6571 7569 7265 6420 666f   Not required fo
-0001c360: 7220 6b65 7973 2063 7265 6174 6564 200d  r keys created .
-0001c370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c390: 2020 2020 696e 2030 2e36 2e32 2b2e 2054      in 0.6.2+. T
-0001c3a0: 6865 2076 616c 7565 206d 7573 7420 6265  he value must be
-0001c3b0: 2065 7861 6374 6c79 2039 3620 6269 7473   exactly 96 bits
-0001c3c0: 2028 3132 2062 7974 6573 2920 6c6f 6e67   (12 bytes) long
-0001c3d0: 2061 6e64 2074 6865 2075 7365 7220 6d75   and the user mu
-0001c3e0: 7374 2065 6e73 7572 6520 7468 6174 2066  st ensure that f
-0001c3f0: 6f72 200d 0a20 2020 2020 2020 2020 2020  or ..           
-0001c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c410: 2020 2020 2020 2020 616e 7920 6769 7665          any give
-0001c420: 6e20 636f 6e74 6578 7420 2861 6e64 2074  n context (and t
-0001c430: 6875 732c 2061 6e79 2067 6976 656e 2065  hus, any given e
-0001c440: 6e63 7279 7074 696f 6e20 6b65 7929 2074  ncryption key) t
-0001c450: 6869 7320 6e6f 6e63 6520 7661 6c75 6520  his nonce value 
-0001c460: 6973 206e 6576 6572 2072 6575 7365 642e  is never reused.
-0001c470: 2044 6566 6175 6c74 7320 0d0a 2020 2020   Defaults ..    
-0001c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c490: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001c4a0: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-0001c4b0: 2020 2072 6566 6572 656e 6365 2028 7374     reference (st
-0001c4c0: 722c 206f 7074 696f 6e61 6c29 3a20 4120  r, optional): A 
-0001c4d0: 7573 6572 2d73 7570 706c 6965 6420 7374  user-supplied st
-0001c4e0: 7269 6e67 2074 6861 7420 7769 6c6c 2062  ring that will b
-0001c4f0: 6520 7072 6573 656e 7420 696e 2074 6865  e present in the
-0001c500: 2060 7265 6665 7265 6e63 6560 2066 6965   `reference` fie
-0001c510: 6c64 206f 6e20 7468 6520 636f 7272 6573  ld on the corres
-0001c520: 706f 6e64 696e 6720 0d0a 2020 2020 2020  ponding ..      
-0001c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c550: 2060 6261 7463 685f 7265 7375 6c74 7360   `batch_results`
-0001c560: 2069 7465 6d20 696e 2074 6865 2072 6573   item in the res
-0001c570: 706f 6e73 652c 2074 6f20 6173 7369 7374  ponse, to assist
-0001c580: 2069 6e20 756e 6465 7273 7461 6e64 696e   in understandin
-0001c590: 6720 7768 6963 6820 7265 7375 6c74 2063  g which result c
-0001c5a0: 6f72 7265 7370 6f6e 6473 200d 0a20 2020  orresponds ..   
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5d0: 2020 2020 746f 2061 2070 6172 7469 6375      to a particu
-0001c5e0: 6c61 7220 696e 7075 742e 204f 6e6c 7920  lar input. Only 
-0001c5f0: 7661 6c69 6420 6f6e 2062 6174 6368 2072  valid on batch r
-0001c600: 6571 7565 7374 7320 7768 656e 2075 7369  equests when usi
-0001c610: 6e67 20e2 8098 6261 7463 685f 696e 7075  ng ...batch_inpu
-0001c620: 74e2 8099 2062 656c 6f77 2e20 4465 6661  t... below. Defa
-0001c630: 756c 7473 200d 0a20 2020 2020 2020 2020  ults ..         
-0001c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c650: 2020 2020 2020 2020 2020 2020 2020 746f                to
-0001c660: 2022 222e 0d0a 2020 2020 2020 2020 2020   ""...          
-0001c670: 2020 6261 7463 685f 696e 7075 7420 284f    batch_input (O
-0001c680: 7074 696f 6e61 6c5b 4c69 7374 5b64 6963  ptional[List[dic
-0001c690: 745d 5d2c 206f 7074 696f 6e61 6c29 3a20  t]], optional): 
-0001c6a0: 5370 6563 6966 6965 7320 6120 6c69 7374  Specifies a list
-0001c6b0: 206f 6620 6974 656d 7320 746f 2062 6520   of items to be 
-0001c6c0: 656e 6372 7970 7465 6420 696e 2061 2073  encrypted in a s
-0001c6d0: 696e 676c 6520 6261 7463 682e 2057 6865  ingle batch. Whe
-0001c6e0: 6e20 7468 6973 200d 0a20 2020 2020 2020  n this ..       
-0001c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178b0: 2021 3d20 6375 725f 696e 666f 5b22 6d69   != cur_info["mi
+000178c0: 6e5f 6465 6372 7970 7469 6f6e 5f76 6572  n_decryption_ver
+000178d0: 7369 6f6e 225d 3a0d 0a20 2020 2020 2020  sion"]:..       
+000178e0: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+000178f0: 5b22 6d69 6e5f 6465 6372 7970 7469 6f6e  ["min_decryption
+00017900: 5f76 6572 7369 6f6e 225d 203d 206d 696e  _version"] = min
+00017910: 5f64 6563 7279 7074 696f 6e5f 7665 7273  _decryption_vers
+00017920: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+00017930: 2020 2020 2068 6173 5f63 6861 6e67 6520       has_change 
+00017940: 3d20 5472 7565 0d0a 0d0a 2020 2020 2020  = True....      
+00017950: 2020 2020 2020 6966 206d 696e 5f65 6e63        if min_enc
+00017960: 7279 7074 696f 6e5f 7665 7273 696f 6e20  ryption_version 
+00017970: 213d 2063 7572 5f69 6e66 6f5b 226d 696e  != cur_info["min
+00017980: 5f65 6e63 7279 7074 696f 6e5f 7665 7273  _encryption_vers
+00017990: 696f 6e22 5d3a 0d0a 2020 2020 2020 2020  ion"]:..        
+000179a0: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
+000179b0: 226d 696e 5f65 6e63 7279 7074 696f 6e5f  "min_encryption_
+000179c0: 7665 7273 696f 6e22 5d20 3d20 6d69 6e5f  version"] = min_
+000179d0: 656e 6372 7970 7469 6f6e 5f76 6572 7369  encryption_versi
+000179e0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+000179f0: 2020 2020 6861 735f 6368 616e 6765 203d      has_change =
+00017a00: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
+00017a10: 2020 2020 2069 6620 6465 6c65 7469 6f6e       if deletion
+00017a20: 5f61 6c6c 6f77 6564 2021 3d20 6375 725f  _allowed != cur_
+00017a30: 696e 666f 5b22 6465 6c65 7469 6f6e 5f61  info["deletion_a
+00017a40: 6c6c 6f77 6564 225d 3a0d 0a20 2020 2020  llowed"]:..     
+00017a50: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
+00017a60: 6164 5b22 6465 6c65 7469 6f6e 5f61 6c6c  ad["deletion_all
+00017a70: 6f77 6564 225d 203d 2064 656c 6574 696f  owed"] = deletio
+00017a80: 6e5f 616c 6c6f 7765 640d 0a20 2020 2020  n_allowed..     
+00017a90: 2020 2020 2020 2020 2020 2068 6173 5f63             has_c
+00017aa0: 6861 6e67 6520 3d20 5472 7565 0d0a 0d0a  hange = True....
+00017ab0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00017ac0: 7870 6f72 7461 626c 6520 213d 2063 7572  xportable != cur
+00017ad0: 5f69 6e66 6f5b 2265 7870 6f72 7461 626c  _info["exportabl
+00017ae0: 6522 5d3a 0d0a 2020 2020 2020 2020 2020  e"]:..          
+00017af0: 2020 2020 2020 6966 2063 7572 5f69 6e66        if cur_inf
+00017b00: 6f5b 2265 7870 6f72 7461 626c 6522 5d3a  o["exportable"]:
+00017b10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017b20: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00017b30: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
+00017b40: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+00017b50: 2075 7064 6174 6520 6b65 7920 636f 6e66   update key conf
+00017b60: 6967 2065 7272 6f72 3a20 6f6e 6365 2073  ig error: once s
+00017b70: 6574 2065 7870 6f72 7461 626c 653d 5472  et exportable=Tr
+00017b80: 7565 2c20 220d 0a20 2020 2020 2020 2020  ue, "..         
+00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ba0: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
+00017bb0: 6869 7320 6361 6e6e 6f74 2062 6520 6469  his cannot be di
+00017bc0: 7361 626c 6564 2229 0d0a 2020 2020 2020  sabled")..      
+00017bd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00017be0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00017bf0: 2020 2020 2020 2020 2020 2020 7061 796c              payl
+00017c00: 6f61 645b 2265 7870 6f72 7461 626c 6522  oad["exportable"
+00017c10: 5d20 3d20 6578 706f 7274 6162 6c65 0d0a  ] = exportable..
+00017c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c30: 6861 735f 6368 616e 6765 203d 2054 7275  has_change = Tru
+00017c40: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00017c50: 2069 6620 616c 6c6f 775f 706c 6169 6e74   if allow_plaint
+00017c60: 6578 745f 6261 636b 7570 2021 3d20 6375  ext_backup != cu
+00017c70: 725f 696e 666f 5b22 616c 6c6f 775f 706c  r_info["allow_pl
+00017c80: 6169 6e74 6578 745f 6261 636b 7570 225d  aintext_backup"]
+00017c90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00017ca0: 2020 2069 6620 6375 725f 696e 666f 5b22     if cur_info["
+00017cb0: 616c 6c6f 775f 706c 6169 6e74 6578 745f  allow_plaintext_
+00017cc0: 6261 636b 7570 225d 3a0d 0a20 2020 2020  backup"]:..     
+00017cd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00017ce0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+00017cf0: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+00017d00: 6e61 6d65 5f5f 7d20 2d20 7570 6461 7465  name__} - update
+00017d10: 206b 6579 2063 6f6e 6669 6720 6572 726f   key config erro
+00017d20: 723a 206f 6e63 6520 7365 7420 616c 6c6f  r: once set allo
+00017d30: 775f 706c 6169 6e74 6578 745f 6261 636b  w_plaintext_back
+00017d40: 7570 3d54 7275 652c 2022 0d0a 2020 2020  up=True, "..    
+00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d70: 2020 6622 7468 6973 2063 616e 6e6f 7420    f"this cannot 
+00017d80: 6265 2064 6973 6162 6c65 6422 290d 0a20  be disabled").. 
+00017d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017da0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00017db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017dc0: 2070 6179 6c6f 6164 5b22 616c 6c6f 775f   payload["allow_
+00017dd0: 706c 6169 6e74 6578 745f 6261 636b 7570  plaintext_backup
+00017de0: 225d 203d 2061 6c6c 6f77 5f70 6c61 696e  "] = allow_plain
+00017df0: 7465 7874 5f62 6163 6b75 700d 0a20 2020  text_backup..   
+00017e00: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00017e10: 5f63 6861 6e67 6520 3d20 5472 7565 0d0a  _change = True..
+00017e20: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00017e30: 2061 7574 6f5f 726f 7461 7465 5f70 6572   auto_rotate_per
+00017e40: 696f 6420 213d 2022 223a 0d0a 2020 2020  iod != "":..    
+00017e50: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00017e60: 6f74 6174 655f 7065 7269 6f64 2e76 616c  otate_period.val
+00017e70: 7565 203e 2030 3a0d 0a20 2020 2020 2020  ue > 0:..       
+00017e80: 2020 2020 2020 2020 2020 2020 2072 6f74               rot
+00017e90: 6174 655f 7065 7269 6f64 203d 2056 6175  ate_period = Vau
+00017ea0: 6c74 4475 7261 7469 6f6e 2861 7574 6f5f  ltDuration(auto_
+00017eb0: 726f 7461 7465 5f70 6572 696f 6429 0d0a  rotate_period)..
+00017ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ed0: 2020 2020 6c6f 7765 725f 7065 7269 6f64      lower_period
+00017ee0: 203d 2056 6175 6c74 4475 7261 7469 6f6e   = VaultDuration
+00017ef0: 2822 3168 2229 0d0a 2020 2020 2020 2020  ("1h")..        
+00017f00: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00017f10: 6f74 6174 655f 7065 7269 6f64 203c 206c  otate_period < l
+00017f20: 6f77 6572 5f70 6572 696f 643a 0d0a 2020  ower_period:..  
+00017f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f40: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00017f50: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
+00017f60: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+00017f70: 2075 7064 6174 6520 6b65 7920 636f 6e66   update key conf
+00017f80: 6967 2065 7272 6f72 3a20 5468 6520 7661  ig error: The va
+00017f90: 6c75 6520 6f66 2061 7574 6f5f 726f 7461  lue of auto_rota
+00017fa0: 7465 5f70 6572 696f 6420 220d 0a20 2020  te_period "..   
+00017fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fd0: 2020 2020 2020 2066 2263 616e 6e6f 7420         f"cannot 
+00017fe0: 6265 2073 686f 7274 6572 2074 6861 6e20  be shorter than 
+00017ff0: 6f6e 6520 686f 7572 2229 0d0a 2020 2020  one hour")..    
+00018000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018010: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00018020: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018030: 2020 7061 796c 6f61 645b 2261 7574 6f5f    payload["auto_
+00018040: 726f 7461 7465 5f70 6572 696f 6422 5d20  rotate_period"] 
+00018050: 3d20 6175 746f 5f72 6f74 6174 655f 7065  = auto_rotate_pe
+00018060: 7269 6f64 0d0a 0d0a 2020 2020 2020 2020  riod....        
+00018070: 2020 2020 6966 2068 6173 5f63 6861 6e67      if has_chang
+00018080: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00018090: 2020 2020 7572 6c20 3d20 6165 735f 6465      url = aes_de
+000180a0: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
+000180b0: 7572 6c2c 206b 6579 3d72 616e 646f 6d5f  url, key=random_
+000180c0: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
+000180d0: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
+000180e0: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
+000180f0: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
+00018100: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00018110: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
+00018120: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
+00018130: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
+00018140: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
+00018150: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
+00018160: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
+00018170: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
+00018180: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
+00018190: 2020 2020 2020 2020 7265 7320 3d20 7265          res = re
+000181a0: 7175 6573 7473 2e70 6f73 7428 7572 6c2b  quests.post(url+
+000181b0: 6622 7b6d 6f75 6e74 5f70 6174 687d 2f6b  f"{mount_path}/k
+000181c0: 6579 732f 7b6e 616d 657d 2f63 6f6e 6669  eys/{name}/confi
+000181d0: 6722 2c20 6865 6164 6572 733d 7b22 582d  g", headers={"X-
+000181e0: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
+000181f0: 6b65 6e7d 2c20 6461 7461 3d6a 736f 6e2e  ken}, data=json.
+00018200: 6475 6d70 7328 7061 796c 6f61 6429 290d  dumps(payload)).
+00018210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018220: 2069 6620 7265 732e 7374 6174 7573 5f63   if res.status_c
+00018230: 6f64 6520 3d3d 2032 3030 206f 7220 7265  ode == 200 or re
+00018240: 732e 7374 6174 7573 5f63 6f64 6520 3d3d  s.status_code ==
+00018250: 2032 3034 3a0d 0a20 2020 2020 2020 2020   204:..         
+00018260: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00018270: 6e20 5472 7565 0d0a 2020 2020 2020 2020  n True..        
+00018280: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182a0: 2020 2073 656c 662e 5f6c 6f67 5f65 7272     self._log_err
+000182b0: 6f72 5f72 6573 706f 6e73 6528 5f5f 636c  or_response(__cl
+000182c0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
+000182d0: 7265 732c 2022 7570 6461 7465 206b 6579  res, "update key
+000182e0: 2063 6f6e 6669 6720 6572 726f 7222 290d   config error").
+000182f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018300: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00018310: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+00018320: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00018330: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00018340: 722e 7761 726e 696e 6728 6622 7b5f 5f63  r.warning(f"{__c
+00018350: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00018360: 202d 2075 7064 6174 6520 6b65 7920 636f   - update key co
+00018370: 6e66 6967 2077 6172 6e69 6e67 3a20 6e6f  nfig warning: no
+00018380: 2063 6861 6e67 6573 2229 0d0a 2020 2020   changes")..    
+00018390: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000183a0: 726e 2054 7275 650d 0a0d 0a20 2020 2020  rn True....     
+000183b0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+000183c0: 0a0d 0a20 2020 2064 6566 2072 6f74 6174  ...    def rotat
+000183d0: 655f 6b65 7928 7365 6c66 2c20 6d6f 756e  e_key(self, moun
+000183e0: 745f 7061 7468 3a20 7374 722c 206e 616d  t_path: str, nam
+000183f0: 653a 2073 7472 293a 0d0a 2020 2020 2020  e: str):..      
+00018400: 2020 2222 2272 6f74 6174 6520 7468 6520    """rotate the 
+00018410: 7665 7273 696f 6e20 6f66 2074 6865 206e  version of the n
+00018420: 616d 6564 206b 6579 0d0a 0d0a 2020 2020  amed key....    
+00018430: 2020 2020 4166 7465 7220 726f 7461 7469      After rotati
+00018440: 6f6e 2c20 6e65 7720 706c 6169 6e74 6578  on, new plaintex
+00018450: 7420 7265 7175 6573 7473 2077 696c 6c20  t requests will 
+00018460: 6265 2065 6e63 7279 7074 6564 2077 6974  be encrypted wit
+00018470: 6820 7468 6520 6e65 7720 7665 7273 696f  h the new versio
+00018480: 6e20 6f66 2074 6865 206b 6579 2e20 0d0a  n of the key. ..
+00018490: 2020 2020 2020 2020 546f 2075 7067 7261          To upgra
+000184a0: 6465 2063 6970 6865 7274 6578 7420 746f  de ciphertext to
+000184b0: 2062 6520 656e 6372 7970 7465 6420 7769   be encrypted wi
+000184c0: 7468 2074 6865 206c 6174 6573 7420 7665  th the latest ve
+000184d0: 7273 696f 6e20 6f66 2074 6865 206b 6579  rsion of the key
+000184e0: 2c20 7573 6520 7468 6520 7265 7772 6170  , use the rewrap
+000184f0: 200d 0a20 2020 2020 2020 2065 6e64 706f   ..        endpo
+00018500: 696e 742e 2054 6869 7320 6973 206f 6e6c  int. This is onl
+00018510: 7920 7375 7070 6f72 7465 6420 7769 7468  y supported with
+00018520: 206b 6579 7320 7468 6174 2073 7570 706f   keys that suppo
+00018530: 7274 2065 6e63 7279 7074 696f 6e20 616e  rt encryption an
+00018540: 6420 6465 6372 7970 7469 6f6e 206f 7065  d decryption ope
+00018550: 7261 7469 6f6e 732e 0d0a 0d0a 2020 2020  rations.....    
+00018560: 2020 2020 5265 6665 7220 746f 2068 7474      Refer to htt
+00018570: 7073 3a2f 2f64 6576 656c 6f70 6572 2e68  ps://developer.h
+00018580: 6173 6869 636f 7270 2e63 6f6d 2f76 6175  ashicorp.com/vau
+00018590: 6c74 2f61 7069 2d64 6f63 732f 7365 6372  lt/api-docs/secr
+000185a0: 6574 2f74 7261 6e73 6974 2372 6f74 6174  et/transit#rotat
+000185b0: 652d 6b65 7920 666f 7220 6d6f 7265 2064  e-key for more d
+000185c0: 6574 6169 6c73 2e0d 0a0d 0a20 2020 2020  etails.....     
+000185d0: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+000185e0: 2020 2020 2020 6d6f 756e 745f 7061 7468        mount_path
+000185f0: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
+00018600: 2020 2020 6e61 6d65 2028 7374 7229 3a20      name (str): 
+00018610: 5370 6563 6966 6965 7320 7468 6520 6e61  Specifies the na
+00018620: 6d65 206f 6620 7468 6520 6b65 7920 746f  me of the key to
+00018630: 2072 6f74 6174 650d 0a0d 0a20 2020 2020   rotate....     
+00018640: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
+00018650: 2020 2020 2020 2020 2062 6f6f 6c3a 2072           bool: r
+00018660: 6574 7572 6e20 5472 7565 2069 6620 7375  eturn True if su
+00018670: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
+00018680: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+00018690: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000186a0: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
+000186b0: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
+000186c0: 2020 6578 6973 745f 6b65 7973 203d 2073    exist_keys = s
+000186d0: 656c 662e 6c69 7374 5f6b 6579 286d 6f75  elf.list_key(mou
+000186e0: 6e74 5f70 6174 6829 0d0a 2020 2020 2020  nt_path)..      
+000186f0: 2020 2020 2020 6966 206e 616d 6520 6e6f        if name no
+00018700: 7420 696e 2065 7869 7374 5f6b 6579 733a  t in exist_keys:
+00018710: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018720: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+00018730: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+00018740: 2e5f 5f6e 616d 655f 5f7d 202d 2072 6f74  .__name__} - rot
+00018750: 6174 6520 6b65 7920 6572 726f 723a 206b  ate key error: k
+00018760: 6579 2027 7b6e 616d 657d 2720 6e6f 7420  ey '{name}' not 
+00018770: 666f 756e 6422 290d 0a20 2020 2020 2020  found")..       
+00018780: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018790: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+000187a0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+000187b0: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
+000187c0: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
+000187d0: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+000187e0: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+000187f0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00018800: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00018810: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+00018820: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+00018830: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
+00018840: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
+00018850: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+00018860: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+00018870: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00018880: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00018890: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+000188a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000188b0: 203d 2072 6571 7565 7374 732e 706f 7374   = requests.post
+000188c0: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
+000188d0: 7468 7d2f 6b65 7973 2f7b 6e61 6d65 7d2f  th}/keys/{name}/
+000188e0: 726f 7461 7465 222c 2068 6561 6465 7273  rotate", headers
+000188f0: 3d7b 2258 2d56 6175 6c74 2d54 6f6b 656e  ={"X-Vault-Token
+00018900: 223a 2074 6f6b 656e 7d29 0d0a 2020 2020  ": token})..    
+00018910: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
+00018920: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+00018930: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
+00018940: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
+00018950: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00018960: 7475 726e 2054 7275 650d 0a20 2020 2020  turn True..     
+00018970: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00018980: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00018990: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+000189a0: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+000189b0: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+000189c0: 2272 6f74 6174 6520 6b65 7920 6572 726f  "rotate key erro
+000189d0: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
+000189e0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000189f0: 650d 0a0d 0a20 2020 2020 2020 2072 6574  e....        ret
+00018a00: 7572 6e20 4661 6c73 650d 0a0d 0a20 2020  urn False....   
+00018a10: 2023 2054 4f44 4f3a 2077 6169 7420 666f   # TODO: wait fo
+00018a20: 7220 7465 7374 696e 670d 0a20 2020 2064  r testing..    d
+00018a30: 6566 2073 6967 6e5f 6373 7228 7365 6c66  ef sign_csr(self
+00018a40: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+00018a50: 2020 2020 206d 6f75 6e74 5f70 6174 683a       mount_path:
+00018a60: 2073 7472 2c0d 0a20 2020 2020 2020 2020   str,..         
+00018a70: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
+00018a80: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+00018a90: 2020 2020 2076 6572 7369 6f6e 3a20 7374       version: st
+00018aa0: 7220 3d20 2222 2c0d 0a20 2020 2020 2020  r = "",..       
+00018ab0: 2020 2020 2020 2020 2020 6373 723a 2073            csr: s
+00018ac0: 7472 203d 2022 2229 3a0d 0a20 2020 2020  tr = ""):..     
+00018ad0: 2020 2022 2222 7369 676e 7320 6120 4353     """signs a CS
+00018ae0: 5220 7769 7468 2074 6865 206e 616d 6564  R with the named
+00018af0: 206b 6579 0d0a 0d0a 2020 2020 2020 2020   key....        
+00018b00: 416c 6c6f 7769 6e67 2074 6865 206b 6579  Allowing the key
+00018b10: 206d 6174 6572 6961 6c20 6e65 7665 7220   material never 
+00018b20: 746f 206c 6561 7665 2054 7261 6e73 6974  to leave Transit
+00018b30: 2e20 4966 206e 6f20 7465 6d70 6c61 7465  . If no template
+00018b40: 2043 5352 2069 7320 7370 6563 6966 6965   CSR is specifie
+00018b50: 642c 200d 0a20 2020 2020 2020 2061 6e20  d, ..        an 
+00018b60: 656d 7074 7920 4353 5220 6973 2073 6967  empty CSR is sig
+00018b70: 6e65 642c 206f 7468 6572 7769 7365 2c20  ned, otherwise, 
+00018b80: 6120 636f 7079 206f 6620 7468 6520 7370  a copy of the sp
+00018b90: 6563 6966 6965 6420 4353 5220 7769 7468  ecified CSR with
+00018ba0: 206b 6579 206d 6174 6572 6961 6c20 0d0a   key material ..
+00018bb0: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
+00018bc0: 2077 6974 6820 7468 6973 206b 6579 206d   with this key m
+00018bd0: 6174 6572 6961 6c20 6973 2073 6967 6e65  aterial is signe
+00018be0: 642e 0d0a 0d0a 2020 2020 2020 2020 5265  d.....        Re
+00018bf0: 6665 7220 746f 2068 7474 7073 3a2f 2f64  fer to https://d
+00018c00: 6576 656c 6f70 6572 2e68 6173 6869 636f  eveloper.hashico
+00018c10: 7270 2e63 6f6d 2f76 6175 6c74 2f61 7069  rp.com/vault/api
+00018c20: 2d64 6f63 732f 7365 6372 6574 2f74 7261  -docs/secret/tra
+00018c30: 6e73 6974 2373 6967 6e2d 6373 7220 666f  nsit#sign-csr fo
+00018c40: 7220 6d6f 7265 2064 6574 6169 6c73 2e0d  r more details..
+00018c50: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00018c60: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+00018c70: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
+00018c80: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00018c90: 2028 7374 7229 3a20 5370 6563 6966 6965   (str): Specifie
+00018ca0: 7320 7468 6520 6e61 6d65 206f 6620 7468  s the name of th
+00018cb0: 6520 6b65 7920 746f 2073 6967 6e20 7468  e key to sign th
+00018cc0: 6520 4353 5220 7769 7468 2e0d 0a20 2020  e CSR with...   
+00018cd0: 2020 2020 2020 2020 2076 6572 7369 6f6e           version
+00018ce0: 2028 7374 722c 206f 7074 696f 6e61 6c29   (str, optional)
+00018cf0: 3a20 5370 6563 6966 6965 7320 7468 6520  : Specifies the 
+00018d00: 7665 7273 696f 6e20 6f66 2074 6865 2043  version of the C
+00018d10: 5352 206b 6579 2074 6f20 7573 6520 666f  SR key to use fo
+00018d20: 7220 7369 676e 696e 672e 200d 0a20 2020  r signing. ..   
+00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d50: 2020 4966 2074 6865 2076 6572 7369 6f6e    If the version
+00018d60: 2069 7320 7365 7420 746f 206c 6174 6573   is set to lates
+00018d70: 7420 6f72 2069 7320 6e6f 7420 7365 742c  t or is not set,
+00018d80: 2074 6865 2063 7572 7265 6e74 200d 0a20   the current .. 
+00018d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018db0: 2020 2020 6b65 7920 7769 6c6c 2062 6520      key will be 
+00018dc0: 7265 7475 726e 6564 2e20 4465 6661 756c  returned. Defaul
+00018dd0: 7473 2074 6f20 2222 2e0d 0a20 2020 2020  ts to ""...     
+00018de0: 2020 2020 2020 2063 7372 2028 7374 722c         csr (str,
+00018df0: 206f 7074 696f 6e61 6c29 3a20 4f70 7469   optional): Opti
+00018e00: 6f6e 616c 2050 454d 2d65 6e63 6f64 6564  onal PEM-encoded
+00018e10: 2043 5352 2074 656d 706c 6174 6520 746f   CSR template to
+00018e20: 2075 7365 2061 7320 6120 6261 7369 7320   use as a basis 
+00018e30: 666f 7220 7468 6520 6e65 7720 0d0a 2020  for the new ..  
+00018e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e50: 2020 2020 2020 2020 2020 2020 2020 2043                 C
+00018e60: 5352 2073 6967 6e65 6420 6279 2074 6869  SR signed by thi
+00018e70: 7320 6b65 792e 2049 6620 6e6f 7420 7365  s key. If not se
+00018e80: 742c 2061 6e20 656d 7074 7920 4353 5220  t, an empty CSR 
+00018e90: 6973 2075 7365 642e 2044 6566 6175 6c74  is used. Default
+00018ea0: 7320 746f 2022 222e 0d0a 0d0a 2020 2020  s to "".....    
+00018eb0: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
+00018ec0: 2020 2020 2020 2020 2020 626f 6f6c 3a20            bool: 
+00018ed0: 7265 7475 726e 2054 7275 6520 6966 2073  return True if s
+00018ee0: 7563 6365 7373 2c20 6f74 6865 7277 6973  uccess, otherwis
+00018ef0: 6520 7265 7475 726e 2046 616c 7365 0d0a  e return False..
+00018f00: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00018f10: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+00018f20: 6175 7468 3a0d 0a20 2020 2020 2020 2020  auth:..         
+00018f30: 2020 2065 7869 7374 5f6b 6579 7320 3d20     exist_keys = 
+00018f40: 7365 6c66 2e6c 6973 745f 6b65 7928 6d6f  self.list_key(mo
+00018f50: 756e 745f 7061 7468 290d 0a20 2020 2020  unt_path)..     
+00018f60: 2020 2020 2020 2069 6620 6e61 6d65 206e         if name n
+00018f70: 6f74 2069 6e20 6578 6973 745f 6b65 7973  ot in exist_keys
+00018f80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00018f90: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+00018fa0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+00018fb0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 7369  _.__name__} - si
+00018fc0: 676e 2063 7372 2065 7272 6f72 3a20 6b65  gn csr error: ke
+00018fd0: 7920 277b 6e61 6d65 7d27 206e 6f74 2066  y '{name}' not f
+00018fe0: 6f75 6e64 2229 0d0a 2020 2020 2020 2020  ound")..        
+00018ff0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00019000: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00019010: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+00019020: 7061 7261 6d73 203d 205b 5d0d 0a0d 0a20  params = [].... 
+00019030: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+00019040: 7273 696f 6e20 213d 2022 223a 0d0a 2020  rsion != "":..  
+00019050: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00019060: 7261 6d73 2e61 7070 656e 6428 6622 7665  rams.append(f"ve
+00019070: 7273 696f 6e3d 7b76 6572 7369 6f6e 7d22  rsion={version}"
+00019080: 290d 0a20 2020 2020 2020 2020 2020 200d  )..            .
+00019090: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000190a0: 6373 7220 213d 2022 223a 0d0a 2020 2020  csr != "":..    
+000190b0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+000190c0: 6d73 2e61 7070 656e 6428 6622 6373 723d  ms.append(f"csr=
+000190d0: 7b63 7372 7d22 290d 0a0d 0a20 2020 2020  {csr}")....     
+000190e0: 2020 2020 2020 2069 6620 6c65 6e28 7061         if len(pa
+000190f0: 7261 6d73 2920 3e20 303a 0d0a 2020 2020  rams) > 0:..    
+00019100: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00019110: 6d73 203d 2022 3f22 202b 2022 2622 2e6a  ms = "?" + "&".j
+00019120: 6f69 6e28 7061 7261 6d73 290d 0a20 2020  oin(params)..   
+00019130: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00019140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019150: 7061 7261 6d73 203d 2022 220d 0a0d 0a20  params = "".... 
+00019160: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+00019170: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+00019180: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
+00019190: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+000191a0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+000191b0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+000191c0: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+000191d0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+000191e0: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
+000191f0: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+00019200: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
+00019210: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+00019220: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+00019230: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+00019240: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+00019250: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+00019260: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
+00019270: 7565 7374 732e 706f 7374 2875 726c 2b66  uests.post(url+f
+00019280: 227b 6d6f 756e 745f 7061 7468 7d2f 6b65  "{mount_path}/ke
+00019290: 7973 2f7b 6e61 6d65 7d2f 6373 7222 2c20  ys/{name}/csr", 
+000192a0: 6865 6164 6572 733d 7b22 582d 5661 756c  headers={"X-Vaul
+000192b0: 742d 546f 6b65 6e22 3a20 746f 6b65 6e7d  t-Token": token}
+000192c0: 2c20 7061 7261 6d73 3d70 6172 616d 7329  , params=params)
+000192d0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000192e0: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
+000192f0: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
+00019300: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+00019310: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
+00019320: 2020 2020 7265 7475 726e 2054 7275 650d      return True.
+00019330: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00019340: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00019350: 2020 2020 7365 6c66 2e5f 6c6f 675f 6572      self._log_er
+00019360: 726f 725f 7265 7370 6f6e 7365 285f 5f63  ror_response(__c
+00019370: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
+00019380: 2072 6573 2c20 2272 6f74 6174 6520 6b65   res, "rotate ke
+00019390: 7920 6572 726f 7222 290d 0a20 2020 2020  y error")..     
+000193a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000193b0: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
+000193c0: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
+000193d0: 6e20 4661 6c73 650d 0a0d 0a20 2020 2023  n False....    #
+000193e0: 2054 4f44 4f3a 2077 6169 7420 666f 7220   TODO: wait for 
+000193f0: 7465 7374 696e 670d 0a20 2020 2064 6566  testing..    def
+00019400: 2073 6574 5f63 6572 7469 6669 6361 7465   set_certificate
+00019410: 5f63 6861 696e 2873 656c 662c 200d 0a20  _chain(self, .. 
+00019420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019430: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
+00019440: 6e74 5f70 6174 683a 2073 7472 2c0d 0a20  nt_path: str,.. 
+00019450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019460: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00019470: 653a 2073 7472 2c0d 0a20 2020 2020 2020  e: str,..       
+00019480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019490: 2020 2020 2020 2063 6572 7469 6669 6361         certifica
+000194a0: 7465 5f63 6861 696e 3a20 7374 722c 0d0a  te_chain: str,..
+000194b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194c0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+000194d0: 7273 696f 6e3a 2073 7472 203d 2022 2229  rsion: str = "")
+000194e0: 3a0d 0a20 2020 2020 2020 2022 2222 7365  :..        """se
+000194f0: 7420 7468 6520 6365 7274 6966 6963 6174  t the certificat
+00019500: 6520 6368 6169 6e20 6173 736f 6369 6174  e chain associat
+00019510: 6564 2077 6974 6820 7468 6520 6e61 6d65  ed with the name
+00019520: 6420 6b65 790d 0a0d 0a20 2020 2020 2020  d key....       
+00019530: 2052 6566 6572 2074 6f20 6874 7470 733a   Refer to https:
+00019540: 2f2f 6465 7665 6c6f 7065 722e 6861 7368  //developer.hash
+00019550: 6963 6f72 702e 636f 6d2f 7661 756c 742f  icorp.com/vault/
+00019560: 6170 692d 646f 6373 2f73 6563 7265 742f  api-docs/secret/
+00019570: 7472 616e 7369 7423 7365 742d 6365 7274  transit#set-cert
+00019580: 6966 6963 6174 652d 6368 6169 6e20 666f  ificate-chain fo
+00019590: 7220 6d6f 7265 2064 6574 6169 6c73 2e0d  r more details..
+000195a0: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+000195b0: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+000195c0: 756e 745f 7061 7468 2028 7374 7229 0d0a  unt_path (str)..
+000195d0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+000195e0: 2028 7374 7229 3a20 5370 6563 6966 6965   (str): Specifie
+000195f0: 7320 7468 6520 6e61 6d65 206f 6620 7468  s the name of th
+00019600: 6520 6b65 7920 746f 2069 6d70 6f72 7420  e key to import 
+00019610: 7468 6520 6365 7274 6966 6963 6174 6520  the certificate 
+00019620: 6368 6169 6e20 6167 6169 6e73 740d 0a20  chain against.. 
+00019630: 2020 2020 2020 2020 2020 2063 6572 7469             certi
+00019640: 6669 6361 7465 5f63 6861 696e 2028 7374  ficate_chain (st
+00019650: 7229 3a20 4120 5045 4d20 656e 636f 6465  r): A PEM encode
+00019660: 6420 6365 7274 6966 6963 6174 6520 6368  d certificate ch
+00019670: 6169 6e2e 2049 7420 7368 6f75 6c64 2062  ain. It should b
+00019680: 6520 636f 6d70 6f73 6564 2062 7920 6f6e  e composed by on
+00019690: 6520 6f72 206d 6f72 6520 636f 6e63 6174  e or more concat
+000196a0: 656e 6174 6564 200d 0a20 2020 2020 2020  enated ..       
+000196b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196c0: 2020 2020 2020 2020 2020 2020 2020 5045                PE
+000196d0: 4d20 626c 6f63 6b73 2061 6e64 206f 7264  M blocks and ord
+000196e0: 6572 6564 2073 7461 7274 696e 6720 6672  ered starting fr
+000196f0: 6f6d 2074 6865 2065 6e64 2d65 6e74 6974  om the end-entit
+00019700: 7920 6365 7274 6966 6963 6174 652e 0d0a  y certificate...
+00019710: 2020 2020 2020 2020 2020 2020 7665 7273              vers
+00019720: 696f 6e20 2873 7472 2c20 6f70 7469 6f6e  ion (str, option
+00019730: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
+00019740: 6865 2076 6572 7369 6f6e 206f 6620 7468  he version of th
+00019750: 6520 6b65 7920 746f 2069 6d70 6f72 7420  e key to import 
+00019760: 7468 6520 6368 6169 6e20 6167 6169 6e73  the chain agains
+00019770: 742e 2049 6620 7468 6520 7665 7273 696f  t. If the versio
+00019780: 6e20 6973 200d 0a20 2020 2020 2020 2020  n is ..         
+00019790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197a0: 2020 2020 2020 2020 2020 2020 7365 7420              set 
+000197b0: 746f 206c 6174 6573 7420 6f72 2069 7320  to latest or is 
+000197c0: 6e6f 7420 7365 742c 2074 6865 2063 7572  not set, the cur
+000197d0: 7265 6e74 206b 6579 2077 696c 6c20 6265  rent key will be
+000197e0: 2072 6574 7572 6e65 642e 2044 6566 6175   returned. Defau
+000197f0: 6c74 7320 746f 2022 222e 0d0a 0d0a 2020  lts to "".....  
+00019800: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
+00019810: 2020 2020 2020 2020 2020 2020 626f 6f6c              bool
+00019820: 3a20 7265 7475 726e 2054 7275 6520 6966  : return True if
+00019830: 2073 7563 6365 7373 2c20 6f74 6865 7277   success, otherw
+00019840: 6973 6520 7265 7475 726e 2046 616c 7365  ise return False
+00019850: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00019860: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00019870: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
+00019880: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
+00019890: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+000198a0: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
+000198b0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+000198c0: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+000198d0: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+000198e0: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+000198f0: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00019900: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
+00019910: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
+00019920: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
+00019930: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+00019940: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+00019950: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+00019960: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+00019970: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00019980: 2075 726c 202b 3d20 6622 7b6d 6f75 6e74   url += f"{mount
+00019990: 5f70 6174 687d 2f6b 6579 732f 7b6e 616d  _path}/keys/{nam
+000199a0: 657d 2f73 6574 2d63 6572 7469 6669 6361  e}/set-certifica
+000199b0: 7465 3f63 6572 7469 6669 6361 7465 5f63  te?certificate_c
+000199c0: 6861 696e 3d7b 6365 7274 6966 6963 6174  hain={certificat
+000199d0: 655f 6368 6169 6e7d 220d 0a20 2020 2020  e_chain}"..     
+000199e0: 2020 2020 2020 2069 6620 7665 7273 696f         if versio
+000199f0: 6e20 213d 2022 223a 0d0a 2020 2020 2020  n != "":..      
+00019a00: 2020 2020 2020 2020 2020 7572 6c20 2b3d            url +=
+00019a10: 2066 2226 7665 7273 696f 6e3d 7b76 6572   f"&version={ver
+00019a20: 7369 6f6e 7d22 0d0a 2020 2020 2020 2020  sion}"..        
+00019a30: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
+00019a40: 7473 2e70 6f73 7428 7572 6c2c 2068 6561  ts.post(url, hea
+00019a50: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
+00019a60: 6f6b 656e 223a 2074 6f6b 656e 7d29 0d0a  oken": token})..
+00019a70: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00019a80: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+00019a90: 3d20 3230 3020 6f72 2072 6573 2e73 7461  = 200 or res.sta
+00019aa0: 7475 735f 636f 6465 203d 3d20 3230 343a  tus_code == 204:
+00019ab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019ac0: 2020 7265 7475 726e 2054 7275 650d 0a20    return True.. 
+00019ad0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00019ae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019af0: 2020 7365 6c66 2e5f 6c6f 675f 6572 726f    self._log_erro
+00019b00: 725f 7265 7370 6f6e 7365 285f 5f63 6c61  r_response(__cla
+00019b10: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
+00019b20: 6573 2c20 2273 6574 2063 6572 7469 6669  es, "set certifi
+00019b30: 6361 7465 2063 6861 696e 2065 7272 6f72  cate chain error
+00019b40: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00019b50: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00019b60: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+00019b70: 726e 2046 616c 7365 0d0a 0d0a 2020 2020  rn False....    
+00019b80: 2320 544f 444f 3a20 7761 6974 2066 6f72  # TODO: wait for
+00019b90: 2074 6573 7469 6e67 0d0a 2020 2020 6465   testing..    de
+00019ba0: 6620 7365 6375 7265 6c79 5f65 7870 6f72  f securely_expor
+00019bb0: 745f 6b65 7928 7365 6c66 2c20 0d0a 2020  t_key(self, ..  
+00019bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bd0: 2020 2020 2020 2020 2020 6d6f 756e 745f            mount_
+00019be0: 7061 7468 3a20 7374 722c 0d0a 2020 2020  path: str,..    
+00019bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c00: 2020 2020 2020 2020 6465 7374 696e 6174          destinat
+00019c10: 696f 6e3a 2073 7472 2c0d 0a20 2020 2020  ion: str,..     
+00019c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c30: 2020 2020 2020 2073 6f75 7263 653a 2073         source: s
+00019c40: 7472 2c0d 0a20 2020 2020 2020 2020 2020  tr,..           
+00019c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c60: 2076 6572 7369 6f6e 3a20 7374 7220 3d20   version: str = 
+00019c70: 2222 293a 0d0a 2020 2020 2020 2020 2222  ""):..        ""
+00019c80: 2265 7870 6f72 7420 696d 706f 7274 6564  "export imported
+00019c90: 206b 6579 2073 6563 7572 656c 790d 0a0d   key securely...
+00019ca0: 0a20 2020 2020 2020 2054 6869 7320 656e  .        This en
+00019cb0: 6470 6f69 6e74 2072 6574 7572 6e73 2061  dpoint returns a
+00019cc0: 2077 7261 7070 6564 2063 6f70 7920 6f66   wrapped copy of
+00019cd0: 2074 6865 2060 736f 7572 6365 6020 6b65   the `source` ke
+00019ce0: 792c 2070 726f 7465 6374 6564 2062 7920  y, protected by 
+00019cf0: 7468 6520 6064 6573 7469 6e61 7469 6f6e  the `destination
+00019d00: 6020 6b65 7920 7573 696e 6720 7468 6520  ` key using the 
+00019d10: 4259 4f4b 206d 6574 686f 6420 0d0a 2020  BYOK method ..  
+00019d20: 2020 2020 2020 6163 6365 7074 6564 2062        accepted b
+00019d30: 7920 7468 6520 602f 7472 616e 7369 742f  y the `/transit/
+00019d40: 6b65 7973 2f3a 6e61 6d65 2f69 6d70 6f72  keys/:name/impor
+00019d50: 7460 2041 5049 2e20 5468 6973 2061 6c6c  t` API. This all
+00019d60: 6f77 7320 616e 206f 7065 7261 746f 7220  ows an operator 
+00019d70: 7573 696e 6720 7477 6f20 7365 7061 7261  using two separa
+00019d80: 7465 2056 6175 6c74 2069 6e73 7461 6e63  te Vault instanc
+00019d90: 6573 2074 6f20 0d0a 2020 2020 2020 2020  es to ..        
+00019da0: 7365 6375 7265 2065 7374 6162 6c69 7368  secure establish
+00019db0: 6564 2073 6861 7265 6420 6b65 7920 6d61  ed shared key ma
+00019dc0: 7465 7269 616c 2c20 7769 7468 6f75 7420  terial, without 
+00019dd0: 6578 706f 7369 6e67 2065 6974 6865 7220  exposing either 
+00019de0: 6b65 7920 696e 2070 6c61 696e 7465 7874  key in plaintext
+00019df0: 2061 6e64 206e 6565 6469 6e67 2074 6f20   and needing to 
+00019e00: 7275 6e20 6120 6d61 6e75 616c 2042 594f  run a manual BYO
+00019e10: 4b20 0d0a 2020 2020 2020 2020 696d 706f  K ..        impo
+00019e20: 7274 2075 7369 6e67 2074 6865 2043 4c49  rt using the CLI
+00019e30: 2068 656c 7065 7220 7574 696c 6974 792e   helper utility.
+00019e40: 0d0a 0d0a 2020 2020 2020 2020 5265 6665  ....        Refe
+00019e50: 7220 746f 2068 7474 7073 3a2f 2f64 6576  r to https://dev
+00019e60: 656c 6f70 6572 2e68 6173 6869 636f 7270  eloper.hashicorp
+00019e70: 2e63 6f6d 2f76 6175 6c74 2f61 7069 2d64  .com/vault/api-d
+00019e80: 6f63 732f 7365 6372 6574 2f74 7261 6e73  ocs/secret/trans
+00019e90: 6974 2373 6563 7572 656c 792d 6578 706f  it#securely-expo
+00019ea0: 7274 2d6b 6579 2066 6f72 206d 6f72 6520  rt-key for more 
+00019eb0: 6465 7461 696c 732e 0d0a 0d0a 2020 2020  details.....    
+00019ec0: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+00019ed0: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
+00019ee0: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
+00019ef0: 2020 2020 2064 6573 7469 6e61 7469 6f6e       destination
+00019f00: 2028 7374 7229 3a20 5370 6563 6966 6965   (str): Specifie
+00019f10: 7320 7468 6520 6e61 6d65 206f 6620 7468  s the name of th
+00019f20: 6520 6b65 7920 746f 2065 6e63 7279 7074  e key to encrypt
+00019f30: 2074 6865 2060 736f 7572 6365 6020 6b65   the `source` ke
+00019f40: 7920 746f 3a20 7468 6973 2069 7320 7573  y to: this is us
+00019f50: 7561 6c6c 7920 616e 6f74 6865 7220 6d6f  ually another mo
+00019f60: 756e 7420 0d0a 2020 2020 2020 2020 2020  unt ..          
+00019f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f80: 2020 2020 206f 7220 636c 7573 7465 7227       or cluster'
+00019f90: 7320 7772 6170 7069 6e67 206b 6579 2028  s wrapping key (
+00019fa0: 6672 6f6d 2060 2f74 7261 6e73 6974 2f77  from `/transit/w
+00019fb0: 7261 7070 696e 675f 6b65 7960 292e 0d0a  rapping_key`)...
+00019fc0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+00019fd0: 6365 2028 7374 7229 3a20 5370 6563 6966  ce (str): Specif
+00019fe0: 6965 7320 7468 6520 736f 7572 6365 206b  ies the source k
+00019ff0: 6579 2074 6f20 656e 6372 7970 742c 2074  ey to encrypt, t
+0001a000: 6f20 636f 7079 2028 656e 6372 7970 7465  o copy (encrypte
+0001a010: 6429 2074 6f20 616e 6f74 6865 7220 636c  d) to another cl
+0001a020: 7573 7465 722e 0d0a 2020 2020 2020 2020  uster...        
+0001a030: 2020 2020 7665 7273 696f 6e20 2873 7472      version (str
+0001a040: 2c20 6f70 7469 6f6e 616c 293a 2053 7065  , optional): Spe
+0001a050: 6369 6669 6573 2074 6865 2076 6572 7369  cifies the versi
+0001a060: 6f6e 206f 6620 7468 6520 736f 7572 6365  on of the source
+0001a070: 206b 6579 2074 6f20 7772 6170 2e20 4966   key to wrap. If
+0001a080: 206f 6d69 7474 6564 2c20 616c 6c20 7665   omitted, all ve
+0001a090: 7273 696f 6e73 206f 6620 7468 6520 6b65  rsions of the ke
+0001a0a0: 7920 0d0a 2020 2020 2020 2020 2020 2020  y ..            
+0001a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0c0: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
+0001a0d0: 2072 6574 7572 6e65 642e 2054 6869 7320   returned. This 
+0001a0e0: 6973 2073 7065 6369 6669 6564 2061 7320  is specified as 
+0001a0f0: 7061 7274 206f 6620 7468 6520 5552 4c2e  part of the URL.
+0001a100: 2049 6620 7468 6520 7665 7273 696f 6e20   If the version 
+0001a110: 6973 2073 6574 2074 6f20 6c61 7465 7374  is set to latest
+0001a120: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+0001a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a140: 2020 2020 2020 2020 2074 6865 2063 7572           the cur
+0001a150: 7265 6e74 206b 6579 2077 696c 6c20 6265  rent key will be
+0001a160: 2072 6574 7572 6e65 642e 2044 6566 6175   returned. Defau
+0001a170: 6c74 7320 746f 2022 222e 0d0a 0d0a 2020  lts to "".....  
+0001a180: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
+0001a190: 2020 2020 2020 2020 2020 2020 6469 6374              dict
+0001a1a0: 206f 7220 4e6f 6e65 3a20 7265 7475 726e   or None: return
+0001a1b0: 2074 6865 206b 6579 2069 6e20 6469 6374   the key in dict
+0001a1c0: 2069 6620 7375 6363 6573 732c 206f 7468   if success, oth
+0001a1d0: 6572 7769 7365 2072 6574 7572 6e20 4e6f  erwise return No
+0001a1e0: 6e65 0d0a 2020 2020 2020 2020 2222 220d  ne..        """.
+0001a1f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001a200: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
+0001a210: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
+0001a220: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
+0001a230: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
+0001a240: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
+0001a250: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
+0001a260: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
+0001a270: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
+0001a280: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
+0001a290: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
+0001a2a0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+0001a2b0: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
+0001a2c0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
+0001a2d0: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
+0001a2e0: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
+0001a2f0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
+0001a300: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
+0001a310: 2020 2075 726c 202b 3d20 6622 7b6d 6f75     url += f"{mou
+0001a320: 6e74 5f70 6174 687d 2f62 796f 6b2d 6578  nt_path}/byok-ex
+0001a330: 706f 7274 2f7b 6465 7374 696e 6174 696f  port/{destinatio
+0001a340: 6e7d 2f7b 736f 7572 6365 7d22 0d0a 2020  n}/{source}"..  
+0001a350: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
+0001a360: 7369 6f6e 2021 3d20 2222 3a0d 0a20 2020  sion != "":..   
+0001a370: 2020 2020 2020 2020 2020 2020 2075 726c               url
+0001a380: 202b 3d20 6622 2f7b 7665 7273 696f 6e7d   += f"/{version}
+0001a390: 220d 0a20 2020 2020 2020 2020 2020 2072  "..            r
+0001a3a0: 6573 203d 2072 6571 7565 7374 732e 6765  es = requests.ge
+0001a3b0: 7428 7572 6c2c 2068 6561 6465 7273 3d7b  t(url, headers={
+0001a3c0: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
+0001a3d0: 2074 6f6b 656e 7d29 0d0a 2020 2020 2020   token})..      
+0001a3e0: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
+0001a3f0: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
+0001a400: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
+0001a410: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
+0001a420: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001a430: 726e 2072 6573 2e6a 736f 6e28 295b 2264  rn res.json()["d
+0001a440: 6174 6122 5d0d 0a20 2020 2020 2020 2020  ata"]..         
+0001a450: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001a460: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0001a470: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
+0001a480: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
+0001a490: 616d 655f 5f2c 2072 6573 2c20 2273 6563  ame__, res, "sec
+0001a4a0: 7572 656c 7920 6578 706f 7274 206b 6579  urely export key
+0001a4b0: 2065 7272 6f72 2229 0d0a 2020 2020 2020   error")..      
+0001a4c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001a4d0: 204e 6f6e 650d 0a20 2020 2020 2020 200d   None..        .
+0001a4e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001a4f0: 4e6f 6e65 0d0a 0d0a 2020 2020 2320 544f  None....    # TO
+0001a500: 444f 3a20 7761 6974 2066 6f72 2074 6573  DO: wait for tes
+0001a510: 7469 6e67 0d0a 2020 2020 6465 6620 6578  ting..    def ex
+0001a520: 706f 7274 5f6b 6579 2873 656c 662c 200d  port_key(self, .
+0001a530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a540: 2020 2020 6d6f 756e 745f 7061 7468 3a20      mount_path: 
+0001a550: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
+0001a560: 2020 2020 2020 2020 206b 6579 5f74 7970           key_typ
+0001a570: 653a 2073 7472 2c0d 0a20 2020 2020 2020  e: str,..       
+0001a580: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0001a590: 3a20 7374 722c 0d0a 2020 2020 2020 2020  : str,..        
+0001a5a0: 2020 2020 2020 2020 2020 2076 6572 7369             versi
+0001a5b0: 6f6e 3a20 7374 7220 3d20 2222 293a 0d0a  on: str = ""):..
+0001a5c0: 2020 2020 2020 2020 2222 2265 7870 6f72          """expor
+0001a5d0: 7420 7468 6520 6e61 6d65 6420 6b65 790d  t the named key.
+0001a5e0: 0a0d 0a20 2020 2020 2020 2054 6865 206b  ...        The k
+0001a5f0: 6579 7320 6f62 6a65 6374 2073 686f 7773  eys object shows
+0001a600: 2074 6865 2076 616c 7565 206f 6620 7468   the value of th
+0001a610: 6520 6b65 7920 666f 7220 6561 6368 2076  e key for each v
+0001a620: 6572 7369 6f6e 2e20 4966 2076 6572 7369  ersion. If versi
+0001a630: 6f6e 2069 7320 7370 6563 6966 6965 642c  on is specified,
+0001a640: 2074 6865 2073 7065 6369 6669 6320 7665   the specific ve
+0001a650: 7273 696f 6e20 7769 6c6c 2062 6520 7265  rsion will be re
+0001a660: 7475 726e 6564 2e20 0d0a 2020 2020 2020  turned. ..      
+0001a670: 2020 4966 206c 6174 6573 7420 6973 2070    If latest is p
+0001a680: 726f 7669 6465 6420 6173 2074 6865 2076  rovided as the v
+0001a690: 6572 7369 6f6e 2c20 7468 6520 6375 7272  ersion, the curr
+0001a6a0: 656e 7420 6b65 7920 7769 6c6c 2062 6520  ent key will be 
+0001a6b0: 7072 6f76 6964 6564 2e20 4465 7065 6e64  provided. Depend
+0001a6c0: 696e 6720 6f6e 2074 6865 2074 7970 6520  ing on the type 
+0001a6d0: 6f66 206b 6579 2c20 6469 6666 6572 656e  of key, differen
+0001a6e0: 7420 696e 666f 726d 6174 696f 6e20 0d0a  t information ..
+0001a6f0: 2020 2020 2020 2020 6d61 7920 6265 2072          may be r
+0001a700: 6574 7572 6e65 642e 2054 6865 206b 6579  eturned. The key
+0001a710: 206d 7573 7420 6265 2065 7870 6f72 7461   must be exporta
+0001a720: 626c 6520 746f 2073 7570 706f 7274 2074  ble to support t
+0001a730: 6869 7320 6f70 6572 6174 696f 6e20 616e  his operation an
+0001a740: 6420 7468 6520 7665 7273 696f 6e20 6d75  d the version mu
+0001a750: 7374 2073 7469 6c6c 2062 6520 7661 6c69  st still be vali
+0001a760: 642e 0d0a 0d0a 2020 2020 2020 2020 5265  d.....        Re
+0001a770: 6665 7220 746f 2068 7474 7073 3a2f 2f64  fer to https://d
+0001a780: 6576 656c 6f70 6572 2e68 6173 6869 636f  eveloper.hashico
+0001a790: 7270 2e63 6f6d 2f76 6175 6c74 2f61 7069  rp.com/vault/api
+0001a7a0: 2d64 6f63 732f 7365 6372 6574 2f74 7261  -docs/secret/tra
+0001a7b0: 6e73 6974 2365 7870 6f72 742d 6b65 7920  nsit#export-key 
+0001a7c0: 666f 7220 6d6f 7265 2064 6574 6169 6c73  for more details
+0001a7d0: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+0001a7e0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0001a7f0: 6d6f 756e 745f 7061 7468 2028 7374 7229  mount_path (str)
+0001a800: 0d0a 2020 2020 2020 2020 2020 2020 6b65  ..            ke
+0001a810: 795f 7479 7065 2028 7374 7229 3a20 5370  y_type (str): Sp
+0001a820: 6563 6966 6965 7320 7468 6520 7479 7065  ecifies the type
+0001a830: 206f 6620 7468 6520 6b65 7920 746f 2065   of the key to e
+0001a840: 7870 6f72 740d 0a20 2020 2020 2020 2020  xport..         
+0001a850: 2020 206e 616d 6520 2873 7472 293a 2053     name (str): S
+0001a860: 7065 6369 6669 6573 2074 6865 206e 616d  pecifies the nam
+0001a870: 6520 6f66 2074 6865 206b 6579 2074 6f20  e of the key to 
+0001a880: 7265 6164 2069 6e66 6f72 6d61 7469 6f6e  read information
+0001a890: 2061 626f 7574 0d0a 2020 2020 2020 2020   about..        
+0001a8a0: 2020 2020 7665 7273 696f 6e20 2873 7472      version (str
+0001a8b0: 2c20 6f70 7469 6f6e 616c 293a 2053 7065  , optional): Spe
+0001a8c0: 6369 6669 6573 2074 6865 2076 6572 7369  cifies the versi
+0001a8d0: 6f6e 206f 6620 7468 6520 6b65 7920 746f  on of the key to
+0001a8e0: 2072 6561 642e 2049 6620 6f6d 6974 7465   read. If omitte
+0001a8f0: 642c 2061 6c6c 2076 6572 7369 6f6e 7320  d, all versions 
+0001a900: 6f66 2074 6865 206b 6579 2077 696c 6c20  of the key will 
+0001a910: 6265 2072 6574 7572 6e65 642e 200d 0a20  be returned. .. 
+0001a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a940: 2020 2020 5468 6973 2069 7320 7370 6563      This is spec
+0001a950: 6966 6965 6420 6173 2070 6172 7420 6f66  ified as part of
+0001a960: 2074 6865 2055 524c 2e20 4966 2074 6865   the URL. If the
+0001a970: 2076 6572 7369 6f6e 2069 7320 7365 7420   version is set 
+0001a980: 746f 206c 6174 6573 742c 2074 6865 2063  to latest, the c
+0001a990: 7572 7265 6e74 206b 6579 2077 696c 6c20  urrent key will 
+0001a9a0: 6265 200d 0a20 2020 2020 2020 2020 2020  be ..           
+0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001a9d0: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
+0001a9e0: 2222 2e0d 0a0d 0a20 2020 2020 2020 2052  "".....        R
+0001a9f0: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
+0001aa00: 2020 2020 2064 6963 7420 6f72 204e 6f6e       dict or Non
+0001aa10: 653a 2072 6574 7572 6e20 7468 6520 6b65  e: return the ke
+0001aa20: 7920 696e 2064 6963 7420 6966 2073 7563  y in dict if suc
+0001aa30: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
+0001aa40: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+0001aa50: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0001aa60: 2020 6966 2073 656c 662e 6973 5f61 7574    if self.is_aut
+0001aa70: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+0001aa80: 7661 6c69 645f 6b65 795f 7479 7065 203d  valid_key_type =
+0001aa90: 205b 2265 6e63 7279 7074 696f 6e2d 6b65   ["encryption-ke
+0001aaa0: 7922 2c20 2273 6967 6e69 6e67 2d6b 6579  y", "signing-key
+0001aab0: 222c 2022 686d 6163 2d6b 6579 222c 2022  ", "hmac-key", "
+0001aac0: 7075 626c 6963 2d6b 6579 222c 2022 6365  public-key", "ce
+0001aad0: 7274 6966 6963 6174 652d 6368 6169 6e22  rtificate-chain"
+0001aae0: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+0001aaf0: 6620 6b65 795f 7479 7065 206e 6f74 2069  f key_type not i
+0001ab00: 6e20 7661 6c69 645f 6b65 795f 7479 7065  n valid_key_type
+0001ab10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001ab20: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+0001ab30: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+0001ab40: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6578  _.__name__} - ex
+0001ab50: 706f 7274 206b 6579 2065 7272 6f72 3a20  port key error: 
+0001ab60: 696e 7661 6c69 6420 6b65 795f 7479 7065  invalid key_type
+0001ab70: 3a20 7b6b 6579 5f74 7970 657d 2e20 5661  : {key_type}. Va
+0001ab80: 6c69 6420 7661 6c75 6573 2061 7265 3a20  lid values are: 
+0001ab90: 7b76 616c 6964 5f6b 6579 5f74 7970 657d  {valid_key_type}
+0001aba0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0001abb0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+0001abc0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+0001abd0: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+0001abe0: 5f6b 6579 7320 3d20 7365 6c66 2e6c 6973  _keys = self.lis
+0001abf0: 745f 6b65 7928 6d6f 756e 745f 7061 7468  t_key(mount_path
+0001ac00: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0001ac10: 6620 6e61 6d65 206e 6f74 2069 6e20 6578  f name not in ex
+0001ac20: 6973 745f 6b65 7973 3a0d 0a20 2020 2020  ist_keys:..     
+0001ac30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001ac40: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
+0001ac50: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001ac60: 5f5f 7d20 2d20 6578 706f 7274 206b 6579  __} - export key
+0001ac70: 2065 7272 6f72 3a20 6b65 7920 277b 6e61   error: key '{na
+0001ac80: 6d65 7d27 206e 6f74 2066 6f75 6e64 2229  me}' not found")
+0001ac90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001aca0: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
+0001acb0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+0001acc0: 2020 2020 2020 2020 2075 726c 203d 2061           url = a
+0001acd0: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+0001ace0: 7365 6c66 2e75 726c 2c20 6b65 793d 7261  self.url, key=ra
+0001acf0: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+0001ad00: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+0001ad10: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+0001ad20: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+0001ad30: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+0001ad40: 2020 2020 2074 6f6b 656e 203d 2061 6573       token = aes
+0001ad50: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
+0001ad60: 6c66 2e74 6f6b 656e 2c20 6b65 793d 7261  lf.token, key=ra
+0001ad70: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
+0001ad80: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
+0001ad90: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
+0001ada0: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
+0001adb0: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
+0001adc0: 2020 2020 2075 726c 202b 3d20 6622 7b6d       url += f"{m
+0001add0: 6f75 6e74 5f70 6174 687d 2f65 7870 6f72  ount_path}/expor
+0001ade0: 742f 7b6b 6579 5f74 7970 657d 220d 0a20  t/{key_type}".. 
+0001adf0: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+0001ae00: 7273 696f 6e20 213d 2022 223a 0d0a 2020  rsion != "":..  
+0001ae10: 2020 2020 2020 2020 2020 2020 2020 7572                ur
+0001ae20: 6c20 2b3d 2066 222f 7b76 6572 7369 6f6e  l += f"/{version
+0001ae30: 7d22 0d0a 2020 2020 2020 2020 2020 2020  }"..            
+0001ae40: 7265 7320 3d20 7265 7175 6573 7473 2e67  res = requests.g
+0001ae50: 6574 2875 726c 2c20 6865 6164 6572 733d  et(url, headers=
+0001ae60: 7b22 582d 5661 756c 742d 546f 6b65 6e22  {"X-Vault-Token"
+0001ae70: 3a20 746f 6b65 6e7d 290d 0a20 2020 2020  : token})..     
+0001ae80: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
+0001ae90: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
+0001aea0: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
+0001aeb0: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
+0001aec0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001aed0: 7572 6e20 7265 732e 6a73 6f6e 2829 5b22  urn res.json()["
+0001aee0: 6461 7461 225d 0d0a 2020 2020 2020 2020  data"]..        
+0001aef0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001af00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001af10: 5f6c 6f67 5f65 7272 6f72 5f72 6573 706f  _log_error_respo
+0001af20: 6e73 6528 5f5f 636c 6173 735f 5f2e 5f5f  nse(__class__.__
+0001af30: 6e61 6d65 5f5f 2c20 7265 732c 2022 6578  name__, res, "ex
+0001af40: 706f 7274 206b 6579 2065 7272 6f72 2229  port key error")
+0001af50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001af60: 2020 7265 7475 726e 204e 6f6e 650d 0a0d    return None...
+0001af70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001af80: 4e6f 6e65 0d0a 0d0a 2020 2020 6465 6620  None....    def 
+0001af90: 7772 6974 655f 676c 6f62 616c 5f6b 6579  write_global_key
+0001afa0: 735f 636f 6e66 6967 2873 656c 662c 206d  s_config(self, m
+0001afb0: 6f75 6e74 5f70 6174 683a 2073 7472 2c20  ount_path: str, 
+0001afc0: 6469 7361 626c 655f 7570 7365 7274 3a20  disable_upsert: 
+0001afd0: 626f 6f6c 203d 2046 616c 7365 293a 0d0a  bool = False):..
+0001afe0: 2020 2020 2020 2020 2222 2277 7269 7465          """write
+0001aff0: 2067 6c6f 6261 6c20 6b65 7920 636f 6e66   global key conf
+0001b000: 6967 7572 6174 696f 6e0d 0a0d 0a20 2020  iguration....   
+0001b010: 2020 2020 2052 6566 6572 2074 6f20 6874       Refer to ht
+0001b020: 7470 733a 2f2f 6465 7665 6c6f 7065 722e  tps://developer.
+0001b030: 6861 7368 6963 6f72 702e 636f 6d2f 7661  hashicorp.com/va
+0001b040: 756c 742f 6170 692d 646f 6373 2f73 6563  ult/api-docs/sec
+0001b050: 7265 742f 7472 616e 7369 7423 7772 6974  ret/transit#writ
+0001b060: 652d 6b65 7973 2d63 6f6e 6669 6775 7261  e-keys-configura
+0001b070: 7469 6f6e 2066 6f72 206d 6f72 6520 6465  tion for more de
+0001b080: 7461 696c 732e 0d0a 0d0a 2020 2020 2020  tails.....      
+0001b090: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+0001b0a0: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
+0001b0b0: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
+0001b0c0: 2020 2064 6973 6162 6c65 5f75 7073 6572     disable_upser
+0001b0d0: 7420 2862 6f6f 6c2c 206f 7074 696f 6e61  t (bool, optiona
+0001b0e0: 6c29 3a20 5370 6563 6966 6965 7320 7768  l): Specifies wh
+0001b0f0: 6574 6865 7220 746f 2064 6973 6162 6c65  ether to disable
+0001b100: 2075 7073 6572 7469 6e67 206f 6e20 656e   upserting on en
+0001b110: 6372 7970 7469 6f6e 200d 0a20 2020 2020  cryption ..     
+0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b140: 2020 2020 2020 2020 2861 7574 6f6d 6174          (automat
+0001b150: 6963 2063 7265 6174 696f 6e20 6f66 2075  ic creation of u
+0001b160: 6e6b 6e6f 776e 206b 6579 7329 2e20 4465  nknown keys). De
+0001b170: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
+0001b180: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0001b190: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+0001b1a0: 2020 626f 6f6c 3a20 7265 7475 726e 2054    bool: return T
+0001b1b0: 7275 6520 6966 2073 7563 6365 7373 2c20  rue if success, 
+0001b1c0: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+0001b1d0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0001b1e0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+0001b1f0: 7365 6c66 2e69 735f 6175 7468 3a0d 0a20  self.is_auth:.. 
+0001b200: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001b210: 6e74 5f63 6f6e 6669 6720 3d20 7365 6c66  nt_config = self
+0001b220: 2e72 6561 645f 676c 6f62 616c 5f6b 6579  .read_global_key
+0001b230: 735f 636f 6e66 6967 286d 6f75 6e74 5f70  s_config(mount_p
+0001b240: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
+0001b250: 2020 6966 2063 7572 7265 6e74 5f63 6f6e    if current_con
+0001b260: 6669 6720 6973 204e 6f6e 653a 0d0a 2020  fig is None:..  
+0001b270: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001b280: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+0001b290: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b2b0: 6620 6375 7272 656e 745f 636f 6e66 6967  f current_config
+0001b2c0: 5b22 6469 7361 626c 655f 7570 7365 7274  ["disable_upsert
+0001b2d0: 225d 203d 3d20 6469 7361 626c 655f 7570  "] == disable_up
+0001b2e0: 7365 7274 3a0d 0a20 2020 2020 2020 2020  sert:..         
+0001b2f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001b300: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
+0001b310: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
+0001b320: 6d65 5f5f 7d20 2d20 7772 6974 6520 676c  me__} - write gl
+0001b330: 6f62 616c 206b 6579 7320 636f 6e66 6967  obal keys config
+0001b340: 2077 6172 6e69 6e67 3a20 6e6f 2063 6861   warning: no cha
+0001b350: 6e67 6520 6f6e 2064 6973 6162 6c65 5f75  nge on disable_u
+0001b360: 7073 6572 7422 290d 0a20 2020 2020 2020  psert")..       
+0001b370: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001b380: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+0001b390: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001b3a0: 2020 2020 2070 6179 6c6f 6164 203d 2064       payload = d
+0001b3b0: 6963 7428 6469 7361 626c 655f 7570 7365  ict(disable_upse
+0001b3c0: 7274 3d64 6973 6162 6c65 5f75 7073 6572  rt=disable_upser
+0001b3d0: 7429 0d0a 0d0a 2020 2020 2020 2020 2020  t)....          
+0001b3e0: 2020 7572 6c20 3d20 6165 735f 6465 6372    url = aes_decr
+0001b3f0: 7970 745f 7465 7874 2873 656c 662e 7572  ypt_text(self.ur
+0001b400: 6c2c 206b 6579 3d72 616e 646f 6d5f 6865  l, key=random_he
+0001b410: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+0001b420: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+0001b430: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+0001b440: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+0001b450: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+0001b460: 6b65 6e20 3d20 6165 735f 6465 6372 7970  ken = aes_decryp
+0001b470: 745f 7465 7874 2873 656c 662e 746f 6b65  t_text(self.toke
+0001b480: 6e2c 206b 6579 3d72 616e 646f 6d5f 6865  n, key=random_he
+0001b490: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+0001b4a0: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+0001b4b0: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+0001b4c0: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+0001b4d0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0001b4e0: 7320 3d20 7265 7175 6573 7473 2e70 6f73  s = requests.pos
+0001b4f0: 7428 7572 6c2b 6622 7b6d 6f75 6e74 5f70  t(url+f"{mount_p
+0001b500: 6174 687d 2f63 6f6e 6669 672f 6b65 7973  ath}/config/keys
+0001b510: 2f22 2c20 6865 6164 6572 733d 7b22 582d  /", headers={"X-
+0001b520: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
+0001b530: 6b65 6e7d 2c20 6461 7461 3d6a 736f 6e2e  ken}, data=json.
+0001b540: 6475 6d70 7328 7061 796c 6f61 6429 290d  dumps(payload)).
+0001b550: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001b560: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+0001b570: 3d3d 2032 3030 206f 7220 7265 732e 7374  == 200 or res.st
+0001b580: 6174 7573 5f63 6f64 6520 3d3d 2032 3034  atus_code == 204
+0001b590: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001b5a0: 2020 2072 6574 7572 6e20 5472 7565 0d0a     return True..
+0001b5b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001b5c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001b5d0: 2020 2073 656c 662e 5f6c 6f67 5f65 7272     self._log_err
+0001b5e0: 6f72 5f72 6573 706f 6e73 6528 5f5f 636c  or_response(__cl
+0001b5f0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
+0001b600: 7265 732c 2022 7772 6974 6520 676c 6f62  res, "write glob
+0001b610: 616c 206b 6579 7320 636f 6e66 6967 2065  al keys config e
+0001b620: 7272 6f72 2229 0d0a 2020 2020 2020 2020  rror")..        
+0001b630: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001b640: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
+0001b650: 7265 7475 726e 2046 616c 7365 0d0a 0d0a  return False....
+0001b660: 2020 2020 6465 6620 7265 6164 5f67 6c6f      def read_glo
+0001b670: 6261 6c5f 6b65 7973 5f63 6f6e 6669 6728  bal_keys_config(
+0001b680: 7365 6c66 2c20 6d6f 756e 745f 7061 7468  self, mount_path
+0001b690: 3a20 7374 7229 3a0d 0a20 2020 2020 2020  : str):..       
+0001b6a0: 2022 2222 7265 6164 2067 6c6f 6261 6c20   """read global 
+0001b6b0: 6b65 7920 636f 6e66 6967 7572 6174 696f  key configuratio
+0001b6c0: 6e0d 0a0d 0a20 2020 2020 2020 2052 6566  n....        Ref
+0001b6d0: 6572 2074 6f20 6874 7470 733a 2f2f 6465  er to https://de
+0001b6e0: 7665 6c6f 7065 722e 6861 7368 6963 6f72  veloper.hashicor
+0001b6f0: 702e 636f 6d2f 7661 756c 742f 6170 692d  p.com/vault/api-
+0001b700: 646f 6373 2f73 6563 7265 742f 7472 616e  docs/secret/tran
+0001b710: 7369 7423 7265 6164 2d6b 6579 732d 636f  sit#read-keys-co
+0001b720: 6e66 6967 7572 6174 696f 6e20 666f 7220  nfiguration for 
+0001b730: 6d6f 7265 2064 6574 6169 6c73 2e0d 0a0d  more details....
+0001b740: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
+0001b750: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
+0001b760: 745f 7061 7468 2028 7374 7229 0d0a 0d0a  t_path (str)....
+0001b770: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+0001b780: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0001b790: 6374 206f 7220 4e6f 6e65 3a20 7265 7475  ct or None: retu
+0001b7a0: 726e 2067 6c6f 6261 6c20 6b65 7920 636f  rn global key co
+0001b7b0: 6e66 6967 7572 6174 696f 6e20 696e 2064  nfiguration in d
+0001b7c0: 6963 7420 6966 2073 7563 6365 7373 2c20  ict if success, 
+0001b7d0: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+0001b7e0: 204e 6f6e 650d 0a20 2020 2020 2020 2022   None..        "
+0001b7f0: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0001b800: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
+0001b810: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
+0001b820: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
+0001b830: 2873 656c 662e 7572 6c2c 206b 6579 3d72  (self.url, key=r
+0001b840: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
+0001b850: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
+0001b860: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
+0001b870: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
+0001b880: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
+0001b890: 2020 2020 2020 746f 6b65 6e20 3d20 6165        token = ae
+0001b8a0: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
+0001b8b0: 656c 662e 746f 6b65 6e2c 206b 6579 3d72  elf.token, key=r
+0001b8c0: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
+0001b8d0: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
+0001b8e0: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
+0001b8f0: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
+0001b900: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
+0001b910: 2020 2020 2020 7265 7320 3d20 7265 7175        res = requ
+0001b920: 6573 7473 2e67 6574 2875 726c 2b66 227b  ests.get(url+f"{
+0001b930: 6d6f 756e 745f 7061 7468 7d2f 636f 6e66  mount_path}/conf
+0001b940: 6967 2f6b 6579 732f 222c 2068 6561 6465  ig/keys/", heade
+0001b950: 7273 3d7b 2258 2d56 6175 6c74 2d54 6f6b  rs={"X-Vault-Tok
+0001b960: 656e 223a 2074 6f6b 656e 7d29 0d0a 2020  en": token})..  
+0001b970: 2020 2020 2020 2020 2020 6966 2072 6573            if res
+0001b980: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
+0001b990: 3230 3020 6f72 2072 6573 2e73 7461 7475  200 or res.statu
+0001b9a0: 735f 636f 6465 203d 3d20 3230 343a 0d0a  s_code == 204:..
+0001b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9c0: 7265 7475 726e 2072 6573 2e6a 736f 6e28  return res.json(
+0001b9d0: 295b 2264 6174 6122 5d0d 0a20 2020 2020  )["data"]..     
+0001b9e0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0001b9f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001ba00: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+0001ba10: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+0001ba20: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+0001ba30: 2272 6561 6420 676c 6f62 616c 206b 6579  "read global key
+0001ba40: 7320 636f 6e66 6967 2065 7272 6f72 2229  s config error")
+0001ba50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ba60: 2020 7265 7475 726e 204e 6f6e 650d 0a0d    return None...
+0001ba70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001ba80: 4e6f 6e65 0d0a 0d0a 2020 2020 2320 544f  None....    # TO
+0001ba90: 444f 3a20 7761 6974 2066 6f72 2074 6573  DO: wait for tes
+0001baa0: 7469 6e67 0d0a 2020 2020 6465 6620 656e  ting..    def en
+0001bab0: 6372 7970 745f 6461 7461 2873 656c 662c  crypt_data(self,
+0001bac0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0001bad0: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+0001bae0: 7468 3a20 7374 722c 0d0a 2020 2020 2020  th: str,..      
+0001baf0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001bb00: 616d 653a 2073 7472 2c0d 0a20 2020 2020  ame: str,..     
+0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb20: 706c 6169 6e74 6578 743a 2073 7472 203d  plaintext: str =
+0001bb30: 2022 222c 0d0a 2020 2020 2020 2020 2020   "",..          
+0001bb40: 2020 2020 2020 2020 2020 2061 7373 6f63             assoc
+0001bb50: 6961 7465 645f 6461 7461 3a20 7374 7220  iated_data: str 
+0001bb60: 3d20 2222 2c0d 0a20 2020 2020 2020 2020  = "",..         
+0001bb70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001bb80: 6578 743a 2073 7472 203d 2022 222c 0d0a  ext: str = "",..
+0001bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bba0: 2020 2020 206b 6579 5f76 6572 7369 6f6e       key_version
+0001bbb0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+0001bbc0: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
+0001bbd0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0001bbe0: 6e63 653a 2073 7472 203d 2022 222c 0d0a  nce: str = "",..
+0001bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc00: 2020 2020 2072 6566 6572 656e 6365 3a20       reference: 
+0001bc10: 7374 7220 3d20 2222 2c0d 0a20 2020 2020  str = "",..     
+0001bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc30: 6261 7463 685f 696e 7075 743a 204f 7074  batch_input: Opt
+0001bc40: 696f 6e61 6c5b 4c69 7374 5b64 6963 745d  ional[List[dict]
+0001bc50: 5d20 3d20 4e6f 6e65 2c0d 0a20 2020 2020  ] = None,..     
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc70: 7061 7274 6961 6c5f 6661 696c 7572 655f  partial_failure_
+0001bc80: 7265 7370 6f6e 7365 5f63 6f64 653a 2069  response_code: i
+0001bc90: 6e74 203d 2034 3030 293a 0d0a 2020 2020  nt = 400):..    
+0001bca0: 2020 2020 2222 2265 6e63 7279 7074 2074      """encrypt t
+0001bcb0: 6865 2070 726f 7669 6465 6420 706c 6169  he provided plai
+0001bcc0: 6e74 6578 7420 7573 696e 6720 7468 6520  ntext using the 
+0001bcd0: 6e61 6d65 6420 6b65 790d 0a0d 0a20 2020  named key....   
+0001bce0: 2020 2020 204e 4f54 453a 2041 6c74 686f       NOTE: Altho
+0001bcf0: 7567 6820 7468 6520 4854 5450 2041 5049  ugh the HTTP API
+0001bd00: 206f 6620 5661 756c 7420 616c 6c6f 7720   of Vault allow 
+0001bd10: 746f 2063 7265 6174 6520 6b65 7920 7768  to create key wh
+0001bd20: 656e 2065 6e63 7279 7074 696e 6720 6461  en encrypting da
+0001bd30: 7461 2c20 7765 2068 6f70 6520 796f 7520  ta, we hope you 
+0001bd40: 7573 6520 6063 7265 6174 655f 6b65 7928  use `create_key(
+0001bd50: 2960 2074 6f20 6372 6561 7465 206b 6579  )` to create key
+0001bd60: 2e20 0d0a 2020 2020 2020 2020 2020 2020  . ..            
+0001bd70: 2020 5468 7573 2c20 6974 2077 696c 6c20    Thus, it will 
+0001bd80: 7261 6973 6520 6120 7761 726e 696e 6720  raise a warning 
+0001bd90: 7768 656e 2073 7065 6369 6679 696e 6720  when specifying 
+0001bda0: 6120 6e6f 6e2d 6578 6973 7465 6e74 206b  a non-existent k
+0001bdb0: 6579 2e0d 0a0d 0a20 2020 2020 2020 2052  ey.....        R
+0001bdc0: 6566 6572 2074 6f20 6874 7470 733a 2f2f  efer to https://
+0001bdd0: 6465 7665 6c6f 7065 722e 6861 7368 6963  developer.hashic
+0001bde0: 6f72 702e 636f 6d2f 7661 756c 742f 6170  orp.com/vault/ap
+0001bdf0: 692d 646f 6373 2f73 6563 7265 742f 7472  i-docs/secret/tr
+0001be00: 616e 7369 7423 656e 6372 7970 742d 6461  ansit#encrypt-da
+0001be10: 7461 2066 6f72 206d 6f72 6520 6465 7461  ta for more deta
+0001be20: 696c 732e 0d0a 0d0a 2020 2020 2020 2020  ils.....        
+0001be30: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+0001be40: 2020 206d 6f75 6e74 5f70 6174 6820 2873     mount_path (s
+0001be50: 7472 290d 0a20 2020 2020 2020 2020 2020  tr)..           
+0001be60: 206e 616d 6520 2873 7472 293a 2053 7065   name (str): Spe
+0001be70: 6369 6669 6573 2074 6865 206e 616d 6520  cifies the name 
+0001be80: 6f66 2074 6865 2065 6e63 7279 7074 696f  of the encryptio
+0001be90: 6e20 6b65 7920 746f 2065 6e63 7279 7074  n key to encrypt
+0001bea0: 2061 6761 696e 7374 0d0a 2020 2020 2020   against..      
+0001beb0: 2020 2020 2020 706c 6169 6e74 6578 7420        plaintext 
+0001bec0: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
+0001bed0: 2053 7065 6369 6669 6573 2062 6173 6536   Specifies base6
+0001bee0: 3420 656e 636f 6465 6420 706c 6169 6e74  4 encoded plaint
+0001bef0: 6578 7420 746f 2062 6520 656e 636f 6465  ext to be encode
+0001bf00: 642e 2044 6566 6175 6c74 7320 746f 2022  d. Defaults to "
+0001bf10: 222e 0d0a 2020 2020 2020 2020 2020 2020  "...            
+0001bf20: 6173 736f 6369 6174 6564 5f64 6174 6120  associated_data 
+0001bf30: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
+0001bf40: 2053 7065 6369 6669 6573 2062 6173 6536   Specifies base6
+0001bf50: 3420 656e 636f 6465 6420 6173 736f 6369  4 encoded associ
+0001bf60: 6174 6564 2064 6174 6120 2861 6c73 6f20  ated data (also 
+0001bf70: 6b6e 6f77 6e20 6173 2061 6464 6974 696f  known as additio
+0001bf80: 6e61 6c20 6461 7461 206f 7220 4141 4429  nal data or AAD)
+0001bf90: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfc0: 746f 2061 6c73 6f20 6265 2061 7574 6865  to also be authe
+0001bfd0: 6e74 6963 6174 6564 2077 6974 6820 4145  nticated with AE
+0001bfe0: 4144 2063 6970 6865 7273 2028 6061 6573  AD ciphers (`aes
+0001bff0: 3132 382d 6763 6d39 3660 2c20 6061 6573  128-gcm96`, `aes
+0001c000: 3235 362d 6763 6d60 2c20 616e 6420 0d0a  256-gcm`, and ..
+0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c030: 2020 2020 2020 2020 2020 2020 2060 6368               `ch
+0001c040: 6163 6861 3230 2d70 6f6c 7931 3330 3560  acha20-poly1305`
+0001c050: 292e 2044 6566 6175 6c74 7320 746f 2022  ). Defaults to "
+0001c060: 222e 0d0a 2020 2020 2020 2020 2020 2020  "...            
+0001c070: 636f 6e74 6578 7420 2873 7472 2c20 6f70  context (str, op
+0001c080: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
+0001c090: 6573 2074 6865 2062 6173 6536 3420 656e  es the base64 en
+0001c0a0: 636f 6465 6420 636f 6e74 6578 7420 666f  coded context fo
+0001c0b0: 7220 6b65 7920 6465 7269 7661 7469 6f6e  r key derivation
+0001c0c0: 2e20 5468 6973 2069 7320 7265 7175 6972  . This is requir
+0001c0d0: 6564 2069 6620 6b65 7920 6465 7269 7661  ed if key deriva
+0001c0e0: 7469 6f6e 200d 0a20 2020 2020 2020 2020  tion ..         
+0001c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c100: 2020 2020 2020 2020 2020 2020 6973 2065              is e
+0001c110: 6e61 626c 6564 2066 6f72 2074 6869 7320  nabled for this 
+0001c120: 6b65 792e 2044 6566 6175 6c74 7320 746f  key. Defaults to
+0001c130: 2022 222e 0d0a 2020 2020 2020 2020 2020   ""...          
+0001c140: 2020 6b65 795f 7665 7273 696f 6e20 284f    key_version (O
+0001c150: 7074 696f 6e61 6c5b 696e 745d 2c20 6f70  ptional[int], op
+0001c160: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
+0001c170: 6573 2074 6865 2076 6572 7369 6f6e 206f  es the version o
+0001c180: 6620 7468 6520 6b65 7920 746f 2075 7365  f the key to use
+0001c190: 2066 6f72 2065 6e63 7279 7074 696f 6e2e   for encryption.
+0001c1a0: 2049 6620 6e6f 7420 7365 742c 2075 7365   If not set, use
+0001c1b0: 7320 7468 6520 0d0a 2020 2020 2020 2020  s the ..        
+0001c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1e0: 2020 2020 2020 2020 2020 206c 6174 6573             lates
+0001c1f0: 7420 7665 7273 696f 6e2e 204d 7573 7420  t version. Must 
+0001c200: 6265 2067 7265 6174 6572 2074 6861 6e20  be greater than 
+0001c210: 6f72 2065 7175 616c 2074 6f20 7468 6520  or equal to the 
+0001c220: 6b65 7927 7320 606d 696e 5f65 6e63 7279  key's `min_encry
+0001c230: 7074 696f 6e5f 7665 7273 696f 6e60 2c20  ption_version`, 
+0001c240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c270: 2020 2020 2069 6620 7365 742e 2044 6566       if set. Def
+0001c280: 6175 6c74 7320 746f 204e 6f6e 652e 0d0a  aults to None...
+0001c290: 2020 2020 2020 2020 2020 2020 6e6f 6e63              nonc
+0001c2a0: 6520 2873 7472 2c20 6f70 7469 6f6e 616c  e (str, optional
+0001c2b0: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
+0001c2c0: 2062 6173 6536 3420 656e 636f 6465 6420   base64 encoded 
+0001c2d0: 6e6f 6e63 6520 7661 6c75 652e 2054 6869  nonce value. Thi
+0001c2e0: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
+0001c2f0: 6564 2069 6620 636f 6e76 6572 6765 6e74  ed if convergent
+0001c300: 2065 6e63 7279 7074 696f 6e20 6973 200d   encryption is .
+0001c310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c330: 2020 2020 656e 6162 6c65 6420 666f 7220      enabled for 
+0001c340: 7468 6973 206b 6579 2061 6e64 2074 6865  this key and the
+0001c350: 206b 6579 2077 6173 2067 656e 6572 6174   key was generat
+0001c360: 6564 2077 6974 6820 5661 756c 7420 302e  ed with Vault 0.
+0001c370: 362e 312e 204e 6f74 2072 6571 7569 7265  6.1. Not require
+0001c380: 6420 666f 7220 6b65 7973 2063 7265 6174  d for keys creat
+0001c390: 6564 200d 0a20 2020 2020 2020 2020 2020  ed ..           
+0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3b0: 2020 2020 2020 2020 696e 2030 2e36 2e32          in 0.6.2
+0001c3c0: 2b2e 2054 6865 2076 616c 7565 206d 7573  +. The value mus
+0001c3d0: 7420 6265 2065 7861 6374 6c79 2039 3620  t be exactly 96 
+0001c3e0: 6269 7473 2028 3132 2062 7974 6573 2920  bits (12 bytes) 
+0001c3f0: 6c6f 6e67 2061 6e64 2074 6865 2075 7365  long and the use
+0001c400: 7220 6d75 7374 2065 6e73 7572 6520 7468  r must ensure th
+0001c410: 6174 2066 6f72 200d 0a20 2020 2020 2020  at for ..       
+0001c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c430: 2020 2020 2020 2020 2020 2020 616e 7920              any 
+0001c440: 6769 7665 6e20 636f 6e74 6578 7420 2861  given context (a
+0001c450: 6e64 2074 6875 732c 2061 6e79 2067 6976  nd thus, any giv
+0001c460: 656e 2065 6e63 7279 7074 696f 6e20 6b65  en encryption ke
+0001c470: 7929 2074 6869 7320 6e6f 6e63 6520 7661  y) this nonce va
+0001c480: 6c75 6520 6973 206e 6576 6572 2072 6575  lue is never reu
+0001c490: 7365 642e 2044 6566 6175 6c74 7320 0d0a  sed. Defaults ..
+0001c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4c0: 2020 2074 6f20 2222 2e0d 0a20 2020 2020     to ""...     
+0001c4d0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+0001c4e0: 2028 7374 722c 206f 7074 696f 6e61 6c29   (str, optional)
+0001c4f0: 3a20 4120 7573 6572 2d73 7570 706c 6965  : A user-supplie
+0001c500: 6420 7374 7269 6e67 2074 6861 7420 7769  d string that wi
+0001c510: 6c6c 2062 6520 7072 6573 656e 7420 696e  ll be present in
+0001c520: 2074 6865 2060 7265 6665 7265 6e63 6560   the `reference`
+0001c530: 2066 6965 6c64 206f 6e20 7468 6520 636f   field on the co
+0001c540: 7272 6573 706f 6e64 696e 6720 0d0a 2020  rresponding ..  
+0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c570: 2020 2020 2060 6261 7463 685f 7265 7375       `batch_resu
+0001c580: 6c74 7360 2069 7465 6d20 696e 2074 6865  lts` item in the
+0001c590: 2072 6573 706f 6e73 652c 2074 6f20 6173   response, to as
+0001c5a0: 7369 7374 2069 6e20 756e 6465 7273 7461  sist in understa
+0001c5b0: 6e64 696e 6720 7768 6963 6820 7265 7375  nding which resu
+0001c5c0: 6c74 2063 6f72 7265 7370 6f6e 6473 200d  lt corresponds .
+0001c5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5f0: 2020 2020 2020 2020 746f 2061 2070 6172          to a par
+0001c600: 7469 6375 6c61 7220 696e 7075 742e 204f  ticular input. O
+0001c610: 6e6c 7920 7661 6c69 6420 6f6e 2062 6174  nly valid on bat
+0001c620: 6368 2072 6571 7565 7374 7320 7768 656e  ch requests when
+0001c630: 2075 7369 6e67 20e2 8098 6261 7463 685f   using ...batch_
+0001c640: 696e 7075 74e2 8099 2062 656c 6f77 2e20  input... below. 
+0001c650: 4465 6661 756c 7473 200d 0a20 2020 2020  Defaults ..     
+0001c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c680: 2020 746f 2022 222e 0d0a 2020 2020 2020    to ""...      
+0001c690: 2020 2020 2020 6261 7463 685f 696e 7075        batch_inpu
+0001c6a0: 7420 284f 7074 696f 6e61 6c5b 4c69 7374  t (Optional[List
+0001c6b0: 5b64 6963 745d 5d2c 206f 7074 696f 6e61  [dict]], optiona
+0001c6c0: 6c29 3a20 5370 6563 6966 6965 7320 6120  l): Specifies a 
+0001c6d0: 6c69 7374 206f 6620 6974 656d 7320 746f  list of items to
+0001c6e0: 2062 6520 656e 6372 7970 7465 6420 696e   be encrypted in
+0001c6f0: 2061 2073 696e 676c 6520 6261 7463 682e   a single batch.
+0001c700: 2057 6865 6e20 7468 6973 200d 0a20 2020   When this ..   
 0001c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c720: 2020 2070 6172 616d 6574 6572 2069 7320     parameter is 
-0001c730: 7365 742c 2069 6620 7468 6520 7061 7261  set, if the para
-0001c740: 6d65 7465 7273 2027 706c 6169 6e74 6578  meters 'plaintex
-0001c750: 7427 2c20 2763 6f6e 7465 7874 2720 616e  t', 'context' an
-0001c760: 6420 276e 6f6e 6365 2720 0d0a 2020 2020  d 'nonce' ..    
-0001c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c740: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
+0001c750: 2069 7320 7365 742c 2069 6620 7468 6520   is set, if the 
+0001c760: 7061 7261 6d65 7465 7273 2027 706c 6169  parameters 'plai
+0001c770: 6e74 6578 7427 2c20 2763 6f6e 7465 7874  ntext', 'context
+0001c780: 2720 616e 6420 276e 6f6e 6365 2720 0d0a  ' and 'nonce' ..
 0001c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7a0: 2020 2020 2020 6172 6520 616c 736f 2073        are also s
-0001c7b0: 6574 2c20 7468 6579 2077 696c 6c20 6265  et, they will be
-0001c7c0: 2069 676e 6f72 6564 2e20 416e 7920 6261   ignored. Any ba
-0001c7d0: 7463 6820 6f75 7470 7574 2077 696c 6c20  tch output will 
-0001c7e0: 7072 6573 6572 7665 2074 6865 200d 0a20  preserve the .. 
-0001c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c820: 2020 2020 2020 2020 206f 7264 6572 206f           order o
-0001c830: 6620 7468 6520 6261 7463 6820 696e 7075  f the batch inpu
-0001c840: 742e 2044 6566 6175 6c74 7320 746f 204e  t. Defaults to N
-0001c850: 6f6e 652e 0d0a 2020 2020 2020 2020 2020  one...          
-0001c860: 2020 7061 7274 6961 6c5f 6661 696c 7572    partial_failur
-0001c870: 655f 7265 7370 6f6e 7365 5f63 6f64 6520  e_response_code 
-0001c880: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
-0001c890: 204f 7264 696e 6172 696c 792c 2069 6620   Ordinarily, if 
-0001c8a0: 6120 6261 7463 6820 6974 656d 2066 6169  a batch item fai
-0001c8b0: 6c73 2074 6f20 656e 6372 7970 7420 6475  ls to encrypt du
-0001c8c0: 6520 746f 2061 2062 6164 2069 6e70 7574  e to a bad input
-0001c8d0: 2c20 6275 7420 6f74 6865 7220 0d0a 2020  , but other ..  
-0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c910: 2020 2020 2020 2020 2062 6174 6368 2069           batch i
-0001c920: 7465 6d73 2073 7563 6365 6564 2c20 7468  tems succeed, th
-0001c930: 6520 4854 5450 2072 6573 706f 6e73 6520  e HTTP response 
-0001c940: 636f 6465 2069 7320 3430 3020 2842 6164  code is 400 (Bad
-0001c950: 2052 6571 7565 7374 292e 2053 6f6d 6520   Request). Some 
-0001c960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c990: 2020 2020 2020 2020 2020 2020 2061 7070               app
-0001c9a0: 6c69 6361 7469 6f6e 7320 6d61 7920 7761  lications may wa
-0001c9b0: 6e74 2074 6f20 7472 6561 7420 7061 7274  nt to treat part
-0001c9c0: 6961 6c20 6661 696c 7572 6573 2064 6966  ial failures dif
-0001c9d0: 6665 7265 6e74 6c79 2e20 5072 6f76 6964  ferently. Provid
-0001c9e0: 696e 6720 7468 6520 0d0a 2020 2020 2020  ing the ..      
-0001c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7c0: 2020 2020 2020 2020 2020 6172 6520 616c            are al
+0001c7d0: 736f 2073 6574 2c20 7468 6579 2077 696c  so set, they wil
+0001c7e0: 6c20 6265 2069 676e 6f72 6564 2e20 416e  l be ignored. An
+0001c7f0: 7920 6261 7463 6820 6f75 7470 7574 2077  y batch output w
+0001c800: 696c 6c20 7072 6573 6572 7665 2074 6865  ill preserve the
+0001c810: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0001c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c840: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0001c850: 6572 206f 6620 7468 6520 6261 7463 6820  er of the batch 
+0001c860: 696e 7075 742e 2044 6566 6175 6c74 7320  input. Defaults 
+0001c870: 746f 204e 6f6e 652e 0d0a 2020 2020 2020  to None...      
+0001c880: 2020 2020 2020 7061 7274 6961 6c5f 6661        partial_fa
+0001c890: 696c 7572 655f 7265 7370 6f6e 7365 5f63  ilure_response_c
+0001c8a0: 6f64 6520 2869 6e74 2c20 6f70 7469 6f6e  ode (int, option
+0001c8b0: 616c 293a 204f 7264 696e 6172 696c 792c  al): Ordinarily,
+0001c8c0: 2069 6620 6120 6261 7463 6820 6974 656d   if a batch item
+0001c8d0: 2066 6169 6c73 2074 6f20 656e 6372 7970   fails to encryp
+0001c8e0: 7420 6475 6520 746f 2061 2062 6164 2069  t due to a bad i
+0001c8f0: 6e70 7574 2c20 6275 7420 6f74 6865 7220  nput, but other 
+0001c900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c930: 2020 2020 2020 2020 2020 2020 2062 6174               bat
+0001c940: 6368 2069 7465 6d73 2073 7563 6365 6564  ch items succeed
+0001c950: 2c20 7468 6520 4854 5450 2072 6573 706f  , the HTTP respo
+0001c960: 6e73 6520 636f 6465 2069 7320 3430 3020  nse code is 400 
+0001c970: 2842 6164 2052 6571 7565 7374 292e 2053  (Bad Request). S
+0001c980: 6f6d 6520 0d0a 2020 2020 2020 2020 2020  ome ..          
+0001c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9c0: 2061 7070 6c69 6361 7469 6f6e 7320 6d61   applications ma
+0001c9d0: 7920 7761 6e74 2074 6f20 7472 6561 7420  y want to treat 
+0001c9e0: 7061 7274 6961 6c20 6661 696c 7572 6573  partial failures
+0001c9f0: 2064 6966 6665 7265 6e74 6c79 2e20 5072   differently. Pr
+0001ca00: 6f76 6964 696e 6720 7468 6520 0d0a 2020  oviding the ..  
 0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca20: 2020 2020 2070 6172 616d 6574 6572 2072       parameter r
-0001ca30: 6574 7572 6e73 2074 6865 2067 6976 656e  eturns the given
-0001ca40: 2072 6573 706f 6e73 6520 636f 6465 2069   response code i
-0001ca50: 6e74 6567 6572 2069 6e73 7465 6164 206f  nteger instead o
-0001ca60: 6620 6120 6661 696c 6564 2073 7461 7475  f a failed statu
-0001ca70: 7320 0d0a 2020 2020 2020 2020 2020 2020  s ..            
-0001ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001cab0: 6f64 6520 696e 2074 6869 7320 6361 7365  ode in this case
-0001cac0: 2e20 4966 2061 6c6c 2076 616c 7565 7320  . If all values 
-0001cad0: 6661 696c 2061 6e20 6572 726f 7220 636f  fail an error co
-0001cae0: 6465 2069 7320 7374 696c 6c20 7265 7475  de is still retu
-0001caf0: 726e 6564 2e20 4265 200d 0a20 2020 2020  rned. Be ..     
-0001cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca40: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
+0001ca50: 6572 2072 6574 7572 6e73 2074 6865 2067  er returns the g
+0001ca60: 6976 656e 2072 6573 706f 6e73 6520 636f  iven response co
+0001ca70: 6465 2069 6e74 6567 6572 2069 6e73 7465  de integer inste
+0001ca80: 6164 206f 6620 6120 6661 696c 6564 2073  ad of a failed s
+0001ca90: 7461 7475 7320 0d0a 2020 2020 2020 2020  tatus ..        
+0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cad0: 2020 2063 6f64 6520 696e 2074 6869 7320     code in this 
+0001cae0: 6361 7365 2e20 4966 2061 6c6c 2076 616c  case. If all val
+0001caf0: 7565 7320 6661 696c 2061 6e20 6572 726f  ues fail an erro
+0001cb00: 7220 636f 6465 2069 7320 7374 696c 6c20  r code is still 
+0001cb10: 7265 7475 726e 6564 2e20 4265 200d 0a20  returned. Be .. 
 0001cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb30: 2020 2020 2020 7761 726e 6564 2074 6861        warned tha
-0001cb40: 7420 736f 6d65 2066 6169 6c75 7265 7320  t some failures 
-0001cb50: 2873 7563 6820 6173 2066 6169 6c75 7265  (such as failure
-0001cb60: 2074 6f20 6465 6372 7970 7429 2063 6f75   to decrypt) cou
-0001cb70: 6c64 2062 6520 696e 6469 6361 7469 7665  ld be indicative
-0001cb80: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbb0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-0001cbc0: 2061 2073 6563 7572 6974 7920 6272 6561   a security brea
-0001cbd0: 6368 2061 6e64 2073 686f 756c 6420 6e6f  ch and should no
-0001cbe0: 7420 6265 2069 676e 6f72 6564 2e20 4465  t be ignored. De
-0001cbf0: 6661 756c 7473 2074 6f20 3430 302e 0d0a  faults to 400...
-0001cc00: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0001cc10: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0001cc20: 6469 6374 206f 7220 4e6f 6e65 3a20 7265  dict or None: re
-0001cc30: 7475 726e 2074 6865 2063 6970 6865 7220  turn the cipher 
-0001cc40: 7465 7874 2069 6e20 6469 6374 2069 6620  text in dict if 
-0001cc50: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
-0001cc60: 7365 2072 6574 7572 6e20 4e6f 6e65 0d0a  se return None..
-0001cc70: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0001cc80: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
-0001cc90: 6175 7468 3a0d 0a20 2020 2020 2020 2020  auth:..         
-0001cca0: 2020 2065 7869 7374 5f6b 6579 7320 3d20     exist_keys = 
-0001ccb0: 7365 6c66 2e6c 6973 745f 6b65 7928 6d6f  self.list_key(mo
-0001ccc0: 756e 745f 7061 7468 290d 0a20 2020 2020  unt_path)..     
-0001ccd0: 2020 2020 2020 2069 6620 6e61 6d65 206e         if name n
-0001cce0: 6f74 2069 6e20 6578 6973 745f 6b65 7973  ot in exist_keys
-0001ccf0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001cd00: 2020 2073 656c 662e 6c6f 6767 6572 2e77     self.logger.w
-0001cd10: 6172 6e69 6e67 2866 227b 5f5f 636c 6173  arning(f"{__clas
-0001cd20: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-0001cd30: 656e 6372 7970 7420 6461 7461 2077 6172  encrypt data war
-0001cd40: 6e69 6e67 3a20 6b65 7920 277b 6e61 6d65  ning: key '{name
-0001cd50: 7d27 206e 6f74 2066 6f75 6e64 2e20 416c  }' not found. Al
-0001cd60: 7468 6f75 6768 2074 6865 2048 5454 5020  though the HTTP 
-0001cd70: 4150 4920 6f66 2056 6175 6c74 2022 0d0a  API of Vault "..
-0001cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cda0: 2020 2020 6622 616c 6c6f 7720 746f 2063      f"allow to c
-0001cdb0: 7265 6174 6520 6b65 7920 7768 656e 2065  reate key when e
-0001cdc0: 6e63 7279 7074 696e 6720 6461 7461 2c20  ncrypting data, 
-0001cdd0: 7765 2068 6f70 6520 796f 7520 7573 6520  we hope you use 
-0001cde0: 6063 7265 6174 655f 6b65 7928 2960 2074  `create_key()` t
-0001cdf0: 6f20 6372 6561 7465 206b 6579 2229 0d0a  o create key")..
-0001ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce10: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
-0001ce20: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
-0001ce30: 6164 203d 2064 6963 7428 290d 0a20 2020  ad = dict()..   
-0001ce40: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-0001ce50: 2020 2020 2020 2069 6620 6261 7463 685f         if batch_
-0001ce60: 696e 7075 7420 6973 204e 6f6e 653a 0d0a  input is None:..
-0001ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce80: 6966 206e 6f74 2069 735f 6261 7365 3634  if not is_base64
-0001ce90: 2870 6c61 696e 7465 7874 293a 0d0a 2020  (plaintext):..  
-0001cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ceb0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-0001cec0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-0001ced0: 2e5f 5f6e 616d 655f 5f7d 202d 2065 6e63  .__name__} - enc
-0001cee0: 7279 7074 2064 6174 6120 6572 726f 723a  rypt data error:
-0001cef0: 2074 6865 2070 6c61 696e 7465 7874 206d   the plaintext m
-0001cf00: 7573 7420 6265 2062 6173 6536 3420 656e  ust be base64 en
-0001cf10: 636f 6465 6422 290d 0a20 2020 2020 2020  coded")..       
-0001cf20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001cf30: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
-0001cf40: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-0001cf50: 645b 2270 6c61 696e 7465 7874 225d 203d  d["plaintext"] =
-0001cf60: 2070 6c61 696e 7465 7874 0d0a 2020 2020   plaintext..    
-0001cf70: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001cf80: 2020 2020 2020 6966 2061 7373 6f63 6961        if associa
-0001cf90: 7465 645f 6461 7461 2021 3d20 2222 3a0d  ted_data != "":.
-0001cfa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cfb0: 2069 6620 6e6f 7420 6973 5f62 6173 6536   if not is_base6
-0001cfc0: 3428 6173 736f 6369 6174 6564 5f64 6174  4(associated_dat
-0001cfd0: 6129 3a0d 0a20 2020 2020 2020 2020 2020  a):..           
-0001cfe0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-0001cff0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
-0001d000: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0001d010: 7d20 2d20 656e 6372 7970 7420 6461 7461  } - encrypt data
-0001d020: 2065 7272 6f72 3a20 7468 6520 6173 736f   error: the asso
-0001d030: 6369 6174 6564 5f64 6174 6120 6d75 7374  ciated_data must
-0001d040: 2062 6520 6261 7365 3634 2065 6e63 6f64   be base64 encod
-0001d050: 6564 2069 6620 7365 7422 290d 0a20 2020  ed if set")..   
-0001d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d070: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-0001d080: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001d090: 796c 6f61 645b 2261 7373 6f63 6961 7465  yload["associate
-0001d0a0: 645f 6461 7461 225d 203d 2061 7373 6f63  d_data"] = assoc
-0001d0b0: 6961 7465 645f 6461 7461 0d0a 2020 2020  iated_data..    
-0001d0c0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001d0d0: 2020 2020 2020 6966 2062 6174 6368 5f69        if batch_i
-0001d0e0: 6e70 7574 2069 7320 4e6f 6e65 2061 6e64  nput is None and
-0001d0f0: 2063 6f6e 7465 7874 2021 3d20 2222 3a0d   context != "":.
-0001d100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d110: 2069 6620 6e6f 7420 6973 5f62 6173 6536   if not is_base6
-0001d120: 3428 636f 6e74 6578 7429 3a0d 0a20 2020  4(context):..   
-0001d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d140: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-0001d150: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-0001d160: 5f5f 6e61 6d65 5f5f 7d20 2d20 656e 6372  __name__} - encr
-0001d170: 7970 7420 6461 7461 2065 7272 6f72 3a20  ypt data error: 
-0001d180: 7468 6520 636f 6e74 6578 7420 6d75 7374  the context must
-0001d190: 2062 6520 6261 7365 3634 2065 6e63 6f64   be base64 encod
-0001d1a0: 6564 2069 6620 7365 7422 290d 0a20 2020  ed if set")..   
-0001d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1c0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-0001d1d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001d1e0: 796c 6f61 645b 2263 6f6e 7465 7874 225d  yload["context"]
-0001d1f0: 203d 2063 6f6e 7465 7874 0d0a 0d0a 2020   = context....  
-0001d200: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-0001d210: 5f76 6572 7369 6f6e 2069 7320 6e6f 7420  _version is not 
-0001d220: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0001d230: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0001d240: 5f69 6e74 286b 6579 5f76 6572 7369 6f6e  _int(key_version
-0001d250: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001d260: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0001d270: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
-0001d280: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0001d290: 202d 2065 6e63 7279 7074 2064 6174 6120   - encrypt data 
-0001d2a0: 6572 726f 723a 2074 6865 206b 6579 5f76  error: the key_v
-0001d2b0: 6572 7369 6f6e 206d 7573 7420 6265 2061  ersion must be a
-0001d2c0: 6e20 696e 7465 6765 7222 290d 0a20 2020  n integer")..   
-0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2e0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-0001d2f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d300: 206b 6579 5f76 6572 7369 6f6e 203c 2073   key_version < s
-0001d310: 656c 662e 7265 6164 5f6b 6579 286d 6f75  elf.read_key(mou
-0001d320: 6e74 5f70 6174 682c 206e 616d 6529 5b22  nt_path, name)["
-0001d330: 6d69 6e5f 656e 6372 7970 7469 6f6e 5f76  min_encryption_v
-0001d340: 6572 7369 6f6e 225d 3a0d 0a20 2020 2020  ersion"]:..     
-0001d350: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d360: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-0001d370: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-0001d380: 6e61 6d65 5f5f 7d20 2d20 656e 6372 7970  name__} - encryp
-0001d390: 7420 6461 7461 2065 7272 6f72 3a20 6772  t data error: gr
-0001d3a0: 6561 7465 7220 7468 616e 206f 7220 6571  eater than or eq
-0001d3b0: 7561 6c20 746f 2074 6865 206b 6579 2773  ual to the key's
-0001d3c0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-0001d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3e0: 2020 2020 2020 2020 2020 6622 606d 696e            f"`min
-0001d3f0: 5f65 6e63 7279 7074 696f 6e5f 7665 7273  _encryption_vers
-0001d400: 696f 6e60 2c20 6966 2073 6574 2229 0d0a  ion`, if set")..
-0001d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d420: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-0001d430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d440: 2070 6179 6c6f 6164 5b22 6b65 795f 7665   payload["key_ve
-0001d450: 7273 696f 6e22 5d20 3d20 6b65 795f 7665  rsion"] = key_ve
-0001d460: 7273 696f 6e0d 0a0d 0a20 2020 2020 2020  rsion....       
-0001d470: 2020 2020 2069 6620 6261 7463 685f 696e       if batch_in
-0001d480: 7075 7420 6973 204e 6f6e 6520 616e 6420  put is None and 
-0001d490: 6e6f 6e63 6520 213d 2022 223a 0d0a 2020  nonce != "":..  
-0001d4a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d4b0: 206e 6f74 2069 735f 6261 7365 3634 286e   not is_base64(n
-0001d4c0: 6f6e 6365 293a 0d0a 2020 2020 2020 2020  once):..        
-0001d4d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001d4e0: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-0001d4f0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-0001d500: 655f 5f7d 202d 2065 6e63 7279 7074 2064  e__} - encrypt d
-0001d510: 6174 6120 6572 726f 723a 2074 6865 206e  ata error: the n
-0001d520: 6f6e 6365 206d 7573 7420 6265 2062 6173  once must be bas
-0001d530: 6536 3420 656e 636f 6465 6420 6966 2073  e64 encoded if s
-0001d540: 6574 2229 0d0a 2020 2020 2020 2020 2020  et")..          
-0001d550: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001d560: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0001d570: 2020 2020 2020 2069 6620 6c65 6e28 6e6f         if len(no
-0001d580: 6e63 6529 2021 3d20 3132 3a0d 0a20 2020  nce) != 12:..   
-0001d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5a0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-0001d5b0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-0001d5c0: 5f5f 6e61 6d65 5f5f 7d20 2d20 656e 6372  __name__} - encr
-0001d5d0: 7970 7420 6461 7461 2065 7272 6f72 3a20  ypt data error: 
-0001d5e0: 7468 6520 6e6f 6e63 6520 6d75 7374 2062  the nonce must b
-0001d5f0: 6520 6578 6163 746c 7920 3936 2062 6974  e exactly 96 bit
-0001d600: 7320 2831 3220 6279 7465 7329 206c 6f6e  s (12 bytes) lon
-0001d610: 6720 6966 2073 6574 2229 0d0a 2020 2020  g if set")..    
-0001d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d630: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-0001d640: 2020 2020 2020 2020 2020 2020 2070 6179               pay
-0001d650: 6c6f 6164 5b22 6e6f 6e63 6522 5d20 3d20  load["nonce"] = 
-0001d660: 6e6f 6e63 650d 0a20 2020 2020 2020 2020  nonce..         
-0001d670: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-0001d680: 2069 6620 6261 7463 685f 696e 7075 7420   if batch_input 
-0001d690: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d6b0: 2072 6566 6572 656e 6365 2021 3d20 2222   reference != ""
-0001d6c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001d6d0: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
-0001d6e0: 7265 6665 7265 6e63 6522 5d20 3d20 7265  reference"] = re
-0001d6f0: 6665 7265 6e63 650d 0a20 2020 2020 2020  ference..       
-0001d700: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
-0001d710: 5b22 6261 7463 685f 696e 7075 7422 5d20  ["batch_input"] 
-0001d720: 3d20 6261 7463 685f 696e 7075 740d 0a0d  = batch_input...
-0001d730: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
-0001d740: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
-0001d750: 6578 7428 7365 6c66 2e75 726c 2c20 6b65  ext(self.url, ke
-0001d760: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
-0001d770: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
-0001d780: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
-0001d790: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
-0001d7a0: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
-0001d7b0: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
-0001d7c0: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
-0001d7d0: 7428 7365 6c66 2e74 6f6b 656e 2c20 6b65  t(self.token, ke
-0001d7e0: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
-0001d7f0: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
-0001d800: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
-0001d810: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
-0001d820: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
-0001d830: 2020 2020 2020 2020 2072 6573 203d 2072           res = r
-0001d840: 6571 7565 7374 732e 706f 7374 2875 726c  equests.post(url
-0001d850: 2b66 227b 6d6f 756e 745f 7061 7468 7d2f  +f"{mount_path}/
-0001d860: 656e 6372 7970 742f 7b6e 616d 657d 222c  encrypt/{name}",
-0001d870: 2068 6561 6465 7273 3d7b 2258 2d56 6175   headers={"X-Vau
-0001d880: 6c74 2d54 6f6b 656e 223a 2074 6f6b 656e  lt-Token": token
-0001d890: 7d2c 2064 6174 613d 6a73 6f6e 2e64 756d  }, data=json.dum
-0001d8a0: 7073 2870 6179 6c6f 6164 2929 0d0a 2020  ps(payload))..  
-0001d8b0: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-0001d8c0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-0001d8d0: 3230 3020 6f72 2072 6573 2e73 7461 7475  200 or res.statu
-0001d8e0: 735f 636f 6465 203d 3d20 3230 343a 0d0a  s_code == 204:..
-0001d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d900: 7265 7475 726e 2072 6573 2e6a 736f 6e28  return res.json(
-0001d910: 295b 2264 6174 6122 5d0d 0a20 2020 2020  )["data"]..     
-0001d920: 2020 2020 2020 2065 6c69 6620 7265 732e         elif res.
-0001d930: 7374 6174 7573 5f63 6f64 6520 3d3d 2070  status_code == p
-0001d940: 6172 7469 616c 5f66 6169 6c75 7265 5f72  artial_failure_r
-0001d950: 6573 706f 6e73 655f 636f 6465 3a0d 0a20  esponse_code:.. 
-0001d960: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d970: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-0001d980: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-0001d990: 6e61 6d65 5f5f 7d20 2d20 656e 6372 7970  name__} - encryp
-0001d9a0: 7420 6461 7461 2065 7272 6f72 3a20 7061  t data error: pa
-0001d9b0: 7274 6961 6c20 6661 696c 7572 6520 7261  rtial failure ra
-0001d9c0: 6973 6564 2229 0d0a 2020 2020 2020 2020  ised")..        
-0001d9d0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001d9e0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0001d9f0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0001da00: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-0001da10: 675f 6572 726f 725f 7265 7370 6f6e 7365  g_error_response
-0001da20: 285f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  (__class__.__nam
-0001da30: 655f 5f2c 2072 6573 2c20 2265 6e63 7279  e__, res, "encry
-0001da40: 7074 2064 6174 6120 6572 726f 7222 290d  pt data error").
-0001da50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001da60: 2072 6574 7572 6e20 4e6f 6e65 0d0a 0d0a   return None....
-0001da70: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001da80: 6f6e 650d 0a0d 0a20 2020 2023 2054 4f44  one....    # TOD
-0001da90: 4f3a 2077 6169 7420 666f 7220 7465 7374  O: wait for test
-0001daa0: 696e 670d 0a20 2020 2064 6566 2064 6563  ing..    def dec
-0001dab0: 7279 7074 5f64 6174 6128 7365 6c66 2c20  rypt_data(self, 
-0001dac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001dad0: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
-0001dae0: 683a 2073 7472 2c0d 0a20 2020 2020 2020  h: str,..       
-0001daf0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0001db00: 6d65 3a20 7374 722c 0d0a 2020 2020 2020  me: str,..      
-0001db10: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001db20: 6970 6865 7274 6578 743a 2073 7472 203d  iphertext: str =
-0001db30: 2022 222c 0d0a 2020 2020 2020 2020 2020   "",..          
-0001db40: 2020 2020 2020 2020 2020 2061 7373 6f63             assoc
-0001db50: 6961 7465 645f 6461 7461 3a20 7374 7220  iated_data: str 
-0001db60: 3d20 2222 2c0d 0a20 2020 2020 2020 2020  = "",..         
-0001db70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001db80: 6578 743a 2073 7472 203d 2022 222c 0d0a  ext: str = "",..
+0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb50: 2020 2020 2020 2020 2020 7761 726e 6564            warned
+0001cb60: 2074 6861 7420 736f 6d65 2066 6169 6c75   that some failu
+0001cb70: 7265 7320 2873 7563 6820 6173 2066 6169  res (such as fai
+0001cb80: 6c75 7265 2074 6f20 6465 6372 7970 7429  lure to decrypt)
+0001cb90: 2063 6f75 6c64 2062 6520 696e 6469 6361   could be indica
+0001cba0: 7469 7665 200d 0a20 2020 2020 2020 2020  tive ..         
+0001cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 2020 6f66 2061 2073 6563 7572 6974 7920    of a security 
+0001cbf0: 6272 6561 6368 2061 6e64 2073 686f 756c  breach and shoul
+0001cc00: 6420 6e6f 7420 6265 2069 676e 6f72 6564  d not be ignored
+0001cc10: 2e20 4465 6661 756c 7473 2074 6f20 3430  . Defaults to 40
+0001cc20: 302e 0d0a 0d0a 2020 2020 2020 2020 5265  0.....        Re
+0001cc30: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
+0001cc40: 2020 2020 6469 6374 206f 7220 4e6f 6e65      dict or None
+0001cc50: 3a20 7265 7475 726e 2074 6865 2063 6970  : return the cip
+0001cc60: 6865 7220 7465 7874 2069 6e20 6469 6374  her text in dict
+0001cc70: 2069 6620 7375 6363 6573 732c 206f 7468   if success, oth
+0001cc80: 6572 7769 7365 2072 6574 7572 6e20 4e6f  erwise return No
+0001cc90: 6e65 0d0a 2020 2020 2020 2020 2222 220d  ne..        """.
+0001cca0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001ccb0: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
+0001ccc0: 2020 2020 2020 2065 7869 7374 5f6b 6579         exist_key
+0001ccd0: 7320 3d20 7365 6c66 2e6c 6973 745f 6b65  s = self.list_ke
+0001cce0: 7928 6d6f 756e 745f 7061 7468 290d 0a20  y(mount_path).. 
+0001ccf0: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
+0001cd00: 6d65 206e 6f74 2069 6e20 6578 6973 745f  me not in exist_
+0001cd10: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
+0001cd20: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+0001cd30: 6572 2e77 6172 6e69 6e67 2866 227b 5f5f  er.warning(f"{__
+0001cd40: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001cd50: 7d20 2d20 656e 6372 7970 7420 6461 7461  } - encrypt data
+0001cd60: 2077 6172 6e69 6e67 3a20 6b65 7920 277b   warning: key '{
+0001cd70: 6e61 6d65 7d27 206e 6f74 2066 6f75 6e64  name}' not found
+0001cd80: 2e20 416c 7468 6f75 6768 2074 6865 2048  . Although the H
+0001cd90: 5454 5020 4150 4920 6f66 2056 6175 6c74  TTP API of Vault
+0001cda0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdc0: 2020 2020 2020 2020 6622 616c 6c6f 7720          f"allow 
+0001cdd0: 746f 2063 7265 6174 6520 6b65 7920 7768  to create key wh
+0001cde0: 656e 2065 6e63 7279 7074 696e 6720 6461  en encrypting da
+0001cdf0: 7461 2c20 7765 2068 6f70 6520 796f 7520  ta, we hope you 
+0001ce00: 7573 6520 6063 7265 6174 655f 6b65 7928  use `create_key(
+0001ce10: 2960 2074 6f20 6372 6561 7465 206b 6579  )` to create key
+0001ce20: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0001ce30: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+0001ce40: 0a0d 0a20 2020 2020 2020 2020 2020 2070  ...            p
+0001ce50: 6179 6c6f 6164 203d 2064 6963 7428 290d  ayload = dict().
+0001ce60: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+0001ce70: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
+0001ce80: 7463 685f 696e 7075 7420 6973 204e 6f6e  tch_input is Non
+0001ce90: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0001cea0: 2020 2020 6966 206e 6f74 2069 735f 6261      if not is_ba
+0001ceb0: 7365 3634 2870 6c61 696e 7465 7874 293a  se64(plaintext):
+0001cec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ced0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0001cee0: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
+0001cef0: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+0001cf00: 2065 6e63 7279 7074 2064 6174 6120 6572   encrypt data er
+0001cf10: 726f 723a 2074 6865 2070 6c61 696e 7465  ror: the plainte
+0001cf20: 7874 206d 7573 7420 6265 2062 6173 6536  xt must be base6
+0001cf30: 3420 656e 636f 6465 6422 290d 0a20 2020  4 encoded")..   
+0001cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf50: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+0001cf60: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0001cf70: 796c 6f61 645b 2270 6c61 696e 7465 7874  yload["plaintext
+0001cf80: 225d 203d 2070 6c61 696e 7465 7874 0d0a  "] = plaintext..
+0001cf90: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0001cfa0: 2020 2020 2020 2020 2020 6966 2061 7373            if ass
+0001cfb0: 6f63 6961 7465 645f 6461 7461 2021 3d20  ociated_data != 
+0001cfc0: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
+0001cfd0: 2020 2020 2069 6620 6e6f 7420 6973 5f62       if not is_b
+0001cfe0: 6173 6536 3428 6173 736f 6369 6174 6564  ase64(associated
+0001cff0: 5f64 6174 6129 3a0d 0a20 2020 2020 2020  _data):..       
+0001d000: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001d010: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
+0001d020: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
+0001d030: 6d65 5f5f 7d20 2d20 656e 6372 7970 7420  me__} - encrypt 
+0001d040: 6461 7461 2065 7272 6f72 3a20 7468 6520  data error: the 
+0001d050: 6173 736f 6369 6174 6564 5f64 6174 6120  associated_data 
+0001d060: 6d75 7374 2062 6520 6261 7365 3634 2065  must be base64 e
+0001d070: 6e63 6f64 6564 2069 6620 7365 7422 290d  ncoded if set").
+0001d080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d090: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0001d0a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d0b0: 2020 7061 796c 6f61 645b 2261 7373 6f63    payload["assoc
+0001d0c0: 6961 7465 645f 6461 7461 225d 203d 2061  iated_data"] = a
+0001d0d0: 7373 6f63 6961 7465 645f 6461 7461 0d0a  ssociated_data..
+0001d0e0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0001d0f0: 2020 2020 2020 2020 2020 6966 2062 6174            if bat
+0001d100: 6368 5f69 6e70 7574 2069 7320 4e6f 6e65  ch_input is None
+0001d110: 2061 6e64 2063 6f6e 7465 7874 2021 3d20   and context != 
+0001d120: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
+0001d130: 2020 2020 2069 6620 6e6f 7420 6973 5f62       if not is_b
+0001d140: 6173 6536 3428 636f 6e74 6578 7429 3a0d  ase64(context):.
+0001d150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d160: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0001d170: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+0001d180: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+0001d190: 656e 6372 7970 7420 6461 7461 2065 7272  encrypt data err
+0001d1a0: 6f72 3a20 7468 6520 636f 6e74 6578 7420  or: the context 
+0001d1b0: 6d75 7374 2062 6520 6261 7365 3634 2065  must be base64 e
+0001d1c0: 6e63 6f64 6564 2069 6620 7365 7422 290d  ncoded if set").
+0001d1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d1e0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0001d1f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d200: 2020 7061 796c 6f61 645b 2263 6f6e 7465    payload["conte
+0001d210: 7874 225d 203d 2063 6f6e 7465 7874 0d0a  xt"] = context..
+0001d220: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001d230: 206b 6579 5f76 6572 7369 6f6e 2069 7320   key_version is 
+0001d240: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0001d250: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0001d260: 7420 6973 5f69 6e74 286b 6579 5f76 6572  t is_int(key_ver
+0001d270: 7369 6f6e 293a 0d0a 2020 2020 2020 2020  sion):..        
+0001d280: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001d290: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
+0001d2a0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
+0001d2b0: 655f 5f7d 202d 2065 6e63 7279 7074 2064  e__} - encrypt d
+0001d2c0: 6174 6120 6572 726f 723a 2074 6865 206b  ata error: the k
+0001d2d0: 6579 5f76 6572 7369 6f6e 206d 7573 7420  ey_version must 
+0001d2e0: 6265 2061 6e20 696e 7465 6765 7222 290d  be an integer").
+0001d2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d300: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0001d310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d320: 2020 6966 206b 6579 5f76 6572 7369 6f6e    if key_version
+0001d330: 203c 2073 656c 662e 7265 6164 5f6b 6579   < self.read_key
+0001d340: 286d 6f75 6e74 5f70 6174 682c 206e 616d  (mount_path, nam
+0001d350: 6529 5b22 6d69 6e5f 656e 6372 7970 7469  e)["min_encrypti
+0001d360: 6f6e 5f76 6572 7369 6f6e 225d 3a0d 0a20  on_version"]:.. 
+0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d380: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+0001d390: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+0001d3a0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 656e  _.__name__} - en
+0001d3b0: 6372 7970 7420 6461 7461 2065 7272 6f72  crypt data error
+0001d3c0: 3a20 6772 6561 7465 7220 7468 616e 206f  : greater than o
+0001d3d0: 7220 6571 7561 6c20 746f 2074 6865 206b  r equal to the k
+0001d3e0: 6579 2773 2022 0d0a 2020 2020 2020 2020  ey's "..        
+0001d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d400: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0001d410: 606d 696e 5f65 6e63 7279 7074 696f 6e5f  `min_encryption_
+0001d420: 7665 7273 696f 6e60 2c20 6966 2073 6574  version`, if set
+0001d430: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0001d440: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001d450: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0001d460: 2020 2020 2070 6179 6c6f 6164 5b22 6b65       payload["ke
+0001d470: 795f 7665 7273 696f 6e22 5d20 3d20 6b65  y_version"] = ke
+0001d480: 795f 7665 7273 696f 6e0d 0a0d 0a20 2020  y_version....   
+0001d490: 2020 2020 2020 2020 2069 6620 6261 7463           if batc
+0001d4a0: 685f 696e 7075 7420 6973 204e 6f6e 6520  h_input is None 
+0001d4b0: 616e 6420 6e6f 6e63 6520 213d 2022 223a  and nonce != "":
+0001d4c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d4d0: 2020 6966 206e 6f74 2069 735f 6261 7365    if not is_base
+0001d4e0: 3634 286e 6f6e 6365 293a 0d0a 2020 2020  64(nonce):..    
+0001d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d500: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+0001d510: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+0001d520: 5f6e 616d 655f 5f7d 202d 2065 6e63 7279  _name__} - encry
+0001d530: 7074 2064 6174 6120 6572 726f 723a 2074  pt data error: t
+0001d540: 6865 206e 6f6e 6365 206d 7573 7420 6265  he nonce must be
+0001d550: 2062 6173 6536 3420 656e 636f 6465 6420   base64 encoded 
+0001d560: 6966 2073 6574 2229 0d0a 2020 2020 2020  if set")..      
+0001d570: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001d580: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+0001d590: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0001d5a0: 6e28 6e6f 6e63 6529 2021 3d20 3132 3a0d  n(nonce) != 12:.
+0001d5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d5c0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0001d5d0: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+0001d5e0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+0001d5f0: 656e 6372 7970 7420 6461 7461 2065 7272  encrypt data err
+0001d600: 6f72 3a20 7468 6520 6e6f 6e63 6520 6d75  or: the nonce mu
+0001d610: 7374 2062 6520 6578 6163 746c 7920 3936  st be exactly 96
+0001d620: 2062 6974 7320 2831 3220 6279 7465 7329   bits (12 bytes)
+0001d630: 206c 6f6e 6720 6966 2073 6574 2229 0d0a   long if set")..
+0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d650: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+0001d660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d670: 2070 6179 6c6f 6164 5b22 6e6f 6e63 6522   payload["nonce"
+0001d680: 5d20 3d20 6e6f 6e63 650d 0a20 2020 2020  ] = nonce..     
+0001d690: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001d6a0: 2020 2020 2069 6620 6261 7463 685f 696e       if batch_in
+0001d6b0: 7075 7420 6973 206e 6f74 204e 6f6e 653a  put is not None:
+0001d6c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d6d0: 2020 6966 2072 6566 6572 656e 6365 2021    if reference !
+0001d6e0: 3d20 2222 3a0d 0a20 2020 2020 2020 2020  = "":..         
+0001d6f0: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
+0001d700: 6164 5b22 7265 6665 7265 6e63 6522 5d20  ad["reference"] 
+0001d710: 3d20 7265 6665 7265 6e63 650d 0a20 2020  = reference..   
+0001d720: 2020 2020 2020 2020 2020 2020 2070 6179               pay
+0001d730: 6c6f 6164 5b22 6261 7463 685f 696e 7075  load["batch_inpu
+0001d740: 7422 5d20 3d20 6261 7463 685f 696e 7075  t"] = batch_inpu
+0001d750: 740d 0a0d 0a20 2020 2020 2020 2020 2020  t....           
+0001d760: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
+0001d770: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
+0001d780: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0001d790: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0001d7a0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+0001d7b0: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+0001d7c0: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+0001d7d0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+0001d7e0: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
+0001d7f0: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
+0001d800: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+0001d810: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+0001d820: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+0001d830: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+0001d840: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+0001d850: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0001d860: 203d 2072 6571 7565 7374 732e 706f 7374   = requests.post
+0001d870: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
+0001d880: 7468 7d2f 656e 6372 7970 742f 7b6e 616d  th}/encrypt/{nam
+0001d890: 657d 222c 2068 6561 6465 7273 3d7b 2258  e}", headers={"X
+0001d8a0: 2d56 6175 6c74 2d54 6f6b 656e 223a 2074  -Vault-Token": t
+0001d8b0: 6f6b 656e 7d2c 2064 6174 613d 6a73 6f6e  oken}, data=json
+0001d8c0: 2e64 756d 7073 2870 6179 6c6f 6164 2929  .dumps(payload))
+0001d8d0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001d8e0: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
+0001d8f0: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
+0001d900: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+0001d910: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
+0001d920: 2020 2020 7265 7475 726e 2072 6573 2e6a      return res.j
+0001d930: 736f 6e28 295b 2264 6174 6122 5d0d 0a20  son()["data"].. 
+0001d940: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001d950: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+0001d960: 3d3d 2070 6172 7469 616c 5f66 6169 6c75  == partial_failu
+0001d970: 7265 5f72 6573 706f 6e73 655f 636f 6465  re_response_code
+0001d980: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001d990: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+0001d9a0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+0001d9b0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 656e  _.__name__} - en
+0001d9c0: 6372 7970 7420 6461 7461 2065 7272 6f72  crypt data error
+0001d9d0: 3a20 7061 7274 6961 6c20 6661 696c 7572  : partial failur
+0001d9e0: 6520 7261 6973 6564 2229 0d0a 2020 2020  e raised")..    
+0001d9f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001da00: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+0001da10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0001da20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001da30: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
+0001da40: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
+0001da50: 5f6e 616d 655f 5f2c 2072 6573 2c20 2265  _name__, res, "e
+0001da60: 6e63 7279 7074 2064 6174 6120 6572 726f  ncrypt data erro
+0001da70: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
+0001da80: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0001da90: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+0001daa0: 726e 204e 6f6e 650d 0a0d 0a20 2020 2023  rn None....    #
+0001dab0: 2054 4f44 4f3a 2077 6169 7420 666f 7220   TODO: wait for 
+0001dac0: 7465 7374 696e 670d 0a20 2020 2064 6566  testing..    def
+0001dad0: 2064 6563 7279 7074 5f64 6174 6128 7365   decrypt_data(se
+0001dae0: 6c66 2c20 0d0a 2020 2020 2020 2020 2020  lf, ..          
+0001daf0: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
+0001db00: 5f70 6174 683a 2073 7472 2c0d 0a20 2020  _path: str,..   
+0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db20: 2020 6e61 6d65 3a20 7374 722c 0d0a 2020    name: str,..  
+0001db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db40: 2020 2063 6970 6865 7274 6578 743a 2073     ciphertext: s
+0001db50: 7472 203d 2022 222c 0d0a 2020 2020 2020  tr = "",..      
+0001db60: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001db70: 7373 6f63 6961 7465 645f 6461 7461 3a20  ssociated_data: 
+0001db80: 7374 7220 3d20 2222 2c0d 0a20 2020 2020  str = "",..     
 0001db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dba0: 2020 2020 206e 6f6e 6365 3a20 7374 7220       nonce: str 
-0001dbb0: 3d20 2222 2c0d 0a20 2020 2020 2020 2020  = "",..         
-0001dbc0: 2020 2020 2020 2020 2020 2020 7265 6665              refe
-0001dbd0: 7265 6e63 653a 2073 7472 203d 2022 222c  rence: str = "",
-0001dbe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001dbf0: 2020 2020 2020 2062 6174 6368 5f69 6e70         batch_inp
-0001dc00: 7574 3a20 4f70 7469 6f6e 616c 5b4c 6973  ut: Optional[Lis
-0001dc10: 745b 6469 6374 5d5d 203d 204e 6f6e 652c  t[dict]] = None,
-0001dc20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001dc30: 2020 2020 2020 2070 6172 7469 616c 5f66         partial_f
-0001dc40: 6169 6c75 7265 5f72 6573 706f 6e73 655f  ailure_response_
-0001dc50: 636f 6465 3a20 696e 7420 3d20 3430 3029  code: int = 400)
-0001dc60: 3a0d 0a20 2020 2020 2020 2022 2222 6465  :..        """de
-0001dc70: 6372 7970 7420 7468 6520 7072 6f76 6964  crypt the provid
-0001dc80: 6564 2063 6970 6865 7274 6578 7420 7573  ed ciphertext us
-0001dc90: 696e 6720 7468 6520 6e61 6d65 6420 6b65  ing the named ke
-0001dca0: 790d 0a0d 0a20 2020 2020 2020 2052 6566  y....        Ref
-0001dcb0: 6572 2074 6f20 6874 7470 733a 2f2f 6465  er to https://de
-0001dcc0: 7665 6c6f 7065 722e 6861 7368 6963 6f72  veloper.hashicor
-0001dcd0: 702e 636f 6d2f 7661 756c 742f 6170 692d  p.com/vault/api-
-0001dce0: 646f 6373 2f73 6563 7265 742f 7472 616e  docs/secret/tran
-0001dcf0: 7369 7423 6465 6372 7970 742d 6461 7461  sit#decrypt-data
-0001dd00: 2066 6f72 206d 6f72 6520 6465 7461 696c   for more detail
-0001dd10: 732e 0d0a 0d0a 2020 2020 2020 2020 4172  s.....        Ar
-0001dd20: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-0001dd30: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
-0001dd40: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-0001dd50: 616d 6520 2873 7472 293a 2053 7065 6369  ame (str): Speci
-0001dd60: 6669 6573 2074 6865 206e 616d 6520 6f66  fies the name of
-0001dd70: 2074 6865 2065 6e63 7279 7074 696f 6e20   the encryption 
-0001dd80: 6b65 7920 746f 2064 6563 7279 7074 2061  key to decrypt a
-0001dd90: 6761 696e 7374 2e0d 0a20 2020 2020 2020  gainst...       
-0001dda0: 2020 2020 2063 6970 6865 7274 6578 7420       ciphertext 
-0001ddb0: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
-0001ddc0: 2053 7065 6369 6669 6573 2074 6865 2063   Specifies the c
-0001ddd0: 6970 6865 7274 6578 7420 746f 2064 6563  iphertext to dec
-0001dde0: 7279 7074 2e20 4465 6661 756c 7473 2074  rypt. Defaults t
-0001ddf0: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-0001de00: 2020 2061 7373 6f63 6961 7465 645f 6461     associated_da
-0001de10: 7461 2028 7374 722c 206f 7074 696f 6e61  ta (str, optiona
-0001de20: 6c29 3a20 5370 6563 6966 6965 7320 6261  l): Specifies ba
-0001de30: 7365 3634 2065 6e63 6f64 6564 2061 7373  se64 encoded ass
-0001de40: 6f63 6961 7465 6420 6461 7461 2028 616c  ociated data (al
-0001de50: 736f 206b 6e6f 776e 2061 7320 6164 6469  so known as addi
-0001de60: 7469 6f6e 616c 2064 6174 6120 6f72 2041  tional data or A
-0001de70: 4144 2920 0d0a 2020 2020 2020 2020 2020  AD) ..          
-0001de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dea0: 2020 2074 6f20 616c 736f 2062 6520 6175     to also be au
-0001deb0: 7468 656e 7469 6361 7465 6420 7769 7468  thenticated with
-0001dec0: 2041 4541 4420 6369 7068 6572 7320 2860   AEAD ciphers (`
-0001ded0: 6165 7331 3238 2d67 636d 3936 602c 2060  aes128-gcm96`, `
-0001dee0: 6165 7332 3536 2d67 636d 602c 2061 6e64  aes256-gcm`, and
-0001def0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0001df00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df20: 6063 6861 6368 6132 302d 706f 6c79 3133  `chacha20-poly13
-0001df30: 3035 6029 2e20 4465 6661 756c 7473 2074  05`). Defaults t
-0001df40: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-0001df50: 2020 2063 6f6e 7465 7874 2028 7374 722c     context (str,
-0001df60: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
-0001df70: 6966 6965 7320 7468 6520 6261 7365 3634  ifies the base64
-0001df80: 2065 6e63 6f64 6564 2063 6f6e 7465 7874   encoded context
-0001df90: 2066 6f72 206b 6579 2064 6572 6976 6174   for key derivat
-0001dfa0: 696f 6e2e 2054 6869 7320 6973 2072 6571  ion. This is req
-0001dfb0: 7569 7265 6420 6966 206b 6579 2064 6572  uired if key der
-0001dfc0: 6976 6174 696f 6e20 0d0a 2020 2020 2020  ivation ..      
-0001dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfe0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001dff0: 7320 656e 6162 6c65 6420 666f 7220 7468  s enabled for th
-0001e000: 6973 206b 6579 2e20 4465 6661 756c 7473  is key. Defaults
-0001e010: 2074 6f20 2222 2e0d 0a20 2020 2020 2020   to ""...       
-0001e020: 2020 2020 206e 6f6e 6365 2028 7374 722c       nonce (str,
-0001e030: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
-0001e040: 6966 6965 7320 6120 6261 7365 3634 2065  ifies a base64 e
-0001e050: 6e63 6f64 6564 206e 6f6e 6365 2076 616c  ncoded nonce val
-0001e060: 7565 2075 7365 6420 6475 7269 6e67 2065  ue used during e
-0001e070: 6e63 7279 7074 696f 6e2e 204d 7573 7420  ncryption. Must 
-0001e080: 6265 2070 726f 7669 6465 6420 6966 2063  be provided if c
-0001e090: 6f6e 7665 7267 656e 7420 0d0a 2020 2020  onvergent ..    
-0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001e0c0: 6e63 7279 7074 696f 6e20 6973 2065 6e61  ncryption is ena
-0001e0d0: 626c 6564 2066 6f72 2074 6869 7320 6b65  bled for this ke
-0001e0e0: 7920 616e 6420 7468 6520 6b65 7920 7761  y and the key wa
-0001e0f0: 7320 6765 6e65 7261 7465 6420 7769 7468  s generated with
-0001e100: 2056 6175 6c74 2030 2e36 2e31 2e20 4e6f   Vault 0.6.1. No
-0001e110: 7420 7265 7175 6972 6564 200d 0a20 2020  t required ..   
-0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e140: 666f 7220 6b65 7973 2063 7265 6174 6564  for keys created
-0001e150: 2069 6e20 302e 362e 322b 2e20 4465 6661   in 0.6.2+. Defa
-0001e160: 756c 7473 2074 6f20 2222 2e0d 0a20 2020  ults to ""...   
-0001e170: 2020 2020 2020 2020 2072 6566 6572 656e           referen
-0001e180: 6365 2028 7374 722c 206f 7074 696f 6e61  ce (str, optiona
-0001e190: 6c29 3a20 4120 7573 6572 2d73 7570 706c  l): A user-suppl
-0001e1a0: 6965 6420 7374 7269 6e67 2074 6861 7420  ied string that 
-0001e1b0: 7769 6c6c 2062 6520 7072 6573 656e 7420  will be present 
-0001e1c0: 696e 2074 6865 2060 7265 6665 7265 6e63  in the `referenc
-0001e1d0: 6560 2066 6965 6c64 206f 6e20 7468 6520  e` field on the 
-0001e1e0: 636f 7272 6573 706f 6e64 696e 6720 0d0a  corresponding ..
-0001e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e210: 2020 2020 2020 2060 6261 7463 685f 7265         `batch_re
-0001e220: 7375 6c74 7360 2069 7465 6d20 696e 2074  sults` item in t
-0001e230: 6865 2072 6573 706f 6e73 652c 2074 6f20  he response, to 
-0001e240: 6173 7369 7374 2069 6e20 756e 6465 7273  assist in unders
-0001e250: 7461 6e64 696e 6720 7768 6963 6820 7265  tanding which re
-0001e260: 7375 6c74 2063 6f72 7265 7370 6f6e 6473  sult corresponds
-0001e270: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0001e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e290: 2020 2020 2020 2020 2020 746f 2061 2070            to a p
-0001e2a0: 6172 7469 6375 6c61 7220 696e 7075 742e  articular input.
-0001e2b0: 204f 6e6c 7920 7661 6c69 6420 6f6e 2062   Only valid on b
-0001e2c0: 6174 6368 2072 6571 7565 7374 7320 7768  atch requests wh
-0001e2d0: 656e 2075 7369 6e67 20e2 8098 6261 7463  en using ...batc
-0001e2e0: 685f 696e 7075 74e2 8099 2062 656c 6f77  h_input... below
-0001e2f0: 2e20 0d0a 2020 2020 2020 2020 2020 2020  . ..            
-0001e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e310: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-0001e320: 6c74 7320 746f 2022 222e 0d0a 2020 2020  lts to ""...    
-0001e330: 2020 2020 2020 2020 6261 7463 685f 696e          batch_in
-0001e340: 7075 7420 284f 7074 696f 6e61 6c5b 4c69  put (Optional[Li
-0001e350: 7374 5b64 6963 745d 5d2c 206f 7074 696f  st[dict]], optio
-0001e360: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
-0001e370: 6120 6c69 7374 206f 6620 6974 656d 7320  a list of items 
-0001e380: 746f 2062 6520 6465 6372 7970 7465 6420  to be decrypted 
-0001e390: 696e 2061 2073 696e 676c 6520 6261 7463  in a single batc
-0001e3a0: 682e 2057 6865 6e20 0d0a 2020 2020 2020  h. When ..      
-0001e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dba0: 636f 6e74 6578 743a 2073 7472 203d 2022  context: str = "
+0001dbb0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0001dbc0: 2020 2020 2020 2020 206e 6f6e 6365 3a20           nonce: 
+0001dbd0: 7374 7220 3d20 2222 2c0d 0a20 2020 2020  str = "",..     
+0001dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbf0: 7265 6665 7265 6e63 653a 2073 7472 203d  reference: str =
+0001dc00: 2022 222c 0d0a 2020 2020 2020 2020 2020   "",..          
+0001dc10: 2020 2020 2020 2020 2020 2062 6174 6368             batch
+0001dc20: 5f69 6e70 7574 3a20 4f70 7469 6f6e 616c  _input: Optional
+0001dc30: 5b4c 6973 745b 6469 6374 5d5d 203d 204e  [List[dict]] = N
+0001dc40: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+0001dc50: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+0001dc60: 616c 5f66 6169 6c75 7265 5f72 6573 706f  al_failure_respo
+0001dc70: 6e73 655f 636f 6465 3a20 696e 7420 3d20  nse_code: int = 
+0001dc80: 3430 3029 3a0d 0a20 2020 2020 2020 2022  400):..        "
+0001dc90: 2222 6465 6372 7970 7420 7468 6520 7072  ""decrypt the pr
+0001dca0: 6f76 6964 6564 2063 6970 6865 7274 6578  ovided ciphertex
+0001dcb0: 7420 7573 696e 6720 7468 6520 6e61 6d65  t using the name
+0001dcc0: 6420 6b65 790d 0a0d 0a20 2020 2020 2020  d key....       
+0001dcd0: 2052 6566 6572 2074 6f20 6874 7470 733a   Refer to https:
+0001dce0: 2f2f 6465 7665 6c6f 7065 722e 6861 7368  //developer.hash
+0001dcf0: 6963 6f72 702e 636f 6d2f 7661 756c 742f  icorp.com/vault/
+0001dd00: 6170 692d 646f 6373 2f73 6563 7265 742f  api-docs/secret/
+0001dd10: 7472 616e 7369 7423 6465 6372 7970 742d  transit#decrypt-
+0001dd20: 6461 7461 2066 6f72 206d 6f72 6520 6465  data for more de
+0001dd30: 7461 696c 732e 0d0a 0d0a 2020 2020 2020  tails.....      
+0001dd40: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+0001dd50: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
+0001dd60: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
+0001dd70: 2020 206e 616d 6520 2873 7472 293a 2053     name (str): S
+0001dd80: 7065 6369 6669 6573 2074 6865 206e 616d  pecifies the nam
+0001dd90: 6520 6f66 2074 6865 2065 6e63 7279 7074  e of the encrypt
+0001dda0: 696f 6e20 6b65 7920 746f 2064 6563 7279  ion key to decry
+0001ddb0: 7074 2061 6761 696e 7374 2e0d 0a20 2020  pt against...   
+0001ddc0: 2020 2020 2020 2020 2063 6970 6865 7274           ciphert
+0001ddd0: 6578 7420 2873 7472 2c20 6f70 7469 6f6e  ext (str, option
+0001dde0: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
+0001ddf0: 6865 2063 6970 6865 7274 6578 7420 746f  he ciphertext to
+0001de00: 2064 6563 7279 7074 2e20 4465 6661 756c   decrypt. Defaul
+0001de10: 7473 2074 6f20 2222 2e0d 0a20 2020 2020  ts to ""...     
+0001de20: 2020 2020 2020 2061 7373 6f63 6961 7465         associate
+0001de30: 645f 6461 7461 2028 7374 722c 206f 7074  d_data (str, opt
+0001de40: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
+0001de50: 7320 6261 7365 3634 2065 6e63 6f64 6564  s base64 encoded
+0001de60: 2061 7373 6f63 6961 7465 6420 6461 7461   associated data
+0001de70: 2028 616c 736f 206b 6e6f 776e 2061 7320   (also known as 
+0001de80: 6164 6469 7469 6f6e 616c 2064 6174 6120  additional data 
+0001de90: 6f72 2041 4144 2920 0d0a 2020 2020 2020  or AAD) ..      
+0001dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dec0: 2020 2020 2020 2074 6f20 616c 736f 2062         to also b
+0001ded0: 6520 6175 7468 656e 7469 6361 7465 6420  e authenticated 
+0001dee0: 7769 7468 2041 4541 4420 6369 7068 6572  with AEAD cipher
+0001def0: 7320 2860 6165 7331 3238 2d67 636d 3936  s (`aes128-gcm96
+0001df00: 602c 2060 6165 7332 3536 2d67 636d 602c  `, `aes256-gcm`,
+0001df10: 2061 6e64 200d 0a20 2020 2020 2020 2020   and ..         
+0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df40: 2020 2020 6063 6861 6368 6132 302d 706f      `chacha20-po
+0001df50: 6c79 3133 3035 6029 2e20 4465 6661 756c  ly1305`). Defaul
+0001df60: 7473 2074 6f20 2222 2e0d 0a20 2020 2020  ts to ""...     
+0001df70: 2020 2020 2020 2063 6f6e 7465 7874 2028         context (
+0001df80: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+0001df90: 5370 6563 6966 6965 7320 7468 6520 6261  Specifies the ba
+0001dfa0: 7365 3634 2065 6e63 6f64 6564 2063 6f6e  se64 encoded con
+0001dfb0: 7465 7874 2066 6f72 206b 6579 2064 6572  text for key der
+0001dfc0: 6976 6174 696f 6e2e 2054 6869 7320 6973  ivation. This is
+0001dfd0: 2072 6571 7569 7265 6420 6966 206b 6579   required if key
+0001dfe0: 2064 6572 6976 6174 696f 6e20 0d0a 2020   derivation ..  
+0001dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e010: 2020 2069 7320 656e 6162 6c65 6420 666f     is enabled fo
+0001e020: 7220 7468 6973 206b 6579 2e20 4465 6661  r this key. Defa
+0001e030: 756c 7473 2074 6f20 2222 2e0d 0a20 2020  ults to ""...   
+0001e040: 2020 2020 2020 2020 206e 6f6e 6365 2028           nonce (
+0001e050: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+0001e060: 5370 6563 6966 6965 7320 6120 6261 7365  Specifies a base
+0001e070: 3634 2065 6e63 6f64 6564 206e 6f6e 6365  64 encoded nonce
+0001e080: 2076 616c 7565 2075 7365 6420 6475 7269   value used duri
+0001e090: 6e67 2065 6e63 7279 7074 696f 6e2e 204d  ng encryption. M
+0001e0a0: 7573 7420 6265 2070 726f 7669 6465 6420  ust be provided 
+0001e0b0: 6966 2063 6f6e 7665 7267 656e 7420 0d0a  if convergent ..
+0001e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0e0: 2020 2065 6e63 7279 7074 696f 6e20 6973     encryption is
+0001e0f0: 2065 6e61 626c 6564 2066 6f72 2074 6869   enabled for thi
+0001e100: 7320 6b65 7920 616e 6420 7468 6520 6b65  s key and the ke
+0001e110: 7920 7761 7320 6765 6e65 7261 7465 6420  y was generated 
+0001e120: 7769 7468 2056 6175 6c74 2030 2e36 2e31  with Vault 0.6.1
+0001e130: 2e20 4e6f 7420 7265 7175 6972 6564 200d  . Not required .
+0001e140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e160: 2020 2020 666f 7220 6b65 7973 2063 7265      for keys cre
+0001e170: 6174 6564 2069 6e20 302e 362e 322b 2e20  ated in 0.6.2+. 
+0001e180: 4465 6661 756c 7473 2074 6f20 2222 2e0d  Defaults to ""..
+0001e190: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+0001e1a0: 6572 656e 6365 2028 7374 722c 206f 7074  erence (str, opt
+0001e1b0: 696f 6e61 6c29 3a20 4120 7573 6572 2d73  ional): A user-s
+0001e1c0: 7570 706c 6965 6420 7374 7269 6e67 2074  upplied string t
+0001e1d0: 6861 7420 7769 6c6c 2062 6520 7072 6573  hat will be pres
+0001e1e0: 656e 7420 696e 2074 6865 2060 7265 6665  ent in the `refe
+0001e1f0: 7265 6e63 6560 2066 6965 6c64 206f 6e20  rence` field on 
+0001e200: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
+0001e210: 6720 0d0a 2020 2020 2020 2020 2020 2020  g ..            
+0001e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e230: 2020 2020 2020 2020 2020 2060 6261 7463             `batc
+0001e240: 685f 7265 7375 6c74 7360 2069 7465 6d20  h_results` item 
+0001e250: 696e 2074 6865 2072 6573 706f 6e73 652c  in the response,
+0001e260: 2074 6f20 6173 7369 7374 2069 6e20 756e   to assist in un
+0001e270: 6465 7273 7461 6e64 696e 6720 7768 6963  derstanding whic
+0001e280: 6820 7265 7375 6c74 2063 6f72 7265 7370  h result corresp
+0001e290: 6f6e 6473 200d 0a20 2020 2020 2020 2020  onds ..         
+0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2b0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0001e2c0: 2061 2070 6172 7469 6375 6c61 7220 696e   a particular in
+0001e2d0: 7075 742e 204f 6e6c 7920 7661 6c69 6420  put. Only valid 
+0001e2e0: 6f6e 2062 6174 6368 2072 6571 7565 7374  on batch request
+0001e2f0: 7320 7768 656e 2075 7369 6e67 20e2 8098  s when using ...
+0001e300: 6261 7463 685f 696e 7075 74e2 8099 2062  batch_input... b
+0001e310: 656c 6f77 2e20 0d0a 2020 2020 2020 2020  elow. ..        
+0001e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e330: 2020 2020 2020 2020 2020 2020 2020 2044                 D
+0001e340: 6566 6175 6c74 7320 746f 2022 222e 0d0a  efaults to ""...
+0001e350: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+0001e360: 685f 696e 7075 7420 284f 7074 696f 6e61  h_input (Optiona
+0001e370: 6c5b 4c69 7374 5b64 6963 745d 5d2c 206f  l[List[dict]], o
+0001e380: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
+0001e390: 6965 7320 6120 6c69 7374 206f 6620 6974  ies a list of it
+0001e3a0: 656d 7320 746f 2062 6520 6465 6372 7970  ems to be decryp
+0001e3b0: 7465 6420 696e 2061 2073 696e 676c 6520  ted in a single 
+0001e3c0: 6261 7463 682e 2057 6865 6e20 0d0a 2020  batch. When ..  
 0001e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3e0: 2020 2020 7468 6973 2070 6172 616d 6574      this paramet
-0001e3f0: 6572 2069 7320 7365 742c 2069 6620 7468  er is set, if th
-0001e400: 6520 7061 7261 6d65 7465 7273 2027 6369  e parameters 'ci
-0001e410: 7068 6572 7465 7874 272c 2027 636f 6e74  phertext', 'cont
-0001e420: 6578 7427 2061 6e64 200d 0a20 2020 2020  ext' and ..     
-0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e400: 2020 2020 2020 2020 7468 6973 2070 6172          this par
+0001e410: 616d 6574 6572 2069 7320 7365 742c 2069  ameter is set, i
+0001e420: 6620 7468 6520 7061 7261 6d65 7465 7273  f the parameters
+0001e430: 2027 6369 7068 6572 7465 7874 272c 2027   'ciphertext', '
+0001e440: 636f 6e74 6578 7427 2061 6e64 200d 0a20  context' and .. 
 0001e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e460: 2020 2020 2027 6e6f 6e63 6527 2061 7265       'nonce' are
-0001e470: 2061 6c73 6f20 7365 742c 2074 6865 7920   also set, they 
-0001e480: 7769 6c6c 2062 6520 6967 6e6f 7265 642e  will be ignored.
-0001e490: 2041 6e79 2062 6174 6368 206f 7574 7075   Any batch outpu
-0001e4a0: 7420 7769 6c6c 200d 0a20 2020 2020 2020  t will ..       
-0001e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e480: 2020 2020 2020 2020 2027 6e6f 6e63 6527           'nonce'
+0001e490: 2061 7265 2061 6c73 6f20 7365 742c 2074   are also set, t
+0001e4a0: 6865 7920 7769 6c6c 2062 6520 6967 6e6f  hey will be igno
+0001e4b0: 7265 642e 2041 6e79 2062 6174 6368 206f  red. Any batch o
+0001e4c0: 7574 7075 7420 7769 6c6c 200d 0a20 2020  utput will ..   
 0001e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4e0: 2020 2070 7265 7365 7276 6520 7468 6520     preserve the 
-0001e4f0: 6f72 6465 7220 6f66 2074 6865 2062 6174  order of the bat
-0001e500: 6368 2069 6e70 7574 2e20 4465 6661 756c  ch input. Defaul
-0001e510: 7473 2074 6f20 4e6f 6e65 2e0d 0a20 2020  ts to None...   
-0001e520: 2020 2020 2020 2020 2070 6172 7469 616c           partial
-0001e530: 5f66 6169 6c75 7265 5f72 6573 706f 6e73  _failure_respons
-0001e540: 655f 636f 6465 2028 696e 742c 206f 7074  e_code (int, opt
-0001e550: 696f 6e61 6c29 3a20 4f72 6469 6e61 7269  ional): Ordinari
-0001e560: 6c79 2c20 6966 2061 2062 6174 6368 2069  ly, if a batch i
-0001e570: 7465 6d20 6661 696c 7320 746f 2065 6e63  tem fails to enc
-0001e580: 7279 7074 2064 7565 2074 6f20 6120 6261  rypt due to a ba
-0001e590: 6420 696e 7075 742c 2062 7574 200d 0a20  d input, but .. 
-0001e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5d0: 2020 2020 2020 2020 2020 6f74 6865 7220            other 
-0001e5e0: 6261 7463 6820 6974 656d 7320 7375 6363  batch items succ
-0001e5f0: 6565 642c 2074 6865 2048 5454 5020 7265  eed, the HTTP re
-0001e600: 7370 6f6e 7365 2063 6f64 6520 6973 2034  sponse code is 4
-0001e610: 3030 2028 4261 6420 5265 7175 6573 7429  00 (Bad Request)
-0001e620: 2e20 0d0a 2020 2020 2020 2020 2020 2020  . ..            
-0001e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e650: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-0001e660: 6f6d 6520 6170 706c 6963 6174 696f 6e73  ome applications
-0001e670: 206d 6179 2077 616e 7420 746f 2074 7265   may want to tre
-0001e680: 6174 2070 6172 7469 616c 2066 6169 6c75  at partial failu
-0001e690: 7265 7320 6469 6666 6572 656e 746c 792e  res differently.
-0001e6a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0001e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6d0: 2020 2020 2020 2020 2020 2020 2020 5072                Pr
-0001e6e0: 6f76 6964 696e 6720 7468 6520 7061 7261  oviding the para
-0001e6f0: 6d65 7465 7220 7265 7475 726e 7320 7468  meter returns th
-0001e700: 6520 6769 7665 6e20 7265 7370 6f6e 7365  e given response
-0001e710: 2063 6f64 6520 696e 7465 6765 7220 696e   code integer in
-0001e720: 7374 6561 6420 0d0a 2020 2020 2020 2020  stead ..        
-0001e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e500: 2020 2020 2020 2070 7265 7365 7276 6520         preserve 
+0001e510: 7468 6520 6f72 6465 7220 6f66 2074 6865  the order of the
+0001e520: 2062 6174 6368 2069 6e70 7574 2e20 4465   batch input. De
+0001e530: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0d  faults to None..
+0001e540: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+0001e550: 7469 616c 5f66 6169 6c75 7265 5f72 6573  tial_failure_res
+0001e560: 706f 6e73 655f 636f 6465 2028 696e 742c  ponse_code (int,
+0001e570: 206f 7074 696f 6e61 6c29 3a20 4f72 6469   optional): Ordi
+0001e580: 6e61 7269 6c79 2c20 6966 2061 2062 6174  narily, if a bat
+0001e590: 6368 2069 7465 6d20 6661 696c 7320 746f  ch item fails to
+0001e5a0: 2065 6e63 7279 7074 2064 7565 2074 6f20   encrypt due to 
+0001e5b0: 6120 6261 6420 696e 7075 742c 2062 7574  a bad input, but
+0001e5c0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0001e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5f0: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
+0001e600: 6865 7220 6261 7463 6820 6974 656d 7320  her batch items 
+0001e610: 7375 6363 6565 642c 2074 6865 2048 5454  succeed, the HTT
+0001e620: 5020 7265 7370 6f6e 7365 2063 6f64 6520  P response code 
+0001e630: 6973 2034 3030 2028 4261 6420 5265 7175  is 400 (Bad Requ
+0001e640: 6573 7429 2e20 0d0a 2020 2020 2020 2020  est). ..        
+0001e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e680: 2020 2053 6f6d 6520 6170 706c 6963 6174     Some applicat
+0001e690: 696f 6e73 206d 6179 2077 616e 7420 746f  ions may want to
+0001e6a0: 2074 7265 6174 2070 6172 7469 616c 2066   treat partial f
+0001e6b0: 6169 6c75 7265 7320 6469 6666 6572 656e  ailures differen
+0001e6c0: 746c 792e 200d 0a20 2020 2020 2020 2020  tly. ..         
+0001e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e700: 2020 5072 6f76 6964 696e 6720 7468 6520    Providing the 
+0001e710: 7061 7261 6d65 7465 7220 7265 7475 726e  parameter return
+0001e720: 7320 7468 6520 6769 7665 6e20 7265 7370  s the given resp
+0001e730: 6f6e 7365 2063 6f64 6520 696e 7465 6765  onse code intege
+0001e740: 7220 696e 7374 6561 6420 0d0a 2020 2020  r instead ..    
 0001e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e760: 2020 206f 6620 6120 6661 696c 6564 2073     of a failed s
-0001e770: 7461 7475 7320 636f 6465 2069 6e20 7468  tatus code in th
-0001e780: 6973 2063 6173 652e 2049 6620 616c 6c20  is case. If all 
-0001e790: 7661 6c75 6573 2066 6169 6c20 616e 2065  values fail an e
-0001e7a0: 7272 6f72 2063 6f64 6520 6973 200d 0a20  rror code is .. 
-0001e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7e0: 2020 2020 2020 2020 2020 7374 696c 6c20            still 
-0001e7f0: 7265 7475 726e 6564 2e20 4265 2077 6172  returned. Be war
-0001e800: 6e65 6420 7468 6174 2073 6f6d 6520 6661  ned that some fa
-0001e810: 696c 7572 6573 2028 7375 6368 2061 7320  ilures (such as 
-0001e820: 6661 696c 7572 6520 746f 2064 6563 7279  failure to decry
-0001e830: 7074 2920 0d0a 2020 2020 2020 2020 2020  pt) ..          
-0001e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e780: 2020 2020 2020 206f 6620 6120 6661 696c         of a fail
+0001e790: 6564 2073 7461 7475 7320 636f 6465 2069  ed status code i
+0001e7a0: 6e20 7468 6973 2063 6173 652e 2049 6620  n this case. If 
+0001e7b0: 616c 6c20 7661 6c75 6573 2066 6169 6c20  all values fail 
+0001e7c0: 616e 2065 7272 6f72 2063 6f64 6520 6973  an error code is
+0001e7d0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0001e7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e800: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0001e810: 696c 6c20 7265 7475 726e 6564 2e20 4265  ill returned. Be
+0001e820: 2077 6172 6e65 6420 7468 6174 2073 6f6d   warned that som
+0001e830: 6520 6661 696c 7572 6573 2028 7375 6368  e failures (such
+0001e840: 2061 7320 6661 696c 7572 6520 746f 2064   as failure to d
+0001e850: 6563 7279 7074 2920 0d0a 2020 2020 2020  ecrypt) ..      
 0001e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e870: 2063 6f75 6c64 2062 6520 696e 6469 6361   could be indica
-0001e880: 7469 7665 206f 6620 6120 7365 6375 7269  tive of a securi
-0001e890: 7479 2062 7265 6163 6820 616e 6420 7368  ty breach and sh
-0001e8a0: 6f75 6c64 206e 6f74 2062 6520 6967 6e6f  ould not be igno
-0001e8b0: 7265 642e 200d 0a20 2020 2020 2020 2020  red. ..         
-0001e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e890: 2020 2020 2063 6f75 6c64 2062 6520 696e       could be in
+0001e8a0: 6469 6361 7469 7665 206f 6620 6120 7365  dicative of a se
+0001e8b0: 6375 7269 7479 2062 7265 6163 6820 616e  curity breach an
+0001e8c0: 6420 7368 6f75 6c64 206e 6f74 2062 6520  d should not be 
+0001e8d0: 6967 6e6f 7265 642e 200d 0a20 2020 2020  ignored. ..     
 0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8f0: 2020 4465 6661 756c 7473 2074 6f20 3430    Defaults to 40
-0001e900: 302e 0d0a 0d0a 2020 2020 2020 2020 5265  0.....        Re
-0001e910: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-0001e920: 2020 2020 6469 6374 206f 7220 4e6f 6e65      dict or None
-0001e930: 3a20 7265 7475 726e 2074 6865 2070 6c61  : return the pla
-0001e940: 696e 2074 6578 7420 696e 2064 6963 7420  in text in dict 
-0001e950: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-0001e960: 7277 6973 6520 7265 7475 726e 204e 6f6e  rwise return Non
-0001e970: 650d 0a20 2020 2020 2020 2022 2222 0d0a  e..        """..
-0001e980: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001e990: 6973 5f61 7574 683a 0d0a 2020 2020 2020  is_auth:..      
-0001e9a0: 2020 2020 2020 6578 6973 745f 6b65 7973        exist_keys
-0001e9b0: 203d 2073 656c 662e 6c69 7374 5f6b 6579   = self.list_key
-0001e9c0: 286d 6f75 6e74 5f70 6174 6829 0d0a 2020  (mount_path)..  
-0001e9d0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-0001e9e0: 6520 6e6f 7420 696e 2065 7869 7374 5f6b  e not in exist_k
-0001e9f0: 6579 733a 0d0a 2020 2020 2020 2020 2020  eys:..          
-0001ea00: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-0001ea10: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-0001ea20: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-0001ea30: 2064 6563 7279 7074 2064 6174 6120 6572   decrypt data er
-0001ea40: 726f 723a 206b 6579 2027 7b6e 616d 657d  ror: key '{name}
-0001ea50: 2720 6e6f 7420 666f 756e 6422 290d 0a20  ' not found").. 
-0001ea60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001ea70: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-0001ea80: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001ea90: 2020 2020 2020 7061 796c 6f61 6420 3d20        payload = 
-0001eaa0: 6469 6374 2829 0d0a 0d0a 2020 2020 2020  dict()....      
-0001eab0: 2020 2020 2020 6966 2062 6174 6368 5f69        if batch_i
-0001eac0: 6e70 7574 2069 7320 4e6f 6e65 3a0d 0a20  nput is None:.. 
-0001ead0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001eae0: 6620 6e6f 7420 6973 5f62 6173 6536 3428  f not is_base64(
-0001eaf0: 6369 7068 6572 7465 7874 293a 0d0a 2020  ciphertext):..  
-0001eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb10: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-0001eb20: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-0001eb30: 2e5f 5f6e 616d 655f 5f7d 202d 2064 6563  .__name__} - dec
-0001eb40: 7279 7074 2064 6174 6120 6572 726f 723a  rypt data error:
-0001eb50: 2074 6865 2063 6970 6865 7274 6578 7420   the ciphertext 
-0001eb60: 6d75 7374 2062 6520 6261 7365 3634 2065  must be base64 e
-0001eb70: 6e63 6f64 6564 2229 0d0a 2020 2020 2020  ncoded")..      
-0001eb80: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001eb90: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-0001eba0: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
-0001ebb0: 6164 5b22 6369 7068 6572 7465 7874 225d  ad["ciphertext"]
-0001ebc0: 203d 2063 6970 6865 7274 6578 740d 0a0d   = ciphertext...
-0001ebd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001ebe0: 6173 736f 6369 6174 6564 5f64 6174 6120  associated_data 
-0001ebf0: 213d 2022 223a 0d0a 2020 2020 2020 2020  != "":..        
-0001ec00: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0001ec10: 735f 6261 7365 3634 2861 7373 6f63 6961  s_base64(associa
-0001ec20: 7465 645f 6461 7461 293a 0d0a 2020 2020  ted_data):..    
-0001ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec40: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
-0001ec50: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
-0001ec60: 5f6e 616d 655f 5f7d 202d 2064 6563 7279  _name__} - decry
-0001ec70: 7074 2064 6174 6120 6572 726f 723a 2074  pt data error: t
-0001ec80: 6865 2061 7373 6f63 6961 7465 645f 6461  he associated_da
-0001ec90: 7461 206d 7573 7420 6265 2062 6173 6536  ta must be base6
-0001eca0: 3420 656e 636f 6465 6420 6966 2073 6574  4 encoded if set
-0001ecb0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0001ecc0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001ecd0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0001ece0: 2020 2020 2070 6179 6c6f 6164 5b22 6173       payload["as
-0001ecf0: 736f 6369 6174 6564 5f64 6174 6122 5d20  sociated_data"] 
-0001ed00: 3d20 6173 736f 6369 6174 6564 5f64 6174  = associated_dat
-0001ed10: 610d 0a0d 0a20 2020 2020 2020 2020 2020  a....           
-0001ed20: 2069 6620 6261 7463 685f 696e 7075 7420   if batch_input 
-0001ed30: 6973 204e 6f6e 6520 616e 6420 636f 6e74  is None and cont
-0001ed40: 6578 7420 213d 2022 223a 0d0a 2020 2020  ext != "":..    
-0001ed50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001ed60: 6f74 2069 735f 6261 7365 3634 2863 6f6e  ot is_base64(con
-0001ed70: 7465 7874 293a 0d0a 2020 2020 2020 2020  text):..        
-0001ed80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001ed90: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-0001eda0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-0001edb0: 655f 5f7d 202d 2064 6563 7279 7074 2064  e__} - decrypt d
-0001edc0: 6174 6120 6572 726f 723a 2074 6865 2063  ata error: the c
-0001edd0: 6f6e 7465 7874 206d 7573 7420 6265 2062  ontext must be b
-0001ede0: 6173 6536 3420 656e 636f 6465 6420 6966  ase64 encoded if
-0001edf0: 2073 6574 2229 0d0a 2020 2020 2020 2020   set")..        
-0001ee00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001ee10: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
-0001ee20: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
-0001ee30: 5b22 636f 6e74 6578 7422 5d20 3d20 636f  ["context"] = co
-0001ee40: 6e74 6578 740d 0a0d 0a20 2020 2020 2020  ntext....       
-0001ee50: 2020 2020 2069 6620 6261 7463 685f 696e       if batch_in
-0001ee60: 7075 7420 6973 204e 6f6e 6520 616e 6420  put is None and 
-0001ee70: 6e6f 6e63 6520 213d 2022 223a 0d0a 2020  nonce != "":..  
-0001ee80: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001ee90: 206e 6f74 2069 735f 6261 7365 3634 286e   not is_base64(n
-0001eea0: 6f6e 6365 293a 0d0a 2020 2020 2020 2020  once):..        
-0001eeb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001eec0: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-0001eed0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-0001eee0: 655f 5f7d 202d 2064 6563 7279 7074 2064  e__} - decrypt d
-0001eef0: 6174 6120 6572 726f 723a 2074 6865 206e  ata error: the n
-0001ef00: 6f6e 6365 206d 7573 7420 6265 2062 6173  once must be bas
-0001ef10: 6536 3420 656e 636f 6465 6420 6966 2073  e64 encoded if s
-0001ef20: 6574 2229 0d0a 2020 2020 2020 2020 2020  et")..          
-0001ef30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001ef40: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0001ef50: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
-0001ef60: 6e6f 6e63 6522 5d20 3d20 6e6f 6e63 650d  nonce"] = nonce.
-0001ef70: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-0001ef80: 6620 6261 7463 685f 696e 7075 7420 6973  f batch_input is
-0001ef90: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0001efa0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0001efb0: 6566 6572 656e 6365 2021 3d20 2222 3a0d  eference != "":.
-0001efc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001efd0: 2020 2020 2070 6179 6c6f 6164 5b22 7265       payload["re
-0001efe0: 6665 7265 6e63 6522 5d20 3d20 7265 6665  ference"] = refe
-0001eff0: 7265 6e63 650d 0a20 2020 2020 2020 2020  rence..         
-0001f000: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
-0001f010: 6261 7463 685f 696e 7075 7422 5d20 3d20  batch_input"] = 
-0001f020: 6261 7463 685f 696e 7075 740d 0a0d 0a20  batch_input.... 
-0001f030: 2020 2020 2020 2020 2020 2075 726c 203d             url =
-0001f040: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
-0001f050: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
-0001f060: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-0001f070: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-0001f080: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-0001f090: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-0001f0a0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-0001f0b0: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
-0001f0c0: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
-0001f0d0: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
-0001f0e0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-0001f0f0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-0001f100: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-0001f110: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-0001f120: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-0001f130: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
-0001f140: 7565 7374 732e 706f 7374 2875 726c 2b66  uests.post(url+f
-0001f150: 227b 6d6f 756e 745f 7061 7468 7d2f 6465  "{mount_path}/de
-0001f160: 6372 7970 742f 7b6e 616d 657d 222c 2068  crypt/{name}", h
-0001f170: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
-0001f180: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d2c  -Token": token},
-0001f190: 2064 6174 613d 6a73 6f6e 2e64 756d 7073   data=json.dumps
-0001f1a0: 2870 6179 6c6f 6164 2929 0d0a 2020 2020  (payload))..    
-0001f1b0: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
-0001f1c0: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
-0001f1d0: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
-0001f1e0: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
-0001f1f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001f200: 7475 726e 2072 6573 2e6a 736f 6e28 295b  turn res.json()[
-0001f210: 2264 6174 6122 5d0d 0a20 2020 2020 2020  "data"]..       
-0001f220: 2020 2020 2065 6c69 6620 7265 732e 7374       elif res.st
-0001f230: 6174 7573 5f63 6f64 6520 3d3d 2070 6172  atus_code == par
-0001f240: 7469 616c 5f66 6169 6c75 7265 5f72 6573  tial_failure_res
-0001f250: 706f 6e73 655f 636f 6465 3a0d 0a20 2020  ponse_code:..   
-0001f260: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001f270: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-0001f280: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-0001f290: 6d65 5f5f 7d20 2d20 6465 6372 7970 7420  me__} - decrypt 
-0001f2a0: 6461 7461 2065 7272 6f72 3a20 7061 7274  data error: part
-0001f2b0: 6961 6c20 6661 696c 7572 6520 7261 6973  ial failure rais
-0001f2c0: 6564 2229 0d0a 2020 2020 2020 2020 2020  ed")..          
-0001f2d0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0001f2e0: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
-0001f2f0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0001f300: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-0001f310: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
-0001f320: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0001f330: 5f2c 2072 6573 2c20 2264 6563 7279 7074  _, res, "decrypt
-0001f340: 2064 6174 6120 6572 726f 7222 290d 0a20   data error").. 
-0001f350: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001f360: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-0001f370: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
-0001f380: 7475 726e 204e 6f6e 650d 0a0d 0a20 2020  turn None....   
-0001f390: 2023 2054 4f44 4f3a 2077 6169 7420 666f   # TODO: wait fo
-0001f3a0: 7220 7465 7374 696e 670d 0a20 2020 2064  r testing..    d
-0001f3b0: 6566 2072 6577 7261 705f 6461 7461 2873  ef rewrap_data(s
-0001f3c0: 656c 662c 200d 0a20 2020 2020 2020 2020  elf, ..         
-0001f3d0: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
-0001f3e0: 5f70 6174 683a 2073 7472 2c0d 0a20 2020  _path: str,..   
-0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f400: 206e 616d 653a 2073 7472 2c0d 0a20 2020   name: str,..   
-0001f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f420: 2063 6970 6865 7274 6578 743a 2073 7472   ciphertext: str
-0001f430: 203d 2022 222c 0d0a 2020 2020 2020 2020   = "",..        
-0001f440: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001f450: 6578 743a 2073 7472 203d 2022 222c 0d0a  ext: str = "",..
+0001e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e910: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+0001e920: 6f20 3430 302e 0d0a 0d0a 2020 2020 2020  o 400.....      
+0001e930: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+0001e940: 2020 2020 2020 2020 6469 6374 206f 7220          dict or 
+0001e950: 4e6f 6e65 3a20 7265 7475 726e 2074 6865  None: return the
+0001e960: 2070 6c61 696e 2074 6578 7420 696e 2064   plain text in d
+0001e970: 6963 7420 6966 2073 7563 6365 7373 2c20  ict if success, 
+0001e980: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+0001e990: 204e 6f6e 650d 0a20 2020 2020 2020 2022   None..        "
+0001e9a0: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0001e9b0: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
+0001e9c0: 2020 2020 2020 2020 2020 6578 6973 745f            exist_
+0001e9d0: 6b65 7973 203d 2073 656c 662e 6c69 7374  keys = self.list
+0001e9e0: 5f6b 6579 286d 6f75 6e74 5f70 6174 6829  _key(mount_path)
+0001e9f0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001ea00: 206e 616d 6520 6e6f 7420 696e 2065 7869   name not in exi
+0001ea10: 7374 5f6b 6579 733a 0d0a 2020 2020 2020  st_keys:..      
+0001ea20: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0001ea30: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
+0001ea40: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+0001ea50: 5f7d 202d 2064 6563 7279 7074 2064 6174  _} - decrypt dat
+0001ea60: 6120 6572 726f 723a 206b 6579 2027 7b6e  a error: key '{n
+0001ea70: 616d 657d 2720 6e6f 7420 666f 756e 6422  ame}' not found"
+0001ea80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001ea90: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+0001eaa0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0001eab0: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
+0001eac0: 6420 3d20 6469 6374 2829 0d0a 0d0a 2020  d = dict()....  
+0001ead0: 2020 2020 2020 2020 2020 6966 2062 6174            if bat
+0001eae0: 6368 5f69 6e70 7574 2069 7320 4e6f 6e65  ch_input is None
+0001eaf0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001eb00: 2020 2069 6620 6e6f 7420 6973 5f62 6173     if not is_bas
+0001eb10: 6536 3428 6369 7068 6572 7465 7874 293a  e64(ciphertext):
+0001eb20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001eb30: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0001eb40: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
+0001eb50: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+0001eb60: 2064 6563 7279 7074 2064 6174 6120 6572   decrypt data er
+0001eb70: 726f 723a 2074 6865 2063 6970 6865 7274  ror: the ciphert
+0001eb80: 6578 7420 6d75 7374 2062 6520 6261 7365  ext must be base
+0001eb90: 3634 2065 6e63 6f64 6564 2229 0d0a 2020  64 encoded")..  
+0001eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebb0: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
+0001ebc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001ebd0: 6179 6c6f 6164 5b22 6369 7068 6572 7465  ayload["cipherte
+0001ebe0: 7874 225d 203d 2063 6970 6865 7274 6578  xt"] = ciphertex
+0001ebf0: 740d 0a0d 0a20 2020 2020 2020 2020 2020  t....           
+0001ec00: 2069 6620 6173 736f 6369 6174 6564 5f64   if associated_d
+0001ec10: 6174 6120 213d 2022 223a 0d0a 2020 2020  ata != "":..    
+0001ec20: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001ec30: 6f74 2069 735f 6261 7365 3634 2861 7373  ot is_base64(ass
+0001ec40: 6f63 6961 7465 645f 6461 7461 293a 0d0a  ociated_data):..
+0001ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec60: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0001ec70: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+0001ec80: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2064  __.__name__} - d
+0001ec90: 6563 7279 7074 2064 6174 6120 6572 726f  ecrypt data erro
+0001eca0: 723a 2074 6865 2061 7373 6f63 6961 7465  r: the associate
+0001ecb0: 645f 6461 7461 206d 7573 7420 6265 2062  d_data must be b
+0001ecc0: 6173 6536 3420 656e 636f 6465 6420 6966  ase64 encoded if
+0001ecd0: 2073 6574 2229 0d0a 2020 2020 2020 2020   set")..        
+0001ece0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001ecf0: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+0001ed00: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+0001ed10: 5b22 6173 736f 6369 6174 6564 5f64 6174  ["associated_dat
+0001ed20: 6122 5d20 3d20 6173 736f 6369 6174 6564  a"] = associated
+0001ed30: 5f64 6174 610d 0a0d 0a20 2020 2020 2020  _data....       
+0001ed40: 2020 2020 2069 6620 6261 7463 685f 696e       if batch_in
+0001ed50: 7075 7420 6973 204e 6f6e 6520 616e 6420  put is None and 
+0001ed60: 636f 6e74 6578 7420 213d 2022 223a 0d0a  context != "":..
+0001ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed80: 6966 206e 6f74 2069 735f 6261 7365 3634  if not is_base64
+0001ed90: 2863 6f6e 7465 7874 293a 0d0a 2020 2020  (context):..    
+0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edb0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+0001edc0: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+0001edd0: 5f6e 616d 655f 5f7d 202d 2064 6563 7279  _name__} - decry
+0001ede0: 7074 2064 6174 6120 6572 726f 723a 2074  pt data error: t
+0001edf0: 6865 2063 6f6e 7465 7874 206d 7573 7420  he context must 
+0001ee00: 6265 2062 6173 6536 3420 656e 636f 6465  be base64 encode
+0001ee10: 6420 6966 2073 6574 2229 0d0a 2020 2020  d if set")..    
+0001ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee30: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+0001ee40: 2020 2020 2020 2020 2020 2020 2070 6179               pay
+0001ee50: 6c6f 6164 5b22 636f 6e74 6578 7422 5d20  load["context"] 
+0001ee60: 3d20 636f 6e74 6578 740d 0a0d 0a20 2020  = context....   
+0001ee70: 2020 2020 2020 2020 2069 6620 6261 7463           if batc
+0001ee80: 685f 696e 7075 7420 6973 204e 6f6e 6520  h_input is None 
+0001ee90: 616e 6420 6e6f 6e63 6520 213d 2022 223a  and nonce != "":
+0001eea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001eeb0: 2020 6966 206e 6f74 2069 735f 6261 7365    if not is_base
+0001eec0: 3634 286e 6f6e 6365 293a 0d0a 2020 2020  64(nonce):..    
+0001eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eee0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+0001eef0: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+0001ef00: 5f6e 616d 655f 5f7d 202d 2064 6563 7279  _name__} - decry
+0001ef10: 7074 2064 6174 6120 6572 726f 723a 2074  pt data error: t
+0001ef20: 6865 206e 6f6e 6365 206d 7573 7420 6265  he nonce must be
+0001ef30: 2062 6173 6536 3420 656e 636f 6465 6420   base64 encoded 
+0001ef40: 6966 2073 6574 2229 0d0a 2020 2020 2020  if set")..      
+0001ef50: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001ef60: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+0001ef70: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
+0001ef80: 6164 5b22 6e6f 6e63 6522 5d20 3d20 6e6f  ad["nonce"] = no
+0001ef90: 6e63 650d 0a0d 0a20 2020 2020 2020 2020  nce....         
+0001efa0: 2020 2069 6620 6261 7463 685f 696e 7075     if batch_inpu
+0001efb0: 7420 6973 206e 6f74 204e 6f6e 653a 0d0a  t is not None:..
+0001efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efd0: 6966 2072 6566 6572 656e 6365 2021 3d20  if reference != 
+0001efe0: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
+0001eff0: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+0001f000: 5b22 7265 6665 7265 6e63 6522 5d20 3d20  ["reference"] = 
+0001f010: 7265 6665 7265 6e63 650d 0a20 2020 2020  reference..     
+0001f020: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
+0001f030: 6164 5b22 6261 7463 685f 696e 7075 7422  ad["batch_input"
+0001f040: 5d20 3d20 6261 7463 685f 696e 7075 740d  ] = batch_input.
+0001f050: 0a0d 0a20 2020 2020 2020 2020 2020 2075  ...            u
+0001f060: 726c 203d 2061 6573 5f64 6563 7279 7074  rl = aes_decrypt
+0001f070: 5f74 6578 7428 7365 6c66 2e75 726c 2c20  _text(self.url, 
+0001f080: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
+0001f090: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
+0001f0a0: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
+0001f0b0: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
+0001f0c0: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
+0001f0d0: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+0001f0e0: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
+0001f0f0: 6578 7428 7365 6c66 2e74 6f6b 656e 2c20  ext(self.token, 
+0001f100: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
+0001f110: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
+0001f120: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
+0001f130: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
+0001f140: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
+0001f150: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+0001f160: 2072 6571 7565 7374 732e 706f 7374 2875   requests.post(u
+0001f170: 726c 2b66 227b 6d6f 756e 745f 7061 7468  rl+f"{mount_path
+0001f180: 7d2f 6465 6372 7970 742f 7b6e 616d 657d  }/decrypt/{name}
+0001f190: 222c 2068 6561 6465 7273 3d7b 2258 2d56  ", headers={"X-V
+0001f1a0: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
+0001f1b0: 656e 7d2c 2064 6174 613d 6a73 6f6e 2e64  en}, data=json.d
+0001f1c0: 756d 7073 2870 6179 6c6f 6164 2929 0d0a  umps(payload))..
+0001f1d0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0001f1e0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+0001f1f0: 3d20 3230 3020 6f72 2072 6573 2e73 7461  = 200 or res.sta
+0001f200: 7475 735f 636f 6465 203d 3d20 3230 343a  tus_code == 204:
+0001f210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001f220: 2020 7265 7475 726e 2072 6573 2e6a 736f    return res.jso
+0001f230: 6e28 295b 2264 6174 6122 5d0d 0a20 2020  n()["data"]..   
+0001f240: 2020 2020 2020 2020 2065 6c69 6620 7265           elif re
+0001f250: 732e 7374 6174 7573 5f63 6f64 6520 3d3d  s.status_code ==
+0001f260: 2070 6172 7469 616c 5f66 6169 6c75 7265   partial_failure
+0001f270: 5f72 6573 706f 6e73 655f 636f 6465 3a0d  _response_code:.
+0001f280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f290: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+0001f2a0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+0001f2b0: 5f5f 6e61 6d65 5f5f 7d20 2d20 6465 6372  __name__} - decr
+0001f2c0: 7970 7420 6461 7461 2065 7272 6f72 3a20  ypt data error: 
+0001f2d0: 7061 7274 6961 6c20 6661 696c 7572 6520  partial failure 
+0001f2e0: 7261 6973 6564 2229 0d0a 2020 2020 2020  raised")..      
+0001f2f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f300: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+0001f310: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001f320: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0001f330: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
+0001f340: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
+0001f350: 616d 655f 5f2c 2072 6573 2c20 2264 6563  ame__, res, "dec
+0001f360: 7279 7074 2064 6174 6120 6572 726f 7222  rypt data error"
+0001f370: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001f380: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+0001f390: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0001f3a0: 2020 7265 7475 726e 204e 6f6e 650d 0a0d    return None...
+0001f3b0: 0a20 2020 2023 2054 4f44 4f3a 2077 6169  .    # TODO: wai
+0001f3c0: 7420 666f 7220 7465 7374 696e 670d 0a20  t for testing.. 
+0001f3d0: 2020 2064 6566 2072 6577 7261 705f 6461     def rewrap_da
+0001f3e0: 7461 2873 656c 662c 200d 0a20 2020 2020  ta(self, ..     
+0001f3f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001f400: 6f75 6e74 5f70 6174 683a 2073 7472 2c0d  ount_path: str,.
+0001f410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f420: 2020 2020 206e 616d 653a 2073 7472 2c0d       name: str,.
+0001f430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f440: 2020 2020 2063 6970 6865 7274 6578 743a       ciphertext:
+0001f450: 2073 7472 203d 2022 222c 0d0a 2020 2020   str = "",..    
 0001f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f470: 2020 2020 6b65 795f 7665 7273 696f 6e3a      key_version:
-0001f480: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-0001f490: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-0001f4a0: 2020 2020 2020 2020 2020 2020 6e6f 6e63              nonc
-0001f4b0: 653a 2073 7472 203d 2022 222c 0d0a 2020  e: str = "",..  
+0001f470: 636f 6e74 6578 743a 2073 7472 203d 2022  context: str = "
+0001f480: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0001f490: 2020 2020 2020 2020 6b65 795f 7665 7273          key_vers
+0001f4a0: 696f 6e3a 204f 7074 696f 6e61 6c5b 696e  ion: Optional[in
+0001f4b0: 745d 203d 204e 6f6e 652c 0d0a 2020 2020  t] = None,..    
 0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4d0: 2020 7265 6665 7265 6e63 653a 2073 7472    reference: str
-0001f4e0: 203d 2022 222c 0d0a 2020 2020 2020 2020   = "",..        
-0001f4f0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-0001f500: 685f 696e 7075 743a 204f 7074 696f 6e61  h_input: Optiona
-0001f510: 6c5b 4c69 7374 5b64 6963 745d 5d20 3d20  l[List[dict]] = 
-0001f520: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-0001f530: 2222 2272 6577 7261 7020 7468 6520 7072  """rewrap the pr
-0001f540: 6f76 6964 6564 2063 6970 6865 7274 6578  ovided ciphertex
-0001f550: 7420 7573 696e 6720 7468 6520 6c61 7465  t using the late
-0001f560: 7374 2076 6572 7369 6f6e 206f 6620 7468  st version of th
-0001f570: 6520 6e61 6d65 6420 6b65 790d 0a0d 0a20  e named key.... 
-0001f580: 2020 2020 2020 2042 6563 6175 7365 2074         Because t
-0001f590: 6869 7320 6e65 7665 7220 7265 7475 726e  his never return
-0001f5a0: 7320 706c 6169 6e74 6578 742c 2069 7420  s plaintext, it 
-0001f5b0: 6973 2070 6f73 7369 626c 6520 746f 2064  is possible to d
-0001f5c0: 656c 6567 6174 6520 7468 6973 2066 756e  elegate this fun
-0001f5d0: 6374 696f 6e61 6c69 7479 2074 6f20 756e  ctionality to un
-0001f5e0: 7472 7573 7465 6420 7573 6572 7320 6f72  trusted users or
-0001f5f0: 2073 6372 6970 7473 0d0a 0d0a 2020 2020   scripts....    
-0001f600: 2020 2020 5265 6665 7220 746f 2068 7474      Refer to htt
-0001f610: 7073 3a2f 2f64 6576 656c 6f70 6572 2e68  ps://developer.h
-0001f620: 6173 6869 636f 7270 2e63 6f6d 2f76 6175  ashicorp.com/vau
-0001f630: 6c74 2f61 7069 2d64 6f63 732f 7365 6372  lt/api-docs/secr
-0001f640: 6574 2f74 7261 6e73 6974 2372 6577 7261  et/transit#rewra
-0001f650: 702d 6461 7461 2066 6f72 206d 6f72 6520  p-data for more 
-0001f660: 6465 7461 696c 732e 0d0a 0d0a 2020 2020  details.....    
-0001f670: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
-0001f680: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
-0001f690: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
-0001f6a0: 2020 2020 206e 616d 6520 2873 7472 293a       name (str):
-0001f6b0: 2053 7065 6369 6669 6573 2074 6865 206e   Specifies the n
-0001f6c0: 616d 6520 6f66 2074 6865 2065 6e63 7279  ame of the encry
-0001f6d0: 7074 696f 6e20 6b65 7920 746f 2072 652d  ption key to re-
-0001f6e0: 656e 6372 7970 7420 6167 6169 6e73 740d  encrypt against.
-0001f6f0: 0a20 2020 2020 2020 2020 2020 2063 6970  .            cip
-0001f700: 6865 7274 6578 7420 2873 7472 2c20 6f70  hertext (str, op
-0001f710: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
-0001f720: 6573 2074 6865 2063 6970 6865 7274 6578  es the ciphertex
-0001f730: 7420 746f 2072 652d 656e 6372 7970 742e  t to re-encrypt.
-0001f740: 2044 6566 6175 6c74 7320 746f 2022 222e   Defaults to "".
-0001f750: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-0001f760: 6e74 6578 7420 2873 7472 2c20 6f70 7469  ntext (str, opti
-0001f770: 6f6e 616c 293a 2053 7065 6369 6669 6573  onal): Specifies
-0001f780: 2074 6865 2062 6173 6536 3420 656e 636f   the base64 enco
-0001f790: 6465 6420 636f 6e74 6578 7420 666f 7220  ded context for 
-0001f7a0: 6b65 7920 6465 7269 7661 7469 6f6e 2e20  key derivation. 
-0001f7b0: 5468 6973 2069 7320 7265 7175 6972 6564  This is required
-0001f7c0: 2069 6620 6b65 7920 0d0a 2020 2020 2020   if key ..      
-0001f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001f7f0: 6572 6976 6174 696f 6e20 6973 2065 6e61  erivation is ena
-0001f800: 626c 6564 2e20 4465 6661 756c 7473 2074  bled. Defaults t
-0001f810: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-0001f820: 2020 206b 6579 5f76 6572 7369 6f6e 2028     key_version (
-0001f830: 4f70 7469 6f6e 616c 5b69 6e74 5d2c 206f  Optional[int], o
-0001f840: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
-0001f850: 6965 7320 7468 6520 7665 7273 696f 6e20  ies the version 
-0001f860: 6f66 2074 6865 206b 6579 2074 6f20 7573  of the key to us
-0001f870: 6520 666f 7220 7468 6520 6f70 6572 6174  e for the operat
-0001f880: 696f 6e2e 2049 6620 6e6f 7420 0d0a 2020  ion. If not ..  
-0001f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8c0: 2073 6574 2c20 7573 6573 2074 6865 206c   set, uses the l
-0001f8d0: 6174 6573 7420 7665 7273 696f 6e2e 204d  atest version. M
-0001f8e0: 7573 7420 6265 2067 7265 6174 6572 2074  ust be greater t
-0001f8f0: 6861 6e20 6f72 2065 7175 616c 2074 6f20  han or equal to 
-0001f900: 7468 6520 0d0a 2020 2020 2020 2020 2020  the ..          
-0001f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f930: 2020 2020 2020 2020 206b 6579 2773 2060           key's `
-0001f940: 6d69 6e5f 656e 6372 7970 7469 6f6e 5f76  min_encryption_v
-0001f950: 6572 7369 6f6e 602c 2069 6620 7365 742e  ersion`, if set.
-0001f960: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-0001f970: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
-0001f980: 6e6f 6e63 6520 2873 7472 2c20 6f70 7469  nonce (str, opti
-0001f990: 6f6e 616c 293a 2053 7065 6369 6669 6573  onal): Specifies
-0001f9a0: 2061 2062 6173 6536 3420 656e 636f 6465   a base64 encode
-0001f9b0: 6420 6e6f 6e63 6520 7661 6c75 6520 7573  d nonce value us
-0001f9c0: 6564 2064 7572 696e 6720 656e 6372 7970  ed during encryp
-0001f9d0: 7469 6f6e 2e20 4d75 7374 2062 6520 7072  tion. Must be pr
-0001f9e0: 6f76 6964 6564 2069 6620 0d0a 2020 2020  ovided if ..    
-0001f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001fa10: 6f6e 7665 7267 656e 7420 656e 6372 7970  onvergent encryp
-0001fa20: 7469 6f6e 2069 7320 656e 6162 6c65 6420  tion is enabled 
-0001fa30: 666f 7220 7468 6973 206b 6579 2061 6e64  for this key and
-0001fa40: 2074 6865 206b 6579 2077 6173 2067 656e   the key was gen
-0001fa50: 6572 6174 6564 2077 6974 6820 5661 756c  erated with Vaul
-0001fa60: 7420 0d0a 2020 2020 2020 2020 2020 2020  t ..            
-0001fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa80: 2020 2020 2020 2030 2e36 2e31 2e20 4e6f         0.6.1. No
-0001fa90: 7420 7265 7175 6972 6564 2066 6f72 206b  t required for k
-0001faa0: 6579 7320 6372 6561 7465 6420 696e 2030  eys created in 0
-0001fab0: 2e36 2e32 2b2e 2044 6566 6175 6c74 7320  .6.2+. Defaults 
-0001fac0: 746f 2022 222e 0d0a 2020 2020 2020 2020  to ""...        
-0001fad0: 2020 2020 7265 6665 7265 6e63 6520 2873      reference (s
-0001fae0: 7472 2c20 6f70 7469 6f6e 616c 293a 2041  tr, optional): A
-0001faf0: 2075 7365 722d 7375 7070 6c69 6564 2073   user-supplied s
-0001fb00: 7472 696e 6720 7468 6174 2077 696c 6c20  tring that will 
-0001fb10: 6265 2070 7265 7365 6e74 2069 6e20 7468  be present in th
-0001fb20: 6520 6072 6566 6572 656e 6365 6020 6669  e `reference` fi
-0001fb30: 656c 6420 6f6e 2074 6865 200d 0a20 2020  eld on the ..   
-0001fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb60: 2020 2020 636f 7272 6573 706f 6e64 696e      correspondin
-0001fb70: 6720 6062 6174 6368 5f72 6573 756c 7473  g `batch_results
-0001fb80: 6020 6974 656d 2069 6e20 7468 6520 7265  ` item in the re
-0001fb90: 7370 6f6e 7365 2c20 746f 2061 7373 6973  sponse, to assis
-0001fba0: 7420 696e 2075 6e64 6572 7374 616e 6469  t in understandi
-0001fbb0: 6e67 200d 0a20 2020 2020 2020 2020 2020  ng ..           
-0001fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbd0: 2020 2020 2020 2020 2020 2020 7768 6963              whic
-0001fbe0: 6820 7265 7375 6c74 2063 6f72 7265 7370  h result corresp
-0001fbf0: 6f6e 6473 2074 6f20 6120 7061 7274 6963  onds to a partic
-0001fc00: 756c 6172 2069 6e70 7574 2e20 4f6e 6c79  ular input. Only
-0001fc10: 2076 616c 6964 206f 6e20 6261 7463 6820   valid on batch 
-0001fc20: 7265 7175 6573 7473 2077 6865 6e20 0d0a  requests when ..
-0001fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc50: 2020 2020 2020 2075 7369 6e67 20e2 8098         using ...
-0001fc60: 6261 7463 685f 696e 7075 74e2 8099 2062  batch_input... b
-0001fc70: 656c 6f77 2e20 4465 6661 756c 7473 2074  elow. Defaults t
-0001fc80: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-0001fc90: 2020 2062 6174 6368 5f69 6e70 7574 2028     batch_input (
-0001fca0: 4f70 7469 6f6e 616c 5b4c 6973 745b 6469  Optional[List[di
-0001fcb0: 6374 5d5d 2c20 6f70 7469 6f6e 616c 293a  ct]], optional):
-0001fcc0: 2053 7065 6369 6669 6573 2061 206c 6973   Specifies a lis
-0001fcd0: 7420 6f66 2069 7465 6d73 2074 6f20 6265  t of items to be
-0001fce0: 2072 652d 656e 6372 7970 7465 6420 696e   re-encrypted in
-0001fcf0: 2061 2073 696e 676c 6520 6261 7463 682e   a single batch.
-0001fd00: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0001fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd30: 2020 2020 2020 2020 2020 2020 2057 6865               Whe
-0001fd40: 6e20 7468 6973 2070 6172 616d 6574 6572  n this parameter
-0001fd50: 2069 7320 7365 742c 2069 6620 7468 6520   is set, if the 
-0001fd60: 7061 7261 6d65 7465 7273 2027 6369 7068  parameters 'ciph
-0001fd70: 6572 7465 7874 272c 200d 0a20 2020 2020  ertext', ..     
-0001fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4d0: 6e6f 6e63 653a 2073 7472 203d 2022 222c  nonce: str = "",
+0001f4e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001f4f0: 2020 2020 2020 7265 6665 7265 6e63 653a        reference:
+0001f500: 2073 7472 203d 2022 222c 0d0a 2020 2020   str = "",..    
+0001f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f520: 6261 7463 685f 696e 7075 743a 204f 7074  batch_input: Opt
+0001f530: 696f 6e61 6c5b 4c69 7374 5b64 6963 745d  ional[List[dict]
+0001f540: 5d20 3d20 4e6f 6e65 293a 0d0a 2020 2020  ] = None):..    
+0001f550: 2020 2020 2222 2272 6577 7261 7020 7468      """rewrap th
+0001f560: 6520 7072 6f76 6964 6564 2063 6970 6865  e provided ciphe
+0001f570: 7274 6578 7420 7573 696e 6720 7468 6520  rtext using the 
+0001f580: 6c61 7465 7374 2076 6572 7369 6f6e 206f  latest version o
+0001f590: 6620 7468 6520 6e61 6d65 6420 6b65 790d  f the named key.
+0001f5a0: 0a0d 0a20 2020 2020 2020 2042 6563 6175  ...        Becau
+0001f5b0: 7365 2074 6869 7320 6e65 7665 7220 7265  se this never re
+0001f5c0: 7475 726e 7320 706c 6169 6e74 6578 742c  turns plaintext,
+0001f5d0: 2069 7420 6973 2070 6f73 7369 626c 6520   it is possible 
+0001f5e0: 746f 2064 656c 6567 6174 6520 7468 6973  to delegate this
+0001f5f0: 2066 756e 6374 696f 6e61 6c69 7479 2074   functionality t
+0001f600: 6f20 756e 7472 7573 7465 6420 7573 6572  o untrusted user
+0001f610: 7320 6f72 2073 6372 6970 7473 0d0a 0d0a  s or scripts....
+0001f620: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
+0001f630: 2068 7474 7073 3a2f 2f64 6576 656c 6f70   https://develop
+0001f640: 6572 2e68 6173 6869 636f 7270 2e63 6f6d  er.hashicorp.com
+0001f650: 2f76 6175 6c74 2f61 7069 2d64 6f63 732f  /vault/api-docs/
+0001f660: 7365 6372 6574 2f74 7261 6e73 6974 2372  secret/transit#r
+0001f670: 6577 7261 702d 6461 7461 2066 6f72 206d  ewrap-data for m
+0001f680: 6f72 6520 6465 7461 696c 732e 0d0a 0d0a  ore details.....
+0001f690: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
+0001f6a0: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
+0001f6b0: 5f70 6174 6820 2873 7472 290d 0a20 2020  _path (str)..   
+0001f6c0: 2020 2020 2020 2020 206e 616d 6520 2873           name (s
+0001f6d0: 7472 293a 2053 7065 6369 6669 6573 2074  tr): Specifies t
+0001f6e0: 6865 206e 616d 6520 6f66 2074 6865 2065  he name of the e
+0001f6f0: 6e63 7279 7074 696f 6e20 6b65 7920 746f  ncryption key to
+0001f700: 2072 652d 656e 6372 7970 7420 6167 6169   re-encrypt agai
+0001f710: 6e73 740d 0a20 2020 2020 2020 2020 2020  nst..           
+0001f720: 2063 6970 6865 7274 6578 7420 2873 7472   ciphertext (str
+0001f730: 2c20 6f70 7469 6f6e 616c 293a 2053 7065  , optional): Spe
+0001f740: 6369 6669 6573 2074 6865 2063 6970 6865  cifies the ciphe
+0001f750: 7274 6578 7420 746f 2072 652d 656e 6372  rtext to re-encr
+0001f760: 7970 742e 2044 6566 6175 6c74 7320 746f  ypt. Defaults to
+0001f770: 2022 222e 0d0a 2020 2020 2020 2020 2020   ""...          
+0001f780: 2020 636f 6e74 6578 7420 2873 7472 2c20    context (str, 
+0001f790: 6f70 7469 6f6e 616c 293a 2053 7065 6369  optional): Speci
+0001f7a0: 6669 6573 2074 6865 2062 6173 6536 3420  fies the base64 
+0001f7b0: 656e 636f 6465 6420 636f 6e74 6578 7420  encoded context 
+0001f7c0: 666f 7220 6b65 7920 6465 7269 7661 7469  for key derivati
+0001f7d0: 6f6e 2e20 5468 6973 2069 7320 7265 7175  on. This is requ
+0001f7e0: 6972 6564 2069 6620 6b65 7920 0d0a 2020  ired if key ..  
+0001f7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f810: 2020 2064 6572 6976 6174 696f 6e20 6973     derivation is
+0001f820: 2065 6e61 626c 6564 2e20 4465 6661 756c   enabled. Defaul
+0001f830: 7473 2074 6f20 2222 2e0d 0a20 2020 2020  ts to ""...     
+0001f840: 2020 2020 2020 206b 6579 5f76 6572 7369         key_versi
+0001f850: 6f6e 2028 4f70 7469 6f6e 616c 5b69 6e74  on (Optional[int
+0001f860: 5d2c 206f 7074 696f 6e61 6c29 3a20 5370  ], optional): Sp
+0001f870: 6563 6966 6965 7320 7468 6520 7665 7273  ecifies the vers
+0001f880: 696f 6e20 6f66 2074 6865 206b 6579 2074  ion of the key t
+0001f890: 6f20 7573 6520 666f 7220 7468 6520 6f70  o use for the op
+0001f8a0: 6572 6174 696f 6e2e 2049 6620 6e6f 7420  eration. If not 
+0001f8b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8e0: 2020 2020 2073 6574 2c20 7573 6573 2074       set, uses t
+0001f8f0: 6865 206c 6174 6573 7420 7665 7273 696f  he latest versio
+0001f900: 6e2e 204d 7573 7420 6265 2067 7265 6174  n. Must be great
+0001f910: 6572 2074 6861 6e20 6f72 2065 7175 616c  er than or equal
+0001f920: 2074 6f20 7468 6520 0d0a 2020 2020 2020   to the ..      
+0001f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f950: 2020 2020 2020 2020 2020 2020 206b 6579               key
+0001f960: 2773 2060 6d69 6e5f 656e 6372 7970 7469  's `min_encrypti
+0001f970: 6f6e 5f76 6572 7369 6f6e 602c 2069 6620  on_version`, if 
+0001f980: 7365 742e 2044 6566 6175 6c74 7320 746f  set. Defaults to
+0001f990: 204e 6f6e 652e 0d0a 2020 2020 2020 2020   None...        
+0001f9a0: 2020 2020 6e6f 6e63 6520 2873 7472 2c20      nonce (str, 
+0001f9b0: 6f70 7469 6f6e 616c 293a 2053 7065 6369  optional): Speci
+0001f9c0: 6669 6573 2061 2062 6173 6536 3420 656e  fies a base64 en
+0001f9d0: 636f 6465 6420 6e6f 6e63 6520 7661 6c75  coded nonce valu
+0001f9e0: 6520 7573 6564 2064 7572 696e 6720 656e  e used during en
+0001f9f0: 6372 7970 7469 6f6e 2e20 4d75 7374 2062  cryption. Must b
+0001fa00: 6520 7072 6f76 6964 6564 2069 6620 0d0a  e provided if ..
+0001fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa30: 2020 2063 6f6e 7665 7267 656e 7420 656e     convergent en
+0001fa40: 6372 7970 7469 6f6e 2069 7320 656e 6162  cryption is enab
+0001fa50: 6c65 6420 666f 7220 7468 6973 206b 6579  led for this key
+0001fa60: 2061 6e64 2074 6865 206b 6579 2077 6173   and the key was
+0001fa70: 2067 656e 6572 6174 6564 2077 6974 6820   generated with 
+0001fa80: 5661 756c 7420 0d0a 2020 2020 2020 2020  Vault ..        
+0001fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001faa0: 2020 2020 2020 2020 2020 2030 2e36 2e31             0.6.1
+0001fab0: 2e20 4e6f 7420 7265 7175 6972 6564 2066  . Not required f
+0001fac0: 6f72 206b 6579 7320 6372 6561 7465 6420  or keys created 
+0001fad0: 696e 2030 2e36 2e32 2b2e 2044 6566 6175  in 0.6.2+. Defau
+0001fae0: 6c74 7320 746f 2022 222e 0d0a 2020 2020  lts to ""...    
+0001faf0: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
+0001fb00: 6520 2873 7472 2c20 6f70 7469 6f6e 616c  e (str, optional
+0001fb10: 293a 2041 2075 7365 722d 7375 7070 6c69  ): A user-suppli
+0001fb20: 6564 2073 7472 696e 6720 7468 6174 2077  ed string that w
+0001fb30: 696c 6c20 6265 2070 7265 7365 6e74 2069  ill be present i
+0001fb40: 6e20 7468 6520 6072 6566 6572 656e 6365  n the `reference
+0001fb50: 6020 6669 656c 6420 6f6e 2074 6865 200d  ` field on the .
+0001fb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb80: 2020 2020 2020 2020 636f 7272 6573 706f          correspo
+0001fb90: 6e64 696e 6720 6062 6174 6368 5f72 6573  nding `batch_res
+0001fba0: 756c 7473 6020 6974 656d 2069 6e20 7468  ults` item in th
+0001fbb0: 6520 7265 7370 6f6e 7365 2c20 746f 2061  e response, to a
+0001fbc0: 7373 6973 7420 696e 2075 6e64 6572 7374  ssist in underst
+0001fbd0: 616e 6469 6e67 200d 0a20 2020 2020 2020  anding ..       
+0001fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc00: 7768 6963 6820 7265 7375 6c74 2063 6f72  which result cor
+0001fc10: 7265 7370 6f6e 6473 2074 6f20 6120 7061  responds to a pa
+0001fc20: 7274 6963 756c 6172 2069 6e70 7574 2e20  rticular input. 
+0001fc30: 4f6e 6c79 2076 616c 6964 206f 6e20 6261  Only valid on ba
+0001fc40: 7463 6820 7265 7175 6573 7473 2077 6865  tch requests whe
+0001fc50: 6e20 0d0a 2020 2020 2020 2020 2020 2020  n ..            
+0001fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc70: 2020 2020 2020 2020 2020 2075 7369 6e67             using
+0001fc80: 20e2 8098 6261 7463 685f 696e 7075 74e2   ...batch_input.
+0001fc90: 8099 2062 656c 6f77 2e20 4465 6661 756c  .. below. Defaul
+0001fca0: 7473 2074 6f20 2222 2e0d 0a20 2020 2020  ts to ""...     
+0001fcb0: 2020 2020 2020 2062 6174 6368 5f69 6e70         batch_inp
+0001fcc0: 7574 2028 4f70 7469 6f6e 616c 5b4c 6973  ut (Optional[Lis
+0001fcd0: 745b 6469 6374 5d5d 2c20 6f70 7469 6f6e  t[dict]], option
+0001fce0: 616c 293a 2053 7065 6369 6669 6573 2061  al): Specifies a
+0001fcf0: 206c 6973 7420 6f66 2069 7465 6d73 2074   list of items t
+0001fd00: 6f20 6265 2072 652d 656e 6372 7970 7465  o be re-encrypte
+0001fd10: 6420 696e 2061 2073 696e 676c 6520 6261  d in a single ba
+0001fd20: 7463 682e 200d 0a20 2020 2020 2020 2020  tch. ..         
+0001fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd60: 2057 6865 6e20 7468 6973 2070 6172 616d   When this param
+0001fd70: 6574 6572 2069 7320 7365 742c 2069 6620  eter is set, if 
+0001fd80: 7468 6520 7061 7261 6d65 7465 7273 2027  the parameters '
+0001fd90: 6369 7068 6572 7465 7874 272c 200d 0a20  ciphertext', .. 
 0001fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdb0: 2020 2020 2027 636f 6e74 6578 7427 2061       'context' a
-0001fdc0: 6e64 2027 6e6f 6e63 6527 2061 7265 2061  nd 'nonce' are a
-0001fdd0: 6c73 6f20 7365 742c 2074 6865 7920 7769  lso set, they wi
-0001fde0: 6c6c 2062 6520 6967 6e6f 7265 642e 2041  ll be ignored. A
-0001fdf0: 6e79 200d 0a20 2020 2020 2020 2020 2020  ny ..           
-0001fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001fe30: 6174 6368 206f 7574 7075 7420 7769 6c6c  atch output will
-0001fe40: 2070 7265 7365 7276 6520 7468 6520 6f72   preserve the or
-0001fe50: 6465 7220 6f66 2074 6865 2062 6174 6368  der of the batch
-0001fe60: 2069 6e70 7574 2e20 0d0a 2020 2020 2020   input. ..      
-0001fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdd0: 2020 2020 2020 2020 2027 636f 6e74 6578           'contex
+0001fde0: 7427 2061 6e64 2027 6e6f 6e63 6527 2061  t' and 'nonce' a
+0001fdf0: 7265 2061 6c73 6f20 7365 742c 2074 6865  re also set, the
+0001fe00: 7920 7769 6c6c 2062 6520 6967 6e6f 7265  y will be ignore
+0001fe10: 642e 2041 6e79 200d 0a20 2020 2020 2020  d. Any ..       
+0001fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe50: 2020 2062 6174 6368 206f 7574 7075 7420     batch output 
+0001fe60: 7769 6c6c 2070 7265 7365 7276 6520 7468  will preserve th
+0001fe70: 6520 6f72 6465 7220 6f66 2074 6865 2062  e order of the b
+0001fe80: 6174 6368 2069 6e70 7574 2e20 0d0a 2020  atch input. ..  
 0001fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fea0: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-0001feb0: 4e6f 6e65 2e0d 0a0d 0a20 2020 2020 2020  None.....       
-0001fec0: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
-0001fed0: 2020 2020 2020 2064 6963 7420 6f72 204e         dict or N
-0001fee0: 6f6e 653a 2072 6574 7572 6e20 7468 6520  one: return the 
-0001fef0: 7265 2d65 6e63 7279 7074 6564 2063 6970  re-encrypted cip
-0001ff00: 6865 7220 7465 7874 2069 6e20 6469 6374  her text in dict
-0001ff10: 2069 6620 7375 6363 6573 732c 206f 7468   if success, oth
-0001ff20: 6572 7769 7365 2072 6574 7572 6e20 4e6f  erwise return No
-0001ff30: 6e65 0d0a 2020 2020 2020 2020 2222 220d  ne..        """.
-0001ff40: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0001ff50: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-0001ff60: 2020 2020 2020 2065 7869 7374 5f6b 6579         exist_key
-0001ff70: 7320 3d20 7365 6c66 2e6c 6973 745f 6b65  s = self.list_ke
-0001ff80: 7928 6d6f 756e 745f 7061 7468 290d 0a20  y(mount_path).. 
-0001ff90: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-0001ffa0: 6d65 206e 6f74 2069 6e20 6578 6973 745f  me not in exist_
-0001ffb0: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
-0001ffc0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-0001ffd0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-0001ffe0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-0001fff0: 2d20 7265 7772 6170 2064 6174 6120 6572  - rewrap data er
-00020000: 726f 723a 206b 6579 2027 7b6e 616d 657d  ror: key '{name}
-00020010: 2720 6e6f 7420 666f 756e 6422 290d 0a20  ' not found").. 
-00020020: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00020030: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-00020040: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00020050: 2020 2020 2020 7061 796c 6f61 6420 3d20        payload = 
-00020060: 6469 6374 2829 0d0a 2020 2020 2020 2020  dict()..        
-00020070: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00020080: 2020 6966 2062 6174 6368 5f69 6e70 7574    if batch_input
-00020090: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000200a0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000200b0: 7420 6973 5f62 6173 6536 3428 6369 7068  t is_base64(ciph
-000200c0: 6572 7465 7874 293a 0d0a 2020 2020 2020  ertext):..      
-000200d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000200e0: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-000200f0: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00020100: 616d 655f 5f7d 202d 2072 6577 7261 7020  ame__} - rewrap 
-00020110: 6461 7461 2065 7272 6f72 3a20 7468 6520  data error: the 
-00020120: 6369 7068 6572 7465 7874 206d 7573 7420  ciphertext must 
-00020130: 6265 2062 6173 6536 3420 656e 636f 6465  be base64 encode
-00020140: 6422 290d 0a20 2020 2020 2020 2020 2020  d")..           
-00020150: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00020160: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00020170: 2020 2020 2020 7061 796c 6f61 645b 2263        payload["c
-00020180: 6970 6865 7274 6578 7422 5d20 3d20 6369  iphertext"] = ci
-00020190: 7068 6572 7465 7874 0d0a 2020 2020 2020  phertext..      
-000201a0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000201b0: 2020 2020 2020 2020 6966 206b 6579 5f76          if key_v
-000201c0: 6572 7369 6f6e 2069 7320 6e6f 7420 4e6f  ersion is not No
-000201d0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000201e0: 2020 2020 2069 6620 6e6f 7420 6973 5f69       if not is_i
-000201f0: 6e74 286b 6579 5f76 6572 7369 6f6e 293a  nt(key_version):
-00020200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00020210: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00020220: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-00020230: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-00020240: 2072 6577 7261 7020 6461 7461 2065 7272   rewrap data err
-00020250: 6f72 3a20 7468 6520 6b65 795f 7665 7273  or: the key_vers
-00020260: 696f 6e20 6d75 7374 2062 6520 616e 2069  ion must be an i
-00020270: 6e74 6567 6572 2229 0d0a 2020 2020 2020  nteger")..      
-00020280: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00020290: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-000202a0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-000202b0: 795f 7665 7273 696f 6e20 3c20 7365 6c66  y_version < self
-000202c0: 2e72 6561 645f 6b65 7928 6d6f 756e 745f  .read_key(mount_
-000202d0: 7061 7468 2c20 6e61 6d65 295b 226d 696e  path, name)["min
-000202e0: 5f65 6e63 7279 7074 696f 6e5f 7665 7273  _encryption_vers
-000202f0: 696f 6e22 5d3a 0d0a 2020 2020 2020 2020  ion"]:..        
-00020300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00020310: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-00020320: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-00020330: 655f 5f7d 202d 2072 6577 7261 7020 6461  e__} - rewrap da
-00020340: 7461 2065 7272 6f72 3a20 6772 6561 7465  ta error: greate
-00020350: 7220 7468 616e 206f 7220 6571 7561 6c20  r than or equal 
-00020360: 746f 2074 6865 206b 6579 2773 2022 0d0a  to the key's "..
-00020370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020390: 2020 2020 2020 6622 606d 696e 5f65 6e63        f"`min_enc
-000203a0: 7279 7074 696f 6e5f 7665 7273 696f 6e60  ryption_version`
-000203b0: 2c20 6966 2073 6574 2229 0d0a 2020 2020  , if set")..    
-000203c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203d0: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-000203e0: 2020 2020 2020 2020 2020 2020 2070 6179               pay
-000203f0: 6c6f 6164 5b22 6b65 795f 7665 7273 696f  load["key_versio
-00020400: 6e22 5d20 3d20 6b65 795f 7665 7273 696f  n"] = key_versio
-00020410: 6e0d 0a0d 0a20 2020 2020 2020 2020 2020  n....           
-00020420: 2069 6620 6261 7463 685f 696e 7075 7420   if batch_input 
-00020430: 6973 204e 6f6e 6520 616e 6420 636f 6e74  is None and cont
-00020440: 6578 7420 213d 2022 223a 0d0a 2020 2020  ext != "":..    
-00020450: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00020460: 6f74 2069 735f 6261 7365 3634 2863 6f6e  ot is_base64(con
-00020470: 7465 7874 293a 0d0a 2020 2020 2020 2020  text):..        
-00020480: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00020490: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-000204a0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-000204b0: 655f 5f7d 202d 2072 6577 7261 7020 6461  e__} - rewrap da
-000204c0: 7461 2065 7272 6f72 3a20 7468 6520 636f  ta error: the co
-000204d0: 6e74 6578 7420 6d75 7374 2062 6520 6261  ntext must be ba
-000204e0: 7365 3634 2065 6e63 6f64 6564 2069 6620  se64 encoded if 
-000204f0: 7365 7422 290d 0a20 2020 2020 2020 2020  set")..         
-00020500: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00020510: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
-00020520: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
-00020530: 2263 6f6e 7465 7874 225d 203d 2063 6f6e  "context"] = con
-00020540: 7465 7874 0d0a 0d0a 2020 2020 2020 2020  text....        
-00020550: 2020 2020 6966 2062 6174 6368 5f69 6e70      if batch_inp
-00020560: 7574 2069 7320 4e6f 6e65 2061 6e64 206e  ut is None and n
-00020570: 6f6e 6365 2021 3d20 2222 3a0d 0a20 2020  once != "":..   
-00020580: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00020590: 6e6f 7420 6973 5f62 6173 6536 3428 6e6f  not is_base64(no
-000205a0: 6e63 6529 3a0d 0a20 2020 2020 2020 2020  nce):..         
-000205b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000205c0: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-000205d0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-000205e0: 5f5f 7d20 2d20 7265 7772 6170 2064 6174  __} - rewrap dat
-000205f0: 6120 6572 726f 723a 2074 6865 206e 6f6e  a error: the non
-00020600: 6365 206d 7573 7420 6265 2062 6173 6536  ce must be base6
-00020610: 3420 656e 636f 6465 6420 6966 2073 6574  4 encoded if set
-00020620: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00020630: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00020640: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00020650: 2020 2020 2070 6179 6c6f 6164 5b22 6e6f       payload["no
-00020660: 6e63 6522 5d20 3d20 6e6f 6e63 650d 0a0d  nce"] = nonce...
-00020670: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00020680: 6261 7463 685f 696e 7075 7420 6973 206e  batch_input is n
-00020690: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-000206a0: 2020 2020 2020 2020 2020 6966 2072 6566            if ref
-000206b0: 6572 656e 6365 2021 3d20 2222 3a0d 0a20  erence != "":.. 
-000206c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000206d0: 2020 2070 6179 6c6f 6164 5b22 7265 6665     payload["refe
-000206e0: 7265 6e63 6522 5d20 3d20 7265 6665 7265  rence"] = refere
-000206f0: 6e63 650d 0a20 2020 2020 2020 2020 2020  nce..           
-00020700: 2020 2020 2070 6179 6c6f 6164 5b22 6261       payload["ba
-00020710: 7463 685f 696e 7075 7422 5d20 3d20 6261  tch_input"] = ba
-00020720: 7463 685f 696e 7075 740d 0a0d 0a20 2020  tch_input....   
-00020730: 2020 2020 2020 2020 2075 726c 203d 2061           url = a
-00020740: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
-00020750: 7365 6c66 2e75 726c 2c20 6b65 793d 7261  self.url, key=ra
-00020760: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
-00020770: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
-00020780: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
-00020790: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
-000207a0: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
-000207b0: 2020 2020 2074 6f6b 656e 203d 2061 6573       token = aes
-000207c0: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-000207d0: 6c66 2e74 6f6b 656e 2c20 6b65 793d 7261  lf.token, key=ra
-000207e0: 6e64 6f6d 5f68 6578 2873 656c 662e 5f6b  ndom_hex(self._k
-000207f0: 6579 5f6c 656e 2c20 7365 6c66 2e5f 7365  ey_len, self._se
-00020800: 6564 2a32 292c 2069 763d 7261 6e64 6f6d  ed*2), iv=random
-00020810: 5f68 6578 2831 362c 2073 656c 662e 5f73  _hex(16, self._s
-00020820: 6565 642a 3329 290d 0a20 2020 2020 2020  eed*3))..       
-00020830: 2020 2020 2072 6573 203d 2072 6571 7565       res = reque
-00020840: 7374 732e 706f 7374 2875 726c 2b66 227b  sts.post(url+f"{
-00020850: 6d6f 756e 745f 7061 7468 7d2f 7265 7772  mount_path}/rewr
-00020860: 6170 2f7b 6e61 6d65 7d22 2c20 6865 6164  ap/{name}", head
-00020870: 6572 733d 7b22 582d 5661 756c 742d 546f  ers={"X-Vault-To
-00020880: 6b65 6e22 3a20 746f 6b65 6e7d 2c20 6461  ken": token}, da
-00020890: 7461 3d6a 736f 6e2e 6475 6d70 7328 7061  ta=json.dumps(pa
-000208a0: 796c 6f61 6429 290d 0a20 2020 2020 2020  yload))..       
-000208b0: 2020 2020 2069 6620 7265 732e 7374 6174       if res.stat
-000208c0: 7573 5f63 6f64 6520 3d3d 2032 3030 206f  us_code == 200 o
-000208d0: 7220 7265 732e 7374 6174 7573 5f63 6f64  r res.status_cod
-000208e0: 6520 3d3d 2032 3034 3a0d 0a20 2020 2020  e == 204:..     
-000208f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00020900: 6e20 7265 732e 6a73 6f6e 2829 5b22 6461  n res.json()["da
-00020910: 7461 225d 0d0a 2020 2020 2020 2020 2020  ta"]..          
-00020920: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00020930: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-00020940: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
-00020950: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
-00020960: 6d65 5f5f 2c20 7265 732c 2022 7265 7772  me__, res, "rewr
-00020970: 6170 2064 6174 6120 6572 726f 7222 290d  ap data error").
-00020980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020990: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-000209a0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000209b0: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
-000209c0: 2020 2023 2054 4f44 4f3a 2077 6169 7420     # TODO: wait 
-000209d0: 666f 7220 7465 7374 696e 670d 0a20 2020  for testing..   
-000209e0: 2064 6566 2067 656e 6572 6174 655f 6461   def generate_da
-000209f0: 7461 5f6b 6579 2873 656c 662c 200d 0a20  ta_key(self, .. 
-00020a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a10: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
-00020a20: 6174 683a 2073 7472 2c0d 0a20 2020 2020  ath: str,..     
-00020a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a40: 2020 2020 2074 7970 655f 6e61 6d65 3a20       type_name: 
-00020a50: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
-00020a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a70: 6e61 6d65 3a20 7374 722c 0d0a 2020 2020  name: str,..    
+0001fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fec0: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
+0001fed0: 2074 6f20 4e6f 6e65 2e0d 0a0d 0a20 2020   to None.....   
+0001fee0: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+0001fef0: 2020 2020 2020 2020 2020 2064 6963 7420             dict 
+0001ff00: 6f72 204e 6f6e 653a 2072 6574 7572 6e20  or None: return 
+0001ff10: 7468 6520 7265 2d65 6e63 7279 7074 6564  the re-encrypted
+0001ff20: 2063 6970 6865 7220 7465 7874 2069 6e20   cipher text in 
+0001ff30: 6469 6374 2069 6620 7375 6363 6573 732c  dict if success,
+0001ff40: 206f 7468 6572 7769 7365 2072 6574 7572   otherwise retur
+0001ff50: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+0001ff60: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+0001ff70: 7365 6c66 2e69 735f 6175 7468 3a0d 0a20  self.is_auth:.. 
+0001ff80: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+0001ff90: 5f6b 6579 7320 3d20 7365 6c66 2e6c 6973  _keys = self.lis
+0001ffa0: 745f 6b65 7928 6d6f 756e 745f 7061 7468  t_key(mount_path
+0001ffb0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0001ffc0: 6620 6e61 6d65 206e 6f74 2069 6e20 6578  f name not in ex
+0001ffd0: 6973 745f 6b65 7973 3a0d 0a20 2020 2020  ist_keys:..     
+0001ffe0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001fff0: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
+00020000: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00020010: 5f5f 7d20 2d20 7265 7772 6170 2064 6174  __} - rewrap dat
+00020020: 6120 6572 726f 723a 206b 6579 2027 7b6e  a error: key '{n
+00020030: 616d 657d 2720 6e6f 7420 666f 756e 6422  ame}' not found"
+00020040: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00020050: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+00020060: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00020070: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
+00020080: 6420 3d20 6469 6374 2829 0d0a 2020 2020  d = dict()..    
+00020090: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000200a0: 2020 2020 2020 6966 2062 6174 6368 5f69        if batch_i
+000200b0: 6e70 7574 2069 7320 4e6f 6e65 3a0d 0a20  nput is None:.. 
+000200c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000200d0: 6620 6e6f 7420 6973 5f62 6173 6536 3428  f not is_base64(
+000200e0: 6369 7068 6572 7465 7874 293a 0d0a 2020  ciphertext):..  
+000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020100: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+00020110: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+00020120: 2e5f 5f6e 616d 655f 5f7d 202d 2072 6577  .__name__} - rew
+00020130: 7261 7020 6461 7461 2065 7272 6f72 3a20  rap data error: 
+00020140: 7468 6520 6369 7068 6572 7465 7874 206d  the ciphertext m
+00020150: 7573 7420 6265 2062 6173 6536 3420 656e  ust be base64 en
+00020160: 636f 6465 6422 290d 0a20 2020 2020 2020  coded")..       
+00020170: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00020180: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+00020190: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
+000201a0: 645b 2263 6970 6865 7274 6578 7422 5d20  d["ciphertext"] 
+000201b0: 3d20 6369 7068 6572 7465 7874 0d0a 2020  = ciphertext..  
+000201c0: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+000201d0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+000201e0: 6579 5f76 6572 7369 6f6e 2069 7320 6e6f  ey_version is no
+000201f0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00020200: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00020210: 6973 5f69 6e74 286b 6579 5f76 6572 7369  is_int(key_versi
+00020220: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
+00020230: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00020240: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
+00020250: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00020260: 5f7d 202d 2072 6577 7261 7020 6461 7461  _} - rewrap data
+00020270: 2065 7272 6f72 3a20 7468 6520 6b65 795f   error: the key_
+00020280: 7665 7273 696f 6e20 6d75 7374 2062 6520  version must be 
+00020290: 616e 2069 6e74 6567 6572 2229 0d0a 2020  an integer")..  
+000202a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202b0: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
+000202c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000202d0: 6620 6b65 795f 7665 7273 696f 6e20 3c20  f key_version < 
+000202e0: 7365 6c66 2e72 6561 645f 6b65 7928 6d6f  self.read_key(mo
+000202f0: 756e 745f 7061 7468 2c20 6e61 6d65 295b  unt_path, name)[
+00020300: 226d 696e 5f65 6e63 7279 7074 696f 6e5f  "min_encryption_
+00020310: 7665 7273 696f 6e22 5d3a 0d0a 2020 2020  version"]:..    
+00020320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020330: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+00020340: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+00020350: 5f6e 616d 655f 5f7d 202d 2072 6577 7261  _name__} - rewra
+00020360: 7020 6461 7461 2065 7272 6f72 3a20 6772  p data error: gr
+00020370: 6561 7465 7220 7468 616e 206f 7220 6571  eater than or eq
+00020380: 7561 6c20 746f 2074 6865 206b 6579 2773  ual to the key's
+00020390: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+000203a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203b0: 2020 2020 2020 2020 2020 6622 606d 696e            f"`min
+000203c0: 5f65 6e63 7279 7074 696f 6e5f 7665 7273  _encryption_vers
+000203d0: 696f 6e60 2c20 6966 2073 6574 2229 0d0a  ion`, if set")..
+000203e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203f0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+00020400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020410: 2070 6179 6c6f 6164 5b22 6b65 795f 7665   payload["key_ve
+00020420: 7273 696f 6e22 5d20 3d20 6b65 795f 7665  rsion"] = key_ve
+00020430: 7273 696f 6e0d 0a0d 0a20 2020 2020 2020  rsion....       
+00020440: 2020 2020 2069 6620 6261 7463 685f 696e       if batch_in
+00020450: 7075 7420 6973 204e 6f6e 6520 616e 6420  put is None and 
+00020460: 636f 6e74 6578 7420 213d 2022 223a 0d0a  context != "":..
+00020470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020480: 6966 206e 6f74 2069 735f 6261 7365 3634  if not is_base64
+00020490: 2863 6f6e 7465 7874 293a 0d0a 2020 2020  (context):..    
+000204a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204b0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+000204c0: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+000204d0: 5f6e 616d 655f 5f7d 202d 2072 6577 7261  _name__} - rewra
+000204e0: 7020 6461 7461 2065 7272 6f72 3a20 7468  p data error: th
+000204f0: 6520 636f 6e74 6578 7420 6d75 7374 2062  e context must b
+00020500: 6520 6261 7365 3634 2065 6e63 6f64 6564  e base64 encoded
+00020510: 2069 6620 7365 7422 290d 0a20 2020 2020   if set")..     
+00020520: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00020530: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
+00020540: 2020 2020 2020 2020 2020 2020 7061 796c              payl
+00020550: 6f61 645b 2263 6f6e 7465 7874 225d 203d  oad["context"] =
+00020560: 2063 6f6e 7465 7874 0d0a 0d0a 2020 2020   context....    
+00020570: 2020 2020 2020 2020 6966 2062 6174 6368          if batch
+00020580: 5f69 6e70 7574 2069 7320 4e6f 6e65 2061  _input is None a
+00020590: 6e64 206e 6f6e 6365 2021 3d20 2222 3a0d  nd nonce != "":.
+000205a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000205b0: 2069 6620 6e6f 7420 6973 5f62 6173 6536   if not is_base6
+000205c0: 3428 6e6f 6e63 6529 3a0d 0a20 2020 2020  4(nonce):..     
+000205d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000205e0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+000205f0: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+00020600: 6e61 6d65 5f5f 7d20 2d20 7265 7772 6170  name__} - rewrap
+00020610: 2064 6174 6120 6572 726f 723a 2074 6865   data error: the
+00020620: 206e 6f6e 6365 206d 7573 7420 6265 2062   nonce must be b
+00020630: 6173 6536 3420 656e 636f 6465 6420 6966  ase64 encoded if
+00020640: 2073 6574 2229 0d0a 2020 2020 2020 2020   set")..        
+00020650: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00020660: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+00020670: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+00020680: 5b22 6e6f 6e63 6522 5d20 3d20 6e6f 6e63  ["nonce"] = nonc
+00020690: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+000206a0: 2069 6620 6261 7463 685f 696e 7075 7420   if batch_input 
+000206b0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000206c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000206d0: 2072 6566 6572 656e 6365 2021 3d20 2222   reference != ""
+000206e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000206f0: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
+00020700: 7265 6665 7265 6e63 6522 5d20 3d20 7265  reference"] = re
+00020710: 6665 7265 6e63 650d 0a20 2020 2020 2020  ference..       
+00020720: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+00020730: 5b22 6261 7463 685f 696e 7075 7422 5d20  ["batch_input"] 
+00020740: 3d20 6261 7463 685f 696e 7075 740d 0a0d  = batch_input...
+00020750: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
+00020760: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
+00020770: 6578 7428 7365 6c66 2e75 726c 2c20 6b65  ext(self.url, ke
+00020780: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
+00020790: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
+000207a0: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
+000207b0: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
+000207c0: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
+000207d0: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
+000207e0: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+000207f0: 7428 7365 6c66 2e74 6f6b 656e 2c20 6b65  t(self.token, ke
+00020800: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
+00020810: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
+00020820: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
+00020830: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
+00020840: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
+00020850: 2020 2020 2020 2020 2072 6573 203d 2072           res = r
+00020860: 6571 7565 7374 732e 706f 7374 2875 726c  equests.post(url
+00020870: 2b66 227b 6d6f 756e 745f 7061 7468 7d2f  +f"{mount_path}/
+00020880: 7265 7772 6170 2f7b 6e61 6d65 7d22 2c20  rewrap/{name}", 
+00020890: 6865 6164 6572 733d 7b22 582d 5661 756c  headers={"X-Vaul
+000208a0: 742d 546f 6b65 6e22 3a20 746f 6b65 6e7d  t-Token": token}
+000208b0: 2c20 6461 7461 3d6a 736f 6e2e 6475 6d70  , data=json.dump
+000208c0: 7328 7061 796c 6f61 6429 290d 0a20 2020  s(payload))..   
+000208d0: 2020 2020 2020 2020 2069 6620 7265 732e           if res.
+000208e0: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
+000208f0: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
+00020900: 5f63 6f64 6520 3d3d 2032 3034 3a0d 0a20  _code == 204:.. 
+00020910: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00020920: 6574 7572 6e20 7265 732e 6a73 6f6e 2829  eturn res.json()
+00020930: 5b22 6461 7461 225d 0d0a 2020 2020 2020  ["data"]..      
+00020940: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00020950: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00020960: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
+00020970: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
+00020980: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
+00020990: 7265 7772 6170 2064 6174 6120 6572 726f  rewrap data erro
+000209a0: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
+000209b0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+000209c0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000209d0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+000209e0: 0a0d 0a20 2020 2023 2054 4f44 4f3a 2077  ...    # TODO: w
+000209f0: 6169 7420 666f 7220 7465 7374 696e 670d  ait for testing.
+00020a00: 0a20 2020 2064 6566 2067 656e 6572 6174  .    def generat
+00020a10: 655f 6461 7461 5f6b 6579 2873 656c 662c  e_data_key(self,
+00020a20: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00020a30: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
+00020a40: 6e74 5f70 6174 683a 2073 7472 2c0d 0a20  nt_path: str,.. 
+00020a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a60: 2020 2020 2020 2020 2074 7970 655f 6e61           type_na
+00020a70: 6d65 3a20 7374 722c 0d0a 2020 2020 2020  me: str,..      
 00020a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a90: 2020 2020 2020 636f 6e74 6578 743a 2073        context: s
-00020aa0: 7472 203d 2022 222c 0d0a 2020 2020 2020  tr = "",..      
-00020ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ac0: 2020 2020 6e6f 6e63 653a 2073 7472 203d      nonce: str =
-00020ad0: 2022 222c 0d0a 2020 2020 2020 2020 2020   "",..          
-00020ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020af0: 6269 7473 3a20 696e 7420 3d20 3235 3629  bits: int = 256)
-00020b00: 3a0d 0a20 2020 2020 2020 2022 2222 6765  :..        """ge
-00020b10: 6e65 7261 7465 2061 206e 6577 2068 6967  nerate a new hig
-00020b20: 682d 656e 7472 6f70 7920 6b65 7920 616e  h-entropy key an
-00020b30: 6420 7468 6520 7661 6c75 6520 656e 6372  d the value encr
-00020b40: 7970 7465 6420 7769 7468 2074 6865 206e  ypted with the n
-00020b50: 616d 6564 206b 6579 0d0a 2020 2020 2020  amed key..      
-00020b60: 2020 0d0a 2020 2020 2020 2020 4f70 7469    ..        Opti
-00020b70: 6f6e 616c 6c79 2072 6574 7572 6e20 7468  onally return th
-00020b80: 6520 706c 6169 6e74 6578 7420 6f66 2074  e plaintext of t
-00020b90: 6865 206b 6579 2061 7320 7765 6c6c 2e20  he key as well. 
-00020ba0: 5768 6574 6865 7220 706c 6169 6e74 6578  Whether plaintex
-00020bb0: 7420 6973 2072 6574 7572 6e65 6420 6465  t is returned de
-00020bc0: 7065 6e64 7320 6f6e 2074 6865 2070 6174  pends on the pat
-00020bd0: 683b 200d 0a20 2020 2020 2020 2061 7320  h; ..        as 
-00020be0: 6120 7265 7375 6c74 2c20 796f 7520 6361  a result, you ca
-00020bf0: 6e20 7573 6520 5661 756c 7420 4143 4c20  n use Vault ACL 
-00020c00: 706f 6c69 6369 6573 2074 6f20 636f 6e74  policies to cont
-00020c10: 726f 6c20 7768 6574 6865 7220 6120 7573  rol whether a us
-00020c20: 6572 2069 7320 616c 6c6f 7765 6420 746f  er is allowed to
-00020c30: 2072 6574 7269 6576 6520 7468 6520 0d0a   retrieve the ..
-00020c40: 2020 2020 2020 2020 706c 6169 6e74 6578          plaintex
-00020c50: 7420 7661 6c75 6520 6f66 2061 206b 6579  t value of a key
-00020c60: 2e20 5468 6973 2069 7320 7573 6566 756c  . This is useful
-00020c70: 2069 6620 796f 7520 7761 6e74 2061 6e20   if you want an 
-00020c80: 756e 7472 7573 7465 6420 7573 6572 206f  untrusted user o
-00020c90: 7220 6f70 6572 6174 696f 6e20 746f 2067  r operation to g
-00020ca0: 656e 6572 6174 6520 6b65 7973 200d 0a20  enerate keys .. 
-00020cb0: 2020 2020 2020 2074 6861 7420 6172 6520         that are 
-00020cc0: 7468 656e 206d 6164 6520 6176 6169 6c61  then made availa
-00020cd0: 626c 6520 746f 2074 7275 7374 6564 2075  ble to trusted u
-00020ce0: 7365 7273 2e0d 0a20 2020 2020 2020 200d  sers...        .
-00020cf0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-00020d00: 6f20 6874 7470 733a 2f2f 6465 7665 6c6f  o https://develo
-00020d10: 7065 722e 6861 7368 6963 6f72 702e 636f  per.hashicorp.co
-00020d20: 6d2f 7661 756c 742f 6170 692d 646f 6373  m/vault/api-docs
-00020d30: 2f73 6563 7265 742f 7472 616e 7369 7423  /secret/transit#
-00020d40: 6765 6e65 7261 7465 2d64 6174 612d 6b65  generate-data-ke
-00020d50: 7920 666f 7220 6d6f 7265 2064 6574 6169  y for more detai
-00020d60: 6c73 2e0d 0a0d 0a20 2020 2020 2020 2041  ls.....        A
-00020d70: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
-00020d80: 2020 6d6f 756e 745f 7061 7468 2028 7374    mount_path (st
-00020d90: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-00020da0: 7479 7065 5f6e 616d 6520 2873 7472 293a  type_name (str):
-00020db0: 2053 7065 6369 6669 6573 2074 6865 2074   Specifies the t
-00020dc0: 7970 6520 6f66 206b 6579 2074 6f20 6765  ype of key to ge
-00020dd0: 6e65 7261 7465 2e20 4966 2060 706c 6169  nerate. If `plai
-00020de0: 6e74 6578 7460 2c20 7468 6520 706c 6169  ntext`, the plai
-00020df0: 6e74 6578 7420 6b65 7920 7769 6c6c 2062  ntext key will b
-00020e00: 6520 0d0a 2020 2020 2020 2020 2020 2020  e ..            
-00020e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e20: 2072 6574 7572 6e65 6420 616c 6f6e 6720   returned along 
-00020e30: 7769 7468 2074 6865 2063 6970 6865 7274  with the ciphert
-00020e40: 6578 742e 2049 6620 6077 7261 7070 6564  ext. If `wrapped
-00020e50: 602c 206f 6e6c 7920 7468 6520 6369 7068  `, only the ciph
-00020e60: 6572 7465 7874 2076 616c 7565 2077 696c  ertext value wil
-00020e70: 6c20 0d0a 2020 2020 2020 2020 2020 2020  l ..            
-00020e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e90: 2062 6520 7265 7475 726e 6564 2e0d 0a20   be returned... 
-00020ea0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-00020eb0: 2873 7472 293a 2053 7065 6369 6669 6573  (str): Specifies
-00020ec0: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-00020ed0: 2065 6e63 7279 7074 696f 6e20 6b65 7920   encryption key 
-00020ee0: 746f 2075 7365 2074 6f20 656e 6372 7970  to use to encryp
-00020ef0: 7420 7468 6520 6461 7461 6b65 792e 0d0a  t the datakey...
-00020f00: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00020f10: 6578 7420 2873 7472 2c20 6f70 7469 6f6e  ext (str, option
-00020f20: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
-00020f30: 6865 206b 6579 2064 6572 6976 6174 696f  he key derivatio
-00020f40: 6e20 636f 6e74 6578 742c 2070 726f 7669  n context, provi
-00020f50: 6465 6420 6173 2061 2062 6173 6536 342d  ded as a base64-
-00020f60: 656e 636f 6465 6420 7374 7269 6e67 2e20  encoded string. 
-00020f70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00020f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f90: 2020 2020 2020 2054 6869 7320 6d75 7374         This must
-00020fa0: 2062 6520 7072 6f76 6964 6564 2069 6620   be provided if 
-00020fb0: 6465 7269 7661 7469 6f6e 2069 7320 656e  derivation is en
-00020fc0: 6162 6c65 642e 2044 6566 6175 6c74 7320  abled. Defaults 
-00020fd0: 746f 2022 222e 0d0a 2020 2020 2020 2020  to ""...        
-00020fe0: 2020 2020 6e6f 6e63 6520 2873 7472 2c20      nonce (str, 
-00020ff0: 6f70 7469 6f6e 616c 293a 2053 7065 6369  optional): Speci
-00021000: 6669 6573 2061 206e 6f6e 6365 2076 616c  fies a nonce val
-00021010: 7565 2c20 7072 6f76 6964 6564 2061 7320  ue, provided as 
-00021020: 6261 7365 3634 2065 6e63 6f64 6564 2e20  base64 encoded. 
-00021030: 4d75 7374 2062 6520 7072 6f76 6964 6564  Must be provided
-00021040: 2069 6620 0d0a 2020 2020 2020 2020 2020   if ..          
-00021050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021060: 2020 2020 2020 2020 2063 6f6e 7665 7267           converg
-00021070: 656e 7420 656e 6372 7970 7469 6f6e 2069  ent encryption i
-00021080: 7320 656e 6162 6c65 6420 666f 7220 7468  s enabled for th
-00021090: 6973 206b 6579 2061 6e64 2074 6865 206b  is key and the k
-000210a0: 6579 2077 6173 2067 656e 6572 6174 6564  ey was generated
-000210b0: 2077 6974 6820 0d0a 2020 2020 2020 2020   with ..        
-000210c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210d0: 2020 2020 2020 2020 2020 2056 6175 6c74             Vault
-000210e0: 2030 2e36 2e31 2e20 4e6f 7420 7265 7175   0.6.1. Not requ
-000210f0: 6972 6564 2066 6f72 206b 6579 7320 6372  ired for keys cr
-00021100: 6561 7465 6420 696e 2030 2e36 2e32 2b2e  eated in 0.6.2+.
-00021110: 2054 6865 2076 616c 7565 206d 7573 7420   The value must 
-00021120: 6265 2065 7861 6374 6c79 200d 0a20 2020  be exactly ..   
-00021130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021150: 3936 2062 6974 7320 2831 3220 6279 7465  96 bits (12 byte
-00021160: 7329 206c 6f6e 6720 616e 6420 7468 6520  s) long and the 
-00021170: 7573 6572 206d 7573 7420 656e 7375 7265  user must ensure
-00021180: 2074 6861 7420 666f 7220 616e 7920 6769   that for any gi
-00021190: 7665 6e20 636f 6e74 6578 7420 0d0a 2020  ven context ..  
-000211a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211c0: 2028 616e 6420 7468 7573 2c20 616e 7920   (and thus, any 
-000211d0: 6769 7665 6e20 656e 6372 7970 7469 6f6e  given encryption
-000211e0: 206b 6579 2920 7468 6973 206e 6f6e 6365   key) this nonce
-000211f0: 2076 616c 7565 2069 7320 6e65 7665 7220   value is never 
-00021200: 7265 7573 6564 2e20 4465 6661 756c 7473  reused. Defaults
-00021210: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00021220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021230: 2020 2020 2020 746f 2022 222e 0d0a 2020        to ""...  
-00021240: 2020 2020 2020 2020 2020 6269 7473 2028            bits (
-00021250: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
-00021260: 5370 6563 6966 6965 7320 7468 6520 6e75  Specifies the nu
-00021270: 6d62 6572 206f 6620 6269 7473 2069 6e20  mber of bits in 
-00021280: 7468 6520 6465 7369 7265 6420 6b65 792e  the desired key.
-00021290: 2043 616e 2062 6520 3132 382c 2032 3536   Can be 128, 256
-000212a0: 2c20 6f72 2035 3132 2e20 4465 6661 756c  , or 512. Defaul
-000212b0: 7473 200d 0a20 2020 2020 2020 2020 2020  ts ..           
-000212c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000212d0: 2020 2020 2020 2074 6f20 3235 362e 0d0a         to 256...
-000212e0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000212f0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00021300: 6469 6374 206f 7220 4e6f 6e65 3a20 7265  dict or None: re
-00021310: 7475 726e 2074 6865 2064 6174 6120 6b65  turn the data ke
-00021320: 7920 696e 2064 6963 7420 6966 2073 7563  y in dict if suc
-00021330: 6365 7373 2c20 6f74 6865 7277 6973 6520  cess, otherwise 
-00021340: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-00021350: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00021360: 2020 6966 2073 656c 662e 6973 5f61 7574    if self.is_aut
-00021370: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-00021380: 6578 6973 745f 6b65 7973 203d 2073 656c  exist_keys = sel
-00021390: 662e 6c69 7374 5f6b 6579 286d 6f75 6e74  f.list_key(mount
-000213a0: 5f70 6174 6829 0d0a 2020 2020 2020 2020  _path)..        
-000213b0: 2020 2020 6966 206e 616d 6520 6e6f 7420      if name not 
-000213c0: 696e 2065 7869 7374 5f6b 6579 733a 0d0a  in exist_keys:..
-000213d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213e0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
-000213f0: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
-00021400: 5f6e 616d 655f 5f7d 202d 2067 656e 6572  _name__} - gener
-00021410: 6174 6520 6461 7461 206b 6579 2065 7272  ate data key err
-00021420: 6f72 3a20 6b65 7920 277b 6e61 6d65 7d27  or: key '{name}'
-00021430: 206e 6f74 2066 6f75 6e64 2229 0d0a 2020   not found")..  
-00021440: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00021450: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-00021460: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00021470: 2020 2020 2069 6620 7479 7065 5f6e 616d       if type_nam
-00021480: 6520 6e6f 7420 696e 205b 2270 6c61 696e  e not in ["plain
-00021490: 7465 7874 222c 2022 7772 6170 7065 6422  text", "wrapped"
-000214a0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-000214b0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-000214c0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
-000214d0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2067  __.__name__} - g
-000214e0: 656e 6572 6174 6520 6461 7461 206b 6579  enerate data key
-000214f0: 2065 7272 6f72 3a20 7479 7065 5f6e 616d   error: type_nam
-00021500: 6520 6d75 7374 2062 6520 6f6e 6520 6f66  e must be one of
-00021510: 3a20 220d 0a20 2020 2020 2020 2020 2020  : "..           
-00021520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021530: 2020 2020 2020 2066 2270 6c61 696e 7465         f"plainte
-00021540: 7874 2c20 7772 6170 7065 6422 290d 0a20  xt, wrapped").. 
-00021550: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00021560: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-00021570: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00021580: 2020 2020 2020 7061 796c 6f61 6420 3d20        payload = 
-00021590: 6469 6374 2829 0d0a 2020 2020 2020 2020  dict()..        
-000215a0: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-000215b0: 2020 6966 2063 6f6e 7465 7874 2021 3d20    if context != 
-000215c0: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
-000215d0: 2020 2020 2069 6620 6e6f 7420 6973 5f62       if not is_b
-000215e0: 6173 6536 3428 636f 6e74 6578 7429 3a0d  ase64(context):.
-000215f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021600: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00021610: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
-00021620: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-00021630: 6765 6e65 7261 7465 2064 6174 6120 6b65  generate data ke
-00021640: 7920 6572 726f 723a 2074 6865 2063 6f6e  y error: the con
-00021650: 7465 7874 206d 7573 7420 6265 2022 0d0a  text must be "..
-00021660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021680: 2020 2020 2020 6622 6261 7365 3634 2065        f"base64 e
-00021690: 6e63 6f64 6564 2069 6620 7365 7422 290d  ncoded if set").
-000216a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000216b0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000216c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000216d0: 2020 7061 796c 6f61 645b 2263 6f6e 7465    payload["conte
-000216e0: 7874 225d 203d 2063 6f6e 7465 7874 0d0a  xt"] = context..
-000216f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021700: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00021710: 206e 6f6e 6365 2021 3d20 2222 3a0d 0a20   nonce != "":.. 
-00021720: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021730: 6620 6e6f 7420 6973 5f62 6173 6536 3428  f not is_base64(
-00021740: 6e6f 6e63 6529 3a0d 0a20 2020 2020 2020  nonce):..       
-00021750: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00021760: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-00021770: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-00021780: 6d65 5f5f 7d20 2d20 6765 6e65 7261 7465  me__} - generate
-00021790: 2064 6174 6120 6b65 7920 6572 726f 723a   data key error:
-000217a0: 2074 6865 206e 6f6e 6365 206d 7573 7420   the nonce must 
-000217b0: 6265 2022 0d0a 2020 2020 2020 2020 2020  be "..          
-000217c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217d0: 2020 2020 2020 2020 2020 2020 6622 6261              f"ba
-000217e0: 7365 3634 2065 6e63 6f64 6564 2069 6620  se64 encoded if 
-000217f0: 7365 7422 290d 0a20 2020 2020 2020 2020  set")..         
-00021800: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00021810: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
-00021820: 2020 2020 2020 2020 6966 206c 656e 286e          if len(n
-00021830: 6f6e 6365 2920 213d 2031 323a 0d0a 2020  once) != 12:..  
-00021840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021850: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-00021860: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-00021870: 2e5f 5f6e 616d 655f 5f7d 202d 2067 656e  .__name__} - gen
-00021880: 6572 6174 6520 6461 7461 206b 6579 2065  erate data key e
-00021890: 7272 6f72 3a20 7468 6520 6e6f 6e63 6520  rror: the nonce 
-000218a0: 6d75 7374 2062 6520 220d 0a20 2020 2020  must be "..     
-000218b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218d0: 2066 2265 7861 6374 6c79 2039 3620 6269   f"exactly 96 bi
-000218e0: 7473 2028 3132 2062 7974 6573 2920 6c6f  ts (12 bytes) lo
-000218f0: 6e67 2069 6620 7365 7422 290d 0a20 2020  ng if set")..   
-00021900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021910: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-00021920: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00021930: 796c 6f61 645b 226e 6f6e 6365 225d 203d  yload["nonce"] =
-00021940: 206e 6f6e 6365 0d0a 2020 2020 2020 2020   nonce..        
-00021950: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00021960: 2020 6966 2062 6974 7320 6e6f 7420 696e    if bits not in
-00021970: 205b 3132 382c 2032 3536 2c20 3531 325d   [128, 256, 512]
-00021980: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00021990: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-000219a0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-000219b0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6765  _.__name__} - ge
-000219c0: 6e65 7261 7465 2064 6174 6120 6b65 7920  nerate data key 
-000219d0: 6572 726f 723a 2062 6974 7320 7368 6f75  error: bits shou
-000219e0: 6c64 2062 6520 6f6e 6520 6f66 3a20 220d  ld be one of: ".
-000219f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a10: 2020 2066 2231 3238 2c20 3235 362c 2035     f"128, 256, 5
-00021a20: 3132 2229 0d0a 2020 2020 2020 2020 2020  12")..          
-00021a30: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00021a40: 650d 0a20 2020 2020 2020 2020 2020 2070  e..            p
-00021a50: 6179 6c6f 6164 5b22 6269 7473 225d 203d  ayload["bits"] =
-00021a60: 2062 6974 730d 0a20 2020 2020 2020 2020   bits..         
-00021a70: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-00021a80: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
-00021a90: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
-00021aa0: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00021ab0: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-00021ac0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-00021ad0: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-00021ae0: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-00021af0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
-00021b00: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
-00021b10: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
-00021b20: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00021b30: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-00021b40: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-00021b50: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-00021b60: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-00021b70: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00021b80: 203d 2072 6571 7565 7374 732e 706f 7374   = requests.post
-00021b90: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
-00021ba0: 7468 7d2f 6461 7461 6b65 792f 7b74 7970  th}/datakey/{typ
-00021bb0: 655f 6e61 6d65 7d2f 7b6e 616d 657d 222c  e_name}/{name}",
-00021bc0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00021bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021be0: 2020 2068 6561 6465 7273 3d7b 2258 2d56     headers={"X-V
-00021bf0: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
-00021c00: 656e 7d2c 200d 0a20 2020 2020 2020 2020  en}, ..         
-00021c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c20: 2020 2020 2020 2064 6174 613d 6a73 6f6e         data=json
-00021c30: 2e64 756d 7073 2870 6179 6c6f 6164 2929  .dumps(payload))
-00021c40: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00021c50: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-00021c60: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
-00021c70: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
-00021c80: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
-00021c90: 2020 2020 7265 7475 726e 2072 6573 2e6a      return res.j
-00021ca0: 736f 6e28 295b 2264 6174 6122 5d0d 0a20  son()["data"].. 
-00021cb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00021cc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00021cd0: 2020 7365 6c66 2e5f 6c6f 675f 6572 726f    self._log_erro
-00021ce0: 725f 7265 7370 6f6e 7365 285f 5f63 6c61  r_response(__cla
-00021cf0: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
-00021d00: 6573 2c20 2267 656e 6572 6174 6520 6461  es, "generate da
-00021d10: 7461 206b 6579 2065 7272 6f72 2229 0d0a  ta key error")..
-00021d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d30: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-00021d40: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00021d50: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00021d60: 0d0a 2020 2020 2320 544f 444f 3a20 7761  ..    # TODO: wa
-00021d70: 6974 2066 6f72 2074 6573 7469 6e67 0d0a  it for testing..
-00021d80: 2020 2020 6465 6620 6765 6e65 7261 7465      def generate
-00021d90: 5f72 616e 646f 6d5f 6279 7465 7328 7365  _random_bytes(se
-00021da0: 6c66 2c20 0d0a 2020 2020 2020 2020 2020  lf, ..          
-00021db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021dc0: 2020 2020 6d6f 756e 745f 7061 7468 3a20      mount_path: 
-00021dd0: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
-00021de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021df0: 2020 2020 6279 7465 735f 6e75 6d3a 2069      bytes_num: i
-00021e00: 6e74 203d 2033 322c 0d0a 2020 2020 2020  nt = 32,..      
-00021e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e20: 2020 2020 2020 2020 6f75 745f 666f 726d          out_form
-00021e30: 6174 3a20 7374 7220 3d20 2262 6173 6536  at: str = "base6
-00021e40: 3422 2c0d 0a20 2020 2020 2020 2020 2020  4",..           
-00021e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e60: 2020 2073 6f75 7263 653a 2073 7472 203d     source: str =
-00021e70: 2022 706c 6174 666f 726d 2229 3a0d 0a20   "platform"):.. 
-00021e80: 2020 2020 2020 2022 2222 7265 7475 726e         """return
-00021e90: 2068 6967 682d 7175 616c 6974 7920 7261   high-quality ra
-00021ea0: 6e64 6f6d 2062 7974 6573 206f 6620 7468  ndom bytes of th
-00021eb0: 6520 7370 6563 6966 6965 6420 6c65 6e67  e specified leng
-00021ec0: 7468 0d0a 2020 2020 2020 2020 0d0a 2020  th..        ..  
-00021ed0: 2020 2020 2020 5265 6665 7220 746f 2068        Refer to h
-00021ee0: 7474 7073 3a2f 2f64 6576 656c 6f70 6572  ttps://developer
-00021ef0: 2e68 6173 6869 636f 7270 2e63 6f6d 2f76  .hashicorp.com/v
-00021f00: 6175 6c74 2f61 7069 2d64 6f63 732f 7365  ault/api-docs/se
-00021f10: 6372 6574 2f74 7261 6e73 6974 2367 656e  cret/transit#gen
-00021f20: 6572 6174 652d 7261 6e64 6f6d 2d62 7974  erate-random-byt
-00021f30: 6573 2066 6f72 206d 6f72 6520 6465 7461  es for more deta
-00021f40: 696c 732e 0d0a 0d0a 2020 2020 2020 2020  ils.....        
-00021f50: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
-00021f60: 2020 206d 6f75 6e74 5f70 6174 6820 2873     mount_path (s
-00021f70: 7472 290d 0a20 2020 2020 2020 2020 2020  tr)..           
-00021f80: 2062 7974 6573 5f6e 756d 2028 696e 742c   bytes_num (int,
-00021f90: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
-00021fa0: 6966 6965 7320 7468 6520 6e75 6d62 6572  ifies the number
-00021fb0: 206f 6620 6279 7465 7320 746f 2072 6574   of bytes to ret
-00021fc0: 7572 6e2e 2054 6869 7320 7661 6c75 6520  urn. This value 
-00021fd0: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
-00021fe0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00021ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022000: 2020 2020 2020 2020 2020 6569 7468 6572            either
-00022010: 2069 6e20 7468 6520 7265 7175 6573 7420   in the request 
-00022020: 626f 6479 2c20 6f72 2061 7320 6120 7061  body, or as a pa
-00022030: 7274 206f 6620 7468 6520 5552 4c2e 2044  rt of the URL. D
-00022040: 6566 6175 6c74 7320 746f 2033 322e 0d0a  efaults to 32...
-00022050: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-00022060: 666f 726d 6174 2028 7374 722c 206f 7074  format (str, opt
-00022070: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
-00022080: 7320 7468 6520 6f75 7470 7574 2065 6e63  s the output enc
-00022090: 6f64 696e 672e 2056 616c 6964 206f 7074  oding. Valid opt
-000220a0: 696f 6e73 2061 7265 2060 6865 7860 206f  ions are `hex` o
-000220b0: 7220 6062 6173 6536 3460 2e20 0d0a 2020  r `base64`. ..  
-000220c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000220d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000220e0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-000220f0: 6f20 2262 6173 6536 3422 2e0d 0a20 2020  o "base64"...   
-00022100: 2020 2020 2020 2020 2073 6f75 7263 6520           source 
-00022110: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
-00022120: 2053 7065 6369 6669 6573 2074 6865 2073   Specifies the s
-00022130: 6f75 7263 6520 6f66 2074 6865 2072 6571  ource of the req
-00022140: 7565 7374 6564 2062 7974 6573 2e20 6070  uested bytes. `p
-00022150: 6c61 7466 6f72 6d60 2c20 7468 6520 6465  latform`, the de
-00022160: 6661 756c 742c 200d 0a20 2020 2020 2020  fault, ..       
-00022170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022180: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
-00022190: 7263 6573 2062 7974 6573 2066 726f 6d20  rces bytes from 
-000221a0: 7468 6520 706c 6174 666f 726d 2773 2065  the platform's e
-000221b0: 6e74 726f 7079 2073 6f75 7263 652e 2060  ntropy source. `
-000221c0: 7365 616c 6020 736f 7572 6365 7320 6672  seal` sources fr
-000221d0: 6f6d 200d 0a20 2020 2020 2020 2020 2020  om ..           
-000221e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221f0: 2020 2020 2020 2020 2065 6e74 726f 7079           entropy
-00022200: 2061 7567 6d65 6e74 6174 696f 6e20 2865   augmentation (e
-00022210: 6e74 6572 7072 6973 6520 6f6e 6c79 292e  nterprise only).
-00022220: 2060 616c 6c60 206d 6978 6573 2062 7974   `all` mixes byt
-00022230: 6573 2066 726f 6d20 616c 6c20 0d0a 2020  es from all ..  
-00022240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022260: 2020 6176 6169 6c61 626c 6520 736f 7572    available sour
-00022270: 6365 732e 2044 6566 6175 6c74 7320 746f  ces. Defaults to
-00022280: 2022 706c 6174 666f 726d 222e 0d0a 0d0a   "platform".....
-00022290: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-000222a0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-000222b0: 6374 206f 7220 4e6f 6e65 3a20 7265 7475  ct or None: retu
-000222c0: 726e 2074 6865 2072 616e 646f 6d20 6279  rn the random by
-000222d0: 7465 7320 696e 2064 6963 7420 6966 2073  tes in dict if s
-000222e0: 7563 6365 7373 2c20 6f74 6865 7277 6973  uccess, otherwis
-000222f0: 6520 7265 7475 726e 204e 6f6e 650d 0a20  e return None.. 
-00022300: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00022310: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
-00022320: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
-00022330: 2020 7061 796c 6f61 6420 3d20 6469 6374    payload = dict
-00022340: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00022350: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00022360: 206f 7574 5f66 6f72 6d61 7420 6e6f 7420   out_format not 
-00022370: 696e 205b 2268 6578 222c 2022 6261 7365  in ["hex", "base
-00022380: 3634 225d 3a0d 0a20 2020 2020 2020 2020  64"]:..         
-00022390: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-000223a0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-000223b0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-000223c0: 2d20 6765 6e65 7261 7465 2072 616e 646f  - generate rando
-000223d0: 6d20 6279 7465 7320 6572 726f 723a 206f  m bytes error: o
-000223e0: 7574 5f66 6f72 6d61 7420 7368 6f75 6c64  ut_format should
-000223f0: 2062 6520 6f6e 6520 6f66 3a20 220d 0a20   be one of: ".. 
-00022400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022420: 2066 2268 6578 2c20 6261 7365 3634 2229   f"hex, base64")
-00022430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022440: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-00022450: 2020 2020 2020 2020 2020 2070 6179 6c6f             paylo
-00022460: 6164 5b22 666f 726d 6174 225d 203d 206f  ad["format"] = o
-00022470: 7574 5f66 6f72 6d61 740d 0a20 2020 2020  ut_format..     
-00022480: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00022490: 2020 2020 2069 6620 736f 7572 6365 206e       if source n
-000224a0: 6f74 2069 6e20 5b22 706c 6174 666f 726d  ot in ["platform
-000224b0: 222c 2022 7365 616c 222c 2022 616c 6c22  ", "seal", "all"
-000224c0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-000224d0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-000224e0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
-000224f0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2067  __.__name__} - g
-00022500: 656e 6572 6174 6520 7261 6e64 6f6d 2062  enerate random b
-00022510: 7974 6573 2065 7272 6f72 3a20 736f 7572  ytes error: sour
-00022520: 6365 2073 686f 756c 6420 6265 206f 6e65  ce should be one
-00022530: 206f 663a 2022 0d0a 2020 2020 2020 2020   of: "..        
-00022540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022550: 2020 2020 2020 2020 2020 6622 706c 6174            f"plat
-00022560: 666f 726d 2c20 7365 616c 2c20 616c 6c22  form, seal, all"
-00022570: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00022580: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00022590: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-000225a0: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-000225b0: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
-000225c0: 2873 656c 662e 7572 6c2c 206b 6579 3d72  (self.url, key=r
-000225d0: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-000225e0: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-000225f0: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-00022600: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-00022610: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-00022620: 2020 2020 2020 746f 6b65 6e20 3d20 6165        token = ae
-00022630: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-00022640: 656c 662e 746f 6b65 6e2c 206b 6579 3d72  elf.token, key=r
-00022650: 616e 646f 6d5f 6865 7828 7365 6c66 2e5f  andom_hex(self._
-00022660: 6b65 795f 6c65 6e2c 2073 656c 662e 5f73  key_len, self._s
-00022670: 6565 642a 3229 2c20 6976 3d72 616e 646f  eed*2), iv=rando
-00022680: 6d5f 6865 7828 3136 2c20 7365 6c66 2e5f  m_hex(16, self._
-00022690: 7365 6564 2a33 2929 0d0a 2020 2020 2020  seed*3))..      
-000226a0: 2020 2020 2020 7572 6c20 2b3d 2066 227b        url += f"{
-000226b0: 6d6f 756e 745f 7061 7468 7d2f 7261 6e64  mount_path}/rand
-000226c0: 6f6d 220d 0a20 2020 2020 2020 2020 2020  om"..           
-000226d0: 2069 6620 736f 7572 6365 2069 6e20 5b22   if source in ["
-000226e0: 7365 616c 222c 2022 616c 6c22 5d3a 0d0a  seal", "all"]:..
-000226f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022700: 7572 6c20 2b3d 2066 222f 7b73 6f75 7263  url += f"/{sourc
-00022710: 657d 220d 0a20 2020 2020 2020 2020 2020  e}"..           
-00022720: 2075 726c 202b 3d20 6622 2f7b 6279 7465   url += f"/{byte
-00022730: 735f 6e75 6d7d 220d 0a20 2020 2020 2020  s_num}"..       
-00022740: 2020 2020 2072 6573 203d 2072 6571 7565       res = reque
-00022750: 7374 732e 706f 7374 2875 726c 2c20 6865  sts.post(url, he
-00022760: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
-00022770: 546f 6b65 6e22 3a20 746f 6b65 6e7d 2c20  Token": token}, 
-00022780: 6461 7461 3d6a 736f 6e2e 6475 6d70 7328  data=json.dumps(
-00022790: 7061 796c 6f61 6429 290d 0a20 2020 2020  payload))..     
-000227a0: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
-000227b0: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
-000227c0: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
-000227d0: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
-000227e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000227f0: 7572 6e20 7265 732e 6a73 6f6e 2829 5b22  urn res.json()["
-00022800: 6461 7461 225d 0d0a 2020 2020 2020 2020  data"]..        
-00022810: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00022820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00022830: 5f6c 6f67 5f65 7272 6f72 5f72 6573 706f  _log_error_respo
-00022840: 6e73 6528 5f5f 636c 6173 735f 5f2e 5f5f  nse(__class__.__
-00022850: 6e61 6d65 5f5f 2c20 7265 732c 2022 6765  name__, res, "ge
-00022860: 6e65 7261 7465 2072 616e 646f 6d20 6279  nerate random by
-00022870: 7465 7320 6572 726f 7222 290d 0a20 2020  tes error")..   
-00022880: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00022890: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
-000228a0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000228b0: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
-000228c0: 2020 2023 2054 4f44 4f3a 2077 6169 7420     # TODO: wait 
-000228d0: 666f 7220 7465 7374 696e 670d 0a20 2020  for testing..   
-000228e0: 2064 6566 2068 6173 685f 6461 7461 2873   def hash_data(s
-000228f0: 656c 662c 200d 0a20 2020 2020 2020 2020  elf, ..         
-00022900: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
-00022910: 6174 683a 2073 7472 2c0d 0a20 2020 2020  ath: str,..     
-00022920: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
-00022930: 7574 5f64 6174 613a 2073 7472 2c0d 0a20  ut_data: str,.. 
+00020a90: 2020 2020 6e61 6d65 3a20 7374 722c 0d0a      name: str,..
+00020aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ab0: 2020 2020 2020 2020 2020 636f 6e74 6578            contex
+00020ac0: 743a 2073 7472 203d 2022 222c 0d0a 2020  t: str = "",..  
+00020ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ae0: 2020 2020 2020 2020 6e6f 6e63 653a 2073          nonce: s
+00020af0: 7472 203d 2022 222c 0d0a 2020 2020 2020  tr = "",..      
+00020b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b10: 2020 2020 6269 7473 3a20 696e 7420 3d20      bits: int = 
+00020b20: 3235 3629 3a0d 0a20 2020 2020 2020 2022  256):..        "
+00020b30: 2222 6765 6e65 7261 7465 2061 206e 6577  ""generate a new
+00020b40: 2068 6967 682d 656e 7472 6f70 7920 6b65   high-entropy ke
+00020b50: 7920 616e 6420 7468 6520 7661 6c75 6520  y and the value 
+00020b60: 656e 6372 7970 7465 6420 7769 7468 2074  encrypted with t
+00020b70: 6865 206e 616d 6564 206b 6579 0d0a 2020  he named key..  
+00020b80: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00020b90: 4f70 7469 6f6e 616c 6c79 2072 6574 7572  Optionally retur
+00020ba0: 6e20 7468 6520 706c 6169 6e74 6578 7420  n the plaintext 
+00020bb0: 6f66 2074 6865 206b 6579 2061 7320 7765  of the key as we
+00020bc0: 6c6c 2e20 5768 6574 6865 7220 706c 6169  ll. Whether plai
+00020bd0: 6e74 6578 7420 6973 2072 6574 7572 6e65  ntext is returne
+00020be0: 6420 6465 7065 6e64 7320 6f6e 2074 6865  d depends on the
+00020bf0: 2070 6174 683b 200d 0a20 2020 2020 2020   path; ..       
+00020c00: 2061 7320 6120 7265 7375 6c74 2c20 796f   as a result, yo
+00020c10: 7520 6361 6e20 7573 6520 5661 756c 7420  u can use Vault 
+00020c20: 4143 4c20 706f 6c69 6369 6573 2074 6f20  ACL policies to 
+00020c30: 636f 6e74 726f 6c20 7768 6574 6865 7220  control whether 
+00020c40: 6120 7573 6572 2069 7320 616c 6c6f 7765  a user is allowe
+00020c50: 6420 746f 2072 6574 7269 6576 6520 7468  d to retrieve th
+00020c60: 6520 0d0a 2020 2020 2020 2020 706c 6169  e ..        plai
+00020c70: 6e74 6578 7420 7661 6c75 6520 6f66 2061  ntext value of a
+00020c80: 206b 6579 2e20 5468 6973 2069 7320 7573   key. This is us
+00020c90: 6566 756c 2069 6620 796f 7520 7761 6e74  eful if you want
+00020ca0: 2061 6e20 756e 7472 7573 7465 6420 7573   an untrusted us
+00020cb0: 6572 206f 7220 6f70 6572 6174 696f 6e20  er or operation 
+00020cc0: 746f 2067 656e 6572 6174 6520 6b65 7973  to generate keys
+00020cd0: 200d 0a20 2020 2020 2020 2074 6861 7420   ..        that 
+00020ce0: 6172 6520 7468 656e 206d 6164 6520 6176  are then made av
+00020cf0: 6169 6c61 626c 6520 746f 2074 7275 7374  ailable to trust
+00020d00: 6564 2075 7365 7273 2e0d 0a20 2020 2020  ed users...     
+00020d10: 2020 200d 0a20 2020 2020 2020 2052 6566     ..        Ref
+00020d20: 6572 2074 6f20 6874 7470 733a 2f2f 6465  er to https://de
+00020d30: 7665 6c6f 7065 722e 6861 7368 6963 6f72  veloper.hashicor
+00020d40: 702e 636f 6d2f 7661 756c 742f 6170 692d  p.com/vault/api-
+00020d50: 646f 6373 2f73 6563 7265 742f 7472 616e  docs/secret/tran
+00020d60: 7369 7423 6765 6e65 7261 7465 2d64 6174  sit#generate-dat
+00020d70: 612d 6b65 7920 666f 7220 6d6f 7265 2064  a-key for more d
+00020d80: 6574 6169 6c73 2e0d 0a0d 0a20 2020 2020  etails.....     
+00020d90: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+00020da0: 2020 2020 2020 6d6f 756e 745f 7061 7468        mount_path
+00020db0: 2028 7374 7229 0d0a 2020 2020 2020 2020   (str)..        
+00020dc0: 2020 2020 7479 7065 5f6e 616d 6520 2873      type_name (s
+00020dd0: 7472 293a 2053 7065 6369 6669 6573 2074  tr): Specifies t
+00020de0: 6865 2074 7970 6520 6f66 206b 6579 2074  he type of key t
+00020df0: 6f20 6765 6e65 7261 7465 2e20 4966 2060  o generate. If `
+00020e00: 706c 6169 6e74 6578 7460 2c20 7468 6520  plaintext`, the 
+00020e10: 706c 6169 6e74 6578 7420 6b65 7920 7769  plaintext key wi
+00020e20: 6c6c 2062 6520 0d0a 2020 2020 2020 2020  ll be ..        
+00020e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e40: 2020 2020 2072 6574 7572 6e65 6420 616c       returned al
+00020e50: 6f6e 6720 7769 7468 2074 6865 2063 6970  ong with the cip
+00020e60: 6865 7274 6578 742e 2049 6620 6077 7261  hertext. If `wra
+00020e70: 7070 6564 602c 206f 6e6c 7920 7468 6520  pped`, only the 
+00020e80: 6369 7068 6572 7465 7874 2076 616c 7565  ciphertext value
+00020e90: 2077 696c 6c20 0d0a 2020 2020 2020 2020   will ..        
+00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020eb0: 2020 2020 2062 6520 7265 7475 726e 6564       be returned
+00020ec0: 2e0d 0a20 2020 2020 2020 2020 2020 206e  ...            n
+00020ed0: 616d 6520 2873 7472 293a 2053 7065 6369  ame (str): Speci
+00020ee0: 6669 6573 2074 6865 206e 616d 6520 6f66  fies the name of
+00020ef0: 2074 6865 2065 6e63 7279 7074 696f 6e20   the encryption 
+00020f00: 6b65 7920 746f 2075 7365 2074 6f20 656e  key to use to en
+00020f10: 6372 7970 7420 7468 6520 6461 7461 6b65  crypt the datake
+00020f20: 792e 0d0a 2020 2020 2020 2020 2020 2020  y...            
+00020f30: 636f 6e74 6578 7420 2873 7472 2c20 6f70  context (str, op
+00020f40: 7469 6f6e 616c 293a 2053 7065 6369 6669  tional): Specifi
+00020f50: 6573 2074 6865 206b 6579 2064 6572 6976  es the key deriv
+00020f60: 6174 696f 6e20 636f 6e74 6578 742c 2070  ation context, p
+00020f70: 726f 7669 6465 6420 6173 2061 2062 6173  rovided as a bas
+00020f80: 6536 342d 656e 636f 6465 6420 7374 7269  e64-encoded stri
+00020f90: 6e67 2e20 0d0a 2020 2020 2020 2020 2020  ng. ..          
+00020fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fb0: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+00020fc0: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+00020fd0: 2069 6620 6465 7269 7661 7469 6f6e 2069   if derivation i
+00020fe0: 7320 656e 6162 6c65 642e 2044 6566 6175  s enabled. Defau
+00020ff0: 6c74 7320 746f 2022 222e 0d0a 2020 2020  lts to ""...    
+00021000: 2020 2020 2020 2020 6e6f 6e63 6520 2873          nonce (s
+00021010: 7472 2c20 6f70 7469 6f6e 616c 293a 2053  tr, optional): S
+00021020: 7065 6369 6669 6573 2061 206e 6f6e 6365  pecifies a nonce
+00021030: 2076 616c 7565 2c20 7072 6f76 6964 6564   value, provided
+00021040: 2061 7320 6261 7365 3634 2065 6e63 6f64   as base64 encod
+00021050: 6564 2e20 4d75 7374 2062 6520 7072 6f76  ed. Must be prov
+00021060: 6964 6564 2069 6620 0d0a 2020 2020 2020  ided if ..      
+00021070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021080: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00021090: 7665 7267 656e 7420 656e 6372 7970 7469  vergent encrypti
+000210a0: 6f6e 2069 7320 656e 6162 6c65 6420 666f  on is enabled fo
+000210b0: 7220 7468 6973 206b 6579 2061 6e64 2074  r this key and t
+000210c0: 6865 206b 6579 2077 6173 2067 656e 6572  he key was gener
+000210d0: 6174 6564 2077 6974 6820 0d0a 2020 2020  ated with ..    
+000210e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000210f0: 2020 2020 2020 2020 2020 2020 2020 2056                 V
+00021100: 6175 6c74 2030 2e36 2e31 2e20 4e6f 7420  ault 0.6.1. Not 
+00021110: 7265 7175 6972 6564 2066 6f72 206b 6579  required for key
+00021120: 7320 6372 6561 7465 6420 696e 2030 2e36  s created in 0.6
+00021130: 2e32 2b2e 2054 6865 2076 616c 7565 206d  .2+. The value m
+00021140: 7573 7420 6265 2065 7861 6374 6c79 200d  ust be exactly .
+00021150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021170: 2020 2020 3936 2062 6974 7320 2831 3220      96 bits (12 
+00021180: 6279 7465 7329 206c 6f6e 6720 616e 6420  bytes) long and 
+00021190: 7468 6520 7573 6572 206d 7573 7420 656e  the user must en
+000211a0: 7375 7265 2074 6861 7420 666f 7220 616e  sure that for an
+000211b0: 7920 6769 7665 6e20 636f 6e74 6578 7420  y given context 
+000211c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000211d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000211e0: 2020 2020 2028 616e 6420 7468 7573 2c20       (and thus, 
+000211f0: 616e 7920 6769 7665 6e20 656e 6372 7970  any given encryp
+00021200: 7469 6f6e 206b 6579 2920 7468 6973 206e  tion key) this n
+00021210: 6f6e 6365 2076 616c 7565 2069 7320 6e65  once value is ne
+00021220: 7665 7220 7265 7573 6564 2e20 4465 6661  ver reused. Defa
+00021230: 756c 7473 200d 0a20 2020 2020 2020 2020  ults ..         
+00021240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021250: 2020 2020 2020 2020 2020 746f 2022 222e            to "".
+00021260: 0d0a 2020 2020 2020 2020 2020 2020 6269  ..            bi
+00021270: 7473 2028 696e 742c 206f 7074 696f 6e61  ts (int, optiona
+00021280: 6c29 3a20 5370 6563 6966 6965 7320 7468  l): Specifies th
+00021290: 6520 6e75 6d62 6572 206f 6620 6269 7473  e number of bits
+000212a0: 2069 6e20 7468 6520 6465 7369 7265 6420   in the desired 
+000212b0: 6b65 792e 2043 616e 2062 6520 3132 382c  key. Can be 128,
+000212c0: 2032 3536 2c20 6f72 2035 3132 2e20 4465   256, or 512. De
+000212d0: 6661 756c 7473 200d 0a20 2020 2020 2020  faults ..       
+000212e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212f0: 2020 2020 2020 2020 2020 2074 6f20 3235             to 25
+00021300: 362e 0d0a 0d0a 2020 2020 2020 2020 5265  6.....        Re
+00021310: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
+00021320: 2020 2020 6469 6374 206f 7220 4e6f 6e65      dict or None
+00021330: 3a20 7265 7475 726e 2074 6865 2064 6174  : return the dat
+00021340: 6120 6b65 7920 696e 2064 6963 7420 6966  a key in dict if
+00021350: 2073 7563 6365 7373 2c20 6f74 6865 7277   success, otherw
+00021360: 6973 6520 7265 7475 726e 204e 6f6e 650d  ise return None.
+00021370: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00021380: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+00021390: 5f61 7574 683a 0d0a 2020 2020 2020 2020  _auth:..        
+000213a0: 2020 2020 6578 6973 745f 6b65 7973 203d      exist_keys =
+000213b0: 2073 656c 662e 6c69 7374 5f6b 6579 286d   self.list_key(m
+000213c0: 6f75 6e74 5f70 6174 6829 0d0a 2020 2020  ount_path)..    
+000213d0: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+000213e0: 6e6f 7420 696e 2065 7869 7374 5f6b 6579  not in exist_key
+000213f0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00021400: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00021410: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+00021420: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2067  __.__name__} - g
+00021430: 656e 6572 6174 6520 6461 7461 206b 6579  enerate data key
+00021440: 2065 7272 6f72 3a20 6b65 7920 277b 6e61   error: key '{na
+00021450: 6d65 7d27 206e 6f74 2066 6f75 6e64 2229  me}' not found")
+00021460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021470: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
+00021480: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00021490: 2020 2020 2020 2020 2069 6620 7479 7065           if type
+000214a0: 5f6e 616d 6520 6e6f 7420 696e 205b 2270  _name not in ["p
+000214b0: 6c61 696e 7465 7874 222c 2022 7772 6170  laintext", "wrap
+000214c0: 7065 6422 5d3a 0d0a 2020 2020 2020 2020  ped"]:..        
+000214d0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000214e0: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+000214f0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00021500: 202d 2067 656e 6572 6174 6520 6461 7461   - generate data
+00021510: 206b 6579 2065 7272 6f72 3a20 7479 7065   key error: type
+00021520: 5f6e 616d 6520 6d75 7374 2062 6520 6f6e  _name must be on
+00021530: 6520 6f66 3a20 220d 0a20 2020 2020 2020  e of: "..       
+00021540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021550: 2020 2020 2020 2020 2020 2066 2270 6c61             f"pla
+00021560: 696e 7465 7874 2c20 7772 6170 7065 6422  intext, wrapped"
+00021570: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00021580: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+00021590: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+000215a0: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
+000215b0: 6420 3d20 6469 6374 2829 0d0a 2020 2020  d = dict()..    
+000215c0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000215d0: 2020 2020 2020 6966 2063 6f6e 7465 7874        if context
+000215e0: 2021 3d20 2222 3a0d 0a20 2020 2020 2020   != "":..       
+000215f0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00021600: 6973 5f62 6173 6536 3428 636f 6e74 6578  is_base64(contex
+00021610: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00021620: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00021630: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+00021640: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00021650: 7d20 2d20 6765 6e65 7261 7465 2064 6174  } - generate dat
+00021660: 6120 6b65 7920 6572 726f 723a 2074 6865  a key error: the
+00021670: 2063 6f6e 7465 7874 206d 7573 7420 6265   context must be
+00021680: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+00021690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000216a0: 2020 2020 2020 2020 2020 6622 6261 7365            f"base
+000216b0: 3634 2065 6e63 6f64 6564 2069 6620 7365  64 encoded if se
+000216c0: 7422 290d 0a20 2020 2020 2020 2020 2020  t")..           
+000216d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000216e0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+000216f0: 2020 2020 2020 7061 796c 6f61 645b 2263        payload["c
+00021700: 6f6e 7465 7874 225d 203d 2063 6f6e 7465  ontext"] = conte
+00021710: 7874 0d0a 2020 2020 2020 2020 2020 2020  xt..            
+00021720: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00021730: 2020 6966 206e 6f6e 6365 2021 3d20 2222    if nonce != ""
+00021740: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00021750: 2020 2069 6620 6e6f 7420 6973 5f62 6173     if not is_bas
+00021760: 6536 3428 6e6f 6e63 6529 3a0d 0a20 2020  e64(nonce):..   
+00021770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021780: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+00021790: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+000217a0: 5f5f 6e61 6d65 5f5f 7d20 2d20 6765 6e65  __name__} - gene
+000217b0: 7261 7465 2064 6174 6120 6b65 7920 6572  rate data key er
+000217c0: 726f 723a 2074 6865 206e 6f6e 6365 206d  ror: the nonce m
+000217d0: 7573 7420 6265 2022 0d0a 2020 2020 2020  ust be "..      
+000217e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000217f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021800: 6622 6261 7365 3634 2065 6e63 6f64 6564  f"base64 encoded
+00021810: 2069 6620 7365 7422 290d 0a20 2020 2020   if set")..     
+00021820: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00021830: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
+00021840: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00021850: 656e 286e 6f6e 6365 2920 213d 2031 323a  en(nonce) != 12:
+00021860: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021870: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00021880: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
+00021890: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+000218a0: 2067 656e 6572 6174 6520 6461 7461 206b   generate data k
+000218b0: 6579 2065 7272 6f72 3a20 7468 6520 6e6f  ey error: the no
+000218c0: 6e63 6520 6d75 7374 2062 6520 220d 0a20  nce must be ".. 
+000218d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000218e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000218f0: 2020 2020 2066 2265 7861 6374 6c79 2039       f"exactly 9
+00021900: 3620 6269 7473 2028 3132 2062 7974 6573  6 bits (12 bytes
+00021910: 2920 6c6f 6e67 2069 6620 7365 7422 290d  ) long if set").
+00021920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021930: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00021940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021950: 2020 7061 796c 6f61 645b 226e 6f6e 6365    payload["nonce
+00021960: 225d 203d 206e 6f6e 6365 0d0a 2020 2020  "] = nonce..    
+00021970: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00021980: 2020 2020 2020 6966 2062 6974 7320 6e6f        if bits no
+00021990: 7420 696e 205b 3132 382c 2032 3536 2c20  t in [128, 256, 
+000219a0: 3531 325d 3a0d 0a20 2020 2020 2020 2020  512]:..         
+000219b0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+000219c0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+000219d0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+000219e0: 2d20 6765 6e65 7261 7465 2064 6174 6120  - generate data 
+000219f0: 6b65 7920 6572 726f 723a 2062 6974 7320  key error: bits 
+00021a00: 7368 6f75 6c64 2062 6520 6f6e 6520 6f66  should be one of
+00021a10: 3a20 220d 0a20 2020 2020 2020 2020 2020  : "..           
+00021a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a30: 2020 2020 2020 2066 2231 3238 2c20 3235         f"128, 25
+00021a40: 362c 2035 3132 2229 0d0a 2020 2020 2020  6, 512")..      
+00021a50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00021a60: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+00021a70: 2020 2070 6179 6c6f 6164 5b22 6269 7473     payload["bits
+00021a80: 225d 203d 2062 6974 730d 0a20 2020 2020  "] = bits..     
+00021a90: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00021aa0: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
+00021ab0: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+00021ac0: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
+00021ad0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+00021ae0: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+00021af0: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+00021b00: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+00021b10: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00021b20: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
+00021b30: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
+00021b40: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
+00021b50: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+00021b60: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+00021b70: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+00021b80: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+00021b90: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00021ba0: 2072 6573 203d 2072 6571 7565 7374 732e   res = requests.
+00021bb0: 706f 7374 2875 726c 2b66 227b 6d6f 756e  post(url+f"{moun
+00021bc0: 745f 7061 7468 7d2f 6461 7461 6b65 792f  t_path}/datakey/
+00021bd0: 7b74 7970 655f 6e61 6d65 7d2f 7b6e 616d  {type_name}/{nam
+00021be0: 657d 222c 200d 0a20 2020 2020 2020 2020  e}", ..         
+00021bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c00: 2020 2020 2020 2068 6561 6465 7273 3d7b         headers={
+00021c10: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
+00021c20: 2074 6f6b 656e 7d2c 200d 0a20 2020 2020   token}, ..     
+00021c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c40: 2020 2020 2020 2020 2020 2064 6174 613d             data=
+00021c50: 6a73 6f6e 2e64 756d 7073 2870 6179 6c6f  json.dumps(paylo
+00021c60: 6164 2929 0d0a 2020 2020 2020 2020 2020  ad))..          
+00021c70: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
+00021c80: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
+00021c90: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+00021ca0: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
+00021cb0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00021cc0: 6573 2e6a 736f 6e28 295b 2264 6174 6122  es.json()["data"
+00021cd0: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
+00021ce0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00021cf0: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
+00021d00: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
+00021d10: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00021d20: 5f2c 2072 6573 2c20 2267 656e 6572 6174  _, res, "generat
+00021d30: 6520 6461 7461 206b 6579 2065 7272 6f72  e data key error
+00021d40: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00021d50: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+00021d60: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00021d70: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00021d80: 6e65 0d0a 0d0a 2020 2020 2320 544f 444f  ne....    # TODO
+00021d90: 3a20 7761 6974 2066 6f72 2074 6573 7469  : wait for testi
+00021da0: 6e67 0d0a 2020 2020 6465 6620 6765 6e65  ng..    def gene
+00021db0: 7261 7465 5f72 616e 646f 6d5f 6279 7465  rate_random_byte
+00021dc0: 7328 7365 6c66 2c20 0d0a 2020 2020 2020  s(self, ..      
+00021dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021de0: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+00021df0: 7468 3a20 7374 722c 0d0a 2020 2020 2020  th: str,..      
+00021e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e10: 2020 2020 2020 2020 6279 7465 735f 6e75          bytes_nu
+00021e20: 6d3a 2069 6e74 203d 2033 322c 0d0a 2020  m: int = 32,..  
+00021e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e40: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+00021e50: 666f 726d 6174 3a20 7374 7220 3d20 2262  format: str = "b
+00021e60: 6173 6536 3422 2c0d 0a20 2020 2020 2020  ase64",..       
+00021e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e80: 2020 2020 2020 2073 6f75 7263 653a 2073         source: s
+00021e90: 7472 203d 2022 706c 6174 666f 726d 2229  tr = "platform")
+00021ea0: 3a0d 0a20 2020 2020 2020 2022 2222 7265  :..        """re
+00021eb0: 7475 726e 2068 6967 682d 7175 616c 6974  turn high-qualit
+00021ec0: 7920 7261 6e64 6f6d 2062 7974 6573 206f  y random bytes o
+00021ed0: 6620 7468 6520 7370 6563 6966 6965 6420  f the specified 
+00021ee0: 6c65 6e67 7468 0d0a 2020 2020 2020 2020  length..        
+00021ef0: 0d0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
+00021f00: 746f 2068 7474 7073 3a2f 2f64 6576 656c  to https://devel
+00021f10: 6f70 6572 2e68 6173 6869 636f 7270 2e63  oper.hashicorp.c
+00021f20: 6f6d 2f76 6175 6c74 2f61 7069 2d64 6f63  om/vault/api-doc
+00021f30: 732f 7365 6372 6574 2f74 7261 6e73 6974  s/secret/transit
+00021f40: 2367 656e 6572 6174 652d 7261 6e64 6f6d  #generate-random
+00021f50: 2d62 7974 6573 2066 6f72 206d 6f72 6520  -bytes for more 
+00021f60: 6465 7461 696c 732e 0d0a 0d0a 2020 2020  details.....    
+00021f70: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+00021f80: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
+00021f90: 6820 2873 7472 290d 0a20 2020 2020 2020  h (str)..       
+00021fa0: 2020 2020 2062 7974 6573 5f6e 756d 2028       bytes_num (
+00021fb0: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
+00021fc0: 5370 6563 6966 6965 7320 7468 6520 6e75  Specifies the nu
+00021fd0: 6d62 6572 206f 6620 6279 7465 7320 746f  mber of bytes to
+00021fe0: 2072 6574 7572 6e2e 2054 6869 7320 7661   return. This va
+00021ff0: 6c75 6520 6361 6e20 6265 2073 7065 6369  lue can be speci
+00022000: 6669 6564 200d 0a20 2020 2020 2020 2020  fied ..         
+00022010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022020: 2020 2020 2020 2020 2020 2020 2020 6569                ei
+00022030: 7468 6572 2069 6e20 7468 6520 7265 7175  ther in the requ
+00022040: 6573 7420 626f 6479 2c20 6f72 2061 7320  est body, or as 
+00022050: 6120 7061 7274 206f 6620 7468 6520 5552  a part of the UR
+00022060: 4c2e 2044 6566 6175 6c74 7320 746f 2033  L. Defaults to 3
+00022070: 322e 0d0a 2020 2020 2020 2020 2020 2020  2...            
+00022080: 6f75 745f 666f 726d 6174 2028 7374 722c  out_format (str,
+00022090: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
+000220a0: 6966 6965 7320 7468 6520 6f75 7470 7574  ifies the output
+000220b0: 2065 6e63 6f64 696e 672e 2056 616c 6964   encoding. Valid
+000220c0: 206f 7074 696f 6e73 2061 7265 2060 6865   options are `he
+000220d0: 7860 206f 7220 6062 6173 6536 3460 2e20  x` or `base64`. 
+000220e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000220f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022100: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+00022110: 7473 2074 6f20 2262 6173 6536 3422 2e0d  ts to "base64"..
+00022120: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
+00022130: 7263 6520 2873 7472 2c20 6f70 7469 6f6e  rce (str, option
+00022140: 616c 293a 2053 7065 6369 6669 6573 2074  al): Specifies t
+00022150: 6865 2073 6f75 7263 6520 6f66 2074 6865  he source of the
+00022160: 2072 6571 7565 7374 6564 2062 7974 6573   requested bytes
+00022170: 2e20 6070 6c61 7466 6f72 6d60 2c20 7468  . `platform`, th
+00022180: 6520 6465 6661 756c 742c 200d 0a20 2020  e default, ..   
+00022190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000221a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000221b0: 2073 6f75 7263 6573 2062 7974 6573 2066   sources bytes f
+000221c0: 726f 6d20 7468 6520 706c 6174 666f 726d  rom the platform
+000221d0: 2773 2065 6e74 726f 7079 2073 6f75 7263  's entropy sourc
+000221e0: 652e 2060 7365 616c 6020 736f 7572 6365  e. `seal` source
+000221f0: 7320 6672 6f6d 200d 0a20 2020 2020 2020  s from ..       
+00022200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022210: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+00022220: 726f 7079 2061 7567 6d65 6e74 6174 696f  ropy augmentatio
+00022230: 6e20 2865 6e74 6572 7072 6973 6520 6f6e  n (enterprise on
+00022240: 6c79 292e 2060 616c 6c60 206d 6978 6573  ly). `all` mixes
+00022250: 2062 7974 6573 2066 726f 6d20 616c 6c20   bytes from all 
+00022260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00022270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022280: 2020 2020 2020 6176 6169 6c61 626c 6520        available 
+00022290: 736f 7572 6365 732e 2044 6566 6175 6c74  sources. Default
+000222a0: 7320 746f 2022 706c 6174 666f 726d 222e  s to "platform".
+000222b0: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+000222c0: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+000222d0: 2020 6469 6374 206f 7220 4e6f 6e65 3a20    dict or None: 
+000222e0: 7265 7475 726e 2074 6865 2072 616e 646f  return the rando
+000222f0: 6d20 6279 7465 7320 696e 2064 6963 7420  m bytes in dict 
+00022300: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
+00022310: 7277 6973 6520 7265 7475 726e 204e 6f6e  rwise return Non
+00022320: 650d 0a20 2020 2020 2020 2022 2222 0d0a  e..        """..
+00022330: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00022340: 6973 5f61 7574 683a 0d0a 2020 2020 2020  is_auth:..      
+00022350: 2020 2020 2020 7061 796c 6f61 6420 3d20        payload = 
+00022360: 6469 6374 2829 0d0a 2020 2020 2020 2020  dict()..        
+00022370: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00022380: 2020 6966 206f 7574 5f66 6f72 6d61 7420    if out_format 
+00022390: 6e6f 7420 696e 205b 2268 6578 222c 2022  not in ["hex", "
+000223a0: 6261 7365 3634 225d 3a0d 0a20 2020 2020  base64"]:..     
+000223b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000223c0: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
+000223d0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+000223e0: 5f5f 7d20 2d20 6765 6e65 7261 7465 2072  __} - generate r
+000223f0: 616e 646f 6d20 6279 7465 7320 6572 726f  andom bytes erro
+00022400: 723a 206f 7574 5f66 6f72 6d61 7420 7368  r: out_format sh
+00022410: 6f75 6c64 2062 6520 6f6e 6520 6f66 3a20  ould be one of: 
+00022420: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+00022430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022440: 2020 2020 2066 2268 6578 2c20 6261 7365       f"hex, base
+00022450: 3634 2229 0d0a 2020 2020 2020 2020 2020  64")..          
+00022460: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00022470: 650d 0a20 2020 2020 2020 2020 2020 2070  e..            p
+00022480: 6179 6c6f 6164 5b22 666f 726d 6174 225d  ayload["format"]
+00022490: 203d 206f 7574 5f66 6f72 6d61 740d 0a20   = out_format.. 
+000224a0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+000224b0: 2020 2020 2020 2020 2069 6620 736f 7572           if sour
+000224c0: 6365 206e 6f74 2069 6e20 5b22 706c 6174  ce not in ["plat
+000224d0: 666f 726d 222c 2022 7365 616c 222c 2022  form", "seal", "
+000224e0: 616c 6c22 5d3a 0d0a 2020 2020 2020 2020  all"]:..        
+000224f0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00022500: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+00022510: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00022520: 202d 2067 656e 6572 6174 6520 7261 6e64   - generate rand
+00022530: 6f6d 2062 7974 6573 2065 7272 6f72 3a20  om bytes error: 
+00022540: 736f 7572 6365 2073 686f 756c 6420 6265  source should be
+00022550: 206f 6e65 206f 663a 2022 0d0a 2020 2020   one of: "..    
+00022560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022570: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00022580: 706c 6174 666f 726d 2c20 7365 616c 2c20  platform, seal, 
+00022590: 616c 6c22 290d 0a20 2020 2020 2020 2020  all")..         
+000225a0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000225b0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+000225c0: 0d0a 2020 2020 2020 2020 2020 2020 7572  ..            ur
+000225d0: 6c20 3d20 6165 735f 6465 6372 7970 745f  l = aes_decrypt_
+000225e0: 7465 7874 2873 656c 662e 7572 6c2c 206b  text(self.url, k
+000225f0: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
+00022600: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
+00022610: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
+00022620: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
+00022630: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
+00022640: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
+00022650: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
+00022660: 7874 2873 656c 662e 746f 6b65 6e2c 206b  xt(self.token, k
+00022670: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
+00022680: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
+00022690: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
+000226a0: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
+000226b0: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
+000226c0: 2020 2020 2020 2020 2020 7572 6c20 2b3d            url +=
+000226d0: 2066 227b 6d6f 756e 745f 7061 7468 7d2f   f"{mount_path}/
+000226e0: 7261 6e64 6f6d 220d 0a20 2020 2020 2020  random"..       
+000226f0: 2020 2020 2069 6620 736f 7572 6365 2069       if source i
+00022700: 6e20 5b22 7365 616c 222c 2022 616c 6c22  n ["seal", "all"
+00022710: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00022720: 2020 2020 7572 6c20 2b3d 2066 222f 7b73      url += f"/{s
+00022730: 6f75 7263 657d 220d 0a20 2020 2020 2020  ource}"..       
+00022740: 2020 2020 2075 726c 202b 3d20 6622 2f7b       url += f"/{
+00022750: 6279 7465 735f 6e75 6d7d 220d 0a20 2020  bytes_num}"..   
+00022760: 2020 2020 2020 2020 2072 6573 203d 2072           res = r
+00022770: 6571 7565 7374 732e 706f 7374 2875 726c  equests.post(url
+00022780: 2c20 6865 6164 6572 733d 7b22 582d 5661  , headers={"X-Va
+00022790: 756c 742d 546f 6b65 6e22 3a20 746f 6b65  ult-Token": toke
+000227a0: 6e7d 2c20 6461 7461 3d6a 736f 6e2e 6475  n}, data=json.du
+000227b0: 6d70 7328 7061 796c 6f61 6429 290d 0a20  mps(payload)).. 
+000227c0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+000227d0: 732e 7374 6174 7573 5f63 6f64 6520 3d3d  s.status_code ==
+000227e0: 2032 3030 206f 7220 7265 732e 7374 6174   200 or res.stat
+000227f0: 7573 5f63 6f64 6520 3d3d 2032 3034 3a0d  us_code == 204:.
+00022800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022810: 2072 6574 7572 6e20 7265 732e 6a73 6f6e   return res.json
+00022820: 2829 5b22 6461 7461 225d 0d0a 2020 2020  ()["data"]..    
+00022830: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00022840: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00022850: 656c 662e 5f6c 6f67 5f65 7272 6f72 5f72  elf._log_error_r
+00022860: 6573 706f 6e73 6528 5f5f 636c 6173 735f  esponse(__class_
+00022870: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7265 732c  _.__name__, res,
+00022880: 2022 6765 6e65 7261 7465 2072 616e 646f   "generate rando
+00022890: 6d20 6279 7465 7320 6572 726f 7222 290d  m bytes error").
+000228a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000228b0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+000228c0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+000228d0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+000228e0: 0a0d 0a20 2020 2023 2054 4f44 4f3a 2077  ...    # TODO: w
+000228f0: 6169 7420 666f 7220 7465 7374 696e 670d  ait for testing.
+00022900: 0a20 2020 2064 6566 2068 6173 685f 6461  .    def hash_da
+00022910: 7461 2873 656c 662c 200d 0a20 2020 2020  ta(self, ..     
+00022920: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
+00022930: 6e74 5f70 6174 683a 2073 7472 2c0d 0a20  nt_path: str,.. 
 00022940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022950: 2061 6c67 6f72 6974 686d 3a20 7374 7220   algorithm: str 
-00022960: 3d20 2273 6861 322d 3235 3622 2c0d 0a20  = "sha2-256",.. 
-00022970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022980: 206f 7574 5f66 6f72 6d61 743a 2073 7472   out_format: str
-00022990: 203d 2022 6865 7822 293a 0d0a 2020 2020   = "hex"):..    
-000229a0: 2020 2020 2222 2272 6574 7572 6e20 7468      """return th
-000229b0: 6520 6372 7970 746f 6772 6170 6869 6320  e cryptographic 
-000229c0: 6861 7368 206f 6620 6769 7665 6e20 6461  hash of given da
-000229d0: 7461 2075 7369 6e67 2074 6865 2073 7065  ta using the spe
-000229e0: 6369 6669 6564 2061 6c67 6f72 6974 686d  cified algorithm
-000229f0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00022a00: 2020 2020 5265 6665 7220 746f 2068 7474      Refer to htt
-00022a10: 7073 3a2f 2f64 6576 656c 6f70 6572 2e68  ps://developer.h
-00022a20: 6173 6869 636f 7270 2e63 6f6d 2f76 6175  ashicorp.com/vau
-00022a30: 6c74 2f61 7069 2d64 6f63 732f 7365 6372  lt/api-docs/secr
-00022a40: 6574 2f74 7261 6e73 6974 2368 6173 682d  et/transit#hash-
-00022a50: 6461 7461 2066 6f72 206d 6f72 6520 6465  data for more de
-00022a60: 7461 696c 732e 0d0a 0d0a 2020 2020 2020  tails.....      
-00022a70: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-00022a80: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
-00022a90: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
-00022aa0: 2020 2069 6e70 7574 5f64 6174 6120 2873     input_data (s
-00022ab0: 7472 293a 2053 7065 6369 6669 6573 2074  tr): Specifies t
-00022ac0: 6865 2062 6173 6536 3420 656e 636f 6465  he base64 encode
-00022ad0: 6420 696e 7075 7420 6461 7461 2e0d 0a20  d input data... 
-00022ae0: 2020 2020 2020 2020 2020 2061 6c67 6f72             algor
-00022af0: 6974 686d 2028 7374 722c 206f 7074 696f  ithm (str, optio
-00022b00: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
-00022b10: 7468 6520 6861 7368 2061 6c67 6f72 6974  the hash algorit
-00022b20: 686d 2074 6f20 7573 652e 2054 6869 7320  hm to use. This 
-00022b30: 6361 6e20 616c 736f 2062 6520 7370 6563  can also be spec
-00022b40: 6966 6965 6420 6173 200d 0a20 2020 2020  ified as ..     
-00022b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b70: 2020 7061 7274 206f 6620 7468 6520 5552    part of the UR
-00022b80: 4c2e 2043 7572 7265 6e74 6c79 2d73 7570  L. Currently-sup
-00022b90: 706f 7274 6564 2061 6c67 6f72 6974 686d  ported algorithm
-00022ba0: 7320 6172 653a 2073 6861 322d 3232 342c  s are: sha2-224,
-00022bb0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bd0: 2020 2020 2020 2020 2020 7368 6132 2d32            sha2-2
-00022be0: 3536 2c20 7368 6132 2d33 3834 2c20 7368  56, sha2-384, sh
-00022bf0: 6132 2d35 3132 2c20 7368 6133 2d32 3234  a2-512, sha3-224
-00022c00: 2c20 7368 6133 2d32 3536 2c20 7368 6133  , sha3-256, sha3
-00022c10: 2d33 3834 2c20 7368 6133 2d35 3132 2e20  -384, sha3-512. 
-00022c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c40: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00022c50: 7320 746f 2022 7368 6132 2d32 3536 222e  s to "sha2-256".
-00022c60: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-00022c70: 745f 666f 726d 6174 2028 7374 722c 206f  t_format (str, o
-00022c80: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
-00022c90: 6965 7320 7468 6520 6f75 7470 7574 2065  ies the output e
-00022ca0: 6e63 6f64 696e 672e 2054 6869 7320 6361  ncoding. This ca
-00022cb0: 6e20 6265 2065 6974 6865 7220 6068 6578  n be either `hex
-00022cc0: 6020 6f72 2060 6261 7365 3634 602e 200d  ` or `base64`. .
-00022cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022cf0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00022d00: 7320 746f 2022 6865 7822 2e0d 0a0d 0a20  s to "hex"..... 
-00022d10: 2020 2020 2020 2052 6574 7572 6e73 3a0d         Returns:.
-00022d20: 0a20 2020 2020 2020 2020 2020 2064 6963  .            dic
-00022d30: 7420 6f72 204e 6f6e 653a 2072 6574 7572  t or None: retur
-00022d40: 6e20 7468 6520 6861 7368 2064 6174 6120  n the hash data 
-00022d50: 696e 2064 6963 7420 6966 2073 7563 6365  in dict if succe
-00022d60: 7373 2c20 6f74 6865 7277 7369 6520 7265  ss, otherwsie re
-00022d70: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-00022d80: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00022d90: 6966 2073 656c 662e 6973 5f61 7574 683a  if self.is_auth:
-00022da0: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
-00022db0: 7070 6f72 745f 616c 676f 7269 7468 6d20  pport_algorithm 
-00022dc0: 3d20 5b22 7368 6132 2d32 3234 222c 2022  = ["sha2-224", "
-00022dd0: 7368 6132 2d32 3536 222c 2022 7368 6132  sha2-256", "sha2
-00022de0: 2d33 3834 222c 2022 7368 6132 2d35 3132  -384", "sha2-512
-00022df0: 222c 200d 0a20 2020 2020 2020 2020 2020  ", ..           
-00022e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022e10: 2020 2020 2020 2273 6861 332d 3232 3422        "sha3-224"
-00022e20: 2c20 2273 6861 332d 3235 3622 2c20 2273  , "sha3-256", "s
-00022e30: 6861 332d 3338 3422 2c20 2273 6861 332d  ha3-384", "sha3-
-00022e40: 3531 3222 5d0d 0a20 2020 2020 2020 2020  512"]..         
-00022e50: 2020 2069 6620 616c 676f 7269 7468 6d20     if algorithm 
-00022e60: 6e6f 7420 696e 2073 7570 706f 7274 5f61  not in support_a
-00022e70: 6c67 6f72 6974 686d 3a0d 0a20 2020 2020  lgorithm:..     
-00022e80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00022e90: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-00022ea0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00022eb0: 5f5f 7d20 2d20 6861 7368 2064 6174 6120  __} - hash data 
-00022ec0: 6572 726f 723a 2061 6c67 6f72 6974 686d  error: algorithm
-00022ed0: 206d 7573 7420 6265 206f 6e65 206f 663a   must be one of:
-00022ee0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-00022ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f00: 2020 2020 2020 6622 7b27 2c20 272e 6a6f        f"{', '.jo
-00022f10: 696e 2873 7570 706f 7274 5f61 6c67 6f72  in(support_algor
-00022f20: 6974 686d 297d 2229 0d0a 2020 2020 2020  ithm)}")..      
-00022f30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00022f40: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-00022f50: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-00022f60: 2070 6179 6c6f 6164 203d 2064 6963 7428   payload = dict(
-00022f70: 290d 0a20 2020 2020 2020 2020 2020 200d  )..            .
-00022f80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00022f90: 6e6f 7420 6973 5f62 6173 6536 3428 696e  not is_base64(in
-00022fa0: 7075 745f 6461 7461 293a 0d0a 2020 2020  put_data):..    
-00022fb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00022fc0: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-00022fd0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-00022fe0: 655f 5f7d 202d 2068 6173 6820 6461 7461  e__} - hash data
-00022ff0: 2065 7272 6f72 3a20 7468 6520 696e 7075   error: the inpu
-00023000: 745f 6461 7461 206d 7573 7420 6265 2062  t_data must be b
-00023010: 6173 6536 3420 656e 636f 6465 6422 290d  ase64 encoded").
-00023020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023030: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-00023040: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-00023050: 645b 2269 6e70 7574 225d 203d 2069 6e70  d["input"] = inp
-00023060: 7574 5f64 6174 610d 0a20 2020 2020 2020  ut_data..       
-00023070: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00023080: 2020 2069 6620 6f75 745f 666f 726d 6174     if out_format
-00023090: 206e 6f74 2069 6e20 5b22 6865 7822 2c20   not in ["hex", 
-000230a0: 2262 6173 6536 3422 5d3a 0d0a 2020 2020  "base64"]:..    
-000230b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000230c0: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-000230d0: 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  {__class__.__nam
-000230e0: 655f 5f7d 202d 2068 6173 6820 6461 7461  e__} - hash data
-000230f0: 2065 7272 6f72 3a20 6f75 745f 666f 726d   error: out_form
-00023100: 6174 2073 686f 756c 6420 6265 206f 6e65  at should be one
-00023110: 206f 663a 2068 6578 2c20 6261 7365 3634   of: hex, base64
-00023120: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00023130: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-00023140: 0a20 2020 2020 2020 2020 2020 2070 6179  .            pay
-00023150: 6c6f 6164 5b22 666f 726d 6174 225d 203d  load["format"] =
-00023160: 206f 7574 5f66 6f72 6d61 740d 0a20 2020   out_format..   
-00023170: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00023180: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
-00023190: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-000231a0: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
-000231b0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-000231c0: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-000231d0: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-000231e0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-000231f0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00023200: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
-00023210: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-00023220: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
-00023230: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-00023240: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-00023250: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-00023260: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-00023270: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-00023280: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-00023290: 732e 706f 7374 2875 726c 2b66 227b 6d6f  s.post(url+f"{mo
-000232a0: 756e 745f 7061 7468 7d2f 6861 7368 2f7b  unt_path}/hash/{
-000232b0: 616c 676f 7269 7468 6d7d 222c 2068 6561  algorithm}", hea
-000232c0: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
-000232d0: 6f6b 656e 223a 2074 6f6b 656e 7d2c 2064  oken": token}, d
-000232e0: 6174 613d 6a73 6f6e 2e64 756d 7073 2870  ata=json.dumps(p
-000232f0: 6179 6c6f 6164 2929 0d0a 2020 2020 2020  ayload))..      
-00023300: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
-00023310: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
-00023320: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
-00023330: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
-00023340: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00023350: 726e 2072 6573 2e6a 736f 6e28 295b 2264  rn res.json()["d
-00023360: 6174 6122 5d0d 0a20 2020 2020 2020 2020  ata"]..         
-00023370: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00023380: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00023390: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
-000233a0: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
-000233b0: 616d 655f 5f2c 2072 6573 2c20 2268 6173  ame__, res, "has
-000233c0: 6820 6461 7461 2065 7272 6f72 2229 0d0a  h data error")..
-000233d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000233e0: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
-000233f0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00023400: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00023410: 0d0a 2020 2020 2320 544f 444f 3a20 7761  ..    # TODO: wa
-00023420: 6974 2066 6f72 2074 6573 7469 6e67 0d0a  it for testing..
-00023430: 2020 2020 6465 6620 6765 6e65 7261 7465      def generate
-00023440: 5f68 6d61 6328 7365 6c66 2c20 0d0a 2020  _hmac(self, ..  
-00023450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023460: 2020 2020 6d6f 756e 745f 7061 7468 3a20      mount_path: 
-00023470: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
-00023480: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00023490: 3a20 7374 722c 0d0a 2020 2020 2020 2020  : str,..        
-000234a0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-000234b0: 795f 7665 7273 696f 6e3a 204f 7074 696f  y_version: Optio
-000234c0: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-000234d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000234e0: 2020 2020 2020 2020 616c 676f 7269 7468          algorith
-000234f0: 6d3a 2073 7472 203d 2022 7368 6132 2d32  m: str = "sha2-2
-00023500: 3536 222c 0d0a 2020 2020 2020 2020 2020  56",..          
-00023510: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00023520: 745f 6461 7461 3a20 7374 7220 3d20 2222  t_data: str = ""
-00023530: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00023540: 2020 2020 2020 2020 2072 6566 6572 656e           referen
-00023550: 6365 3a20 7374 7220 3d20 2222 2c0d 0a20  ce: str = "",.. 
-00023560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023570: 2020 2020 2062 6174 6368 5f69 6e70 7574       batch_input
-00023580: 3a20 4f70 7469 6f6e 616c 5b4c 6973 745b  : Optional[List[
-00023590: 6469 6374 5d5d 203d 204e 6f6e 6529 3a0d  dict]] = None):.
-000235a0: 0a20 2020 2020 2020 2022 2222 7265 7475  .        """retu
-000235b0: 726e 2074 6865 2064 6967 6573 7420 6f66  rn the digest of
-000235c0: 2067 6976 656e 2064 6174 6120 7573 696e   given data usin
-000235d0: 6720 7468 6520 7370 6563 6966 6965 6420  g the specified 
-000235e0: 6861 7368 2061 6c67 6f72 6974 686d 2061  hash algorithm a
-000235f0: 6e64 2074 6865 206e 616d 6564 206b 6579  nd the named key
-00023600: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00023610: 2020 2020 5468 6520 6b65 7920 6361 6e20      The key can 
-00023620: 6265 206f 6620 616e 7920 7479 7065 2073  be of any type s
-00023630: 7570 706f 7274 6564 2062 7920 7472 616e  upported by tran
-00023640: 7369 742c 2061 7320 6561 6368 2074 7261  sit, as each tra
-00023650: 6e73 6974 206b 6579 2076 6572 7369 6f6e  nsit key version
-00023660: 2068 6173 2061 6e20 696e 6465 7065 6e64   has an independ
-00023670: 656e 742c 200d 0a20 2020 2020 2020 2072  ent, ..        r
-00023680: 616e 646f 6d20 3235 362d 6269 7420 484d  andom 256-bit HM
-00023690: 4143 2073 6563 7265 7420 6b65 792e 2049  AC secret key. I
-000236a0: 6620 7468 6520 6b65 7920 6973 206f 6620  f the key is of 
-000236b0: 6120 7479 7065 2074 6861 7420 7375 7070  a type that supp
-000236c0: 6f72 7473 2072 6f74 6174 696f 6e2c 2074  orts rotation, t
-000236d0: 6865 206c 6174 6573 7420 2863 7572 7265  he latest (curre
-000236e0: 6e74 2920 0d0a 2020 2020 2020 2020 7665  nt) ..        ve
-000236f0: 7273 696f 6e20 7769 6c6c 2062 6520 7573  rsion will be us
-00023700: 6564 2e0d 0a20 2020 2020 2020 200d 0a20  ed...        .. 
-00023710: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
-00023720: 6874 7470 733a 2f2f 6465 7665 6c6f 7065  https://develope
-00023730: 722e 6861 7368 6963 6f72 702e 636f 6d2f  r.hashicorp.com/
-00023740: 7661 756c 742f 6170 692d 646f 6373 2f73  vault/api-docs/s
-00023750: 6563 7265 742f 7472 616e 7369 7423 6765  ecret/transit#ge
-00023760: 6e65 7261 7465 2d68 6d61 6320 666f 7220  nerate-hmac for 
-00023770: 6d6f 7265 2064 6574 6169 6c73 2e0d 0a0d  more details....
-00023780: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-00023790: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-000237a0: 745f 7061 7468 2028 7374 7229 0d0a 2020  t_path (str)..  
-000237b0: 2020 2020 2020 2020 2020 6e61 6d65 2028            name (
-000237c0: 7374 7229 3a20 5370 6563 6966 6965 7320  str): Specifies 
-000237d0: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
-000237e0: 656e 6372 7970 7469 6f6e 206b 6579 2074  encryption key t
-000237f0: 6f20 6765 6e65 7261 7465 2068 6d61 6320  o generate hmac 
-00023800: 6167 6169 6e73 742e 0d0a 2020 2020 2020  against...      
-00023810: 2020 2020 2020 6b65 795f 7665 7273 696f        key_versio
-00023820: 6e20 284f 7074 696f 6e61 6c5b 696e 745d  n (Optional[int]
-00023830: 2c20 6f70 7469 6f6e 616c 293a 2053 7065  , optional): Spe
-00023840: 6369 6669 6573 2074 6865 2076 6572 7369  cifies the versi
-00023850: 6f6e 206f 6620 7468 6520 6b65 7920 746f  on of the key to
-00023860: 2075 7365 2066 6f72 2074 6865 206f 7065   use for the ope
-00023870: 7261 7469 6f6e 2e20 0d0a 2020 2020 2020  ration. ..      
-00023880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238a0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-000238b0: 6e6f 7420 7365 742c 2075 7365 7320 7468  not set, uses th
-000238c0: 6520 6c61 7465 7374 2076 6572 7369 6f6e  e latest version
-000238d0: 2e20 4d75 7374 2062 6520 6772 6561 7465  . Must be greate
-000238e0: 7220 7468 616e 200d 0a20 2020 2020 2020  r than ..       
-000238f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023910: 2020 2020 2020 2020 2020 2020 6f72 2065              or e
-00023920: 7175 616c 2074 6f20 7468 6520 6b65 7927  qual to the key'
-00023930: 7320 606d 696e 5f65 6e63 7279 7074 696f  s `min_encryptio
-00023940: 6e5f 7665 7273 696f 6e60 2c20 6966 2073  n_version`, if s
-00023950: 6574 2e20 0d0a 2020 2020 2020 2020 2020  et. ..          
-00023960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023980: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00023990: 7320 746f 204e 6f6e 652e 0d0a 2020 2020  s to None...    
-000239a0: 2020 2020 2020 2020 616c 676f 7269 7468          algorith
-000239b0: 6d20 2873 7472 2c20 6f70 7469 6f6e 616c  m (str, optional
-000239c0: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
-000239d0: 2068 6173 6820 616c 676f 7269 7468 6d20   hash algorithm 
-000239e0: 746f 2075 7365 2e20 5468 6973 2063 616e  to use. This can
-000239f0: 2061 6c73 6f20 6265 2073 7065 6369 6669   also be specifi
-00023a00: 6564 2061 7320 7061 7274 200d 0a20 2020  ed as part ..   
-00023a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a30: 2020 2020 6f66 2074 6865 2055 524c 2e20      of the URL. 
-00023a40: 4375 7272 656e 746c 792d 7375 7070 6f72  Currently-suppor
-00023a50: 7465 6420 616c 676f 7269 7468 6d73 2061  ted algorithms a
-00023a60: 7265 3a20 7368 6132 2d32 3234 2c20 7368  re: sha2-224, sh
-00023a70: 6132 2d32 3536 2c20 0d0a 2020 2020 2020  a2-256, ..      
-00023a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023aa0: 2073 6861 322d 3338 342c 2073 6861 322d   sha2-384, sha2-
-00023ab0: 3531 322c 2073 6861 332d 3232 342c 2073  512, sha3-224, s
-00023ac0: 6861 332d 3235 362c 2073 6861 332d 3338  ha3-256, sha3-38
-00023ad0: 342c 2073 6861 332d 3531 322e 2044 6566  4, sha3-512. Def
-00023ae0: 6175 6c74 7320 746f 200d 0a20 2020 2020  aults to ..     
-00023af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b10: 2020 2273 6861 322d 3235 3622 2e0d 0a20    "sha2-256"... 
-00023b20: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-00023b30: 5f64 6174 6120 2873 7472 2c20 6f70 7469  _data (str, opti
-00023b40: 6f6e 616c 293a 2053 7065 6369 6669 6573  onal): Specifies
-00023b50: 2074 6865 2062 6173 6536 3420 656e 636f   the base64 enco
-00023b60: 6465 6420 696e 7075 7420 6461 7461 2e20  ded input data. 
-00023b70: 4f6e 6520 6f66 2060 696e 7075 7460 206f  One of `input` o
-00023b80: 7220 6062 6174 6368 5f69 6e70 7574 6020  r `batch_input` 
-00023b90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00023ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023bb0: 2020 2020 2020 2020 2020 6d75 7374 2062            must b
-00023bc0: 6520 7375 7070 6c69 6564 2e20 4465 6661  e supplied. Defa
-00023bd0: 756c 7473 2074 6f20 2222 2e0d 0a20 2020  ults to ""...   
-00023be0: 2020 2020 2020 2020 2072 6566 6572 656e           referen
-00023bf0: 6365 2028 7374 722c 206f 7074 696f 6e61  ce (str, optiona
-00023c00: 6c29 3a20 4120 7573 6572 2d73 7570 706c  l): A user-suppl
-00023c10: 6965 6420 7374 7269 6e67 2074 6861 7420  ied string that 
-00023c20: 7769 6c6c 2062 6520 7072 6573 656e 7420  will be present 
-00023c30: 696e 2074 6865 2060 7265 6665 7265 6e63  in the `referenc
-00023c40: 6560 2066 6965 6c64 206f 6e20 0d0a 2020  e` field on ..  
-00023c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c70: 2020 2020 2074 6865 2063 6f72 7265 7370       the corresp
-00023c80: 6f6e 6469 6e67 2060 6261 7463 685f 7265  onding `batch_re
-00023c90: 7375 6c74 7360 2069 7465 6d20 696e 2074  sults` item in t
-00023ca0: 6865 2072 6573 706f 6e73 652c 2074 6f20  he response, to 
-00023cb0: 6173 7369 7374 2069 6e20 0d0a 2020 2020  assist in ..    
-00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ce0: 2020 2075 6e64 6572 7374 616e 6469 6e67     understanding
-00023cf0: 2077 6869 6368 2072 6573 756c 7420 636f   which result co
-00023d00: 7272 6573 706f 6e64 7320 746f 2061 2070  rresponds to a p
-00023d10: 6172 7469 6375 6c61 7220 696e 7075 742e  articular input.
-00023d20: 204f 6e6c 7920 7661 6c69 6420 0d0a 2020   Only valid ..  
-00023d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d50: 2020 2020 206f 6e20 6261 7463 6820 7265       on batch re
-00023d60: 7175 6573 7473 2077 6865 6e20 7573 696e  quests when usin
-00023d70: 6720 e280 9862 6174 6368 5f69 6e70 7574  g ...batch_input
-00023d80: e280 9920 6265 6c6f 772e 2044 6566 6175  ... below. Defau
-00023d90: 6c74 7320 746f 2022 222e 0d0a 2020 2020  lts to ""...    
-00023da0: 2020 2020 2020 2020 6261 7463 685f 696e          batch_in
-00023db0: 7075 7420 284f 7074 696f 6e61 6c5b 4c69  put (Optional[Li
-00023dc0: 7374 5b64 6963 745d 5d2c 206f 7074 696f  st[dict]], optio
-00023dd0: 6e61 6c29 3a20 5370 6563 6966 6965 7320  nal): Specifies 
-00023de0: 6120 6c69 7374 206f 6620 6974 656d 7320  a list of items 
-00023df0: 666f 7220 7072 6f63 6573 7369 6e67 2e20  for processing. 
-00023e00: 5768 656e 2074 6869 7320 0d0a 2020 2020  When this ..    
-00023e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022950: 2069 6e70 7574 5f64 6174 613a 2073 7472   input_data: str
+00022960: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00022970: 2020 2020 2061 6c67 6f72 6974 686d 3a20       algorithm: 
+00022980: 7374 7220 3d20 2273 6861 322d 3235 3622  str = "sha2-256"
+00022990: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000229a0: 2020 2020 206f 7574 5f66 6f72 6d61 743a       out_format:
+000229b0: 2073 7472 203d 2022 6865 7822 293a 0d0a   str = "hex"):..
+000229c0: 2020 2020 2020 2020 2222 2272 6574 7572          """retur
+000229d0: 6e20 7468 6520 6372 7970 746f 6772 6170  n the cryptograp
+000229e0: 6869 6320 6861 7368 206f 6620 6769 7665  hic hash of give
+000229f0: 6e20 6461 7461 2075 7369 6e67 2074 6865  n data using the
+00022a00: 2073 7065 6369 6669 6564 2061 6c67 6f72   specified algor
+00022a10: 6974 686d 0d0a 2020 2020 2020 2020 0d0a  ithm..        ..
+00022a20: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
+00022a30: 2068 7474 7073 3a2f 2f64 6576 656c 6f70   https://develop
+00022a40: 6572 2e68 6173 6869 636f 7270 2e63 6f6d  er.hashicorp.com
+00022a50: 2f76 6175 6c74 2f61 7069 2d64 6f63 732f  /vault/api-docs/
+00022a60: 7365 6372 6574 2f74 7261 6e73 6974 2368  secret/transit#h
+00022a70: 6173 682d 6461 7461 2066 6f72 206d 6f72  ash-data for mor
+00022a80: 6520 6465 7461 696c 732e 0d0a 0d0a 2020  e details.....  
+00022a90: 2020 2020 2020 4172 6773 3a0d 0a20 2020        Args:..   
+00022aa0: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
+00022ab0: 6174 6820 2873 7472 290d 0a20 2020 2020  ath (str)..     
+00022ac0: 2020 2020 2020 2069 6e70 7574 5f64 6174         input_dat
+00022ad0: 6120 2873 7472 293a 2053 7065 6369 6669  a (str): Specifi
+00022ae0: 6573 2074 6865 2062 6173 6536 3420 656e  es the base64 en
+00022af0: 636f 6465 6420 696e 7075 7420 6461 7461  coded input data
+00022b00: 2e0d 0a20 2020 2020 2020 2020 2020 2061  ...            a
+00022b10: 6c67 6f72 6974 686d 2028 7374 722c 206f  lgorithm (str, o
+00022b20: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
+00022b30: 6965 7320 7468 6520 6861 7368 2061 6c67  ies the hash alg
+00022b40: 6f72 6974 686d 2074 6f20 7573 652e 2054  orithm to use. T
+00022b50: 6869 7320 6361 6e20 616c 736f 2062 6520  his can also be 
+00022b60: 7370 6563 6966 6965 6420 6173 200d 0a20  specified as .. 
+00022b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b90: 2020 2020 2020 7061 7274 206f 6620 7468        part of th
+00022ba0: 6520 5552 4c2e 2043 7572 7265 6e74 6c79  e URL. Currently
+00022bb0: 2d73 7570 706f 7274 6564 2061 6c67 6f72  -supported algor
+00022bc0: 6974 686d 7320 6172 653a 2073 6861 322d  ithms are: sha2-
+00022bd0: 3232 342c 200d 0a20 2020 2020 2020 2020  224, ..         
+00022be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bf0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00022c00: 6132 2d32 3536 2c20 7368 6132 2d33 3834  a2-256, sha2-384
+00022c10: 2c20 7368 6132 2d35 3132 2c20 7368 6133  , sha2-512, sha3
+00022c20: 2d32 3234 2c20 7368 6133 2d32 3536 2c20  -224, sha3-256, 
+00022c30: 7368 6133 2d33 3834 2c20 7368 6133 2d35  sha3-384, sha3-5
+00022c40: 3132 2e20 0d0a 2020 2020 2020 2020 2020  12. ..          
+00022c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c60: 2020 2020 2020 2020 2020 2020 2044 6566               Def
+00022c70: 6175 6c74 7320 746f 2022 7368 6132 2d32  aults to "sha2-2
+00022c80: 3536 222e 0d0a 2020 2020 2020 2020 2020  56"...          
+00022c90: 2020 6f75 745f 666f 726d 6174 2028 7374    out_format (st
+00022ca0: 722c 206f 7074 696f 6e61 6c29 3a20 5370  r, optional): Sp
+00022cb0: 6563 6966 6965 7320 7468 6520 6f75 7470  ecifies the outp
+00022cc0: 7574 2065 6e63 6f64 696e 672e 2054 6869  ut encoding. Thi
+00022cd0: 7320 6361 6e20 6265 2065 6974 6865 7220  s can be either 
+00022ce0: 6068 6578 6020 6f72 2060 6261 7365 3634  `hex` or `base64
+00022cf0: 602e 200d 0a20 2020 2020 2020 2020 2020  `. ..           
+00022d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d10: 2020 2020 2020 2020 2020 2020 2044 6566               Def
+00022d20: 6175 6c74 7320 746f 2022 6865 7822 2e0d  aults to "hex"..
+00022d30: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00022d40: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+00022d50: 2064 6963 7420 6f72 204e 6f6e 653a 2072   dict or None: r
+00022d60: 6574 7572 6e20 7468 6520 6861 7368 2064  eturn the hash d
+00022d70: 6174 6120 696e 2064 6963 7420 6966 2073  ata in dict if s
+00022d80: 7563 6365 7373 2c20 6f74 6865 7277 7369  uccess, otherwsi
+00022d90: 6520 7265 7475 726e 204e 6f6e 650d 0a20  e return None.. 
+00022da0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00022db0: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
+00022dc0: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
+00022dd0: 2020 7375 7070 6f72 745f 616c 676f 7269    support_algori
+00022de0: 7468 6d20 3d20 5b22 7368 6132 2d32 3234  thm = ["sha2-224
+00022df0: 222c 2022 7368 6132 2d32 3536 222c 2022  ", "sha2-256", "
+00022e00: 7368 6132 2d33 3834 222c 2022 7368 6132  sha2-384", "sha2
+00022e10: 2d35 3132 222c 200d 0a20 2020 2020 2020  -512", ..       
+00022e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e30: 2020 2020 2020 2020 2020 2273 6861 332d            "sha3-
+00022e40: 3232 3422 2c20 2273 6861 332d 3235 3622  224", "sha3-256"
+00022e50: 2c20 2273 6861 332d 3338 3422 2c20 2273  , "sha3-384", "s
+00022e60: 6861 332d 3531 3222 5d0d 0a20 2020 2020  ha3-512"]..     
+00022e70: 2020 2020 2020 2069 6620 616c 676f 7269         if algori
+00022e80: 7468 6d20 6e6f 7420 696e 2073 7570 706f  thm not in suppo
+00022e90: 7274 5f61 6c67 6f72 6974 686d 3a0d 0a20  rt_algorithm:.. 
+00022ea0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00022eb0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+00022ec0: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+00022ed0: 6e61 6d65 5f5f 7d20 2d20 6861 7368 2064  name__} - hash d
+00022ee0: 6174 6120 6572 726f 723a 2061 6c67 6f72  ata error: algor
+00022ef0: 6974 686d 206d 7573 7420 6265 206f 6e65  ithm must be one
+00022f00: 206f 663a 2022 0d0a 2020 2020 2020 2020   of: "..        
+00022f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f20: 2020 2020 2020 2020 2020 6622 7b27 2c20            f"{', 
+00022f30: 272e 6a6f 696e 2873 7570 706f 7274 5f61  '.join(support_a
+00022f40: 6c67 6f72 6974 686d 297d 2229 0d0a 2020  lgorithm)}")..  
+00022f50: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00022f60: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+00022f70: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00022f80: 2020 2020 2070 6179 6c6f 6164 203d 2064       payload = d
+00022f90: 6963 7428 290d 0a20 2020 2020 2020 2020  ict()..         
+00022fa0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00022fb0: 2069 6620 6e6f 7420 6973 5f62 6173 6536   if not is_base6
+00022fc0: 3428 696e 7075 745f 6461 7461 293a 0d0a  4(input_data):..
+00022fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022fe0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+00022ff0: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+00023000: 5f6e 616d 655f 5f7d 202d 2068 6173 6820  _name__} - hash 
+00023010: 6461 7461 2065 7272 6f72 3a20 7468 6520  data error: the 
+00023020: 696e 7075 745f 6461 7461 206d 7573 7420  input_data must 
+00023030: 6265 2062 6173 6536 3420 656e 636f 6465  be base64 encode
+00023040: 6422 290d 0a20 2020 2020 2020 2020 2020  d")..           
+00023050: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00023060: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+00023070: 796c 6f61 645b 2269 6e70 7574 225d 203d  yload["input"] =
+00023080: 2069 6e70 7574 5f64 6174 610d 0a20 2020   input_data..   
+00023090: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+000230a0: 2020 2020 2020 2069 6620 6f75 745f 666f         if out_fo
+000230b0: 726d 6174 206e 6f74 2069 6e20 5b22 6865  rmat not in ["he
+000230c0: 7822 2c20 2262 6173 6536 3422 5d3a 0d0a  x", "base64"]:..
+000230d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230e0: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
+000230f0: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
+00023100: 5f6e 616d 655f 5f7d 202d 2068 6173 6820  _name__} - hash 
+00023110: 6461 7461 2065 7272 6f72 3a20 6f75 745f  data error: out_
+00023120: 666f 726d 6174 2073 686f 756c 6420 6265  format should be
+00023130: 206f 6e65 206f 663a 2068 6578 2c20 6261   one of: hex, ba
+00023140: 7365 3634 2229 0d0a 2020 2020 2020 2020  se64")..        
+00023150: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00023160: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00023170: 2070 6179 6c6f 6164 5b22 666f 726d 6174   payload["format
+00023180: 225d 203d 206f 7574 5f66 6f72 6d61 740d  "] = out_format.
+00023190: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+000231a0: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+000231b0: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+000231c0: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
+000231d0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+000231e0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+000231f0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+00023200: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+00023210: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+00023220: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
+00023230: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+00023240: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
+00023250: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+00023260: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+00023270: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+00023280: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+00023290: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+000232a0: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
+000232b0: 7565 7374 732e 706f 7374 2875 726c 2b66  uests.post(url+f
+000232c0: 227b 6d6f 756e 745f 7061 7468 7d2f 6861  "{mount_path}/ha
+000232d0: 7368 2f7b 616c 676f 7269 7468 6d7d 222c  sh/{algorithm}",
+000232e0: 2068 6561 6465 7273 3d7b 2258 2d56 6175   headers={"X-Vau
+000232f0: 6c74 2d54 6f6b 656e 223a 2074 6f6b 656e  lt-Token": token
+00023300: 7d2c 2064 6174 613d 6a73 6f6e 2e64 756d  }, data=json.dum
+00023310: 7073 2870 6179 6c6f 6164 2929 0d0a 2020  ps(payload))..  
+00023320: 2020 2020 2020 2020 2020 6966 2072 6573            if res
+00023330: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
+00023340: 3230 3020 6f72 2072 6573 2e73 7461 7475  200 or res.statu
+00023350: 735f 636f 6465 203d 3d20 3230 343a 0d0a  s_code == 204:..
+00023360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023370: 7265 7475 726e 2072 6573 2e6a 736f 6e28  return res.json(
+00023380: 295b 2264 6174 6122 5d0d 0a20 2020 2020  )["data"]..     
+00023390: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000233a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000233b0: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+000233c0: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+000233d0: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+000233e0: 2268 6173 6820 6461 7461 2065 7272 6f72  "hash data error
+000233f0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00023400: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+00023410: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00023420: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00023430: 6e65 0d0a 0d0a 2020 2020 2320 544f 444f  ne....    # TODO
+00023440: 3a20 7761 6974 2066 6f72 2074 6573 7469  : wait for testi
+00023450: 6e67 0d0a 2020 2020 6465 6620 6765 6e65  ng..    def gene
+00023460: 7261 7465 5f68 6d61 6328 7365 6c66 2c20  rate_hmac(self, 
+00023470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023480: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+00023490: 7468 3a20 7374 722c 0d0a 2020 2020 2020  th: str,..      
+000234a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000234b0: 6e61 6d65 3a20 7374 722c 0d0a 2020 2020  name: str,..    
+000234c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000234d0: 2020 6b65 795f 7665 7273 696f 6e3a 204f    key_version: O
+000234e0: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+000234f0: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+00023500: 2020 2020 2020 2020 2020 2020 616c 676f              algo
+00023510: 7269 7468 6d3a 2073 7472 203d 2022 7368  rithm: str = "sh
+00023520: 6132 2d32 3536 222c 0d0a 2020 2020 2020  a2-256",..      
+00023530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023540: 696e 7075 745f 6461 7461 3a20 7374 7220  input_data: str 
+00023550: 3d20 2222 2c0d 0a20 2020 2020 2020 2020  = "",..         
+00023560: 2020 2020 2020 2020 2020 2020 2072 6566               ref
+00023570: 6572 656e 6365 3a20 7374 7220 3d20 2222  erence: str = ""
+00023580: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00023590: 2020 2020 2020 2020 2062 6174 6368 5f69           batch_i
+000235a0: 6e70 7574 3a20 4f70 7469 6f6e 616c 5b4c  nput: Optional[L
+000235b0: 6973 745b 6469 6374 5d5d 203d 204e 6f6e  ist[dict]] = Non
+000235c0: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+000235d0: 7265 7475 726e 2074 6865 2064 6967 6573  return the diges
+000235e0: 7420 6f66 2067 6976 656e 2064 6174 6120  t of given data 
+000235f0: 7573 696e 6720 7468 6520 7370 6563 6966  using the specif
+00023600: 6965 6420 6861 7368 2061 6c67 6f72 6974  ied hash algorit
+00023610: 686d 2061 6e64 2074 6865 206e 616d 6564  hm and the named
+00023620: 206b 6579 0d0a 2020 2020 2020 2020 0d0a   key..        ..
+00023630: 2020 2020 2020 2020 5468 6520 6b65 7920          The key 
+00023640: 6361 6e20 6265 206f 6620 616e 7920 7479  can be of any ty
+00023650: 7065 2073 7570 706f 7274 6564 2062 7920  pe supported by 
+00023660: 7472 616e 7369 742c 2061 7320 6561 6368  transit, as each
+00023670: 2074 7261 6e73 6974 206b 6579 2076 6572   transit key ver
+00023680: 7369 6f6e 2068 6173 2061 6e20 696e 6465  sion has an inde
+00023690: 7065 6e64 656e 742c 200d 0a20 2020 2020  pendent, ..     
+000236a0: 2020 2072 616e 646f 6d20 3235 362d 6269     random 256-bi
+000236b0: 7420 484d 4143 2073 6563 7265 7420 6b65  t HMAC secret ke
+000236c0: 792e 2049 6620 7468 6520 6b65 7920 6973  y. If the key is
+000236d0: 206f 6620 6120 7479 7065 2074 6861 7420   of a type that 
+000236e0: 7375 7070 6f72 7473 2072 6f74 6174 696f  supports rotatio
+000236f0: 6e2c 2074 6865 206c 6174 6573 7420 2863  n, the latest (c
+00023700: 7572 7265 6e74 2920 0d0a 2020 2020 2020  urrent) ..      
+00023710: 2020 7665 7273 696f 6e20 7769 6c6c 2062    version will b
+00023720: 6520 7573 6564 2e0d 0a20 2020 2020 2020  e used...       
+00023730: 200d 0a20 2020 2020 2020 2052 6566 6572   ..        Refer
+00023740: 2074 6f20 6874 7470 733a 2f2f 6465 7665   to https://deve
+00023750: 6c6f 7065 722e 6861 7368 6963 6f72 702e  loper.hashicorp.
+00023760: 636f 6d2f 7661 756c 742f 6170 692d 646f  com/vault/api-do
+00023770: 6373 2f73 6563 7265 742f 7472 616e 7369  cs/secret/transi
+00023780: 7423 6765 6e65 7261 7465 2d68 6d61 6320  t#generate-hmac 
+00023790: 666f 7220 6d6f 7265 2064 6574 6169 6c73  for more details
+000237a0: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+000237b0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000237c0: 6d6f 756e 745f 7061 7468 2028 7374 7229  mount_path (str)
+000237d0: 0d0a 2020 2020 2020 2020 2020 2020 6e61  ..            na
+000237e0: 6d65 2028 7374 7229 3a20 5370 6563 6966  me (str): Specif
+000237f0: 6965 7320 7468 6520 6e61 6d65 206f 6620  ies the name of 
+00023800: 7468 6520 656e 6372 7970 7469 6f6e 206b  the encryption k
+00023810: 6579 2074 6f20 6765 6e65 7261 7465 2068  ey to generate h
+00023820: 6d61 6320 6167 6169 6e73 742e 0d0a 2020  mac against...  
+00023830: 2020 2020 2020 2020 2020 6b65 795f 7665            key_ve
+00023840: 7273 696f 6e20 284f 7074 696f 6e61 6c5b  rsion (Optional[
+00023850: 696e 745d 2c20 6f70 7469 6f6e 616c 293a  int], optional):
+00023860: 2053 7065 6369 6669 6573 2074 6865 2076   Specifies the v
+00023870: 6572 7369 6f6e 206f 6620 7468 6520 6b65  ersion of the ke
+00023880: 7920 746f 2075 7365 2066 6f72 2074 6865  y to use for the
+00023890: 206f 7065 7261 7469 6f6e 2e20 0d0a 2020   operation. ..  
+000238a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238d0: 2049 6620 6e6f 7420 7365 742c 2075 7365   If not set, use
+000238e0: 7320 7468 6520 6c61 7465 7374 2076 6572  s the latest ver
+000238f0: 7369 6f6e 2e20 4d75 7374 2062 6520 6772  sion. Must be gr
+00023900: 6561 7465 7220 7468 616e 200d 0a20 2020  eater than ..   
+00023910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023940: 6f72 2065 7175 616c 2074 6f20 7468 6520  or equal to the 
+00023950: 6b65 7927 7320 606d 696e 5f65 6e63 7279  key's `min_encry
+00023960: 7074 696f 6e5f 7665 7273 696f 6e60 2c20  ption_version`, 
+00023970: 6966 2073 6574 2e20 0d0a 2020 2020 2020  if set. ..      
+00023980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239a0: 2020 2020 2020 2020 2020 2020 2044 6566               Def
+000239b0: 6175 6c74 7320 746f 204e 6f6e 652e 0d0a  aults to None...
+000239c0: 2020 2020 2020 2020 2020 2020 616c 676f              algo
+000239d0: 7269 7468 6d20 2873 7472 2c20 6f70 7469  rithm (str, opti
+000239e0: 6f6e 616c 293a 2053 7065 6369 6669 6573  onal): Specifies
+000239f0: 2074 6865 2068 6173 6820 616c 676f 7269   the hash algori
+00023a00: 7468 6d20 746f 2075 7365 2e20 5468 6973  thm to use. This
+00023a10: 2063 616e 2061 6c73 6f20 6265 2073 7065   can also be spe
+00023a20: 6369 6669 6564 2061 7320 7061 7274 200d  cified as part .
+00023a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a50: 2020 2020 2020 2020 6f66 2074 6865 2055          of the U
+00023a60: 524c 2e20 4375 7272 656e 746c 792d 7375  RL. Currently-su
+00023a70: 7070 6f72 7465 6420 616c 676f 7269 7468  pported algorith
+00023a80: 6d73 2061 7265 3a20 7368 6132 2d32 3234  ms are: sha2-224
+00023a90: 2c20 7368 6132 2d32 3536 2c20 0d0a 2020  , sha2-256, ..  
+00023aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ac0: 2020 2020 2073 6861 322d 3338 342c 2073       sha2-384, s
+00023ad0: 6861 322d 3531 322c 2073 6861 332d 3232  ha2-512, sha3-22
+00023ae0: 342c 2073 6861 332d 3235 362c 2073 6861  4, sha3-256, sha
+00023af0: 332d 3338 342c 2073 6861 332d 3531 322e  3-384, sha3-512.
+00023b00: 2044 6566 6175 6c74 7320 746f 200d 0a20   Defaults to .. 
+00023b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b30: 2020 2020 2020 2273 6861 322d 3235 3622        "sha2-256"
+00023b40: 2e0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00023b50: 6e70 7574 5f64 6174 6120 2873 7472 2c20  nput_data (str, 
+00023b60: 6f70 7469 6f6e 616c 293a 2053 7065 6369  optional): Speci
+00023b70: 6669 6573 2074 6865 2062 6173 6536 3420  fies the base64 
+00023b80: 656e 636f 6465 6420 696e 7075 7420 6461  encoded input da
+00023b90: 7461 2e20 4f6e 6520 6f66 2060 696e 7075  ta. One of `inpu
+00023ba0: 7460 206f 7220 6062 6174 6368 5f69 6e70  t` or `batch_inp
+00023bb0: 7574 6020 0d0a 2020 2020 2020 2020 2020  ut` ..          
+00023bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bd0: 2020 2020 2020 2020 2020 2020 2020 6d75                mu
+00023be0: 7374 2062 6520 7375 7070 6c69 6564 2e20  st be supplied. 
+00023bf0: 4465 6661 756c 7473 2074 6f20 2222 2e0d  Defaults to ""..
+00023c00: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+00023c10: 6572 656e 6365 2028 7374 722c 206f 7074  erence (str, opt
+00023c20: 696f 6e61 6c29 3a20 4120 7573 6572 2d73  ional): A user-s
+00023c30: 7570 706c 6965 6420 7374 7269 6e67 2074  upplied string t
+00023c40: 6861 7420 7769 6c6c 2062 6520 7072 6573  hat will be pres
+00023c50: 656e 7420 696e 2074 6865 2060 7265 6665  ent in the `refe
+00023c60: 7265 6e63 6560 2066 6965 6c64 206f 6e20  rence` field on 
+00023c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c90: 2020 2020 2020 2020 2074 6865 2063 6f72           the cor
+00023ca0: 7265 7370 6f6e 6469 6e67 2060 6261 7463  responding `batc
+00023cb0: 685f 7265 7375 6c74 7360 2069 7465 6d20  h_results` item 
+00023cc0: 696e 2074 6865 2072 6573 706f 6e73 652c  in the response,
+00023cd0: 2074 6f20 6173 7369 7374 2069 6e20 0d0a   to assist in ..
+00023ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d00: 2020 2020 2020 2075 6e64 6572 7374 616e         understan
+00023d10: 6469 6e67 2077 6869 6368 2072 6573 756c  ding which resul
+00023d20: 7420 636f 7272 6573 706f 6e64 7320 746f  t corresponds to
+00023d30: 2061 2070 6172 7469 6375 6c61 7220 696e   a particular in
+00023d40: 7075 742e 204f 6e6c 7920 7661 6c69 6420  put. Only valid 
+00023d50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d70: 2020 2020 2020 2020 206f 6e20 6261 7463           on batc
+00023d80: 6820 7265 7175 6573 7473 2077 6865 6e20  h requests when 
+00023d90: 7573 696e 6720 e280 9862 6174 6368 5f69  using ...batch_i
+00023da0: 6e70 7574 e280 9920 6265 6c6f 772e 2044  nput... below. D
+00023db0: 6566 6175 6c74 7320 746f 2022 222e 0d0a  efaults to ""...
+00023dc0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+00023dd0: 685f 696e 7075 7420 284f 7074 696f 6e61  h_input (Optiona
+00023de0: 6c5b 4c69 7374 5b64 6963 745d 5d2c 206f  l[List[dict]], o
+00023df0: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
+00023e00: 6965 7320 6120 6c69 7374 206f 6620 6974  ies a list of it
+00023e10: 656d 7320 666f 7220 7072 6f63 6573 7369  ems for processi
+00023e20: 6e67 2e20 5768 656e 2074 6869 7320 0d0a  ng. When this ..
 00023e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e40: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
-00023e50: 6973 2073 6574 2c20 6966 2074 6865 2070  is set, if the p
-00023e60: 6172 616d 6574 6572 2027 696e 7075 7427  arameter 'input'
-00023e70: 2069 7320 616c 736f 2073 6574 2c20 0d0a   is also set, ..
-00023e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023eb0: 2020 2020 2020 2020 2020 6974 2077 696c            it wil
-00023ec0: 6c20 6265 2069 676e 6f72 6564 2e20 5265  l be ignored. Re
-00023ed0: 7370 6f6e 7365 7320 6172 6520 7265 7475  sponses are retu
-00023ee0: 726e 6564 2069 6e20 7468 6520 0d0a 2020  rned in the ..  
-00023ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f20: 2020 2020 2020 2020 2762 6174 6368 5f72          'batch_r
-00023f30: 6573 756c 7473 2720 6172 7261 7920 636f  esults' array co
-00023f40: 6d70 6f6e 656e 7420 6f66 2074 6865 2027  mponent of the '
-00023f50: 6461 7461 2720 656c 656d 656e 7420 0d0a  data' element ..
-00023f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f90: 2020 2020 2020 2020 2020 6f66 2074 6865            of the
-00023fa0: 2072 6573 706f 6e73 652e 2041 6e79 2062   response. Any b
-00023fb0: 6174 6368 206f 7574 7075 7420 7769 6c6c  atch output will
-00023fc0: 2070 7265 7365 7276 6520 7468 6520 0d0a   preserve the ..
-00023fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024000: 2020 2020 2020 2020 2020 6f72 6465 7220            order 
-00024010: 6f66 2074 6865 2062 6174 6368 2069 6e70  of the batch inp
-00024020: 7574 2e20 4966 2074 6865 2069 6e70 7574  ut. If the input
-00024030: 2064 6174 6120 7661 6c75 6520 6f66 200d   data value of .
-00024040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024070: 2020 2020 2020 2020 2020 2061 6e20 6974             an it
-00024080: 656d 2069 7320 696e 7661 6c69 642c 2074  em is invalid, t
-00024090: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
-000240a0: 2069 7465 6d20 696e 2074 6865 200d 0a20   item in the .. 
-000240b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240e0: 2020 2020 2020 2020 2027 6261 7463 685f           'batch_
-000240f0: 7265 7375 6c74 7327 2077 696c 6c20 6861  results' will ha
-00024100: 7665 2074 6865 206b 6579 2027 6572 726f  ve the key 'erro
-00024110: 7227 2077 6974 6820 6120 7661 6c75 6520  r' with a value 
-00024120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024150: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-00024160: 7269 6269 6e67 2074 6865 2065 7272 6f72  ribing the error
-00024170: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
-00024180: 6e65 2e0d 0a0d 0a20 2020 2020 2020 2052  ne.....        R
-00024190: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
-000241a0: 2020 2020 2064 6963 7420 6f72 204e 6f6e       dict or Non
-000241b0: 653a 2072 6574 7572 6e20 7468 6520 6469  e: return the di
-000241c0: 6765 7374 206f 6620 6769 7665 6e20 6461  gest of given da
-000241d0: 7461 2069 6e20 6469 6374 2069 6620 7375  ta in dict if su
-000241e0: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
-000241f0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-00024200: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00024210: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
-00024220: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
-00024230: 2069 6620 696e 7075 745f 6461 7461 203d   if input_data =
-00024240: 3d20 2222 2061 6e64 2062 6174 6368 5f69  = "" and batch_i
-00024250: 6e70 7574 2069 7320 4e6f 6e65 3a0d 0a20  nput is None:.. 
-00024260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00024270: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-00024280: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-00024290: 6e61 6d65 5f5f 7d20 2d20 6765 6e65 7261  name__} - genera
-000242a0: 7465 2068 6d61 6320 6572 726f 723a 204f  te hmac error: O
-000242b0: 6e65 206f 6620 6069 6e70 7574 6020 6f72  ne of `input` or
-000242c0: 2060 6261 7463 685f 696e 7075 7460 2022   `batch_input` "
-000242d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000242e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000242f0: 2020 2020 6622 6d75 7374 2062 6520 7375      f"must be su
-00024300: 7070 6c69 6564 2229 0d0a 2020 2020 2020  pplied")..      
-00024310: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00024320: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-00024330: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-00024340: 2073 7570 706f 7274 5f61 6c67 6f72 6974   support_algorit
-00024350: 686d 203d 205b 2273 6861 322d 3232 3422  hm = ["sha2-224"
-00024360: 2c20 2273 6861 322d 3235 3622 2c20 2273  , "sha2-256", "s
-00024370: 6861 322d 3338 3422 2c20 2273 6861 322d  ha2-384", "sha2-
-00024380: 3531 3222 2c20 0d0a 2020 2020 2020 2020  512", ..        
-00024390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243a0: 2020 2020 2020 2020 2022 7368 6133 2d32           "sha3-2
-000243b0: 3234 222c 2022 7368 6133 2d32 3536 222c  24", "sha3-256",
-000243c0: 2022 7368 6133 2d33 3834 222c 2022 7368   "sha3-384", "sh
-000243d0: 6133 2d35 3132 225d 0d0a 2020 2020 2020  a3-512"]..      
-000243e0: 2020 2020 2020 6966 2061 6c67 6f72 6974        if algorit
-000243f0: 686d 206e 6f74 2069 6e20 7375 7070 6f72  hm not in suppor
-00024400: 745f 616c 676f 7269 7468 6d3a 0d0a 2020  t_algorithm:..  
-00024410: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00024420: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00024430: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00024440: 616d 655f 5f7d 202d 2067 656e 6572 6174  ame__} - generat
-00024450: 6520 686d 6163 2065 7272 6f72 3a20 616c  e hmac error: al
-00024460: 676f 7269 7468 6d20 6d75 7374 2062 6520  gorithm must be 
-00024470: 6f6e 6520 6f66 3a20 220d 0a20 2020 2020  one of: "..     
-00024480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024490: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-000244a0: 272c 2027 2e6a 6f69 6e28 7375 7070 6f72  ', '.join(suppor
-000244b0: 745f 616c 676f 7269 7468 6d29 7d22 290d  t_algorithm)}").
-000244c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000244d0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-000244e0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000244f0: 2020 2020 2020 2020 7061 796c 6f61 6420          payload 
-00024500: 3d20 6469 6374 2829 0d0a 2020 2020 2020  = dict()..      
-00024510: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00024520: 2020 2020 6966 2062 6174 6368 5f69 6e70      if batch_inp
-00024530: 7574 2069 7320 4e6f 6e65 3a0d 0a20 2020  ut is None:..   
-00024540: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00024550: 6e6f 7420 6973 5f62 6173 6536 3428 696e  not is_base64(in
-00024560: 7075 745f 6461 7461 293a 0d0a 2020 2020  put_data):..    
-00024570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024580: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
-00024590: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
-000245a0: 5f6e 616d 655f 5f7d 202d 2067 656e 6572  _name__} - gener
-000245b0: 6174 6520 686d 6163 2065 7272 6f72 3a20  ate hmac error: 
-000245c0: 7468 6520 696e 7075 745f 6461 7461 206d  the input_data m
-000245d0: 7573 7420 6265 2062 6173 6536 3420 656e  ust be base64 en
-000245e0: 636f 6465 6422 290d 0a20 2020 2020 2020  coded")..       
-000245f0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00024600: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
-00024610: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-00024620: 645b 2269 6e70 7574 225d 203d 2069 6e70  d["input"] = inp
-00024630: 7574 5f64 6174 610d 0a20 2020 2020 2020  ut_data..       
-00024640: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00024650: 2020 2020 2020 2069 6620 6b65 795f 7665         if key_ve
-00024660: 7273 696f 6e20 6973 206e 6f74 204e 6f6e  rsion is not Non
-00024670: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00024680: 2020 2020 6966 206e 6f74 2069 735f 696e      if not is_in
-00024690: 7428 6b65 795f 7665 7273 696f 6e29 3a0d  t(key_version):.
-000246a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000246b0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-000246c0: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
-000246d0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-000246e0: 6765 6e65 7261 7465 2068 6d61 6320 6572  generate hmac er
-000246f0: 726f 723a 2074 6865 206b 6579 5f76 6572  ror: the key_ver
-00024700: 7369 6f6e 206d 7573 7420 6265 2061 6e20  sion must be an 
-00024710: 696e 7465 6765 7222 290d 0a20 2020 2020  integer")..     
-00024720: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00024730: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-00024740: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00024750: 6579 5f76 6572 7369 6f6e 203c 2073 656c  ey_version < sel
-00024760: 662e 7265 6164 5f6b 6579 286d 6f75 6e74  f.read_key(mount
-00024770: 5f70 6174 682c 206e 616d 6529 5b22 6d69  _path, name)["mi
-00024780: 6e5f 656e 6372 7970 7469 6f6e 5f76 6572  n_encryption_ver
-00024790: 7369 6f6e 225d 3a0d 0a20 2020 2020 2020  sion"]:..       
-000247a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000247b0: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-000247c0: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-000247d0: 6d65 5f5f 7d20 2d20 6765 6e65 7261 7465  me__} - generate
-000247e0: 2068 6d61 6320 6572 726f 723a 2067 7265   hmac error: gre
-000247f0: 6174 6572 2074 6861 6e20 6f72 2065 7175  ater than or equ
-00024800: 616c 2074 6f20 7468 6520 6b65 7927 7320  al to the key's 
-00024810: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00024820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024830: 2020 2020 2020 2020 2066 2260 6d69 6e5f           f"`min_
-00024840: 656e 6372 7970 7469 6f6e 5f76 6572 7369  encryption_versi
-00024850: 6f6e 602c 2069 6620 7365 7422 290d 0a20  on`, if set").. 
-00024860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024870: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00024880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024890: 7061 796c 6f61 645b 226b 6579 5f76 6572  payload["key_ver
-000248a0: 7369 6f6e 225d 203d 206b 6579 5f76 6572  sion"] = key_ver
-000248b0: 7369 6f6e 0d0a 2020 2020 2020 2020 2020  sion..          
-000248c0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000248d0: 2020 2020 6966 2062 6174 6368 5f69 6e70      if batch_inp
-000248e0: 7574 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ut is not None:.
-000248f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024900: 2069 6620 7265 6665 7265 6e63 6520 213d   if reference !=
-00024910: 2022 223a 0d0a 2020 2020 2020 2020 2020   "":..          
-00024920: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-00024930: 645b 2272 6566 6572 656e 6365 225d 203d  d["reference"] =
-00024940: 2072 6566 6572 656e 6365 0d0a 2020 2020   reference..    
-00024950: 2020 2020 2020 2020 2020 2020 7061 796c              payl
-00024960: 6f61 645b 2262 6174 6368 5f69 6e70 7574  oad["batch_input
-00024970: 225d 203d 2062 6174 6368 5f69 6e70 7574  "] = batch_input
-00024980: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024990: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-000249a0: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-000249b0: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-000249c0: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-000249d0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-000249e0: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-000249f0: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-00024a00: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-00024a10: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-00024a20: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
-00024a30: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
-00024a40: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-00024a50: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-00024a60: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-00024a70: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-00024a80: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-00024a90: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-00024aa0: 3d20 7265 7175 6573 7473 2e70 6f73 7428  = requests.post(
-00024ab0: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
-00024ac0: 687d 2f68 6d61 632f 7b6e 616d 657d 2f7b  h}/hmac/{name}/{
-00024ad0: 616c 676f 7269 7468 6d7d 222c 200d 0a20  algorithm}", .. 
-00024ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024af0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00024b00: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
-00024b10: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d2c  -Token": token},
-00024b20: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00024b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b40: 2020 2064 6174 613d 6a73 6f6e 2e64 756d     data=json.dum
-00024b50: 7073 2870 6179 6c6f 6164 2929 0d0a 2020  ps(payload))..  
-00024b60: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-00024b70: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-00024b80: 3230 3020 6f72 2072 6573 2e73 7461 7475  200 or res.statu
-00024b90: 735f 636f 6465 203d 3d20 3230 343a 0d0a  s_code == 204:..
-00024ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024bb0: 7265 7475 726e 2072 6573 2e6a 736f 6e28  return res.json(
-00024bc0: 295b 2264 6174 6122 5d0d 0a20 2020 2020  )["data"]..     
-00024bd0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00024be0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00024bf0: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
-00024c00: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
-00024c10: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
-00024c20: 2267 656e 6572 6174 6520 686d 6163 2065  "generate hmac e
-00024c30: 7272 6f72 2229 0d0a 2020 2020 2020 2020  rror")..        
-00024c40: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00024c50: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00024c60: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
-00024c70: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00024c80: 6e65 0d0a 0d0a 2020 2020 2320 544f 444f  ne....    # TODO
-00024c90: 3a20 7761 6974 2066 6f72 2074 6573 7469  : wait for testi
-00024ca0: 6e67 0d0a 2020 2020 6465 6620 7369 676e  ng..    def sign
-00024cb0: 5f64 6174 6128 7365 6c66 2c20 0d0a 2020  _data(self, ..  
-00024cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024cd0: 6d6f 756e 745f 7061 7468 3a20 7374 722c  mount_path: str,
+00023e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e60: 2020 2020 2020 2020 2020 7061 7261 6d65            parame
+00023e70: 7465 7220 6973 2073 6574 2c20 6966 2074  ter is set, if t
+00023e80: 6865 2070 6172 616d 6574 6572 2027 696e  he parameter 'in
+00023e90: 7075 7427 2069 7320 616c 736f 2073 6574  put' is also set
+00023ea0: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+00023eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ed0: 2020 2020 2020 2020 2020 2020 2020 6974                it
+00023ee0: 2077 696c 6c20 6265 2069 676e 6f72 6564   will be ignored
+00023ef0: 2e20 5265 7370 6f6e 7365 7320 6172 6520  . Responses are 
+00023f00: 7265 7475 726e 6564 2069 6e20 7468 6520  returned in the 
+00023f10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f40: 2020 2020 2020 2020 2020 2020 2762 6174              'bat
+00023f50: 6368 5f72 6573 756c 7473 2720 6172 7261  ch_results' arra
+00023f60: 7920 636f 6d70 6f6e 656e 7420 6f66 2074  y component of t
+00023f70: 6865 2027 6461 7461 2720 656c 656d 656e  he 'data' elemen
+00023f80: 7420 0d0a 2020 2020 2020 2020 2020 2020  t ..            
+00023f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fb0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+00023fc0: 2074 6865 2072 6573 706f 6e73 652e 2041   the response. A
+00023fd0: 6e79 2062 6174 6368 206f 7574 7075 7420  ny batch output 
+00023fe0: 7769 6c6c 2070 7265 7365 7276 6520 7468  will preserve th
+00023ff0: 6520 0d0a 2020 2020 2020 2020 2020 2020  e ..            
+00024000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024020: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00024030: 6465 7220 6f66 2074 6865 2062 6174 6368  der of the batch
+00024040: 2069 6e70 7574 2e20 4966 2074 6865 2069   input. If the i
+00024050: 6e70 7574 2064 6174 6120 7661 6c75 6520  nput data value 
+00024060: 6f66 200d 0a20 2020 2020 2020 2020 2020  of ..           
+00024070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024090: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000240a0: 6e20 6974 656d 2069 7320 696e 7661 6c69  n item is invali
+000240b0: 642c 2074 6865 2063 6f72 7265 7370 6f6e  d, the correspon
+000240c0: 6469 6e67 2069 7465 6d20 696e 2074 6865  ding item in the
+000240d0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+000240e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024100: 2020 2020 2020 2020 2020 2020 2027 6261               'ba
+00024110: 7463 685f 7265 7375 6c74 7327 2077 696c  tch_results' wil
+00024120: 6c20 6861 7665 2074 6865 206b 6579 2027  l have the key '
+00024130: 6572 726f 7227 2077 6974 6820 6120 7661  error' with a va
+00024140: 6c75 6520 0d0a 2020 2020 2020 2020 2020  lue ..          
+00024150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024180: 6465 7363 7269 6269 6e67 2074 6865 2065  describing the e
+00024190: 7272 6f72 2e20 4465 6661 756c 7473 2074  rror. Defaults t
+000241a0: 6f20 4e6f 6e65 2e0d 0a0d 0a20 2020 2020  o None.....     
+000241b0: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
+000241c0: 2020 2020 2020 2020 2064 6963 7420 6f72           dict or
+000241d0: 204e 6f6e 653a 2072 6574 7572 6e20 7468   None: return th
+000241e0: 6520 6469 6765 7374 206f 6620 6769 7665  e digest of give
+000241f0: 6e20 6461 7461 2069 6e20 6469 6374 2069  n data in dict i
+00024200: 6620 7375 6363 6573 732c 206f 7468 6572  f success, other
+00024210: 7769 7365 2072 6574 7572 6e20 4e6f 6e65  wise return None
+00024220: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00024230: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00024240: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
+00024250: 2020 2020 2069 6620 696e 7075 745f 6461       if input_da
+00024260: 7461 203d 3d20 2222 2061 6e64 2062 6174  ta == "" and bat
+00024270: 6368 5f69 6e70 7574 2069 7320 4e6f 6e65  ch_input is None
+00024280: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00024290: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+000242a0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+000242b0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 6765  _.__name__} - ge
+000242c0: 6e65 7261 7465 2068 6d61 6320 6572 726f  nerate hmac erro
+000242d0: 723a 204f 6e65 206f 6620 6069 6e70 7574  r: One of `input
+000242e0: 6020 6f72 2060 6261 7463 685f 696e 7075  ` or `batch_inpu
+000242f0: 7460 2022 0d0a 2020 2020 2020 2020 2020  t` "..          
+00024300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024310: 2020 2020 2020 2020 6622 6d75 7374 2062          f"must b
+00024320: 6520 7375 7070 6c69 6564 2229 0d0a 2020  e supplied")..  
+00024330: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00024340: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+00024350: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00024360: 2020 2020 2073 7570 706f 7274 5f61 6c67       support_alg
+00024370: 6f72 6974 686d 203d 205b 2273 6861 322d  orithm = ["sha2-
+00024380: 3232 3422 2c20 2273 6861 322d 3235 3622  224", "sha2-256"
+00024390: 2c20 2273 6861 322d 3338 3422 2c20 2273  , "sha2-384", "s
+000243a0: 6861 322d 3531 3222 2c20 0d0a 2020 2020  ha2-512", ..    
+000243b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000243c0: 2020 2020 2020 2020 2020 2020 2022 7368               "sh
+000243d0: 6133 2d32 3234 222c 2022 7368 6133 2d32  a3-224", "sha3-2
+000243e0: 3536 222c 2022 7368 6133 2d33 3834 222c  56", "sha3-384",
+000243f0: 2022 7368 6133 2d35 3132 225d 0d0a 2020   "sha3-512"]..  
+00024400: 2020 2020 2020 2020 2020 6966 2061 6c67            if alg
+00024410: 6f72 6974 686d 206e 6f74 2069 6e20 7375  orithm not in su
+00024420: 7070 6f72 745f 616c 676f 7269 7468 6d3a  pport_algorithm:
+00024430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024440: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+00024450: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+00024460: 2e5f 5f6e 616d 655f 5f7d 202d 2067 656e  .__name__} - gen
+00024470: 6572 6174 6520 686d 6163 2065 7272 6f72  erate hmac error
+00024480: 3a20 616c 676f 7269 7468 6d20 6d75 7374  : algorithm must
+00024490: 2062 6520 6f6e 6520 6f66 3a20 220d 0a20   be one of: ".. 
+000244a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000244c0: 2066 227b 272c 2027 2e6a 6f69 6e28 7375   f"{', '.join(su
+000244d0: 7070 6f72 745f 616c 676f 7269 7468 6d29  pport_algorithm)
+000244e0: 7d22 290d 0a20 2020 2020 2020 2020 2020  }")..           
+000244f0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00024500: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+00024510: 2020 2020 2020 2020 2020 2020 7061 796c              payl
+00024520: 6f61 6420 3d20 6469 6374 2829 0d0a 2020  oad = dict()..  
+00024530: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00024540: 2020 2020 2020 2020 6966 2062 6174 6368          if batch
+00024550: 5f69 6e70 7574 2069 7320 4e6f 6e65 3a0d  _input is None:.
+00024560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024570: 2069 6620 6e6f 7420 6973 5f62 6173 6536   if not is_base6
+00024580: 3428 696e 7075 745f 6461 7461 293a 0d0a  4(input_data):..
+00024590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000245a0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+000245b0: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+000245c0: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2067  __.__name__} - g
+000245d0: 656e 6572 6174 6520 686d 6163 2065 7272  enerate hmac err
+000245e0: 6f72 3a20 7468 6520 696e 7075 745f 6461  or: the input_da
+000245f0: 7461 206d 7573 7420 6265 2062 6173 6536  ta must be base6
+00024600: 3420 656e 636f 6465 6422 290d 0a20 2020  4 encoded")..   
+00024610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024620: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+00024630: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00024640: 796c 6f61 645b 2269 6e70 7574 225d 203d  yload["input"] =
+00024650: 2069 6e70 7574 5f64 6174 610d 0a20 2020   input_data..   
+00024660: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
+00024670: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
+00024680: 795f 7665 7273 696f 6e20 6973 206e 6f74  y_version is not
+00024690: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000246a0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+000246b0: 735f 696e 7428 6b65 795f 7665 7273 696f  s_int(key_versio
+000246c0: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
+000246d0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+000246e0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+000246f0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00024700: 7d20 2d20 6765 6e65 7261 7465 2068 6d61  } - generate hma
+00024710: 6320 6572 726f 723a 2074 6865 206b 6579  c error: the key
+00024720: 5f76 6572 7369 6f6e 206d 7573 7420 6265  _version must be
+00024730: 2061 6e20 696e 7465 6765 7222 290d 0a20   an integer").. 
+00024740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024750: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+00024760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024770: 6966 206b 6579 5f76 6572 7369 6f6e 203c  if key_version <
+00024780: 2073 656c 662e 7265 6164 5f6b 6579 286d   self.read_key(m
+00024790: 6f75 6e74 5f70 6174 682c 206e 616d 6529  ount_path, name)
+000247a0: 5b22 6d69 6e5f 656e 6372 7970 7469 6f6e  ["min_encryption
+000247b0: 5f76 6572 7369 6f6e 225d 3a0d 0a20 2020  _version"]:..   
+000247c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000247d0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+000247e0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+000247f0: 5f5f 6e61 6d65 5f5f 7d20 2d20 6765 6e65  __name__} - gene
+00024800: 7261 7465 2068 6d61 6320 6572 726f 723a  rate hmac error:
+00024810: 2067 7265 6174 6572 2074 6861 6e20 6f72   greater than or
+00024820: 2065 7175 616c 2074 6f20 7468 6520 6b65   equal to the ke
+00024830: 7927 7320 220d 0a20 2020 2020 2020 2020  y's "..         
+00024840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024850: 2020 2020 2020 2020 2020 2020 2066 2260               f"`
+00024860: 6d69 6e5f 656e 6372 7970 7469 6f6e 5f76  min_encryption_v
+00024870: 6572 7369 6f6e 602c 2069 6620 7365 7422  ersion`, if set"
+00024880: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00024890: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000248a0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+000248b0: 2020 2020 7061 796c 6f61 645b 226b 6579      payload["key
+000248c0: 5f76 6572 7369 6f6e 225d 203d 206b 6579  _version"] = key
+000248d0: 5f76 6572 7369 6f6e 0d0a 2020 2020 2020  _version..      
+000248e0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+000248f0: 2020 2020 2020 2020 6966 2062 6174 6368          if batch
+00024900: 5f69 6e70 7574 2069 7320 6e6f 7420 4e6f  _input is not No
+00024910: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00024920: 2020 2020 2069 6620 7265 6665 7265 6e63       if referenc
+00024930: 6520 213d 2022 223a 0d0a 2020 2020 2020  e != "":..      
+00024940: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00024950: 796c 6f61 645b 2272 6566 6572 656e 6365  yload["reference
+00024960: 225d 203d 2072 6566 6572 656e 6365 0d0a  "] = reference..
+00024970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024980: 7061 796c 6f61 645b 2262 6174 6368 5f69  payload["batch_i
+00024990: 6e70 7574 225d 203d 2062 6174 6368 5f69  nput"] = batch_i
+000249a0: 6e70 7574 0d0a 2020 2020 2020 2020 2020  nput..          
+000249b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000249c0: 2020 2020 7572 6c20 3d20 6165 735f 6465      url = aes_de
+000249d0: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
+000249e0: 7572 6c2c 206b 6579 3d72 616e 646f 6d5f  url, key=random_
+000249f0: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
+00024a00: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
+00024a10: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
+00024a20: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
+00024a30: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00024a40: 746f 6b65 6e20 3d20 6165 735f 6465 6372  token = aes_decr
+00024a50: 7970 745f 7465 7874 2873 656c 662e 746f  ypt_text(self.to
+00024a60: 6b65 6e2c 206b 6579 3d72 616e 646f 6d5f  ken, key=random_
+00024a70: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
+00024a80: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
+00024a90: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
+00024aa0: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
+00024ab0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00024ac0: 7265 7320 3d20 7265 7175 6573 7473 2e70  res = requests.p
+00024ad0: 6f73 7428 7572 6c2b 6622 7b6d 6f75 6e74  ost(url+f"{mount
+00024ae0: 5f70 6174 687d 2f68 6d61 632f 7b6e 616d  _path}/hmac/{nam
+00024af0: 657d 2f7b 616c 676f 7269 7468 6d7d 222c  e}/{algorithm}",
+00024b00: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00024b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b20: 2020 2068 6561 6465 7273 3d7b 2258 2d56     headers={"X-V
+00024b30: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
+00024b40: 656e 7d2c 200d 0a20 2020 2020 2020 2020  en}, ..         
+00024b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b60: 2020 2020 2020 2064 6174 613d 6a73 6f6e         data=json
+00024b70: 2e64 756d 7073 2870 6179 6c6f 6164 2929  .dumps(payload))
+00024b80: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00024b90: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
+00024ba0: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
+00024bb0: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+00024bc0: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
+00024bd0: 2020 2020 7265 7475 726e 2072 6573 2e6a      return res.j
+00024be0: 736f 6e28 295b 2264 6174 6122 5d0d 0a20  son()["data"].. 
+00024bf0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00024c00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024c10: 2020 7365 6c66 2e5f 6c6f 675f 6572 726f    self._log_erro
+00024c20: 725f 7265 7370 6f6e 7365 285f 5f63 6c61  r_response(__cla
+00024c30: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
+00024c40: 6573 2c20 2267 656e 6572 6174 6520 686d  es, "generate hm
+00024c50: 6163 2065 7272 6f72 2229 0d0a 2020 2020  ac error")..    
+00024c60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00024c70: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+00024c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024c90: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
+00024ca0: 6e20 4e6f 6e65 0d0a 0d0a 2020 2020 2320  n None....    # 
+00024cb0: 544f 444f 3a20 7761 6974 2066 6f72 2074  TODO: wait for t
+00024cc0: 6573 7469 6e67 0d0a 2020 2020 6465 6620  esting..    def 
+00024cd0: 7369 676e 5f64 6174 6128 7365 6c66 2c20  sign_data(self, 
 00024ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024cf0: 2020 2020 6e61 6d65 3a20 7374 722c 0d0a      name: str,..
-00024d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d10: 2020 6b65 795f 7665 7273 696f 6e3a 204f    key_version: O
-00024d20: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-00024d30: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-00024d40: 2020 2020 2020 2020 6861 7368 5f61 6c67          hash_alg
-00024d50: 6f72 6974 686d 3a20 7374 7220 3d20 2273  orithm: str = "s
-00024d60: 6861 322d 3235 3622 2c0d 0a20 2020 2020  ha2-256",..     
-00024d70: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
-00024d80: 7574 5f64 6174 613a 2073 7472 203d 2022  ut_data: str = "
-00024d90: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00024da0: 2020 2020 2020 7265 6665 7265 6e63 653a        reference:
-00024db0: 2073 7472 203d 2022 222c 0d0a 2020 2020   str = "",..    
-00024dc0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-00024dd0: 7463 685f 696e 7075 743a 204f 7074 696f  tch_input: Optio
-00024de0: 6e61 6c5b 4c69 7374 5b64 6963 745d 5d20  nal[List[dict]] 
-00024df0: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
-00024e00: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
-00024e10: 7874 3a20 7374 7220 3d20 2222 2c0d 0a20  xt: str = "",.. 
-00024e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e30: 2070 7265 6861 7368 6564 3a20 626f 6f6c   prehashed: bool
-00024e40: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-00024e50: 2020 2020 2020 2020 2020 2020 2073 6967               sig
-00024e60: 6e61 7475 7265 5f61 6c67 6f72 6974 686d  nature_algorithm
-00024e70: 3a20 7374 7220 3d20 2222 2c0d 0a20 2020  : str = "",..   
-00024e80: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00024e90: 6172 7368 616c 696e 675f 616c 676f 7269  arshaling_algori
-00024ea0: 7468 6d3a 2073 7472 203d 2022 222c 0d0a  thm: str = "",..
-00024eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ec0: 2020 7361 6c74 5f6c 656e 6774 683a 2073    salt_length: s
-00024ed0: 7472 203d 2022 2229 3a0d 0a20 2020 2020  tr = ""):..     
-00024ee0: 2020 2022 2222 7265 7475 726e 2074 6865     """return the
-00024ef0: 2063 7279 7074 6f67 7261 7068 6963 2073   cryptographic s
-00024f00: 6967 6e61 7475 7265 206f 6620 7468 6520  ignature of the 
-00024f10: 6769 7665 6e20 6461 7461 2075 7369 6e67  given data using
-00024f20: 2074 6865 206e 616d 6564 206b 6579 2061   the named key a
-00024f30: 6e64 2074 6865 2073 7065 6369 6669 6564  nd the specified
-00024f40: 2068 6173 6820 616c 676f 7269 7468 6d0d   hash algorithm.
-00024f50: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00024f60: 2020 2052 6566 6572 2074 6f20 6874 7470     Refer to http
-00024f70: 733a 2f2f 6465 7665 6c6f 7065 722e 6861  s://developer.ha
-00024f80: 7368 6963 6f72 702e 636f 6d2f 7661 756c  shicorp.com/vaul
-00024f90: 742f 6170 692d 646f 6373 2f73 6563 7265  t/api-docs/secre
-00024fa0: 742f 7472 616e 7369 7423 7369 676e 2d64  t/transit#sign-d
-00024fb0: 6174 6120 666f 7220 6d6f 7265 2064 6574  ata for more det
-00024fc0: 6169 6c73 2e0d 0a0d 0a20 2020 2020 2020  ails.....       
-00024fd0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00024fe0: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-00024ff0: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-00025000: 2020 6e61 6d65 2028 7374 7229 3a20 5370    name (str): Sp
-00025010: 6563 6966 6965 7320 7468 6520 6e61 6d65  ecifies the name
-00025020: 206f 6620 7468 6520 656e 6372 7970 7469   of the encrypti
-00025030: 6f6e 206b 6579 2074 6f20 7573 6520 666f  on key to use fo
-00025040: 7220 7369 676e 696e 672e 0d0a 2020 2020  r signing...    
-00025050: 2020 2020 2020 2020 6b65 795f 7665 7273          key_vers
-00025060: 696f 6e20 284f 7074 696f 6e61 6c5b 696e  ion (Optional[in
-00025070: 745d 2c20 6f70 7469 6f6e 616c 293a 2053  t], optional): S
-00025080: 7065 6369 6669 6573 2074 6865 2076 6572  pecifies the ver
-00025090: 7369 6f6e 206f 6620 7468 6520 6b65 7920  sion of the key 
-000250a0: 746f 2075 7365 2066 6f72 2073 6967 6e69  to use for signi
-000250b0: 6e67 2e20 0d0a 2020 2020 2020 2020 2020  ng. ..          
-000250c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000250d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000250e0: 2020 2020 2020 2020 2049 6620 6e6f 7420           If not 
-000250f0: 7365 742c 2075 7365 7320 7468 6520 6c61  set, uses the la
-00025100: 7465 7374 2076 6572 7369 6f6e 2e20 4d75  test version. Mu
-00025110: 7374 2062 6520 6772 6561 7465 7220 0d0a  st be greater ..
-00025120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025150: 2020 2074 6861 6e20 6f72 2065 7175 616c     than or equal
-00025160: 2074 6f20 7468 6520 6b65 7927 7320 606d   to the key's `m
-00025170: 696e 5f65 6e63 7279 7074 696f 6e5f 7665  in_encryption_ve
-00025180: 7273 696f 6e60 2c20 0d0a 2020 2020 2020  rsion`, ..      
-00025190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000251c0: 7365 742e 2044 6566 6175 6c74 7320 746f  set. Defaults to
-000251d0: 204e 6f6e 652e 0d0a 2020 2020 2020 2020   None...        
-000251e0: 2020 2020 6861 7368 5f61 6c67 6f72 6974      hash_algorit
-000251f0: 686d 2028 7374 722c 206f 7074 696f 6e61  hm (str, optiona
-00025200: 6c29 3a20 5370 6563 6966 6965 7320 7468  l): Specifies th
-00025210: 6520 6861 7368 2061 6c67 6f72 6974 686d  e hash algorithm
-00025220: 2074 6f20 7573 6520 666f 7220 7375 7070   to use for supp
-00025230: 6f72 7469 6e67 206b 6579 2074 7970 6573  orting key types
-00025240: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00025250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025260: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00025270: 6e6f 7461 626c 792c 206e 6f74 2069 6e63  notably, not inc
-00025280: 6c75 6469 6e67 2060 6564 3235 3531 3960  luding `ed25519`
-00025290: 2077 6869 6368 2073 7065 6369 6669 6573   which specifies
-000252a0: 2069 7473 206f 776e 2068 6173 6820 0d0a   its own hash ..
-000252b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000252c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000252d0: 2020 2020 2020 2020 2020 2020 616c 676f              algo
-000252e0: 7269 7468 6d29 2e20 5468 6973 2063 616e  rithm). This can
-000252f0: 2061 6c73 6f20 6265 2073 7065 6369 6669   also be specifi
-00025300: 6564 2061 7320 7061 7274 206f 6620 7468  ed as part of th
-00025310: 6520 5552 4c2e 200d 0a20 2020 2020 2020  e URL. ..       
-00025320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025340: 2020 2020 2043 7572 7265 6e74 6c79 2d73       Currently-s
-00025350: 7570 706f 7274 6564 2061 6c67 6f72 6974  upported algorit
-00025360: 686d 7320 6172 653a 2073 6861 312c 2073  hms are: sha1, s
-00025370: 6861 322d 3232 342c 2073 6861 322d 3235  ha2-224, sha2-25
-00025380: 362c 200d 0a20 2020 2020 2020 2020 2020  6, ..           
-00025390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253b0: 2073 6861 322d 3338 342c 2073 6861 322d   sha2-384, sha2-
-000253c0: 3531 322c 2073 6861 332d 3232 342c 2073  512, sha3-224, s
-000253d0: 6861 332d 3338 342c 2073 6861 332d 3531  ha3-384, sha3-51
-000253e0: 322c 206e 6f6e 652e 2044 6566 6175 6c74  2, none. Default
-000253f0: 7320 0d0a 2020 2020 2020 2020 2020 2020  s ..            
-00025400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025420: 746f 2022 7368 6132 2d32 3536 222e 0d0a  to "sha2-256"...
-00025430: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00025440: 745f 6461 7461 2028 7374 722c 206f 7074  t_data (str, opt
-00025450: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
-00025460: 7320 7468 6520 6261 7365 3634 2065 6e63  s the base64 enc
-00025470: 6f64 6564 2069 6e70 7574 2064 6174 612e  oded input data.
-00025480: 204f 6e65 206f 6620 6069 6e70 7574 6020   One of `input` 
-00025490: 6f72 2060 6261 7463 685f 696e 7075 7460  or `batch_input`
-000254a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-000254b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000254c0: 2020 2020 2020 2020 2020 206d 7573 7420             must 
-000254d0: 6265 2073 7570 706c 6965 642e 2044 6566  be supplied. Def
-000254e0: 6175 6c74 7320 746f 2022 222e 0d0a 2020  aults to ""...  
-000254f0: 2020 2020 2020 2020 2020 7265 6665 7265            refere
-00025500: 6e63 6520 2873 7472 2c20 6f70 7469 6f6e  nce (str, option
-00025510: 616c 293a 2041 2075 7365 722d 7375 7070  al): A user-supp
-00025520: 6c69 6564 2073 7472 696e 6720 7468 6174  lied string that
-00025530: 2077 696c 6c20 6265 2070 7265 7365 6e74   will be present
-00025540: 2069 6e20 7468 6520 6072 6566 6572 656e   in the `referen
-00025550: 6365 6020 6669 656c 6420 0d0a 2020 2020  ce` field ..    
-00025560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025580: 2020 206f 6e20 7468 6520 636f 7272 6573     on the corres
-00025590: 706f 6e64 696e 6720 6062 6174 6368 5f72  ponding `batch_r
-000255a0: 6573 756c 7473 6020 6974 656d 2069 6e20  esults` item in 
-000255b0: 7468 6520 7265 7370 6f6e 7365 2c20 746f  the response, to
-000255c0: 2061 7373 6973 7420 0d0a 2020 2020 2020   assist ..      
-000255d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000255e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000255f0: 2069 6e20 756e 6465 7273 7461 6e64 696e   in understandin
-00025600: 6720 7768 6963 6820 7265 7375 6c74 2063  g which result c
-00025610: 6f72 7265 7370 6f6e 6473 2074 6f20 6120  orresponds to a 
-00025620: 7061 7274 6963 756c 6172 2069 6e70 7574  particular input
-00025630: 2e20 4f6e 6c79 200d 0a20 2020 2020 2020  . Only ..       
-00025640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025660: 7661 6c69 6420 6f6e 2062 6174 6368 2072  valid on batch r
-00025670: 6571 7565 7374 7320 7768 656e 2075 7369  equests when usi
-00025680: 6e67 20e2 8098 6261 7463 685f 696e 7075  ng ...batch_inpu
-00025690: 74e2 8099 2062 656c 6f77 2e2e 2044 6566  t... below.. Def
-000256a0: 6175 6c74 7320 746f 2022 222e 0d0a 2020  aults to ""...  
-000256b0: 2020 2020 2020 2020 2020 6261 7463 685f            batch_
-000256c0: 696e 7075 7420 284f 7074 696f 6e61 6c5b  input (Optional[
-000256d0: 4c69 7374 5b64 6963 745d 5d2c 206f 7074  List[dict]], opt
-000256e0: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
-000256f0: 7320 6120 6c69 7374 206f 6620 6974 656d  s a list of item
-00025700: 7320 666f 7220 7072 6f63 6573 7369 6e67  s for processing
-00025710: 2e20 5768 656e 2074 6869 7320 0d0a 2020  . When this ..  
-00025720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025750: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
-00025760: 7220 6973 2073 6574 2c20 616e 7920 7375  r is set, any su
-00025770: 7070 6c69 6564 2027 696e 7075 7427 206f  pplied 'input' o
-00025780: 7220 2763 6f6e 7465 7874 2720 0d0a 2020  r 'context' ..  
-00025790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000257a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000257b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000257c0: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
-000257d0: 7273 2077 696c 6c20 6265 2069 676e 6f72  rs will be ignor
-000257e0: 6564 2e20 5265 7370 6f6e 7365 7320 6172  ed. Responses ar
-000257f0: 6520 7265 7475 726e 6564 200d 0a20 2020  e returned ..   
-00025800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025830: 2020 2020 2020 2069 6e20 7468 6520 2762         in the 'b
-00025840: 6174 6368 5f72 6573 756c 7473 2720 6172  atch_results' ar
-00025850: 7261 7920 636f 6d70 6f6e 656e 7420 6f66  ray component of
-00025860: 2074 6865 2027 6461 7461 2720 0d0a 2020   the 'data' ..  
-00025870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000258a0: 2020 2020 2020 2020 656c 656d 656e 7420          element 
-000258b0: 6f66 2074 6865 2072 6573 706f 6e73 652e  of the response.
-000258c0: 2041 6e79 2062 6174 6368 206f 7574 7075   Any batch outpu
-000258d0: 7420 7769 6c6c 2070 7265 7365 7276 6520  t will preserve 
-000258e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000258f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025910: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00025920: 6f72 6465 7220 6f66 2074 6865 2062 6174  order of the bat
-00025930: 6368 2069 6e70 7574 2e20 4966 2074 6865  ch input. If the
-00025940: 2069 6e70 7574 2064 6174 6120 7661 6c75   input data valu
-00025950: 6520 0d0a 2020 2020 2020 2020 2020 2020  e ..            
-00025960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025980: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-00025990: 2061 6e20 6974 656d 2069 7320 696e 7661   an item is inva
-000259a0: 6c69 642c 2074 6865 2063 6f72 7265 7370  lid, the corresp
-000259b0: 6f6e 6469 6e67 2069 7465 6d20 696e 2074  onding item in t
-000259c0: 6865 200d 0a20 2020 2020 2020 2020 2020  he ..           
-000259d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000259e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000259f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00025a00: 6261 7463 685f 7265 7375 6c74 7327 2077  batch_results' w
-00025a10: 696c 6c20 6861 7665 2074 6865 206b 6579  ill have the key
-00025a20: 2027 6572 726f 7227 2077 6974 6820 6120   'error' with a 
-00025a30: 7661 6c75 6520 0d0a 2020 2020 2020 2020  value ..        
-00025a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024cf0: 2020 2020 6d6f 756e 745f 7061 7468 3a20      mount_path: 
+00024d00: 7374 722c 0d0a 2020 2020 2020 2020 2020  str,..          
+00024d10: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
+00024d20: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+00024d30: 2020 2020 2020 6b65 795f 7665 7273 696f        key_versio
+00024d40: 6e3a 204f 7074 696f 6e61 6c5b 696e 745d  n: Optional[int]
+00024d50: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
+00024d60: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00024d70: 5f61 6c67 6f72 6974 686d 3a20 7374 7220  _algorithm: str 
+00024d80: 3d20 2273 6861 322d 3235 3622 2c0d 0a20  = "sha2-256",.. 
+00024d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024da0: 2069 6e70 7574 5f64 6174 613a 2073 7472   input_data: str
+00024db0: 203d 2022 222c 0d0a 2020 2020 2020 2020   = "",..        
+00024dc0: 2020 2020 2020 2020 2020 7265 6665 7265            refere
+00024dd0: 6e63 653a 2073 7472 203d 2022 222c 0d0a  nce: str = "",..
+00024de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024df0: 2020 6261 7463 685f 696e 7075 743a 204f    batch_input: O
+00024e00: 7074 696f 6e61 6c5b 4c69 7374 5b64 6963  ptional[List[dic
+00024e10: 745d 5d20 3d20 4e6f 6e65 2c0d 0a20 2020  t]] = None,..   
+00024e20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00024e30: 6f6e 7465 7874 3a20 7374 7220 3d20 2222  ontext: str = ""
+00024e40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00024e50: 2020 2020 2070 7265 6861 7368 6564 3a20       prehashed: 
+00024e60: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+00024e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e80: 2073 6967 6e61 7475 7265 5f61 6c67 6f72   signature_algor
+00024e90: 6974 686d 3a20 7374 7220 3d20 2222 2c0d  ithm: str = "",.
+00024ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024eb0: 2020 206d 6172 7368 616c 696e 675f 616c     marshaling_al
+00024ec0: 676f 7269 7468 6d3a 2073 7472 203d 2022  gorithm: str = "
+00024ed0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00024ee0: 2020 2020 2020 7361 6c74 5f6c 656e 6774        salt_lengt
+00024ef0: 683a 2073 7472 203d 2022 2229 3a0d 0a20  h: str = ""):.. 
+00024f00: 2020 2020 2020 2022 2222 7265 7475 726e         """return
+00024f10: 2074 6865 2063 7279 7074 6f67 7261 7068   the cryptograph
+00024f20: 6963 2073 6967 6e61 7475 7265 206f 6620  ic signature of 
+00024f30: 7468 6520 6769 7665 6e20 6461 7461 2075  the given data u
+00024f40: 7369 6e67 2074 6865 206e 616d 6564 206b  sing the named k
+00024f50: 6579 2061 6e64 2074 6865 2073 7065 6369  ey and the speci
+00024f60: 6669 6564 2068 6173 6820 616c 676f 7269  fied hash algori
+00024f70: 7468 6d0d 0a20 2020 2020 2020 200d 0a20  thm..        .. 
+00024f80: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
+00024f90: 6874 7470 733a 2f2f 6465 7665 6c6f 7065  https://develope
+00024fa0: 722e 6861 7368 6963 6f72 702e 636f 6d2f  r.hashicorp.com/
+00024fb0: 7661 756c 742f 6170 692d 646f 6373 2f73  vault/api-docs/s
+00024fc0: 6563 7265 742f 7472 616e 7369 7423 7369  ecret/transit#si
+00024fd0: 676e 2d64 6174 6120 666f 7220 6d6f 7265  gn-data for more
+00024fe0: 2064 6574 6169 6c73 2e0d 0a0d 0a20 2020   details.....   
+00024ff0: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
+00025000: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+00025010: 7468 2028 7374 7229 0d0a 2020 2020 2020  th (str)..      
+00025020: 2020 2020 2020 6e61 6d65 2028 7374 7229        name (str)
+00025030: 3a20 5370 6563 6966 6965 7320 7468 6520  : Specifies the 
+00025040: 6e61 6d65 206f 6620 7468 6520 656e 6372  name of the encr
+00025050: 7970 7469 6f6e 206b 6579 2074 6f20 7573  yption key to us
+00025060: 6520 666f 7220 7369 676e 696e 672e 0d0a  e for signing...
+00025070: 2020 2020 2020 2020 2020 2020 6b65 795f              key_
+00025080: 7665 7273 696f 6e20 284f 7074 696f 6e61  version (Optiona
+00025090: 6c5b 696e 745d 2c20 6f70 7469 6f6e 616c  l[int], optional
+000250a0: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
+000250b0: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+000250c0: 6b65 7920 746f 2075 7365 2066 6f72 2073  key to use for s
+000250d0: 6967 6e69 6e67 2e20 0d0a 2020 2020 2020  igning. ..      
+000250e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000250f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025100: 2020 2020 2020 2020 2020 2020 2049 6620               If 
+00025110: 6e6f 7420 7365 742c 2075 7365 7320 7468  not set, uses th
+00025120: 6520 6c61 7465 7374 2076 6572 7369 6f6e  e latest version
+00025130: 2e20 4d75 7374 2062 6520 6772 6561 7465  . Must be greate
+00025140: 7220 0d0a 2020 2020 2020 2020 2020 2020  r ..            
+00025150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025170: 2020 2020 2020 2074 6861 6e20 6f72 2065         than or e
+00025180: 7175 616c 2074 6f20 7468 6520 6b65 7927  qual to the key'
+00025190: 7320 606d 696e 5f65 6e63 7279 7074 696f  s `min_encryptio
+000251a0: 6e5f 7665 7273 696f 6e60 2c20 0d0a 2020  n_version`, ..  
+000251b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251e0: 2069 6620 7365 742e 2044 6566 6175 6c74   if set. Default
+000251f0: 7320 746f 204e 6f6e 652e 0d0a 2020 2020  s to None...    
+00025200: 2020 2020 2020 2020 6861 7368 5f61 6c67          hash_alg
+00025210: 6f72 6974 686d 2028 7374 722c 206f 7074  orithm (str, opt
+00025220: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
+00025230: 7320 7468 6520 6861 7368 2061 6c67 6f72  s the hash algor
+00025240: 6974 686d 2074 6f20 7573 6520 666f 7220  ithm to use for 
+00025250: 7375 7070 6f72 7469 6e67 206b 6579 2074  supporting key t
+00025260: 7970 6573 200d 0a20 2020 2020 2020 2020  ypes ..         
+00025270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025290: 2020 2028 6e6f 7461 626c 792c 206e 6f74     (notably, not
+000252a0: 2069 6e63 6c75 6469 6e67 2060 6564 3235   including `ed25
+000252b0: 3531 3960 2077 6869 6368 2073 7065 6369  519` which speci
+000252c0: 6669 6573 2069 7473 206f 776e 2068 6173  fies its own has
+000252d0: 6820 0d0a 2020 2020 2020 2020 2020 2020  h ..            
+000252e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000252f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025300: 616c 676f 7269 7468 6d29 2e20 5468 6973  algorithm). This
+00025310: 2063 616e 2061 6c73 6f20 6265 2073 7065   can also be spe
+00025320: 6369 6669 6564 2061 7320 7061 7274 206f  cified as part o
+00025330: 6620 7468 6520 5552 4c2e 200d 0a20 2020  f the URL. ..   
+00025340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025360: 2020 2020 2020 2020 2043 7572 7265 6e74           Current
+00025370: 6c79 2d73 7570 706f 7274 6564 2061 6c67  ly-supported alg
+00025380: 6f72 6974 686d 7320 6172 653a 2073 6861  orithms are: sha
+00025390: 312c 2073 6861 322d 3232 342c 2073 6861  1, sha2-224, sha
+000253a0: 322d 3235 362c 200d 0a20 2020 2020 2020  2-256, ..       
+000253b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253d0: 2020 2020 2073 6861 322d 3338 342c 2073       sha2-384, s
+000253e0: 6861 322d 3531 322c 2073 6861 332d 3232  ha2-512, sha3-22
+000253f0: 342c 2073 6861 332d 3338 342c 2073 6861  4, sha3-384, sha
+00025400: 332d 3531 322c 206e 6f6e 652e 2044 6566  3-512, none. Def
+00025410: 6175 6c74 7320 0d0a 2020 2020 2020 2020  aults ..        
+00025420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025440: 2020 2020 746f 2022 7368 6132 2d32 3536      to "sha2-256
+00025450: 222e 0d0a 2020 2020 2020 2020 2020 2020  "...            
+00025460: 696e 7075 745f 6461 7461 2028 7374 722c  input_data (str,
+00025470: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
+00025480: 6966 6965 7320 7468 6520 6261 7365 3634  ifies the base64
+00025490: 2065 6e63 6f64 6564 2069 6e70 7574 2064   encoded input d
+000254a0: 6174 612e 204f 6e65 206f 6620 6069 6e70  ata. One of `inp
+000254b0: 7574 6020 6f72 2060 6261 7463 685f 696e  ut` or `batch_in
+000254c0: 7075 7460 200d 0a20 2020 2020 2020 2020  put` ..         
+000254d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000254f0: 7573 7420 6265 2073 7570 706c 6965 642e  ust be supplied.
+00025500: 2044 6566 6175 6c74 7320 746f 2022 222e   Defaults to "".
+00025510: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00025520: 6665 7265 6e63 6520 2873 7472 2c20 6f70  ference (str, op
+00025530: 7469 6f6e 616c 293a 2041 2075 7365 722d  tional): A user-
+00025540: 7375 7070 6c69 6564 2073 7472 696e 6720  supplied string 
+00025550: 7468 6174 2077 696c 6c20 6265 2070 7265  that will be pre
+00025560: 7365 6e74 2069 6e20 7468 6520 6072 6566  sent in the `ref
+00025570: 6572 656e 6365 6020 6669 656c 6420 0d0a  erence` field ..
+00025580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255a0: 2020 2020 2020 206f 6e20 7468 6520 636f         on the co
+000255b0: 7272 6573 706f 6e64 696e 6720 6062 6174  rresponding `bat
+000255c0: 6368 5f72 6573 756c 7473 6020 6974 656d  ch_results` item
+000255d0: 2069 6e20 7468 6520 7265 7370 6f6e 7365   in the response
+000255e0: 2c20 746f 2061 7373 6973 7420 0d0a 2020  , to assist ..  
+000255f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025610: 2020 2020 2069 6e20 756e 6465 7273 7461       in understa
+00025620: 6e64 696e 6720 7768 6963 6820 7265 7375  nding which resu
+00025630: 6c74 2063 6f72 7265 7370 6f6e 6473 2074  lt corresponds t
+00025640: 6f20 6120 7061 7274 6963 756c 6172 2069  o a particular i
+00025650: 6e70 7574 2e20 4f6e 6c79 200d 0a20 2020  nput. Only ..   
+00025660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025680: 2020 2020 7661 6c69 6420 6f6e 2062 6174      valid on bat
+00025690: 6368 2072 6571 7565 7374 7320 7768 656e  ch requests when
+000256a0: 2075 7369 6e67 20e2 8098 6261 7463 685f   using ...batch_
+000256b0: 696e 7075 74e2 8099 2062 656c 6f77 2e2e  input... below..
+000256c0: 2044 6566 6175 6c74 7320 746f 2022 222e   Defaults to "".
+000256d0: 0d0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
+000256e0: 7463 685f 696e 7075 7420 284f 7074 696f  tch_input (Optio
+000256f0: 6e61 6c5b 4c69 7374 5b64 6963 745d 5d2c  nal[List[dict]],
+00025700: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
+00025710: 6966 6965 7320 6120 6c69 7374 206f 6620  ifies a list of 
+00025720: 6974 656d 7320 666f 7220 7072 6f63 6573  items for proces
+00025730: 7369 6e67 2e20 5768 656e 2074 6869 7320  sing. When this 
+00025740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025770: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00025780: 6d65 7465 7220 6973 2073 6574 2c20 616e  meter is set, an
+00025790: 7920 7375 7070 6c69 6564 2027 696e 7075  y supplied 'inpu
+000257a0: 7427 206f 7220 2763 6f6e 7465 7874 2720  t' or 'context' 
+000257b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000257c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257e0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+000257f0: 6d65 7465 7273 2077 696c 6c20 6265 2069  meters will be i
+00025800: 676e 6f72 6564 2e20 5265 7370 6f6e 7365  gnored. Response
+00025810: 7320 6172 6520 7265 7475 726e 6564 200d  s are returned .
+00025820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025850: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
+00025860: 6520 2762 6174 6368 5f72 6573 756c 7473  e 'batch_results
+00025870: 2720 6172 7261 7920 636f 6d70 6f6e 656e  ' array componen
+00025880: 7420 6f66 2074 6865 2027 6461 7461 2720  t of the 'data' 
+00025890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000258a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000258b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000258c0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+000258d0: 656e 7420 6f66 2074 6865 2072 6573 706f  ent of the respo
+000258e0: 6e73 652e 2041 6e79 2062 6174 6368 206f  nse. Any batch o
+000258f0: 7574 7075 7420 7769 6c6c 2070 7265 7365  utput will prese
+00025900: 7276 6520 0d0a 2020 2020 2020 2020 2020  rve ..          
+00025910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025940: 7468 6520 6f72 6465 7220 6f66 2074 6865  the order of the
+00025950: 2062 6174 6368 2069 6e70 7574 2e20 4966   batch input. If
+00025960: 2074 6865 2069 6e70 7574 2064 6174 6120   the input data 
+00025970: 7661 6c75 6520 0d0a 2020 2020 2020 2020  value ..        
+00025980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000259a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000259b0: 2020 6f66 2061 6e20 6974 656d 2069 7320    of an item is 
+000259c0: 696e 7661 6c69 642c 2074 6865 2063 6f72  invalid, the cor
+000259d0: 7265 7370 6f6e 6469 6e67 2069 7465 6d20  responding item 
+000259e0: 696e 2074 6865 200d 0a20 2020 2020 2020  in the ..       
+000259f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a20: 2020 2027 6261 7463 685f 7265 7375 6c74     'batch_result
+00025a30: 7327 2077 696c 6c20 6861 7665 2074 6865  s' will have the
+00025a40: 206b 6579 2027 6572 726f 7227 2077 6974   key 'error' wit
+00025a50: 6820 6120 7661 6c75 6520 0d0a 2020 2020  h a value ..    
 00025a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a70: 2020 6465 7363 7269 6269 6e67 2074 6865    describing the
-00025a80: 2065 7272 6f72 2e20 4465 6661 756c 7473   error. Defaults
-00025a90: 2074 6f20 4e6f 6e65 2e0d 0a20 2020 2020   to None...     
-00025aa0: 2020 2020 2020 2063 6f6e 7465 7874 2028         context (
-00025ab0: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
-00025ac0: 4261 7365 3634 2065 6e63 6f64 6564 2063  Base64 encoded c
-00025ad0: 6f6e 7465 7874 2066 6f72 206b 6579 2064  ontext for key d
-00025ae0: 6572 6976 6174 696f 6e2e 2052 6571 7569  erivation. Requi
-00025af0: 7265 6420 6966 206b 6579 2064 6572 6976  red if key deriv
-00025b00: 6174 696f 6e20 6973 200d 0a20 2020 2020  ation is ..     
-00025b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b30: 656e 6162 6c65 643b 2063 7572 7265 6e74  enabled; current
-00025b40: 6c79 206f 6e6c 7920 6176 6169 6c61 626c  ly only availabl
-00025b50: 6520 7769 7468 2065 6432 3535 3139 206b  e with ed25519 k
-00025b60: 6579 732e 2044 6566 6175 6c74 7320 746f  eys. Defaults to
-00025b70: 2022 222e 0d0a 2020 2020 2020 2020 2020   ""...          
-00025b80: 2020 7072 6568 6173 6865 6420 2862 6f6f    prehashed (boo
-00025b90: 6c2c 206f 7074 696f 6e61 6c29 3a20 5365  l, optional): Se
-00025ba0: 7420 746f 2060 7472 7565 6020 7768 656e  t to `true` when
-00025bb0: 2074 6865 2069 6e70 7574 2069 7320 616c   the input is al
-00025bc0: 7265 6164 7920 6861 7368 6564 2e20 4966  ready hashed. If
-00025bd0: 2074 6865 206b 6579 2074 7970 6520 6973   the key type is
-00025be0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00025bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c00: 2020 2020 2020 2020 2020 2060 7273 612d             `rsa-
-00025c10: 3230 3438 602c 2060 7273 612d 3330 3732  2048`, `rsa-3072
-00025c20: 6020 6f72 2060 7273 612d 3430 3936 602c  ` or `rsa-4096`,
-00025c30: 2074 6865 6e20 7468 6520 616c 676f 7269   then the algori
-00025c40: 7468 6d20 7573 6564 2074 6f20 6861 7368  thm used to hash
-00025c50: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00025c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c70: 2020 2020 2020 2020 2020 2074 6865 2069             the i
-00025c80: 6e70 7574 2073 686f 756c 6420 6265 2069  nput should be i
-00025c90: 6e64 6963 6174 6564 2062 7920 7468 6520  ndicated by the 
-00025ca0: 6068 6173 685f 616c 676f 7269 7468 6d60  `hash_algorithm`
-00025cb0: 2070 6172 616d 6574 6572 2e20 4a75 7374   parameter. Just
-00025cc0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00025cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ce0: 2020 2020 2020 2020 2020 2061 7320 7468             as th
-00025cf0: 6520 7661 6c75 6520 746f 2073 6967 6e20  e value to sign 
-00025d00: 7368 6f75 6c64 2062 6520 7468 6520 6261  should be the ba
-00025d10: 7365 3634 2d65 6e63 6f64 6564 2072 6570  se64-encoded rep
-00025d20: 7265 7365 6e74 6174 696f 6e20 6f66 200d  resentation of .
-00025d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d50: 2020 2020 2020 2020 2074 6865 2065 7861           the exa
-00025d60: 6374 2062 696e 6172 7920 6461 7461 2079  ct binary data y
-00025d70: 6f75 2077 616e 7420 7369 676e 6564 2c20  ou want signed, 
-00025d80: 7768 656e 2073 6574 2c20 6069 6e70 7574  when set, `input
-00025d90: 6020 6973 2065 7870 6563 7465 6420 0d0a  ` is expected ..
-00025da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025dc0: 2020 2020 2020 2020 746f 2062 6520 6261          to be ba
-00025dd0: 7365 3634 2d65 6e63 6f64 6564 2062 696e  se64-encoded bin
-00025de0: 6172 7920 6861 7368 6564 2064 6174 612c  ary hashed data,
-00025df0: 206e 6f74 2068 6578 2d66 6f72 6d61 7474   not hex-formatt
-00025e00: 6564 2e20 2841 7320 616e 200d 0a20 2020  ed. (As an ..   
-00025e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e30: 2020 2020 2065 7861 6d70 6c65 2c20 6f6e       example, on
-00025e40: 2074 6865 2063 6f6d 6d61 6e64 206c 696e   the command lin
-00025e50: 652c 2079 6f75 2063 6f75 6c64 2067 656e  e, you could gen
-00025e60: 6572 6174 6520 6120 7375 6974 6162 6c65  erate a suitable
-00025e70: 2069 6e70 7574 2076 6961 200d 0a20 2020   input via ..   
-00025e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ea0: 2020 2020 2060 6f70 656e 7373 6c20 6467       `openssl dg
-00025eb0: 7374 202d 7368 6132 3536 202d 6269 6e61  st -sha256 -bina
-00025ec0: 7279 207c 2062 6173 6536 3460 2e29 2e20  ry | base64`.). 
-00025ed0: 4465 6661 756c 7473 2074 6f20 4661 6c73  Defaults to Fals
-00025ee0: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
-00025ef0: 7369 676e 6174 7572 655f 616c 676f 7269  signature_algori
-00025f00: 7468 6d20 2873 7472 2c20 6f70 7469 6f6e  thm (str, option
-00025f10: 616c 293a 2057 6865 6e20 7573 696e 6720  al): When using 
-00025f20: 6120 5253 4120 6b65 792c 2073 7065 6369  a RSA key, speci
-00025f30: 6669 6573 2074 6865 2052 5341 2073 6967  fies the RSA sig
-00025f40: 6e61 7475 7265 2061 6c67 6f72 6974 686d  nature algorithm
-00025f50: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00025f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f80: 2020 2020 746f 2075 7365 2066 6f72 2073      to use for s
-00025f90: 6967 6e69 6e67 2e20 5375 7070 6f72 7465  igning. Supporte
-00025fa0: 6420 7369 676e 6174 7572 6520 7479 7065  d signature type
-00025fb0: 7320 6172 653a 2070 7373 2c20 706b 6373  s are: pss, pkcs
-00025fc0: 3176 3135 2e20 0d0a 2020 2020 2020 2020  1v15. ..        
-00025fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ff0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00026000: 7320 746f 2022 222e 0d0a 2020 2020 2020  s to ""...      
-00026010: 2020 2020 2020 6d61 7273 6861 6c69 6e67        marshaling
-00026020: 5f61 6c67 6f72 6974 686d 2028 7374 722c  _algorithm (str,
-00026030: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
-00026040: 6966 6965 7320 7468 6520 7761 7920 696e  ifies the way in
-00026050: 2077 6869 6368 2074 6865 2073 6967 6e61   which the signa
-00026060: 7475 7265 2073 686f 756c 6420 6265 206d  ture should be m
-00026070: 6172 7368 616c 6564 2e20 0d0a 2020 2020  arshaled. ..    
-00026080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260a0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-000260b0: 6973 2063 7572 7265 6e74 6c79 206f 6e6c  is currently onl
-000260c0: 7920 6170 706c 6965 7320 746f 2045 4344  y applies to ECD
-000260d0: 5341 206b 6579 732e 2053 7570 706f 7274  SA keys. Support
-000260e0: 6564 2074 7970 6573 2061 7265 3a20 0d0a  ed types are: ..
-000260f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026120: 2020 6173 6e31 2c20 6a77 732e 2044 6566    asn1, jws. Def
-00026130: 6175 6c74 7320 746f 2022 222e 0d0a 2020  aults to ""...  
-00026140: 2020 2020 2020 2020 2020 7361 6c74 5f6c            salt_l
-00026150: 656e 6774 6820 2873 7472 2c20 6f70 7469  ength (str, opti
-00026160: 6f6e 616c 293a 2054 6865 2073 616c 7420  onal): The salt 
-00026170: 6c65 6e67 7468 2075 7365 6420 746f 2073  length used to s
-00026180: 6967 6e2e 2054 6869 7320 6375 7272 656e  ign. This curren
-00026190: 746c 7920 6f6e 6c79 2061 7070 6c69 6573  tly only applies
-000261a0: 2074 6f20 7468 6520 5253 4120 5053 5320   to the RSA PSS 
-000261b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000261c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261d0: 2020 2020 2020 2020 2020 2073 6967 6e61             signa
-000261e0: 7475 7265 2073 6368 656d 652e 204f 7074  ture scheme. Opt
-000261f0: 696f 6e73 2061 7265 3a20 6175 746f 2c20  ions are: auto, 
-00026200: 6861 7368 2c20 6f72 2061 6e20 696e 7465  hash, or an inte
-00026210: 6765 7220 6265 7477 6565 6e20 7468 6520  ger between the 
-00026220: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00026230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026240: 2020 2020 2020 2020 2020 206d 696e 696d             minim
-00026250: 756d 2061 6e64 2074 6865 206d 6178 696d  um and the maxim
-00026260: 756d 2070 6572 6d69 7373 6962 6c65 2073  um permissible s
-00026270: 616c 7420 6c65 6e67 7468 7320 666f 7220  alt lengths for 
-00026280: 7468 6520 6769 7665 6e20 5253 4120 6b65  the given RSA ke
-00026290: 7920 7369 7a65 2e20 0d0a 2020 2020 2020  y size. ..      
-000262a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262c0: 2020 2044 6566 6175 6c74 7320 746f 2022     Defaults to "
-000262d0: 222e 0d0a 0d0a 2020 2020 2020 2020 5265  ".....        Re
-000262e0: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-000262f0: 2020 2020 6469 6374 206f 7220 4e6f 6e65      dict or None
-00026300: 3a20 7265 7475 726e 2074 6865 2073 6967  : return the sig
-00026310: 6e61 7475 7265 2069 6e20 6469 6374 2069  nature in dict i
-00026320: 6620 7375 6363 6573 732c 206f 7468 6572  f success, other
-00026330: 7769 7365 2072 6574 7572 6e20 4e6f 6e65  wise return None
-00026340: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00026350: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-00026360: 735f 6175 7468 3a0d 0a20 2020 2020 2020  s_auth:..       
-00026370: 2020 2020 2069 6620 696e 7075 745f 6461       if input_da
-00026380: 7461 203d 3d20 2222 2061 6e64 2062 6174  ta == "" and bat
-00026390: 6368 5f69 6e70 7574 2069 7320 4e6f 6e65  ch_input is None
-000263a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000263b0: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-000263c0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-000263d0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 7369  _.__name__} - si
-000263e0: 676e 2064 6174 6120 6572 726f 723a 204f  gn data error: O
-000263f0: 6e65 206f 6620 6069 6e70 7574 6020 6f72  ne of `input` or
-00026400: 2060 6261 7463 685f 696e 7075 7460 2022   `batch_input` "
-00026410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00026420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026430: 2020 2020 6622 6d75 7374 2062 6520 7375      f"must be su
-00026440: 7070 6c69 6564 2229 0d0a 2020 2020 2020  pplied")..      
-00026450: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00026460: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-00026470: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-00026480: 2065 7869 7374 5f6b 6579 7320 3d20 7365   exist_keys = se
-00026490: 6c66 2e6c 6973 745f 6b65 7928 6d6f 756e  lf.list_key(moun
-000264a0: 745f 7061 7468 290d 0a20 2020 2020 2020  t_path)..       
-000264b0: 2020 2020 2069 6620 6e61 6d65 206e 6f74       if name not
-000264c0: 2069 6e20 6578 6973 745f 6b65 7973 3a0d   in exist_keys:.
-000264d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000264e0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-000264f0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-00026500: 5f5f 6e61 6d65 5f5f 7d20 2d20 7369 676e  __name__} - sign
-00026510: 2064 6174 6120 6572 726f 723a 206b 6579   data error: key
-00026520: 2027 7b6e 616d 657d 2720 6e6f 7420 666f   '{name}' not fo
-00026530: 756e 6422 290d 0a20 2020 2020 2020 2020  und")..         
-00026540: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00026550: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00026560: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-00026570: 796c 6f61 6420 3d20 6469 6374 2829 0d0a  yload = dict()..
-00026580: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00026590: 2020 2020 2020 2020 2020 7375 7070 6f72            suppor
-000265a0: 745f 6861 7368 5f61 6c67 6f72 6974 686d  t_hash_algorithm
-000265b0: 203d 205b 2273 6861 3122 2c20 2273 6861   = ["sha1", "sha
-000265c0: 322d 3232 3422 2c20 2273 6861 322d 3235  2-224", "sha2-25
-000265d0: 3622 2c20 2273 6861 322d 3338 3422 2c20  6", "sha2-384", 
-000265e0: 2273 6861 322d 3531 3222 2c20 0d0a 2020  "sha2-512", ..  
-000265f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026610: 2020 2020 2273 6861 332d 3232 3422 2c20      "sha3-224", 
-00026620: 2273 6861 332d 3338 3422 2c20 2273 6861  "sha3-384", "sha
-00026630: 332d 3531 3222 2c20 226e 6f6e 6522 5d0d  3-512", "none"].
-00026640: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00026650: 6861 7368 5f61 6c67 6f72 6974 686d 206e  hash_algorithm n
-00026660: 6f74 2069 6e20 7375 7070 6f72 745f 6861  ot in support_ha
-00026670: 7368 5f61 6c67 6f72 6974 686d 3a0d 0a20  sh_algorithm:.. 
-00026680: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00026690: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-000266a0: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-000266b0: 6e61 6d65 5f5f 7d20 2d20 7369 676e 2064  name__} - sign d
-000266c0: 6174 6120 6572 726f 723a 2068 6173 685f  ata error: hash_
-000266d0: 616c 676f 7269 7468 6d20 6d75 7374 2062  algorithm must b
-000266e0: 6520 6f6e 6520 6f66 3a20 220d 0a20 2020  e one of: "..   
-000266f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026700: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00026710: 227b 272c 2027 2e6a 6f69 6e28 7375 7070  "{', '.join(supp
-00026720: 6f72 745f 6861 7368 5f61 6c67 6f72 6974  ort_hash_algorit
-00026730: 686d 297d 2229 0d0a 2020 2020 2020 2020  hm)}")..        
-00026740: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00026750: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00026760: 200d 0a20 2020 2020 2020 2020 2020 2069   ..            i
-00026770: 6620 6b65 795f 7665 7273 696f 6e20 6973  f key_version is
-00026780: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00026790: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000267a0: 6f74 2069 735f 696e 7428 6b65 795f 7665  ot is_int(key_ve
-000267b0: 7273 696f 6e29 3a0d 0a20 2020 2020 2020  rsion):..       
-000267c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000267d0: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-000267e0: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-000267f0: 6d65 5f5f 7d20 2d20 7369 676e 2064 6174  me__} - sign dat
-00026800: 6120 6572 726f 723a 2074 6865 206b 6579  a error: the key
-00026810: 5f76 6572 7369 6f6e 206d 7573 7420 6265  _version must be
-00026820: 2061 6e20 696e 7465 6765 7222 290d 0a20   an integer").. 
-00026830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026840: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00026850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026860: 6966 206b 6579 5f76 6572 7369 6f6e 203c  if key_version <
-00026870: 2073 656c 662e 7265 6164 5f6b 6579 286d   self.read_key(m
-00026880: 6f75 6e74 5f70 6174 682c 206e 616d 6529  ount_path, name)
-00026890: 5b22 6d69 6e5f 656e 6372 7970 7469 6f6e  ["min_encryption
-000268a0: 5f76 6572 7369 6f6e 225d 3a0d 0a20 2020  _version"]:..   
-000268b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000268c0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-000268d0: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-000268e0: 5f5f 6e61 6d65 5f5f 7d20 2d20 7369 676e  __name__} - sign
-000268f0: 2064 6174 6120 6572 726f 723a 2067 7265   data error: gre
-00026900: 6174 6572 2074 6861 6e20 6f72 2065 7175  ater than or equ
-00026910: 616c 2074 6f20 7468 6520 6b65 7927 7320  al to the key's 
-00026920: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00026930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026940: 2020 2020 2020 2020 2066 2260 6d69 6e5f           f"`min_
-00026950: 656e 6372 7970 7469 6f6e 5f76 6572 7369  encryption_versi
-00026960: 6f6e 602c 2069 6620 7365 7422 290d 0a20  on`, if set").. 
-00026970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026980: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00026990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000269a0: 7061 796c 6f61 645b 226b 6579 5f76 6572  payload["key_ver
-000269b0: 7369 6f6e 225d 203d 206b 6579 5f76 6572  sion"] = key_ver
-000269c0: 7369 6f6e 0d0a 2020 2020 2020 2020 2020  sion..          
-000269d0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000269e0: 2020 2020 6966 2062 6174 6368 5f69 6e70      if batch_inp
-000269f0: 7574 2069 7320 4e6f 6e65 3a0d 0a20 2020  ut is None:..   
-00026a00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00026a10: 6e6f 7420 6973 5f62 6173 6536 3428 696e  not is_base64(in
-00026a20: 7075 745f 6461 7461 293a 0d0a 2020 2020  put_data):..    
-00026a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026a40: 7365 6c66 2e6c 6f67 6765 722e 6572 726f  self.logger.erro
-00026a50: 7228 6622 7b5f 5f63 6c61 7373 5f5f 2e5f  r(f"{__class__._
-00026a60: 5f6e 616d 655f 5f7d 202d 2073 6967 6e20  _name__} - sign 
-00026a70: 6461 7461 2065 7272 6f72 3a20 7468 6520  data error: the 
-00026a80: 696e 7075 745f 6461 7461 206d 7573 7420  input_data must 
-00026a90: 6265 2062 6173 6536 3420 656e 636f 6465  be base64 encode
-00026aa0: 6422 290d 0a20 2020 2020 2020 2020 2020  d")..           
-00026ab0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00026ac0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00026ad0: 2020 2020 2020 7061 796c 6f61 645b 2269        payload["i
-00026ae0: 6e70 7574 225d 203d 2069 6e70 7574 5f64  nput"] = input_d
-00026af0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
-00026b00: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00026b10: 2020 2069 6620 6261 7463 685f 696e 7075     if batch_inpu
-00026b20: 7420 6973 204e 6f6e 6520 616e 6420 636f  t is None and co
-00026b30: 6e74 6578 7420 213d 2022 223a 0d0a 2020  ntext != "":..  
-00026b40: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00026b50: 206e 6f74 2069 735f 6261 7365 3634 2863   not is_base64(c
-00026b60: 6f6e 7465 7874 293a 0d0a 2020 2020 2020  ontext):..      
-00026b70: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00026b80: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
-00026b90: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
-00026ba0: 616d 655f 5f7d 202d 2073 6967 6e20 6461  ame__} - sign da
-00026bb0: 7461 2065 7272 6f72 3a20 7468 6520 636f  ta error: the co
-00026bc0: 6e74 6578 7420 6d75 7374 2062 6520 6261  ntext must be ba
-00026bd0: 7365 3634 2065 6e63 6f64 6564 2069 6620  se64 encoded if 
-00026be0: 7365 7422 290d 0a20 2020 2020 2020 2020  set")..         
-00026bf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00026c00: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
-00026c10: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
-00026c20: 2263 6f6e 7465 7874 225d 203d 2063 6f6e  "context"] = con
-00026c30: 7465 7874 0d0a 2020 2020 2020 2020 2020  text..          
-00026c40: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00026c50: 2020 2020 6966 2062 6174 6368 5f69 6e70      if batch_inp
-00026c60: 7574 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ut is not None:.
-00026c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026c80: 2069 6620 7265 6665 7265 6e63 6520 213d   if reference !=
-00026c90: 2022 223a 0d0a 2020 2020 2020 2020 2020   "":..          
-00026ca0: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-00026cb0: 645b 2272 6566 6572 656e 6365 225d 203d  d["reference"] =
-00026cc0: 2072 6566 6572 656e 6365 0d0a 2020 2020   reference..    
-00026cd0: 2020 2020 2020 2020 2020 2020 7061 796c              payl
-00026ce0: 6f61 645b 2262 6174 6368 5f69 6e70 7574  oad["batch_input
-00026cf0: 225d 203d 2062 6174 6368 5f69 6e70 7574  "] = batch_input
-00026d00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00026d10: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00026d20: 6966 2070 7265 6861 7368 6564 3a0d 0a20  if prehashed:.. 
-00026d30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00026d40: 6179 6c6f 6164 5b22 7072 6568 6173 6865  ayload["prehashe
-00026d50: 6422 5d20 3d20 7072 6568 6173 6865 640d  d"] = prehashed.
-00026d60: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-00026d70: 2020 2020 2020 2020 2020 2069 6620 7369             if si
-00026d80: 676e 6174 7572 655f 616c 676f 7269 7468  gnature_algorith
-00026d90: 6d20 213d 2022 223a 0d0a 2020 2020 2020  m != "":..      
-00026da0: 2020 2020 2020 2020 2020 6966 2073 6967            if sig
-00026db0: 6e61 7475 7265 5f61 6c67 6f72 6974 686d  nature_algorithm
-00026dc0: 206e 6f74 2069 6e20 5b22 7073 7322 2c20   not in ["pss", 
-00026dd0: 2270 6b63 7331 7631 3522 5d3a 0d0a 2020  "pkcs1v15"]:..  
-00026de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026df0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
-00026e00: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
-00026e10: 2e5f 5f6e 616d 655f 5f7d 202d 2073 6967  .__name__} - sig
-00026e20: 6e20 6461 7461 2065 7272 6f72 3a20 7369  n data error: si
-00026e30: 676e 6174 7572 655f 616c 676f 7269 7468  gnature_algorith
-00026e40: 6d20 6d75 7374 2062 6520 6f6e 6520 6f66  m must be one of
-00026e50: 3a20 7073 732c 2070 6b63 7331 7631 3522  : pss, pkcs1v15"
-00026e60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00026e70: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00026e80: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00026e90: 2020 2020 7061 796c 6f61 645b 2273 6967      payload["sig
-00026ea0: 6e61 7475 7265 5f61 6c67 6f72 6974 686d  nature_algorithm
-00026eb0: 225d 203d 2073 6967 6e61 7475 7265 5f61  "] = signature_a
-00026ec0: 6c67 6f72 6974 686d 0d0a 2020 2020 2020  lgorithm..      
-00026ed0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00026ee0: 2020 2020 2020 2020 6966 206d 6172 7368          if marsh
-00026ef0: 616c 696e 675f 616c 676f 7269 7468 6d20  aling_algorithm 
-00026f00: 213d 2022 223a 0d0a 2020 2020 2020 2020  != "":..        
-00026f10: 2020 2020 2020 2020 6966 206d 6172 7368          if marsh
-00026f20: 616c 696e 675f 616c 676f 7269 7468 6d20  aling_algorithm 
-00026f30: 6e6f 7420 696e 205b 2261 736e 3122 2c20  not in ["asn1", 
-00026f40: 226a 7773 225d 3a0d 0a20 2020 2020 2020  "jws"]:..       
-00026f50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00026f60: 662e 6c6f 6767 6572 2e65 7272 6f72 2866  f.logger.error(f
-00026f70: 227b 5f5f 636c 6173 735f 5f2e 5f5f 6e61  "{__class__.__na
-00026f80: 6d65 5f5f 7d20 2d20 7369 676e 2064 6174  me__} - sign dat
-00026f90: 6120 6572 726f 723a 206d 6172 7368 616c  a error: marshal
-00026fa0: 696e 675f 616c 676f 7269 7468 6d20 6d75  ing_algorithm mu
-00026fb0: 7374 2062 6520 6f6e 6520 6f66 3a20 7073  st be one of: ps
-00026fc0: 6173 6e31 732c 206a 7773 2229 0d0a 2020  asn1s, jws")..  
-00026fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026fe0: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-00026ff0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00027000: 6179 6c6f 6164 5b22 6d61 7273 6861 6c69  ayload["marshali
-00027010: 6e67 5f61 6c67 6f72 6974 686d 225d 203d  ng_algorithm"] =
-00027020: 206d 6172 7368 616c 696e 675f 616c 676f   marshaling_algo
-00027030: 7269 7468 6d0d 0a20 2020 2020 2020 2020  rithm..         
-00027040: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00027050: 2020 2020 2069 6620 7361 6c74 5f6c 656e       if salt_len
-00027060: 6774 6820 213d 2022 223a 0d0a 2020 2020  gth != "":..    
-00027070: 2020 2020 2020 2020 2020 2020 7061 796c              payl
-00027080: 6f61 645b 2273 616c 745f 6c65 6e67 7468  oad["salt_length
-00027090: 225d 203d 2073 616c 745f 6c65 6e67 7468  "] = salt_length
-000270a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000270b0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-000270c0: 7572 6c20 3d20 6165 735f 6465 6372 7970  url = aes_decryp
-000270d0: 745f 7465 7874 2873 656c 662e 7572 6c2c  t_text(self.url,
-000270e0: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-000270f0: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-00027100: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-00027110: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-00027120: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-00027130: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-00027140: 6e20 3d20 6165 735f 6465 6372 7970 745f  n = aes_decrypt_
-00027150: 7465 7874 2873 656c 662e 746f 6b65 6e2c  text(self.token,
-00027160: 206b 6579 3d72 616e 646f 6d5f 6865 7828   key=random_hex(
-00027170: 7365 6c66 2e5f 6b65 795f 6c65 6e2c 2073  self._key_len, s
-00027180: 656c 662e 5f73 6565 642a 3229 2c20 6976  elf._seed*2), iv
-00027190: 3d72 616e 646f 6d5f 6865 7828 3136 2c20  =random_hex(16, 
-000271a0: 7365 6c66 2e5f 7365 6564 2a33 2929 0d0a  self._seed*3))..
-000271b0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-000271c0: 3d20 7265 7175 6573 7473 2e70 6f73 7428  = requests.post(
-000271d0: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
-000271e0: 687d 2f73 6967 6e2f 7b6e 616d 657d 2f7b  h}/sign/{name}/{
-000271f0: 6861 7368 5f61 6c67 6f72 6974 686d 7d22  hash_algorithm}"
-00027200: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
-00027210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027220: 2020 2020 6865 6164 6572 733d 7b22 582d      headers={"X-
-00027230: 5661 756c 742d 546f 6b65 6e22 3a20 746f  Vault-Token": to
-00027240: 6b65 6e7d 2c20 0d0a 2020 2020 2020 2020  ken}, ..        
-00027250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027260: 2020 2020 2020 2020 6461 7461 3d6a 736f          data=jso
-00027270: 6e2e 6475 6d70 7328 7061 796c 6f61 6429  n.dumps(payload)
-00027280: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00027290: 6620 7265 732e 7374 6174 7573 5f63 6f64  f res.status_cod
-000272a0: 6520 3d3d 2032 3030 206f 7220 7265 732e  e == 200 or res.
-000272b0: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
-000272c0: 3034 3a0d 0a20 2020 2020 2020 2020 2020  04:..           
-000272d0: 2020 2020 2072 6574 7572 6e20 7265 732e       return res.
-000272e0: 6a73 6f6e 2829 5b22 6461 7461 225d 0d0a  json()["data"]..
-000272f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00027300: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00027310: 2020 2073 656c 662e 5f6c 6f67 5f65 7272     self._log_err
-00027320: 6f72 5f72 6573 706f 6e73 6528 5f5f 636c  or_response(__cl
-00027330: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
-00027340: 7265 732c 2022 7369 676e 2064 6174 6120  res, "sign data 
-00027350: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
-00027360: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00027370: 4e6f 6e65 0d0a 2020 2020 2020 2020 0d0a  None..        ..
-00027380: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00027390: 6f6e 650d 0a0d 0a20 2020 2023 2054 4f44  one....    # TOD
-000273a0: 4f3a 2077 6169 7420 666f 7220 7465 7374  O: wait for test
-000273b0: 696e 670d 0a20 2020 2064 6566 2076 6572  ing..    def ver
-000273c0: 6966 795f 7369 676e 6564 5f64 6174 6128  ify_signed_data(
-000273d0: 7365 6c66 2c20 0d0a 2020 2020 2020 2020  self, ..        
-000273e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273f0: 2020 206d 6f75 6e74 5f70 6174 683a 2073     mount_path: s
-00027400: 7472 2c0d 0a20 2020 2020 2020 2020 2020  tr,..           
-00027410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027420: 6e61 6d65 3a20 7374 722c 0d0a 2020 2020  name: str,..    
+00025a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a90: 2020 2020 2020 6465 7363 7269 6269 6e67        describing
+00025aa0: 2074 6865 2065 7272 6f72 2e20 4465 6661   the error. Defa
+00025ab0: 756c 7473 2074 6f20 4e6f 6e65 2e0d 0a20  ults to None... 
+00025ac0: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
+00025ad0: 7874 2028 7374 722c 206f 7074 696f 6e61  xt (str, optiona
+00025ae0: 6c29 3a20 4261 7365 3634 2065 6e63 6f64  l): Base64 encod
+00025af0: 6564 2063 6f6e 7465 7874 2066 6f72 206b  ed context for k
+00025b00: 6579 2064 6572 6976 6174 696f 6e2e 2052  ey derivation. R
+00025b10: 6571 7569 7265 6420 6966 206b 6579 2064  equired if key d
+00025b20: 6572 6976 6174 696f 6e20 6973 200d 0a20  erivation is .. 
+00025b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b50: 2020 2020 656e 6162 6c65 643b 2063 7572      enabled; cur
+00025b60: 7265 6e74 6c79 206f 6e6c 7920 6176 6169  rently only avai
+00025b70: 6c61 626c 6520 7769 7468 2065 6432 3535  lable with ed255
+00025b80: 3139 206b 6579 732e 2044 6566 6175 6c74  19 keys. Default
+00025b90: 7320 746f 2022 222e 0d0a 2020 2020 2020  s to ""...      
+00025ba0: 2020 2020 2020 7072 6568 6173 6865 6420        prehashed 
+00025bb0: 2862 6f6f 6c2c 206f 7074 696f 6e61 6c29  (bool, optional)
+00025bc0: 3a20 5365 7420 746f 2060 7472 7565 6020  : Set to `true` 
+00025bd0: 7768 656e 2074 6865 2069 6e70 7574 2069  when the input i
+00025be0: 7320 616c 7265 6164 7920 6861 7368 6564  s already hashed
+00025bf0: 2e20 4966 2074 6865 206b 6579 2074 7970  . If the key typ
+00025c00: 6520 6973 200d 0a20 2020 2020 2020 2020  e is ..         
+00025c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025c20: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+00025c30: 7273 612d 3230 3438 602c 2060 7273 612d  rsa-2048`, `rsa-
+00025c40: 3330 3732 6020 6f72 2060 7273 612d 3430  3072` or `rsa-40
+00025c50: 3936 602c 2074 6865 6e20 7468 6520 616c  96`, then the al
+00025c60: 676f 7269 7468 6d20 7573 6564 2074 6f20  gorithm used to 
+00025c70: 6861 7368 200d 0a20 2020 2020 2020 2020  hash ..         
+00025c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025c90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00025ca0: 6865 2069 6e70 7574 2073 686f 756c 6420  he input should 
+00025cb0: 6265 2069 6e64 6963 6174 6564 2062 7920  be indicated by 
+00025cc0: 7468 6520 6068 6173 685f 616c 676f 7269  the `hash_algori
+00025cd0: 7468 6d60 2070 6172 616d 6574 6572 2e20  thm` parameter. 
+00025ce0: 4a75 7374 200d 0a20 2020 2020 2020 2020  Just ..         
+00025cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d00: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00025d10: 7320 7468 6520 7661 6c75 6520 746f 2073  s the value to s
+00025d20: 6967 6e20 7368 6f75 6c64 2062 6520 7468  ign should be th
+00025d30: 6520 6261 7365 3634 2d65 6e63 6f64 6564  e base64-encoded
+00025d40: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+00025d50: 6f66 200d 0a20 2020 2020 2020 2020 2020  of ..           
+00025d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d70: 2020 2020 2020 2020 2020 2020 2074 6865               the
+00025d80: 2065 7861 6374 2062 696e 6172 7920 6461   exact binary da
+00025d90: 7461 2079 6f75 2077 616e 7420 7369 676e  ta you want sign
+00025da0: 6564 2c20 7768 656e 2073 6574 2c20 6069  ed, when set, `i
+00025db0: 6e70 7574 6020 6973 2065 7870 6563 7465  nput` is expecte
+00025dc0: 6420 0d0a 2020 2020 2020 2020 2020 2020  d ..            
+00025dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025de0: 2020 2020 2020 2020 2020 2020 746f 2062              to b
+00025df0: 6520 6261 7365 3634 2d65 6e63 6f64 6564  e base64-encoded
+00025e00: 2062 696e 6172 7920 6861 7368 6564 2064   binary hashed d
+00025e10: 6174 612c 206e 6f74 2068 6578 2d66 6f72  ata, not hex-for
+00025e20: 6d61 7474 6564 2e20 2841 7320 616e 200d  matted. (As an .
+00025e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025e50: 2020 2020 2020 2020 2065 7861 6d70 6c65           example
+00025e60: 2c20 6f6e 2074 6865 2063 6f6d 6d61 6e64  , on the command
+00025e70: 206c 696e 652c 2079 6f75 2063 6f75 6c64   line, you could
+00025e80: 2067 656e 6572 6174 6520 6120 7375 6974   generate a suit
+00025e90: 6162 6c65 2069 6e70 7574 2076 6961 200d  able input via .
+00025ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ec0: 2020 2020 2020 2020 2060 6f70 656e 7373           `openss
+00025ed0: 6c20 6467 7374 202d 7368 6132 3536 202d  l dgst -sha256 -
+00025ee0: 6269 6e61 7279 207c 2062 6173 6536 3460  binary | base64`
+00025ef0: 2e29 2e20 4465 6661 756c 7473 2074 6f20  .). Defaults to 
+00025f00: 4661 6c73 652e 0d0a 2020 2020 2020 2020  False...        
+00025f10: 2020 2020 7369 676e 6174 7572 655f 616c      signature_al
+00025f20: 676f 7269 7468 6d20 2873 7472 2c20 6f70  gorithm (str, op
+00025f30: 7469 6f6e 616c 293a 2057 6865 6e20 7573  tional): When us
+00025f40: 696e 6720 6120 5253 4120 6b65 792c 2073  ing a RSA key, s
+00025f50: 7065 6369 6669 6573 2074 6865 2052 5341  pecifies the RSA
+00025f60: 2073 6967 6e61 7475 7265 2061 6c67 6f72   signature algor
+00025f70: 6974 686d 200d 0a20 2020 2020 2020 2020  ithm ..         
+00025f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fa0: 2020 2020 2020 2020 746f 2075 7365 2066          to use f
+00025fb0: 6f72 2073 6967 6e69 6e67 2e20 5375 7070  or signing. Supp
+00025fc0: 6f72 7465 6420 7369 676e 6174 7572 6520  orted signature 
+00025fd0: 7479 7065 7320 6172 653a 2070 7373 2c20  types are: pss, 
+00025fe0: 706b 6373 3176 3135 2e20 0d0a 2020 2020  pkcs1v15. ..    
+00025ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026010: 2020 2020 2020 2020 2020 2020 2044 6566               Def
+00026020: 6175 6c74 7320 746f 2022 222e 0d0a 2020  aults to ""...  
+00026030: 2020 2020 2020 2020 2020 6d61 7273 6861            marsha
+00026040: 6c69 6e67 5f61 6c67 6f72 6974 686d 2028  ling_algorithm (
+00026050: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+00026060: 5370 6563 6966 6965 7320 7468 6520 7761  Specifies the wa
+00026070: 7920 696e 2077 6869 6368 2074 6865 2073  y in which the s
+00026080: 6967 6e61 7475 7265 2073 686f 756c 6420  ignature should 
+00026090: 6265 206d 6172 7368 616c 6564 2e20 0d0a  be marshaled. ..
+000260a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260d0: 2020 5468 6973 2063 7572 7265 6e74 6c79    This currently
+000260e0: 206f 6e6c 7920 6170 706c 6965 7320 746f   only applies to
+000260f0: 2045 4344 5341 206b 6579 732e 2053 7570   ECDSA keys. Sup
+00026100: 706f 7274 6564 2074 7970 6573 2061 7265  ported types are
+00026110: 3a20 0d0a 2020 2020 2020 2020 2020 2020  : ..            
+00026120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026140: 2020 2020 2020 6173 6e31 2c20 6a77 732e        asn1, jws.
+00026150: 2044 6566 6175 6c74 7320 746f 2022 222e   Defaults to "".
+00026160: 0d0a 2020 2020 2020 2020 2020 2020 7361  ..            sa
+00026170: 6c74 5f6c 656e 6774 6820 2873 7472 2c20  lt_length (str, 
+00026180: 6f70 7469 6f6e 616c 293a 2054 6865 2073  optional): The s
+00026190: 616c 7420 6c65 6e67 7468 2075 7365 6420  alt length used 
+000261a0: 746f 2073 6967 6e2e 2054 6869 7320 6375  to sign. This cu
+000261b0: 7272 656e 746c 7920 6f6e 6c79 2061 7070  rrently only app
+000261c0: 6c69 6573 2074 6f20 7468 6520 5253 4120  lies to the RSA 
+000261d0: 5053 5320 0d0a 2020 2020 2020 2020 2020  PSS ..          
+000261e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000261f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00026200: 6967 6e61 7475 7265 2073 6368 656d 652e  ignature scheme.
+00026210: 204f 7074 696f 6e73 2061 7265 3a20 6175   Options are: au
+00026220: 746f 2c20 6861 7368 2c20 6f72 2061 6e20  to, hash, or an 
+00026230: 696e 7465 6765 7220 6265 7477 6565 6e20  integer between 
+00026240: 7468 6520 0d0a 2020 2020 2020 2020 2020  the ..          
+00026250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026260: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00026270: 696e 696d 756d 2061 6e64 2074 6865 206d  inimum and the m
+00026280: 6178 696d 756d 2070 6572 6d69 7373 6962  aximum permissib
+00026290: 6c65 2073 616c 7420 6c65 6e67 7468 7320  le salt lengths 
+000262a0: 666f 7220 7468 6520 6769 7665 6e20 5253  for the given RS
+000262b0: 4120 6b65 7920 7369 7a65 2e20 0d0a 2020  A key size. ..  
+000262c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262e0: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+000262f0: 746f 2022 222e 0d0a 0d0a 2020 2020 2020  to "".....      
+00026300: 2020 5265 7475 726e 733a 0d0a 2020 2020    Returns:..    
+00026310: 2020 2020 2020 2020 6469 6374 206f 7220          dict or 
+00026320: 4e6f 6e65 3a20 7265 7475 726e 2074 6865  None: return the
+00026330: 2073 6967 6e61 7475 7265 2069 6e20 6469   signature in di
+00026340: 6374 2069 6620 7375 6363 6573 732c 206f  ct if success, o
+00026350: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
+00026360: 4e6f 6e65 0d0a 2020 2020 2020 2020 2222  None..        ""
+00026370: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+00026380: 6c66 2e69 735f 6175 7468 3a0d 0a20 2020  lf.is_auth:..   
+00026390: 2020 2020 2020 2020 2069 6620 696e 7075           if inpu
+000263a0: 745f 6461 7461 203d 3d20 2222 2061 6e64  t_data == "" and
+000263b0: 2062 6174 6368 5f69 6e70 7574 2069 7320   batch_input is 
+000263c0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000263d0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+000263e0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+000263f0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+00026400: 2d20 7369 676e 2064 6174 6120 6572 726f  - sign data erro
+00026410: 723a 204f 6e65 206f 6620 6069 6e70 7574  r: One of `input
+00026420: 6020 6f72 2060 6261 7463 685f 696e 7075  ` or `batch_inpu
+00026430: 7460 2022 0d0a 2020 2020 2020 2020 2020  t` "..          
+00026440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026450: 2020 2020 2020 2020 6622 6d75 7374 2062          f"must b
+00026460: 6520 7375 7070 6c69 6564 2229 0d0a 2020  e supplied")..  
+00026470: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00026480: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+00026490: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000264a0: 2020 2020 2065 7869 7374 5f6b 6579 7320       exist_keys 
+000264b0: 3d20 7365 6c66 2e6c 6973 745f 6b65 7928  = self.list_key(
+000264c0: 6d6f 756e 745f 7061 7468 290d 0a20 2020  mount_path)..   
+000264d0: 2020 2020 2020 2020 2069 6620 6e61 6d65           if name
+000264e0: 206e 6f74 2069 6e20 6578 6973 745f 6b65   not in exist_ke
+000264f0: 7973 3a0d 0a20 2020 2020 2020 2020 2020  ys:..           
+00026500: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00026510: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+00026520: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+00026530: 7369 676e 2064 6174 6120 6572 726f 723a  sign data error:
+00026540: 206b 6579 2027 7b6e 616d 657d 2720 6e6f   key '{name}' no
+00026550: 7420 666f 756e 6422 290d 0a20 2020 2020  t found")..     
+00026560: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00026570: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+00026580: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00026590: 2020 7061 796c 6f61 6420 3d20 6469 6374    payload = dict
+000265a0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000265b0: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+000265c0: 7070 6f72 745f 6861 7368 5f61 6c67 6f72  pport_hash_algor
+000265d0: 6974 686d 203d 205b 2273 6861 3122 2c20  ithm = ["sha1", 
+000265e0: 2273 6861 322d 3232 3422 2c20 2273 6861  "sha2-224", "sha
+000265f0: 322d 3235 3622 2c20 2273 6861 322d 3338  2-256", "sha2-38
+00026600: 3422 2c20 2273 6861 322d 3531 3222 2c20  4", "sha2-512", 
+00026610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026630: 2020 2020 2020 2020 2273 6861 332d 3232          "sha3-22
+00026640: 3422 2c20 2273 6861 332d 3338 3422 2c20  4", "sha3-384", 
+00026650: 2273 6861 332d 3531 3222 2c20 226e 6f6e  "sha3-512", "non
+00026660: 6522 5d0d 0a20 2020 2020 2020 2020 2020  e"]..           
+00026670: 2069 6620 6861 7368 5f61 6c67 6f72 6974   if hash_algorit
+00026680: 686d 206e 6f74 2069 6e20 7375 7070 6f72  hm not in suppor
+00026690: 745f 6861 7368 5f61 6c67 6f72 6974 686d  t_hash_algorithm
+000266a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000266b0: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+000266c0: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+000266d0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 7369  _.__name__} - si
+000266e0: 676e 2064 6174 6120 6572 726f 723a 2068  gn data error: h
+000266f0: 6173 685f 616c 676f 7269 7468 6d20 6d75  ash_algorithm mu
+00026700: 7374 2062 6520 6f6e 6520 6f66 3a20 220d  st be one of: ".
+00026710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026730: 2020 2066 227b 272c 2027 2e6a 6f69 6e28     f"{', '.join(
+00026740: 7375 7070 6f72 745f 6861 7368 5f61 6c67  support_hash_alg
+00026750: 6f72 6974 686d 297d 2229 0d0a 2020 2020  orithm)}")..    
+00026760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00026770: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+00026780: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00026790: 2020 2069 6620 6b65 795f 7665 7273 696f     if key_versio
+000267a0: 6e20 6973 206e 6f74 204e 6f6e 653a 0d0a  n is not None:..
+000267b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000267c0: 6966 206e 6f74 2069 735f 696e 7428 6b65  if not is_int(ke
+000267d0: 795f 7665 7273 696f 6e29 3a0d 0a20 2020  y_version):..   
+000267e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000267f0: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+00026800: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+00026810: 5f5f 6e61 6d65 5f5f 7d20 2d20 7369 676e  __name__} - sign
+00026820: 2064 6174 6120 6572 726f 723a 2074 6865   data error: the
+00026830: 206b 6579 5f76 6572 7369 6f6e 206d 7573   key_version mus
+00026840: 7420 6265 2061 6e20 696e 7465 6765 7222  t be an integer"
+00026850: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00026860: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00026870: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00026880: 2020 2020 6966 206b 6579 5f76 6572 7369      if key_versi
+00026890: 6f6e 203c 2073 656c 662e 7265 6164 5f6b  on < self.read_k
+000268a0: 6579 286d 6f75 6e74 5f70 6174 682c 206e  ey(mount_path, n
+000268b0: 616d 6529 5b22 6d69 6e5f 656e 6372 7970  ame)["min_encryp
+000268c0: 7469 6f6e 5f76 6572 7369 6f6e 225d 3a0d  tion_version"]:.
+000268d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000268e0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+000268f0: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+00026900: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+00026910: 7369 676e 2064 6174 6120 6572 726f 723a  sign data error:
+00026920: 2067 7265 6174 6572 2074 6861 6e20 6f72   greater than or
+00026930: 2065 7175 616c 2074 6f20 7468 6520 6b65   equal to the ke
+00026940: 7927 7320 220d 0a20 2020 2020 2020 2020  y's "..         
+00026950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026960: 2020 2020 2020 2020 2020 2020 2066 2260               f"`
+00026970: 6d69 6e5f 656e 6372 7970 7469 6f6e 5f76  min_encryption_v
+00026980: 6572 7369 6f6e 602c 2069 6620 7365 7422  ersion`, if set"
+00026990: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000269a0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000269b0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+000269c0: 2020 2020 7061 796c 6f61 645b 226b 6579      payload["key
+000269d0: 5f76 6572 7369 6f6e 225d 203d 206b 6579  _version"] = key
+000269e0: 5f76 6572 7369 6f6e 0d0a 2020 2020 2020  _version..      
+000269f0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00026a00: 2020 2020 2020 2020 6966 2062 6174 6368          if batch
+00026a10: 5f69 6e70 7574 2069 7320 4e6f 6e65 3a0d  _input is None:.
+00026a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026a30: 2069 6620 6e6f 7420 6973 5f62 6173 6536   if not is_base6
+00026a40: 3428 696e 7075 745f 6461 7461 293a 0d0a  4(input_data):..
+00026a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026a60: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00026a70: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
+00026a80: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2073  __.__name__} - s
+00026a90: 6967 6e20 6461 7461 2065 7272 6f72 3a20  ign data error: 
+00026aa0: 7468 6520 696e 7075 745f 6461 7461 206d  the input_data m
+00026ab0: 7573 7420 6265 2062 6173 6536 3420 656e  ust be base64 en
+00026ac0: 636f 6465 6422 290d 0a20 2020 2020 2020  coded")..       
+00026ad0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00026ae0: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+00026af0: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
+00026b00: 645b 2269 6e70 7574 225d 203d 2069 6e70  d["input"] = inp
+00026b10: 7574 5f64 6174 610d 0a20 2020 2020 2020  ut_data..       
+00026b20: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00026b30: 2020 2020 2020 2069 6620 6261 7463 685f         if batch_
+00026b40: 696e 7075 7420 6973 204e 6f6e 6520 616e  input is None an
+00026b50: 6420 636f 6e74 6578 7420 213d 2022 223a  d context != "":
+00026b60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026b70: 2020 6966 206e 6f74 2069 735f 6261 7365    if not is_base
+00026b80: 3634 2863 6f6e 7465 7874 293a 0d0a 2020  64(context):..  
+00026b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ba0: 2020 7365 6c66 2e6c 6f67 6765 722e 6572    self.logger.er
+00026bb0: 726f 7228 6622 7b5f 5f63 6c61 7373 5f5f  ror(f"{__class__
+00026bc0: 2e5f 5f6e 616d 655f 5f7d 202d 2073 6967  .__name__} - sig
+00026bd0: 6e20 6461 7461 2065 7272 6f72 3a20 7468  n data error: th
+00026be0: 6520 636f 6e74 6578 7420 6d75 7374 2062  e context must b
+00026bf0: 6520 6261 7365 3634 2065 6e63 6f64 6564  e base64 encoded
+00026c00: 2069 6620 7365 7422 290d 0a20 2020 2020   if set")..     
+00026c10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00026c20: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
+00026c30: 2020 2020 2020 2020 2020 2020 7061 796c              payl
+00026c40: 6f61 645b 2263 6f6e 7465 7874 225d 203d  oad["context"] =
+00026c50: 2063 6f6e 7465 7874 0d0a 2020 2020 2020   context..      
+00026c60: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00026c70: 2020 2020 2020 2020 6966 2062 6174 6368          if batch
+00026c80: 5f69 6e70 7574 2069 7320 6e6f 7420 4e6f  _input is not No
+00026c90: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00026ca0: 2020 2020 2069 6620 7265 6665 7265 6e63       if referenc
+00026cb0: 6520 213d 2022 223a 0d0a 2020 2020 2020  e != "":..      
+00026cc0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00026cd0: 796c 6f61 645b 2272 6566 6572 656e 6365  yload["reference
+00026ce0: 225d 203d 2072 6566 6572 656e 6365 0d0a  "] = reference..
+00026cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026d00: 7061 796c 6f61 645b 2262 6174 6368 5f69  payload["batch_i
+00026d10: 6e70 7574 225d 203d 2062 6174 6368 5f69  nput"] = batch_i
+00026d20: 6e70 7574 0d0a 2020 2020 2020 2020 2020  nput..          
+00026d30: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00026d40: 2020 2020 6966 2070 7265 6861 7368 6564      if prehashed
+00026d50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00026d60: 2020 2070 6179 6c6f 6164 5b22 7072 6568     payload["preh
+00026d70: 6173 6865 6422 5d20 3d20 7072 6568 6173  ashed"] = prehas
+00026d80: 6865 640d 0a20 2020 2020 2020 2020 2020  hed..           
+00026d90: 200d 0a20 2020 2020 2020 2020 2020 2069   ..            i
+00026da0: 6620 7369 676e 6174 7572 655f 616c 676f  f signature_algo
+00026db0: 7269 7468 6d20 213d 2022 223a 0d0a 2020  rithm != "":..  
+00026dc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00026dd0: 2073 6967 6e61 7475 7265 5f61 6c67 6f72   signature_algor
+00026de0: 6974 686d 206e 6f74 2069 6e20 5b22 7073  ithm not in ["ps
+00026df0: 7322 2c20 2270 6b63 7331 7631 3522 5d3a  s", "pkcs1v15"]:
+00026e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026e10: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00026e20: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
+00026e30: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
+00026e40: 2073 6967 6e20 6461 7461 2065 7272 6f72   sign data error
+00026e50: 3a20 7369 676e 6174 7572 655f 616c 676f  : signature_algo
+00026e60: 7269 7468 6d20 6d75 7374 2062 6520 6f6e  rithm must be on
+00026e70: 6520 6f66 3a20 7073 732c 2070 6b63 7331  e of: pss, pkcs1
+00026e80: 7631 3522 290d 0a20 2020 2020 2020 2020  v15")..         
+00026e90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00026ea0: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+00026eb0: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
+00026ec0: 2273 6967 6e61 7475 7265 5f61 6c67 6f72  "signature_algor
+00026ed0: 6974 686d 225d 203d 2073 6967 6e61 7475  ithm"] = signatu
+00026ee0: 7265 5f61 6c67 6f72 6974 686d 0d0a 2020  re_algorithm..  
+00026ef0: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00026f00: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00026f10: 6172 7368 616c 696e 675f 616c 676f 7269  arshaling_algori
+00026f20: 7468 6d20 213d 2022 223a 0d0a 2020 2020  thm != "":..    
+00026f30: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00026f40: 6172 7368 616c 696e 675f 616c 676f 7269  arshaling_algori
+00026f50: 7468 6d20 6e6f 7420 696e 205b 2261 736e  thm not in ["asn
+00026f60: 3122 2c20 226a 7773 225d 3a0d 0a20 2020  1", "jws"]:..   
+00026f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f80: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
+00026f90: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
+00026fa0: 5f5f 6e61 6d65 5f5f 7d20 2d20 7369 676e  __name__} - sign
+00026fb0: 2064 6174 6120 6572 726f 723a 206d 6172   data error: mar
+00026fc0: 7368 616c 696e 675f 616c 676f 7269 7468  shaling_algorith
+00026fd0: 6d20 6d75 7374 2062 6520 6f6e 6520 6f66  m must be one of
+00026fe0: 3a20 7073 6173 6e31 732c 206a 7773 2229  : psasn1s, jws")
+00026ff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00027000: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00027010: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00027020: 2020 2070 6179 6c6f 6164 5b22 6d61 7273     payload["mars
+00027030: 6861 6c69 6e67 5f61 6c67 6f72 6974 686d  haling_algorithm
+00027040: 225d 203d 206d 6172 7368 616c 696e 675f  "] = marshaling_
+00027050: 616c 676f 7269 7468 6d0d 0a20 2020 2020  algorithm..     
+00027060: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00027070: 2020 2020 2020 2020 2069 6620 7361 6c74           if salt
+00027080: 5f6c 656e 6774 6820 213d 2022 223a 0d0a  _length != "":..
+00027090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000270a0: 7061 796c 6f61 645b 2273 616c 745f 6c65  payload["salt_le
+000270b0: 6e67 7468 225d 203d 2073 616c 745f 6c65  ngth"] = salt_le
+000270c0: 6e67 7468 0d0a 2020 2020 2020 2020 2020  ngth..          
+000270d0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000270e0: 2020 2020 7572 6c20 3d20 6165 735f 6465      url = aes_de
+000270f0: 6372 7970 745f 7465 7874 2873 656c 662e  crypt_text(self.
+00027100: 7572 6c2c 206b 6579 3d72 616e 646f 6d5f  url, key=random_
+00027110: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
+00027120: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
+00027130: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
+00027140: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
+00027150: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00027160: 746f 6b65 6e20 3d20 6165 735f 6465 6372  token = aes_decr
+00027170: 7970 745f 7465 7874 2873 656c 662e 746f  ypt_text(self.to
+00027180: 6b65 6e2c 206b 6579 3d72 616e 646f 6d5f  ken, key=random_
+00027190: 6865 7828 7365 6c66 2e5f 6b65 795f 6c65  hex(self._key_le
+000271a0: 6e2c 2073 656c 662e 5f73 6565 642a 3229  n, self._seed*2)
+000271b0: 2c20 6976 3d72 616e 646f 6d5f 6865 7828  , iv=random_hex(
+000271c0: 3136 2c20 7365 6c66 2e5f 7365 6564 2a33  16, self._seed*3
+000271d0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+000271e0: 7265 7320 3d20 7265 7175 6573 7473 2e70  res = requests.p
+000271f0: 6f73 7428 7572 6c2b 6622 7b6d 6f75 6e74  ost(url+f"{mount
+00027200: 5f70 6174 687d 2f73 6967 6e2f 7b6e 616d  _path}/sign/{nam
+00027210: 657d 2f7b 6861 7368 5f61 6c67 6f72 6974  e}/{hash_algorit
+00027220: 686d 7d22 2c20 0d0a 2020 2020 2020 2020  hm}", ..        
+00027230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027240: 2020 2020 2020 2020 6865 6164 6572 733d          headers=
+00027250: 7b22 582d 5661 756c 742d 546f 6b65 6e22  {"X-Vault-Token"
+00027260: 3a20 746f 6b65 6e7d 2c20 0d0a 2020 2020  : token}, ..    
+00027270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027280: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00027290: 3d6a 736f 6e2e 6475 6d70 7328 7061 796c  =json.dumps(payl
+000272a0: 6f61 6429 290d 0a20 2020 2020 2020 2020  oad))..         
+000272b0: 2020 2069 6620 7265 732e 7374 6174 7573     if res.status
+000272c0: 5f63 6f64 6520 3d3d 2032 3030 206f 7220  _code == 200 or 
+000272d0: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
+000272e0: 3d3d 2032 3034 3a0d 0a20 2020 2020 2020  == 204:..       
+000272f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00027300: 7265 732e 6a73 6f6e 2829 5b22 6461 7461  res.json()["data
+00027310: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+00027320: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00027330: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
+00027340: 5f65 7272 6f72 5f72 6573 706f 6e73 6528  _error_response(
+00027350: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00027360: 5f5f 2c20 7265 732c 2022 7369 676e 2064  __, res, "sign d
+00027370: 6174 6120 6572 726f 7222 290d 0a20 2020  ata error")..   
+00027380: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00027390: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+000273a0: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
+000273b0: 726e 204e 6f6e 650d 0a0d 0a20 2020 2023  rn None....    #
+000273c0: 2054 4f44 4f3a 2077 6169 7420 666f 7220   TODO: wait for 
+000273d0: 7465 7374 696e 670d 0a20 2020 2064 6566  testing..    def
+000273e0: 2076 6572 6966 795f 7369 676e 6564 5f64   verify_signed_d
+000273f0: 6174 6128 7365 6c66 2c20 0d0a 2020 2020  ata(self, ..    
+00027400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027410: 2020 2020 2020 206d 6f75 6e74 5f70 6174         mount_pat
+00027420: 683a 2073 7472 2c0d 0a20 2020 2020 2020  h: str,..       
 00027430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027440: 2020 2020 2020 2068 6173 685f 616c 676f         hash_algo
-00027450: 7269 7468 6d3a 2073 7472 203d 2022 7368  rithm: str = "sh
-00027460: 6132 2d32 3536 222c 0d0a 2020 2020 2020  a2-256",..      
-00027470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027480: 2020 2020 2069 6e70 7574 5f64 6174 613a       input_data:
-00027490: 2073 7472 203d 2022 222c 0d0a 2020 2020   str = "",..    
-000274a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274b0: 2020 2020 2020 2073 6967 6e61 7475 7265         signature
-000274c0: 3a20 7374 7220 3d20 2222 2c0d 0a20 2020  : str = "",..   
-000274d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274e0: 2020 2020 2020 2020 686d 6163 3a20 7374          hmac: st
-000274f0: 7220 3d20 2222 2c0d 0a20 2020 2020 2020  r = "",..       
-00027500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027510: 2020 2020 7265 6665 7265 6e63 653a 2073      reference: s
-00027520: 7472 203d 2022 222c 0d0a 2020 2020 2020  tr = "",..      
-00027530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027540: 2020 2020 2062 6174 6368 5f69 6e70 7574       batch_input
-00027550: 3a20 4f70 7469 6f6e 616c 5b4c 6973 745b  : Optional[List[
-00027560: 6469 6374 5d5d 203d 204e 6f6e 652c 0d0a  dict]] = None,..
-00027570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027580: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
-00027590: 7874 3a20 7374 7220 3d20 2222 2c0d 0a20  xt: str = "",.. 
-000275a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000275b0: 2020 2020 2020 2020 2020 7072 6568 6173            prehas
-000275c0: 6865 643a 2062 6f6f 6c20 3d20 4661 6c73  hed: bool = Fals
-000275d0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-000275e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000275f0: 6967 6e61 7475 7265 5f61 6c67 6f72 6974  ignature_algorit
-00027600: 686d 3a20 7374 7220 3d20 2222 2c0d 0a20  hm: str = "",.. 
-00027610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027620: 2020 2020 2020 2020 2020 6d61 7273 6861            marsha
-00027630: 6c69 6e67 5f61 6c67 6f72 6974 686d 3a20  ling_algorithm: 
-00027640: 7374 7220 3d20 2222 2c0d 0a20 2020 2020  str = "",..     
-00027650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027660: 2020 2020 2020 7361 6c74 5f6c 656e 6774        salt_lengt
-00027670: 683a 2073 7472 203d 2022 2229 3a0d 0a20  h: str = ""):.. 
-00027680: 2020 2020 2020 2022 2222 7665 7269 6679         """verify
-00027690: 2077 6865 7468 6572 2074 6865 2070 726f   whether the pro
-000276a0: 7669 6465 6420 7369 676e 6174 7572 6520  vided signature 
-000276b0: 6973 2076 616c 6964 2066 6f72 2074 6865  is valid for the
-000276c0: 2067 6976 656e 2064 6174 610d 0a20 2020   given data..   
-000276d0: 2020 2020 200d 0a20 2020 2020 2020 2052       ..        R
-000276e0: 6566 6572 2074 6f20 6874 7470 733a 2f2f  efer to https://
-000276f0: 6465 7665 6c6f 7065 722e 6861 7368 6963  developer.hashic
-00027700: 6f72 702e 636f 6d2f 7661 756c 742f 6170  orp.com/vault/ap
-00027710: 692d 646f 6373 2f73 6563 7265 742f 7472  i-docs/secret/tr
-00027720: 616e 7369 7423 7665 7269 6679 2d73 6967  ansit#verify-sig
-00027730: 6e65 642d 6461 7461 2066 6f72 206d 6f72  ned-data for mor
-00027740: 6520 6465 7461 696c 732e 0d0a 0d0a 2020  e details.....  
-00027750: 2020 2020 2020 4172 6773 3a0d 0a20 2020        Args:..   
-00027760: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
-00027770: 6174 6820 2873 7472 290d 0a20 2020 2020  ath (str)..     
-00027780: 2020 2020 2020 206e 616d 6520 2873 7472         name (str
-00027790: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
-000277a0: 206e 616d 6520 6f66 2074 6865 2065 6e63   name of the enc
-000277b0: 7279 7074 696f 6e20 6b65 7920 7468 6174  ryption key that
-000277c0: 2077 6173 2075 7365 6420 746f 2067 656e   was used to gen
-000277d0: 6572 6174 6520 7468 6520 7369 676e 6174  erate the signat
-000277e0: 7572 6520 6f72 2048 4d41 432e 0d0a 2020  ure or HMAC...  
-000277f0: 2020 2020 2020 2020 2020 6861 7368 5f61            hash_a
-00027800: 6c67 6f72 6974 686d 2028 7374 722c 206f  lgorithm (str, o
-00027810: 7074 696f 6e61 6c29 3a20 5370 6563 6966  ptional): Specif
-00027820: 6965 7320 7468 6520 6861 7368 2061 6c67  ies the hash alg
-00027830: 6f72 6974 686d 2074 6f20 7573 652e 2054  orithm to use. T
-00027840: 6869 7320 6361 6e20 616c 736f 2062 6520  his can also be 
-00027850: 7370 6563 6966 6965 6420 6173 200d 0a20  specified as .. 
-00027860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027880: 2020 2020 2020 2020 2020 2070 6172 7420             part 
-00027890: 6f66 2074 6865 2055 524c 2e20 4375 7272  of the URL. Curr
-000278a0: 656e 746c 792d 7375 7070 6f72 7465 6420  ently-supported 
-000278b0: 616c 676f 7269 7468 6d73 2061 7265 3a20  algorithms are: 
-000278c0: 7368 6131 2c20 7368 6132 2d32 3234 2c20  sha1, sha2-224, 
-000278d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000278e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278f0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00027900: 6132 2d32 3536 2c20 7368 6132 2d33 3834  a2-256, sha2-384
-00027910: 2c20 7368 6132 2d35 3132 2c20 7368 6133  , sha2-512, sha3
-00027920: 2d32 3234 2c20 7368 6133 2d33 3834 2c20  -224, sha3-384, 
-00027930: 7368 6133 2d35 3132 2c20 6e6f 6e65 2e20  sha3-512, none. 
-00027940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00027950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027960: 2020 2020 2020 2020 2020 2020 2020 4465                De
-00027970: 6661 756c 7473 2074 6f20 2273 6861 322d  faults to "sha2-
-00027980: 3235 3622 2e0d 0a20 2020 2020 2020 2020  256"...         
-00027990: 2020 2069 6e70 7574 5f64 6174 6120 2873     input_data (s
-000279a0: 7472 2c20 6f70 7469 6f6e 616c 293a 2053  tr, optional): S
-000279b0: 7065 6369 6669 6573 2074 6865 2062 6173  pecifies the bas
-000279c0: 6536 3420 656e 636f 6465 6420 696e 7075  e64 encoded inpu
-000279d0: 7420 6461 7461 2e20 4f6e 6520 6f66 2060  t data. One of `
-000279e0: 696e 7075 7460 206f 7220 6062 6174 6368  input` or `batch
-000279f0: 5f69 6e70 7574 6020 0d0a 2020 2020 2020  _input` ..      
-00027a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a20: 2020 6d75 7374 2062 6520 7375 7070 6c69    must be suppli
-00027a30: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
-00027a40: 2222 2e0d 0a20 2020 2020 2020 2020 2020  ""...           
-00027a50: 2073 6967 6e61 7475 7265 2028 7374 722c   signature (str,
-00027a60: 206f 7074 696f 6e61 6c29 3a20 5370 6563   optional): Spec
-00027a70: 6966 6965 7320 7468 6520 7369 676e 6174  ifies the signat
-00027a80: 7572 6520 6f75 7470 7574 2066 726f 6d20  ure output from 
-00027a90: 7468 6520 602f 7472 616e 7369 742f 7369  the `/transit/si
-00027aa0: 676e 6020 6675 6e63 7469 6f6e 2e20 4569  gn` function. Ei
-00027ab0: 7468 6572 200d 0a20 2020 2020 2020 2020  ther ..         
-00027ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ad0: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00027ae0: 6973 206d 7573 7420 6265 2073 7570 706c  is must be suppl
-00027af0: 6965 6420 6f72 2060 686d 6163 6020 6d75  ied or `hmac` mu
-00027b00: 7374 2062 6520 7375 7070 6c69 6564 2e20  st be supplied. 
-00027b10: 4465 6661 756c 7473 2074 6f20 2222 2e0d  Defaults to ""..
-00027b20: 0a20 2020 2020 2020 2020 2020 2068 6d61  .            hma
-00027b30: 6320 2873 7472 2c20 6f70 7469 6f6e 616c  c (str, optional
-00027b40: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
-00027b50: 2073 6967 6e61 7475 7265 206f 7574 7075   signature outpu
-00027b60: 7420 6672 6f6d 2074 6865 2060 2f74 7261  t from the `/tra
-00027b70: 6e73 6974 2f68 6d61 6360 2066 756e 6374  nsit/hmac` funct
-00027b80: 696f 6e2e 2045 6974 6865 7220 7468 6973  ion. Either this
-00027b90: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00027ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027bb0: 2020 2020 206d 7573 7420 6265 2073 7570       must be sup
-00027bc0: 706c 6965 6420 6f72 2060 7369 676e 6174  plied or `signat
-00027bd0: 7572 6560 206d 7573 7420 6265 2073 7570  ure` must be sup
-00027be0: 706c 6965 642e 2044 6566 6175 6c74 7320  plied. Defaults 
-00027bf0: 746f 2022 222e 0d0a 2020 2020 2020 2020  to ""...        
-00027c00: 2020 2020 7265 6665 7265 6e63 6520 2873      reference (s
-00027c10: 7472 2c20 6f70 7469 6f6e 616c 293a 2041  tr, optional): A
-00027c20: 2075 7365 722d 7375 7070 6c69 6564 2073   user-supplied s
-00027c30: 7472 696e 6720 7468 6174 2077 696c 6c20  tring that will 
-00027c40: 6265 2070 7265 7365 6e74 2069 6e20 7468  be present in th
-00027c50: 6520 6072 6566 6572 656e 6365 6020 6669  e `reference` fi
-00027c60: 656c 6420 6f6e 200d 0a20 2020 2020 2020  eld on ..       
-00027c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c90: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
-00027ca0: 6720 6062 6174 6368 5f72 6573 756c 7473  g `batch_results
-00027cb0: 6020 6974 656d 2069 6e20 7468 6520 7265  ` item in the re
-00027cc0: 7370 6f6e 7365 2c20 746f 2061 7373 6973  sponse, to assis
-00027cd0: 7420 696e 200d 0a20 2020 2020 2020 2020  t in ..         
-00027ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027cf0: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00027d00: 6465 7273 7461 6e64 696e 6720 7768 6963  derstanding whic
-00027d10: 6820 7265 7375 6c74 2063 6f72 7265 7370  h result corresp
-00027d20: 6f6e 6473 2074 6f20 6120 7061 7274 6963  onds to a partic
-00027d30: 756c 6172 2069 6e70 7574 2e20 4f6e 6c79  ular input. Only
-00027d40: 2076 616c 6964 200d 0a20 2020 2020 2020   valid ..       
-00027d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d70: 6f6e 2062 6174 6368 2072 6571 7565 7374  on batch request
-00027d80: 7320 7768 656e 2075 7369 6e67 20e2 8098  s when using ...
-00027d90: 6261 7463 685f 696e 7075 74e2 8099 2062  batch_input... b
-00027da0: 656c 6f77 2e20 4465 6661 756c 7473 2074  elow. Defaults t
-00027db0: 6f20 2222 2e0d 0a20 2020 2020 2020 2020  o ""...         
-00027dc0: 2020 2062 6174 6368 5f69 6e70 7574 2028     batch_input (
-00027dd0: 4f70 7469 6f6e 616c 5b4c 6973 745b 6469  Optional[List[di
-00027de0: 6374 5d5d 2c20 6f70 7469 6f6e 616c 293a  ct]], optional):
-00027df0: 2053 7065 6369 6669 6573 2061 206c 6973   Specifies a lis
-00027e00: 7420 6f66 2069 7465 6d73 2066 6f72 2070  t of items for p
-00027e10: 726f 6365 7373 696e 672e 2057 6865 6e20  rocessing. When 
-00027e20: 7468 6973 200d 0a20 2020 2020 2020 2020  this ..         
-00027e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027440: 2020 2020 6e61 6d65 3a20 7374 722c 0d0a      name: str,..
+00027450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027460: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00027470: 616c 676f 7269 7468 6d3a 2073 7472 203d  algorithm: str =
+00027480: 2022 7368 6132 2d32 3536 222c 0d0a 2020   "sha2-256",..  
+00027490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000274a0: 2020 2020 2020 2020 2069 6e70 7574 5f64           input_d
+000274b0: 6174 613a 2073 7472 203d 2022 222c 0d0a  ata: str = "",..
+000274c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000274d0: 2020 2020 2020 2020 2020 2073 6967 6e61             signa
+000274e0: 7475 7265 3a20 7374 7220 3d20 2222 2c0d  ture: str = "",.
+000274f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027500: 2020 2020 2020 2020 2020 2020 686d 6163              hmac
+00027510: 3a20 7374 7220 3d20 2222 2c0d 0a20 2020  : str = "",..   
+00027520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027530: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
+00027540: 653a 2073 7472 203d 2022 222c 0d0a 2020  e: str = "",..  
+00027550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027560: 2020 2020 2020 2020 2062 6174 6368 5f69           batch_i
+00027570: 6e70 7574 3a20 4f70 7469 6f6e 616c 5b4c  nput: Optional[L
+00027580: 6973 745b 6469 6374 5d5d 203d 204e 6f6e  ist[dict]] = Non
+00027590: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+000275a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000275b0: 6f6e 7465 7874 3a20 7374 7220 3d20 2222  ontext: str = ""
+000275c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000275d0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000275e0: 6568 6173 6865 643a 2062 6f6f 6c20 3d20  ehashed: bool = 
+000275f0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
+00027600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027610: 2020 2073 6967 6e61 7475 7265 5f61 6c67     signature_alg
+00027620: 6f72 6974 686d 3a20 7374 7220 3d20 2222  orithm: str = ""
+00027630: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00027640: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00027650: 7273 6861 6c69 6e67 5f61 6c67 6f72 6974  rshaling_algorit
+00027660: 686d 3a20 7374 7220 3d20 2222 2c0d 0a20  hm: str = "",.. 
+00027670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027680: 2020 2020 2020 2020 2020 7361 6c74 5f6c            salt_l
+00027690: 656e 6774 683a 2073 7472 203d 2022 2229  ength: str = "")
+000276a0: 3a0d 0a20 2020 2020 2020 2022 2222 7665  :..        """ve
+000276b0: 7269 6679 2077 6865 7468 6572 2074 6865  rify whether the
+000276c0: 2070 726f 7669 6465 6420 7369 676e 6174   provided signat
+000276d0: 7572 6520 6973 2076 616c 6964 2066 6f72  ure is valid for
+000276e0: 2074 6865 2067 6976 656e 2064 6174 610d   the given data.
+000276f0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00027700: 2020 2052 6566 6572 2074 6f20 6874 7470     Refer to http
+00027710: 733a 2f2f 6465 7665 6c6f 7065 722e 6861  s://developer.ha
+00027720: 7368 6963 6f72 702e 636f 6d2f 7661 756c  shicorp.com/vaul
+00027730: 742f 6170 692d 646f 6373 2f73 6563 7265  t/api-docs/secre
+00027740: 742f 7472 616e 7369 7423 7665 7269 6679  t/transit#verify
+00027750: 2d73 6967 6e65 642d 6461 7461 2066 6f72  -signed-data for
+00027760: 206d 6f72 6520 6465 7461 696c 732e 0d0a   more details...
+00027770: 0d0a 2020 2020 2020 2020 4172 6773 3a0d  ..        Args:.
+00027780: 0a20 2020 2020 2020 2020 2020 206d 6f75  .            mou
+00027790: 6e74 5f70 6174 6820 2873 7472 290d 0a20  nt_path (str).. 
+000277a0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+000277b0: 2873 7472 293a 2053 7065 6369 6669 6573  (str): Specifies
+000277c0: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+000277d0: 2065 6e63 7279 7074 696f 6e20 6b65 7920   encryption key 
+000277e0: 7468 6174 2077 6173 2075 7365 6420 746f  that was used to
+000277f0: 2067 656e 6572 6174 6520 7468 6520 7369   generate the si
+00027800: 676e 6174 7572 6520 6f72 2048 4d41 432e  gnature or HMAC.
+00027810: 0d0a 2020 2020 2020 2020 2020 2020 6861  ..            ha
+00027820: 7368 5f61 6c67 6f72 6974 686d 2028 7374  sh_algorithm (st
+00027830: 722c 206f 7074 696f 6e61 6c29 3a20 5370  r, optional): Sp
+00027840: 6563 6966 6965 7320 7468 6520 6861 7368  ecifies the hash
+00027850: 2061 6c67 6f72 6974 686d 2074 6f20 7573   algorithm to us
+00027860: 652e 2054 6869 7320 6361 6e20 616c 736f  e. This can also
+00027870: 2062 6520 7370 6563 6966 6965 6420 6173   be specified as
+00027880: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00027890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000278b0: 6172 7420 6f66 2074 6865 2055 524c 2e20  art of the URL. 
+000278c0: 4375 7272 656e 746c 792d 7375 7070 6f72  Currently-suppor
+000278d0: 7465 6420 616c 676f 7269 7468 6d73 2061  ted algorithms a
+000278e0: 7265 3a20 7368 6131 2c20 7368 6132 2d32  re: sha1, sha2-2
+000278f0: 3234 2c20 0d0a 2020 2020 2020 2020 2020  24, ..          
+00027900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027920: 2020 7368 6132 2d32 3536 2c20 7368 6132    sha2-256, sha2
+00027930: 2d33 3834 2c20 7368 6132 2d35 3132 2c20  -384, sha2-512, 
+00027940: 7368 6133 2d32 3234 2c20 7368 6133 2d33  sha3-224, sha3-3
+00027950: 3834 2c20 7368 6133 2d35 3132 2c20 6e6f  84, sha3-512, no
+00027960: 6e65 2e20 0d0a 2020 2020 2020 2020 2020  ne. ..          
+00027970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027990: 2020 4465 6661 756c 7473 2074 6f20 2273    Defaults to "s
+000279a0: 6861 322d 3235 3622 2e0d 0a20 2020 2020  ha2-256"...     
+000279b0: 2020 2020 2020 2069 6e70 7574 5f64 6174         input_dat
+000279c0: 6120 2873 7472 2c20 6f70 7469 6f6e 616c  a (str, optional
+000279d0: 293a 2053 7065 6369 6669 6573 2074 6865  ): Specifies the
+000279e0: 2062 6173 6536 3420 656e 636f 6465 6420   base64 encoded 
+000279f0: 696e 7075 7420 6461 7461 2e20 4f6e 6520  input data. One 
+00027a00: 6f66 2060 696e 7075 7460 206f 7220 6062  of `input` or `b
+00027a10: 6174 6368 5f69 6e70 7574 6020 0d0a 2020  atch_input` ..  
+00027a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a40: 2020 2020 2020 6d75 7374 2062 6520 7375        must be su
+00027a50: 7070 6c69 6564 2e20 4465 6661 756c 7473  pplied. Defaults
+00027a60: 2074 6f20 2222 2e0d 0a20 2020 2020 2020   to ""...       
+00027a70: 2020 2020 2073 6967 6e61 7475 7265 2028       signature (
+00027a80: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+00027a90: 5370 6563 6966 6965 7320 7468 6520 7369  Specifies the si
+00027aa0: 676e 6174 7572 6520 6f75 7470 7574 2066  gnature output f
+00027ab0: 726f 6d20 7468 6520 602f 7472 616e 7369  rom the `/transi
+00027ac0: 742f 7369 676e 6020 6675 6e63 7469 6f6e  t/sign` function
+00027ad0: 2e20 4569 7468 6572 200d 0a20 2020 2020  . Either ..     
+00027ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b00: 2020 7468 6973 206d 7573 7420 6265 2073    this must be s
+00027b10: 7570 706c 6965 6420 6f72 2060 686d 6163  upplied or `hmac
+00027b20: 6020 6d75 7374 2062 6520 7375 7070 6c69  ` must be suppli
+00027b30: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
+00027b40: 2222 2e0d 0a20 2020 2020 2020 2020 2020  ""...           
+00027b50: 2068 6d61 6320 2873 7472 2c20 6f70 7469   hmac (str, opti
+00027b60: 6f6e 616c 293a 2053 7065 6369 6669 6573  onal): Specifies
+00027b70: 2074 6865 2073 6967 6e61 7475 7265 206f   the signature o
+00027b80: 7574 7075 7420 6672 6f6d 2074 6865 2060  utput from the `
+00027b90: 2f74 7261 6e73 6974 2f68 6d61 6360 2066  /transit/hmac` f
+00027ba0: 756e 6374 696f 6e2e 2045 6974 6865 7220  unction. Either 
+00027bb0: 7468 6973 200d 0a20 2020 2020 2020 2020  this ..         
+00027bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027bd0: 2020 2020 2020 2020 206d 7573 7420 6265           must be
+00027be0: 2073 7570 706c 6965 6420 6f72 2060 7369   supplied or `si
+00027bf0: 676e 6174 7572 6560 206d 7573 7420 6265  gnature` must be
+00027c00: 2073 7570 706c 6965 642e 2044 6566 6175   supplied. Defau
+00027c10: 6c74 7320 746f 2022 222e 0d0a 2020 2020  lts to ""...    
+00027c20: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
+00027c30: 6520 2873 7472 2c20 6f70 7469 6f6e 616c  e (str, optional
+00027c40: 293a 2041 2075 7365 722d 7375 7070 6c69  ): A user-suppli
+00027c50: 6564 2073 7472 696e 6720 7468 6174 2077  ed string that w
+00027c60: 696c 6c20 6265 2070 7265 7365 6e74 2069  ill be present i
+00027c70: 6e20 7468 6520 6072 6566 6572 656e 6365  n the `reference
+00027c80: 6020 6669 656c 6420 6f6e 200d 0a20 2020  ` field on ..   
+00027c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027cb0: 2020 2020 7468 6520 636f 7272 6573 706f      the correspo
+00027cc0: 6e64 696e 6720 6062 6174 6368 5f72 6573  nding `batch_res
+00027cd0: 756c 7473 6020 6974 656d 2069 6e20 7468  ults` item in th
+00027ce0: 6520 7265 7370 6f6e 7365 2c20 746f 2061  e response, to a
+00027cf0: 7373 6973 7420 696e 200d 0a20 2020 2020  ssist in ..     
+00027d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d20: 2020 756e 6465 7273 7461 6e64 696e 6720    understanding 
+00027d30: 7768 6963 6820 7265 7375 6c74 2063 6f72  which result cor
+00027d40: 7265 7370 6f6e 6473 2074 6f20 6120 7061  responds to a pa
+00027d50: 7274 6963 756c 6172 2069 6e70 7574 2e20  rticular input. 
+00027d60: 4f6e 6c79 2076 616c 6964 200d 0a20 2020  Only valid ..   
+00027d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d90: 2020 2020 6f6e 2062 6174 6368 2072 6571      on batch req
+00027da0: 7565 7374 7320 7768 656e 2075 7369 6e67  uests when using
+00027db0: 20e2 8098 6261 7463 685f 696e 7075 74e2   ...batch_input.
+00027dc0: 8099 2062 656c 6f77 2e20 4465 6661 756c  .. below. Defaul
+00027dd0: 7473 2074 6f20 2222 2e0d 0a20 2020 2020  ts to ""...     
+00027de0: 2020 2020 2020 2062 6174 6368 5f69 6e70         batch_inp
+00027df0: 7574 2028 4f70 7469 6f6e 616c 5b4c 6973  ut (Optional[Lis
+00027e00: 745b 6469 6374 5d5d 2c20 6f70 7469 6f6e  t[dict]], option
+00027e10: 616c 293a 2053 7065 6369 6669 6573 2061  al): Specifies a
+00027e20: 206c 6973 7420 6f66 2069 7465 6d73 2066   list of items f
+00027e30: 6f72 2070 726f 6365 7373 696e 672e 2057  or processing. W
+00027e40: 6865 6e20 7468 6973 200d 0a20 2020 2020  hen this ..     
 00027e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e60: 2070 6172 616d 6574 6572 2069 7320 7365   parameter is se
-00027e70: 742c 2061 6e79 2073 7570 706c 6965 6420  t, any supplied 
-00027e80: 2769 6e70 7574 272c 2027 686d 6163 2720  'input', 'hmac' 
-00027e90: 6f72 200d 0a20 2020 2020 2020 2020 2020  or ..           
-00027ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ec0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00027ed0: 7369 676e 6174 7572 6527 2070 6172 616d  signature' param
-00027ee0: 6574 6572 7320 7769 6c6c 2062 6520 6967  eters will be ig
-00027ef0: 6e6f 7265 642e 2027 6261 7463 685f 696e  nored. 'batch_in
-00027f00: 7075 7427 200d 0a20 2020 2020 2020 2020  put' ..         
-00027f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e80: 2020 2020 2070 6172 616d 6574 6572 2069       parameter i
+00027e90: 7320 7365 742c 2061 6e79 2073 7570 706c  s set, any suppl
+00027ea0: 6965 6420 2769 6e70 7574 272c 2027 686d  ied 'input', 'hm
+00027eb0: 6163 2720 6f72 200d 0a20 2020 2020 2020  ac' or ..       
+00027ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ef0: 2020 2027 7369 676e 6174 7572 6527 2070     'signature' p
+00027f00: 6172 616d 6574 6572 7320 7769 6c6c 2062  arameters will b
+00027f10: 6520 6967 6e6f 7265 642e 2027 6261 7463  e ignored. 'batc
+00027f20: 685f 696e 7075 7427 200d 0a20 2020 2020  h_input' ..     
 00027f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f40: 2069 7465 6d73 2073 686f 756c 6420 636f   items should co
-00027f50: 6e74 6169 6e20 616e 2027 696e 7075 7427  ntain an 'input'
-00027f60: 2070 6172 616d 6574 6572 2061 6e64 2065   parameter and e
-00027f70: 6974 6865 7220 0d0a 2020 2020 2020 2020  ither ..        
-00027f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f60: 2020 2020 2069 7465 6d73 2073 686f 756c       items shoul
+00027f70: 6420 636f 6e74 6169 6e20 616e 2027 696e  d contain an 'in
+00027f80: 7075 7427 2070 6172 616d 6574 6572 2061  put' parameter a
+00027f90: 6e64 2065 6974 6865 7220 0d0a 2020 2020  nd either ..    
 00027fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fb0: 2020 616e 2027 686d 6163 2720 6f72 2027    an 'hmac' or '
-00027fc0: 7369 676e 6174 7572 6527 2070 6172 616d  signature' param
-00027fd0: 6574 6572 2e20 416c 6c20 6974 656d 7320  eter. All items 
-00027fe0: 696e 2074 6865 200d 0a20 2020 2020 2020  in the ..       
-00027ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fd0: 2020 2020 2020 616e 2027 686d 6163 2720        an 'hmac' 
+00027fe0: 6f72 2027 7369 676e 6174 7572 6527 2070  or 'signature' p
+00027ff0: 6172 616d 6574 6572 2e20 416c 6c20 6974  arameter. All it
+00028000: 656d 7320 696e 2074 6865 200d 0a20 2020  ems in the ..   
 00028010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028020: 2020 2062 6174 6368 206d 7573 7420 636f     batch must co
-00028030: 6e73 6973 7465 6e74 6c79 2073 7570 706c  nsistently suppl
-00028040: 7920 6569 7468 6572 2027 686d 6163 2720  y either 'hmac' 
-00028050: 6f72 200d 0a20 2020 2020 2020 2020 2020  or ..           
-00028060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028080: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00028090: 7369 676e 6174 7572 6527 2070 6172 616d  signature' param
-000280a0: 6574 6572 732e 2049 7420 6973 2061 6e20  eters. It is an 
-000280b0: 6572 726f 7220 666f 7220 736f 6d65 2069  error for some i
-000280c0: 7465 6d73 200d 0a20 2020 2020 2020 2020  tems ..         
-000280d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000280e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028040: 2020 2020 2020 2062 6174 6368 206d 7573         batch mus
+00028050: 7420 636f 6e73 6973 7465 6e74 6c79 2073  t consistently s
+00028060: 7570 706c 7920 6569 7468 6572 2027 686d  upply either 'hm
+00028070: 6163 2720 6f72 200d 0a20 2020 2020 2020  ac' or ..       
+00028080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000280a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000280b0: 2020 2027 7369 676e 6174 7572 6527 2070     'signature' p
+000280c0: 6172 616d 6574 6572 732e 2049 7420 6973  arameters. It is
+000280d0: 2061 6e20 6572 726f 7220 666f 7220 736f   an error for so
+000280e0: 6d65 2069 7465 6d73 200d 0a20 2020 2020  me items ..     
 000280f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028100: 2074 6f20 7375 7070 6c79 2027 686d 6163   to supply 'hmac
-00028110: 2720 7768 696c 6520 6f74 6865 7273 2073  ' while others s
-00028120: 7570 706c 7920 2773 6967 6e61 7475 7265  upply 'signature
-00028130: 272e 200d 0a20 2020 2020 2020 2020 2020  '. ..           
-00028140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028160: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-00028170: 6573 706f 6e73 6573 2061 7265 2072 6574  esponses are ret
-00028180: 7572 6e65 6420 696e 2074 6865 2027 6261  urned in the 'ba
-00028190: 7463 685f 7265 7375 6c74 7327 2061 7272  tch_results' arr
-000281a0: 6179 200d 0a20 2020 2020 2020 2020 2020  ay ..           
-000281b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000281e0: 6f6d 706f 6e65 6e74 206f 6620 7468 6520  omponent of the 
-000281f0: 2764 6174 6127 2065 6c65 6d65 6e74 206f  'data' element o
-00028200: 6620 7468 6520 7265 7370 6f6e 7365 2e20  f the response. 
-00028210: 416e 7920 0d0a 2020 2020 2020 2020 2020  Any ..          
-00028220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028120: 2020 2020 2074 6f20 7375 7070 6c79 2027       to supply '
+00028130: 686d 6163 2720 7768 696c 6520 6f74 6865  hmac' while othe
+00028140: 7273 2073 7570 706c 7920 2773 6967 6e61  rs supply 'signa
+00028150: 7475 7265 272e 200d 0a20 2020 2020 2020  ture'. ..       
+00028160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028190: 2020 2052 6573 706f 6e73 6573 2061 7265     Responses are
+000281a0: 2072 6574 7572 6e65 6420 696e 2074 6865   returned in the
+000281b0: 2027 6261 7463 685f 7265 7375 6c74 7327   'batch_results'
+000281c0: 2061 7272 6179 200d 0a20 2020 2020 2020   array ..       
+000281d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028200: 2020 2063 6f6d 706f 6e65 6e74 206f 6620     component of 
+00028210: 7468 6520 2764 6174 6127 2065 6c65 6d65  the 'data' eleme
+00028220: 6e74 206f 6620 7468 6520 7265 7370 6f6e  nt of the respon
+00028230: 7365 2e20 416e 7920 0d0a 2020 2020 2020  se. Any ..      
 00028240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028250: 6261 7463 6820 6f75 7470 7574 2077 696c  batch output wil
-00028260: 6c20 7072 6573 6572 7665 2074 6865 206f  l preserve the o
-00028270: 7264 6572 206f 6620 7468 6520 6261 7463  rder of the batc
-00028280: 6820 696e 7075 742e 200d 0a20 2020 2020  h input. ..     
-00028290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000282a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028270: 2020 2020 6261 7463 6820 6f75 7470 7574      batch output
+00028280: 2077 696c 6c20 7072 6573 6572 7665 2074   will preserve t
+00028290: 6865 206f 7264 6572 206f 6620 7468 6520  he order of the 
+000282a0: 6261 7463 6820 696e 7075 742e 200d 0a20  batch input. .. 
 000282b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000282c0: 2020 2020 2049 6620 7468 6520 696e 7075       If the inpu
-000282d0: 7420 6461 7461 2076 616c 7565 206f 6620  t data value of 
-000282e0: 616e 2069 7465 6d20 6973 2069 6e76 616c  an item is inval
-000282f0: 6964 2c20 7468 6520 0d0a 2020 2020 2020  id, the ..      
-00028300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000282c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000282d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000282e0: 2020 2020 2020 2020 2049 6620 7468 6520           If the 
+000282f0: 696e 7075 7420 6461 7461 2076 616c 7565  input data value
+00028300: 206f 6620 616e 2069 7465 6d20 6973 2069   of an item is i
+00028310: 6e76 616c 6964 2c20 7468 6520 0d0a 2020  nvalid, the ..  
 00028320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028330: 2020 2020 636f 7272 6573 706f 6e64 696e      correspondin
-00028340: 6720 6974 656d 2069 6e20 7468 6520 2762  g item in the 'b
-00028350: 6174 6368 5f72 6573 756c 7473 2720 7769  atch_results' wi
-00028360: 6c6c 2068 6176 6520 0d0a 2020 2020 2020  ll have ..      
-00028370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028350: 2020 2020 2020 2020 636f 7272 6573 706f          correspo
+00028360: 6e64 696e 6720 6974 656d 2069 6e20 7468  nding item in th
+00028370: 6520 2762 6174 6368 5f72 6573 756c 7473  e 'batch_results
+00028380: 2720 7769 6c6c 2068 6176 6520 0d0a 2020  ' will have ..  
 00028390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283a0: 2020 2020 7468 6520 6b65 7920 2765 7272      the key 'err
-000283b0: 6f72 2720 7769 7468 2061 2076 616c 7565  or' with a value
-000283c0: 2064 6573 6372 6962 696e 6720 7468 6520   describing the 
-000283d0: 6572 726f 722e 200d 0a20 2020 2020 2020  error. ..       
-000283e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283c0: 2020 2020 2020 2020 7468 6520 6b65 7920          the key 
+000283d0: 2765 7272 6f72 2720 7769 7468 2061 2076  'error' with a v
+000283e0: 616c 7565 2064 6573 6372 6962 696e 6720  alue describing 
+000283f0: 7468 6520 6572 726f 722e 200d 0a20 2020  the error. ..   
 00028400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028410: 2020 2044 6566 6175 6c74 7320 746f 204e     Defaults to N
-00028420: 6f6e 652e 0d0a 2020 2020 2020 2020 2020  one...          
-00028430: 2020 636f 6e74 6578 7420 2873 7472 2c20    context (str, 
-00028440: 6f70 7469 6f6e 616c 293a 2042 6173 6536  optional): Base6
-00028450: 3420 656e 636f 6465 6420 636f 6e74 6578  4 encoded contex
-00028460: 7420 666f 7220 6b65 7920 6465 7269 7661  t for key deriva
-00028470: 7469 6f6e 2e20 5265 7175 6972 6564 2069  tion. Required i
-00028480: 6620 6b65 7920 6465 7269 7661 7469 6f6e  f key derivation
-00028490: 2069 7320 0d0a 2020 2020 2020 2020 2020   is ..          
-000284a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284b0: 2020 2020 2020 2020 2020 2065 6e61 626c             enabl
-000284c0: 6564 3b20 6375 7272 656e 746c 7920 6f6e  ed; currently on
-000284d0: 6c79 2061 7661 696c 6162 6c65 2077 6974  ly available wit
-000284e0: 6820 6564 3235 3531 3920 6b65 7973 2e20  h ed25519 keys. 
-000284f0: 4465 6661 756c 7473 2074 6f20 2222 2e0d  Defaults to ""..
-00028500: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00028510: 6861 7368 6564 2028 626f 6f6c 2c20 6f70  hashed (bool, op
-00028520: 7469 6f6e 616c 293a 2053 6574 2074 6f20  tional): Set to 
-00028530: 6074 7275 6560 2077 6865 6e20 7468 6520  `true` when the 
-00028540: 696e 7075 7420 6973 2061 6c72 6561 6479  input is already
-00028550: 2068 6173 6865 642e 2049 6620 7468 6520   hashed. If the 
-00028560: 6b65 7920 7479 7065 2069 7320 0d0a 2020  key type is ..  
-00028570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028590: 2020 2020 2020 6072 7361 2d32 3034 3860        `rsa-2048`
-000285a0: 2c20 6072 7361 2d33 3037 3260 206f 7220  , `rsa-3072` or 
-000285b0: 6072 7361 2d34 3039 3660 2c20 7468 656e  `rsa-4096`, then
-000285c0: 2074 6865 2061 6c67 6f72 6974 686d 2075   the algorithm u
-000285d0: 7365 6420 746f 2068 6173 6820 0d0a 2020  sed to hash ..  
-000285e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000285f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028600: 2020 2020 2020 7468 6520 696e 7075 7420        the input 
-00028610: 7368 6f75 6c64 2062 6520 696e 6469 6361  should be indica
-00028620: 7465 6420 6279 2074 6865 2060 6861 7368  ted by the `hash
-00028630: 5f61 6c67 6f72 6974 686d 6020 7061 7261  _algorithm` para
-00028640: 6d65 7465 722e 2044 6566 6175 6c74 7320  meter. Defaults 
-00028650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00028660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028670: 2020 2020 2020 2020 2020 746f 2046 616c            to Fal
-00028680: 7365 2e0d 0a20 2020 2020 2020 2020 2020  se...           
-00028690: 2073 6967 6e61 7475 7265 5f61 6c67 6f72   signature_algor
-000286a0: 6974 686d 2028 7374 722c 206f 7074 696f  ithm (str, optio
-000286b0: 6e61 6c29 3a20 5768 656e 2075 7369 6e67  nal): When using
-000286c0: 2061 2052 5341 206b 6579 2c20 7370 6563   a RSA key, spec
-000286d0: 6966 6965 7320 7468 6520 5253 4120 7369  ifies the RSA si
-000286e0: 676e 6174 7572 6520 616c 676f 7269 7468  gnature algorith
-000286f0: 6d20 746f 200d 0a20 2020 2020 2020 2020  m to ..         
-00028700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028720: 2020 2020 2020 2020 7573 6520 666f 7220          use for 
-00028730: 7369 676e 6174 7572 6520 7665 7269 6669  signature verifi
-00028740: 6361 7469 6f6e 2e20 5375 7070 6f72 7465  cation. Supporte
-00028750: 6420 7369 676e 6174 7572 6520 7479 7065  d signature type
-00028760: 7320 6172 653a 200d 0a20 2020 2020 2020  s are: ..       
-00028770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028790: 2020 2020 2020 2020 2020 7073 7320 706b            pss pk
-000287a0: 6373 3176 3135 2e20 4465 6661 756c 7473  cs1v15. Defaults
-000287b0: 2074 6f20 2222 2e0d 0a20 2020 2020 2020   to ""...       
-000287c0: 2020 2020 206d 6172 7368 616c 696e 675f       marshaling_
-000287d0: 616c 676f 7269 7468 6d20 2873 7472 2c20  algorithm (str, 
-000287e0: 6f70 7469 6f6e 616c 293a 2020 5370 6563  optional):  Spec
-000287f0: 6966 6965 7320 7468 6520 7761 7920 696e  ifies the way in
-00028800: 2077 6869 6368 2074 6865 2073 6967 6e61   which the signa
-00028810: 7475 7265 2077 6173 206f 7269 6769 6e61  ture was origina
-00028820: 6c6c 7920 6d61 7273 6861 6c65 642e 200d  lly marshaled. .
-00028830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028860: 2020 2020 5468 6973 2063 7572 7265 6e74      This current
-00028870: 6c79 206f 6e6c 7920 6170 706c 6965 7320  ly only applies 
-00028880: 746f 2045 4344 5341 206b 6579 732e 2053  to ECDSA keys. S
-00028890: 7570 706f 7274 6564 2074 7970 6573 2061  upported types a
-000288a0: 7265 3a20 0d0a 2020 2020 2020 2020 2020  re: ..          
-000288b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288d0: 2020 2020 2020 2020 2061 736e 312c 206a           asn1, j
-000288e0: 7773 2e20 4465 6661 756c 7473 2074 6f20  ws. Defaults to 
-000288f0: 2222 2e0d 0a20 2020 2020 2020 2020 2020  ""...           
-00028900: 2073 616c 745f 6c65 6e67 7468 2028 7374   salt_length (st
-00028910: 722c 206f 7074 696f 6e61 6c29 3a20 5468  r, optional): Th
-00028920: 6520 7361 6c74 206c 656e 6774 6820 7573  e salt length us
-00028930: 6564 2074 6f20 7369 676e 2e20 5468 6973  ed to sign. This
-00028940: 2063 7572 7265 6e74 6c79 206f 6e6c 7920   currently only 
-00028950: 6170 706c 6965 7320 746f 2074 6865 2052  applies to the R
-00028960: 5341 200d 0a20 2020 2020 2020 2020 2020  SA ..           
-00028970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028980: 2020 2020 2020 2020 2020 2020 2020 5053                PS
-00028990: 5320 7369 676e 6174 7572 6520 7363 6865  S signature sche
-000289a0: 6d65 2e20 4f70 7469 6f6e 7320 6172 653a  me. Options are:
-000289b0: 2061 7574 6f2c 2068 6173 682c 206f 7220   auto, hash, or 
-000289c0: 616e 2069 6e74 6567 6572 2062 6574 7765  an integer betwe
-000289d0: 656e 2074 6865 200d 0a20 2020 2020 2020  en the ..       
-000289e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a00: 2020 6d69 6e69 6d75 6d20 616e 6420 7468    minimum and th
-00028a10: 6520 6d61 7869 6d75 6d20 7065 726d 6973  e maximum permis
-00028a20: 7369 626c 6520 7361 6c74 206c 656e 6774  sible salt lengt
-00028a30: 6873 2066 6f72 2074 6865 2067 6976 656e  hs for the given
-00028a40: 2052 5341 206b 6579 2073 697a 652e 200d   RSA key size. .
-00028a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a70: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
-00028a80: 7473 2074 6f20 2222 2e0d 0a0d 0a20 2020  ts to "".....   
-00028a90: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
-00028aa0: 2020 2020 2020 2020 2020 2064 6963 7420             dict 
-00028ab0: 6f72 204e 6f6e 653a 2072 6574 7572 6e20  or None: return 
-00028ac0: 7468 6520 7665 7269 6669 6361 7469 6f6e  the verification
-00028ad0: 200d 0a20 2020 2020 2020 2022 2222 0d0a   ..        """..
-00028ae0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00028af0: 6973 5f61 7574 683a 0d0a 2020 2020 2020  is_auth:..      
-00028b00: 2020 2020 2020 6966 2069 6e70 7574 5f64        if input_d
-00028b10: 6174 6120 3d3d 2022 2220 616e 6420 6261  ata == "" and ba
-00028b20: 7463 685f 696e 7075 7420 6973 204e 6f6e  tch_input is Non
-00028b30: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00028b40: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-00028b50: 6572 726f 7228 6622 7b5f 5f63 6c61 7373  error(f"{__class
-00028b60: 5f5f 2e5f 5f6e 616d 655f 5f7d 202d 2076  __.__name__} - v
-00028b70: 6572 6966 7920 7369 676e 6564 2064 6174  erify signed dat
-00028b80: 6120 6572 726f 723a 204f 6e65 206f 6620  a error: One of 
-00028b90: 6069 6e70 7574 6020 6f72 2060 6261 7463  `input` or `batc
-00028ba0: 685f 696e 7075 7460 2022 0d0a 2020 2020  h_input` "..    
-00028bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028bc0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00028bd0: 6d75 7374 2062 6520 7375 7070 6c69 6564  must be supplied
-00028be0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00028bf0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-00028c00: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-00028c10: 2020 2020 2020 2020 2020 2069 6620 7369             if si
-00028c20: 676e 6174 7572 6520 213d 2022 2220 616e  gnature != "" an
-00028c30: 6420 686d 6163 2021 3d20 2222 3a0d 0a20  d hmac != "":.. 
-00028c40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00028c50: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
-00028c60: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
-00028c70: 6e61 6d65 5f5f 7d20 2d20 7665 7269 6679  name__} - verify
-00028c80: 2073 6967 6e65 6420 6461 7461 2064 6174   signed data dat
-00028c90: 6120 6572 726f 723a 2063 616e 6e6f 7420  a error: cannot 
-00028ca0: 7370 6563 6966 7920 626f 7468 2073 6967  specify both sig
-00028cb0: 6e61 7475 7265 2061 6e64 2068 6d61 6322  nature and hmac"
-00028cc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00028cd0: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00028ce0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00028cf0: 2020 2020 2020 2020 2020 6578 6973 745f            exist_
-00028d00: 6b65 7973 203d 2073 656c 662e 6c69 7374  keys = self.list
-00028d10: 5f6b 6579 286d 6f75 6e74 5f70 6174 6829  _key(mount_path)
-00028d20: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00028d30: 206e 616d 6520 6e6f 7420 696e 2065 7869   name not in exi
-00028d40: 7374 5f6b 6579 733a 0d0a 2020 2020 2020  st_keys:..      
-00028d50: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00028d60: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
-00028d70: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00028d80: 5f7d 202d 2076 6572 6966 7920 7369 676e  _} - verify sign
-00028d90: 6564 2064 6174 6120 6572 726f 723a 206b  ed data error: k
-00028da0: 6579 2027 7b6e 616d 657d 2720 6e6f 7420  ey '{name}' not 
-00028db0: 666f 756e 6422 290d 0a20 2020 2020 2020  found")..       
-00028dc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00028dd0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00028de0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00028df0: 7061 796c 6f61 6420 3d20 6469 6374 2829  payload = dict()
-00028e00: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-00028e10: 2020 2020 2020 2020 2020 2020 7375 7070              supp
-00028e20: 6f72 745f 6861 7368 5f61 6c67 6f72 6974  ort_hash_algorit
-00028e30: 686d 203d 205b 2273 6861 3122 2c20 2273  hm = ["sha1", "s
-00028e40: 6861 322d 3232 3422 2c20 2273 6861 322d  ha2-224", "sha2-
-00028e50: 3235 3622 2c20 2273 6861 322d 3338 3422  256", "sha2-384"
-00028e60: 2c20 2273 6861 322d 3531 3222 2c20 0d0a  , "sha2-512", ..
-00028e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e90: 2020 2020 2020 2273 6861 332d 3232 3422        "sha3-224"
-00028ea0: 2c20 2273 6861 332d 3338 3422 2c20 2273  , "sha3-384", "s
-00028eb0: 6861 332d 3531 3222 2c20 226e 6f6e 6522  ha3-512", "none"
-00028ec0: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-00028ed0: 6620 6861 7368 5f61 6c67 6f72 6974 686d  f hash_algorithm
-00028ee0: 206e 6f74 2069 6e20 7375 7070 6f72 745f   not in support_
-00028ef0: 6861 7368 5f61 6c67 6f72 6974 686d 3a0d  hash_algorithm:.
-00028f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028f10: 2073 656c 662e 6c6f 6767 6572 2e65 7272   self.logger.err
-00028f20: 6f72 2866 227b 5f5f 636c 6173 735f 5f2e  or(f"{__class__.
-00028f30: 5f5f 6e61 6d65 5f5f 7d20 2d20 7665 7269  __name__} - veri
-00028f40: 6679 2073 6967 6e65 6420 6461 7461 2065  fy signed data e
-00028f50: 7272 6f72 3a20 6861 7368 5f61 6c67 6f72  rror: hash_algor
-00028f60: 6974 686d 206d 7573 7420 6265 206f 6e65  ithm must be one
-00028f70: 206f 663a 2022 0d0a 2020 2020 2020 2020   of: "..        
-00028f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f90: 2020 2020 2020 2020 2020 6622 7b27 2c20            f"{', 
-00028fa0: 272e 6a6f 696e 2873 7570 706f 7274 5f68  '.join(support_h
-00028fb0: 6173 685f 616c 676f 7269 7468 6d29 7d22  ash_algorithm)}"
-00028fc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00028fd0: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00028fe0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00028ff0: 2020 2020 2020 2020 2020 6966 2062 6174            if bat
-00029000: 6368 5f69 6e70 7574 2069 7320 4e6f 6e65  ch_input is None
-00029010: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00029020: 2020 2069 6620 6e6f 7420 6973 5f62 6173     if not is_bas
-00029030: 6536 3428 696e 7075 745f 6461 7461 293a  e64(input_data):
-00029040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029050: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00029060: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-00029070: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-00029080: 2076 6572 6966 7920 7369 676e 6564 2064   verify signed d
-00029090: 6174 6120 6572 726f 723a 2074 6865 2069  ata error: the i
-000290a0: 6e70 7574 5f64 6174 6120 6d75 7374 2062  nput_data must b
-000290b0: 6520 6261 7365 3634 2065 6e63 6f64 6564  e base64 encoded
-000290c0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-000290d0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000290e0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-000290f0: 2020 2020 2070 6179 6c6f 6164 5b22 696e       payload["in
-00029100: 7075 7422 5d20 3d20 696e 7075 745f 6461  put"] = input_da
-00029110: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
-00029120: 2020 2020 6966 2073 6967 6e61 7475 7265      if signature
-00029130: 2021 3d20 2222 3a0d 0a20 2020 2020 2020   != "":..       
-00029140: 2020 2020 2020 2020 2020 2020 2070 6179               pay
-00029150: 6c6f 6164 5b22 7369 676e 6174 7572 6522  load["signature"
-00029160: 5d20 3d20 7369 676e 6174 7572 650d 0a20  ] = signature.. 
-00029170: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00029180: 6620 686d 6163 2021 3d20 2222 3a0d 0a20  f hmac != "":.. 
-00029190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291a0: 2020 2070 6179 6c6f 6164 5b22 686d 6163     payload["hmac
-000291b0: 225d 203d 2068 6d61 630d 0a20 2020 2020  "] = hmac..     
-000291c0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-000291d0: 6e74 6578 7420 213d 2022 223a 0d0a 2020  ntext != "":..  
-000291e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291f0: 2020 6966 206e 6f74 2069 735f 6261 7365    if not is_base
-00029200: 3634 2863 6f6e 7465 7874 293a 0d0a 2020  64(context):..  
-00029210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029220: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00029230: 722e 6572 726f 7228 6622 7b5f 5f63 6c61  r.error(f"{__cla
-00029240: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 202d  ss__.__name__} -
-00029250: 2076 6572 6966 7920 7369 676e 6564 2064   verify signed d
-00029260: 6174 6120 6572 726f 723a 2074 6865 2063  ata error: the c
-00029270: 6f6e 7465 7874 206d 7573 7420 6265 2062  ontext must be b
-00029280: 6173 6536 3420 656e 636f 6465 6420 6966  ase64 encoded if
-00029290: 2073 6574 2229 0d0a 2020 2020 2020 2020   set")..        
-000292a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000292b0: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+00028410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028430: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+00028440: 746f 204e 6f6e 652e 0d0a 2020 2020 2020  to None...      
+00028450: 2020 2020 2020 636f 6e74 6578 7420 2873        context (s
+00028460: 7472 2c20 6f70 7469 6f6e 616c 293a 2042  tr, optional): B
+00028470: 6173 6536 3420 656e 636f 6465 6420 636f  ase64 encoded co
+00028480: 6e74 6578 7420 666f 7220 6b65 7920 6465  ntext for key de
+00028490: 7269 7661 7469 6f6e 2e20 5265 7175 6972  rivation. Requir
+000284a0: 6564 2069 6620 6b65 7920 6465 7269 7661  ed if key deriva
+000284b0: 7469 6f6e 2069 7320 0d0a 2020 2020 2020  tion is ..      
+000284c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000284d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000284e0: 6e61 626c 6564 3b20 6375 7272 656e 746c  nabled; currentl
+000284f0: 7920 6f6e 6c79 2061 7661 696c 6162 6c65  y only available
+00028500: 2077 6974 6820 6564 3235 3531 3920 6b65   with ed25519 ke
+00028510: 7973 2e20 4465 6661 756c 7473 2074 6f20  ys. Defaults to 
+00028520: 2222 2e0d 0a20 2020 2020 2020 2020 2020  ""...           
+00028530: 2070 7265 6861 7368 6564 2028 626f 6f6c   prehashed (bool
+00028540: 2c20 6f70 7469 6f6e 616c 293a 2053 6574  , optional): Set
+00028550: 2074 6f20 6074 7275 6560 2077 6865 6e20   to `true` when 
+00028560: 7468 6520 696e 7075 7420 6973 2061 6c72  the input is alr
+00028570: 6561 6479 2068 6173 6865 642e 2049 6620  eady hashed. If 
+00028580: 7468 6520 6b65 7920 7479 7065 2069 7320  the key type is 
+00028590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000285a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000285b0: 2020 2020 2020 2020 2020 6072 7361 2d32            `rsa-2
+000285c0: 3034 3860 2c20 6072 7361 2d33 3037 3260  048`, `rsa-3072`
+000285d0: 206f 7220 6072 7361 2d34 3039 3660 2c20   or `rsa-4096`, 
+000285e0: 7468 656e 2074 6865 2061 6c67 6f72 6974  then the algorit
+000285f0: 686d 2075 7365 6420 746f 2068 6173 6820  hm used to hash 
+00028600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00028610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028620: 2020 2020 2020 2020 2020 7468 6520 696e            the in
+00028630: 7075 7420 7368 6f75 6c64 2062 6520 696e  put should be in
+00028640: 6469 6361 7465 6420 6279 2074 6865 2060  dicated by the `
+00028650: 6861 7368 5f61 6c67 6f72 6974 686d 6020  hash_algorithm` 
+00028660: 7061 7261 6d65 7465 722e 2044 6566 6175  parameter. Defau
+00028670: 6c74 7320 0d0a 2020 2020 2020 2020 2020  lts ..          
+00028680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028690: 2020 2020 2020 2020 2020 2020 2020 746f                to
+000286a0: 2046 616c 7365 2e0d 0a20 2020 2020 2020   False...       
+000286b0: 2020 2020 2073 6967 6e61 7475 7265 5f61       signature_a
+000286c0: 6c67 6f72 6974 686d 2028 7374 722c 206f  lgorithm (str, o
+000286d0: 7074 696f 6e61 6c29 3a20 5768 656e 2075  ptional): When u
+000286e0: 7369 6e67 2061 2052 5341 206b 6579 2c20  sing a RSA key, 
+000286f0: 7370 6563 6966 6965 7320 7468 6520 5253  specifies the RS
+00028700: 4120 7369 676e 6174 7572 6520 616c 676f  A signature algo
+00028710: 7269 7468 6d20 746f 200d 0a20 2020 2020  rithm to ..     
+00028720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028740: 2020 2020 2020 2020 2020 2020 7573 6520              use 
+00028750: 666f 7220 7369 676e 6174 7572 6520 7665  for signature ve
+00028760: 7269 6669 6361 7469 6f6e 2e20 5375 7070  rification. Supp
+00028770: 6f72 7465 6420 7369 676e 6174 7572 6520  orted signature 
+00028780: 7479 7065 7320 6172 653a 200d 0a20 2020  types are: ..   
+00028790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000287a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000287b0: 2020 2020 2020 2020 2020 2020 2020 7073                ps
+000287c0: 7320 706b 6373 3176 3135 2e20 4465 6661  s pkcs1v15. Defa
+000287d0: 756c 7473 2074 6f20 2222 2e0d 0a20 2020  ults to ""...   
+000287e0: 2020 2020 2020 2020 206d 6172 7368 616c           marshal
+000287f0: 696e 675f 616c 676f 7269 7468 6d20 2873  ing_algorithm (s
+00028800: 7472 2c20 6f70 7469 6f6e 616c 293a 2020  tr, optional):  
+00028810: 5370 6563 6966 6965 7320 7468 6520 7761  Specifies the wa
+00028820: 7920 696e 2077 6869 6368 2074 6865 2073  y in which the s
+00028830: 6967 6e61 7475 7265 2077 6173 206f 7269  ignature was ori
+00028840: 6769 6e61 6c6c 7920 6d61 7273 6861 6c65  ginally marshale
+00028850: 642e 200d 0a20 2020 2020 2020 2020 2020  d. ..           
+00028860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028880: 2020 2020 2020 2020 5468 6973 2063 7572          This cur
+00028890: 7265 6e74 6c79 206f 6e6c 7920 6170 706c  rently only appl
+000288a0: 6965 7320 746f 2045 4344 5341 206b 6579  ies to ECDSA key
+000288b0: 732e 2053 7570 706f 7274 6564 2074 7970  s. Supported typ
+000288c0: 6573 2061 7265 3a20 0d0a 2020 2020 2020  es are: ..      
+000288d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000288e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000288f0: 2020 2020 2020 2020 2020 2020 2061 736e               asn
+00028900: 312c 206a 7773 2e20 4465 6661 756c 7473  1, jws. Defaults
+00028910: 2074 6f20 2222 2e0d 0a20 2020 2020 2020   to ""...       
+00028920: 2020 2020 2073 616c 745f 6c65 6e67 7468       salt_length
+00028930: 2028 7374 722c 206f 7074 696f 6e61 6c29   (str, optional)
+00028940: 3a20 5468 6520 7361 6c74 206c 656e 6774  : The salt lengt
+00028950: 6820 7573 6564 2074 6f20 7369 676e 2e20  h used to sign. 
+00028960: 5468 6973 2063 7572 7265 6e74 6c79 206f  This currently o
+00028970: 6e6c 7920 6170 706c 6965 7320 746f 2074  nly applies to t
+00028980: 6865 2052 5341 200d 0a20 2020 2020 2020  he RSA ..       
+00028990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000289a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000289b0: 2020 5053 5320 7369 676e 6174 7572 6520    PSS signature 
+000289c0: 7363 6865 6d65 2e20 4f70 7469 6f6e 7320  scheme. Options 
+000289d0: 6172 653a 2061 7574 6f2c 2068 6173 682c  are: auto, hash,
+000289e0: 206f 7220 616e 2069 6e74 6567 6572 2062   or an integer b
+000289f0: 6574 7765 656e 2074 6865 200d 0a20 2020  etween the ..   
+00028a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a20: 2020 2020 2020 6d69 6e69 6d75 6d20 616e        minimum an
+00028a30: 6420 7468 6520 6d61 7869 6d75 6d20 7065  d the maximum pe
+00028a40: 726d 6973 7369 626c 6520 7361 6c74 206c  rmissible salt l
+00028a50: 656e 6774 6873 2066 6f72 2074 6865 2067  engths for the g
+00028a60: 6976 656e 2052 5341 206b 6579 2073 697a  iven RSA key siz
+00028a70: 652e 200d 0a20 2020 2020 2020 2020 2020  e. ..           
+00028a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a90: 2020 2020 2020 2020 2020 2020 2020 4465                De
+00028aa0: 6661 756c 7473 2074 6f20 2222 2e0d 0a0d  faults to ""....
+00028ab0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00028ac0: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00028ad0: 6963 7420 6f72 204e 6f6e 653a 2072 6574  ict or None: ret
+00028ae0: 7572 6e20 7468 6520 7665 7269 6669 6361  urn the verifica
+00028af0: 7469 6f6e 200d 0a20 2020 2020 2020 2022  tion ..        "
+00028b00: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+00028b10: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
+00028b20: 2020 2020 2020 2020 2020 6966 2069 6e70            if inp
+00028b30: 7574 5f64 6174 6120 3d3d 2022 2220 616e  ut_data == "" an
+00028b40: 6420 6261 7463 685f 696e 7075 7420 6973  d batch_input is
+00028b50: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00028b60: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00028b70: 6765 722e 6572 726f 7228 6622 7b5f 5f63  ger.error(f"{__c
+00028b80: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00028b90: 202d 2076 6572 6966 7920 7369 676e 6564   - verify signed
+00028ba0: 2064 6174 6120 6572 726f 723a 204f 6e65   data error: One
+00028bb0: 206f 6620 6069 6e70 7574 6020 6f72 2060   of `input` or `
+00028bc0: 6261 7463 685f 696e 7075 7460 2022 0d0a  batch_input` "..
+00028bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028bf0: 2020 6622 6d75 7374 2062 6520 7375 7070    f"must be supp
+00028c00: 6c69 6564 2229 0d0a 2020 2020 2020 2020  lied")..        
+00028c10: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00028c20: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00028c30: 200d 0a20 2020 2020 2020 2020 2020 2069   ..            i
+00028c40: 6620 7369 676e 6174 7572 6520 213d 2022  f signature != "
+00028c50: 2220 616e 6420 686d 6163 2021 3d20 2222  " and hmac != ""
+00028c60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00028c70: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
+00028c80: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
+00028c90: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 7665  _.__name__} - ve
+00028ca0: 7269 6679 2073 6967 6e65 6420 6461 7461  rify signed data
+00028cb0: 2064 6174 6120 6572 726f 723a 2063 616e   data error: can
+00028cc0: 6e6f 7420 7370 6563 6966 7920 626f 7468  not specify both
+00028cd0: 2073 6967 6e61 7475 7265 2061 6e64 2068   signature and h
+00028ce0: 6d61 6322 290d 0a20 2020 2020 2020 2020  mac")..         
+00028cf0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00028d00: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00028d10: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00028d20: 6973 745f 6b65 7973 203d 2073 656c 662e  ist_keys = self.
+00028d30: 6c69 7374 5f6b 6579 286d 6f75 6e74 5f70  list_key(mount_p
+00028d40: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
+00028d50: 2020 6966 206e 616d 6520 6e6f 7420 696e    if name not in
+00028d60: 2065 7869 7374 5f6b 6579 733a 0d0a 2020   exist_keys:..  
+00028d70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00028d80: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00028d90: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
+00028da0: 616d 655f 5f7d 202d 2076 6572 6966 7920  ame__} - verify 
+00028db0: 7369 676e 6564 2064 6174 6120 6572 726f  signed data erro
+00028dc0: 723a 206b 6579 2027 7b6e 616d 657d 2720  r: key '{name}' 
+00028dd0: 6e6f 7420 666f 756e 6422 290d 0a20 2020  not found")..   
+00028de0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00028df0: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+00028e00: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00028e10: 2020 2020 7061 796c 6f61 6420 3d20 6469      payload = di
+00028e20: 6374 2829 0d0a 2020 2020 2020 2020 2020  ct()..          
+00028e30: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+00028e40: 7375 7070 6f72 745f 6861 7368 5f61 6c67  support_hash_alg
+00028e50: 6f72 6974 686d 203d 205b 2273 6861 3122  orithm = ["sha1"
+00028e60: 2c20 2273 6861 322d 3232 3422 2c20 2273  , "sha2-224", "s
+00028e70: 6861 322d 3235 3622 2c20 2273 6861 322d  ha2-256", "sha2-
+00028e80: 3338 3422 2c20 2273 6861 322d 3531 3222  384", "sha2-512"
+00028e90: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+00028ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028eb0: 2020 2020 2020 2020 2020 2273 6861 332d            "sha3-
+00028ec0: 3232 3422 2c20 2273 6861 332d 3338 3422  224", "sha3-384"
+00028ed0: 2c20 2273 6861 332d 3531 3222 2c20 226e  , "sha3-512", "n
+00028ee0: 6f6e 6522 5d0d 0a20 2020 2020 2020 2020  one"]..         
+00028ef0: 2020 2069 6620 6861 7368 5f61 6c67 6f72     if hash_algor
+00028f00: 6974 686d 206e 6f74 2069 6e20 7375 7070  ithm not in supp
+00028f10: 6f72 745f 6861 7368 5f61 6c67 6f72 6974  ort_hash_algorit
+00028f20: 686d 3a0d 0a20 2020 2020 2020 2020 2020  hm:..           
+00028f30: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00028f40: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
+00028f50: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
+00028f60: 7665 7269 6679 2073 6967 6e65 6420 6461  verify signed da
+00028f70: 7461 2065 7272 6f72 3a20 6861 7368 5f61  ta error: hash_a
+00028f80: 6c67 6f72 6974 686d 206d 7573 7420 6265  lgorithm must be
+00028f90: 206f 6e65 206f 663a 2022 0d0a 2020 2020   one of: "..    
+00028fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028fb0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00028fc0: 7b27 2c20 272e 6a6f 696e 2873 7570 706f  {', '.join(suppo
+00028fd0: 7274 5f68 6173 685f 616c 676f 7269 7468  rt_hash_algorith
+00028fe0: 6d29 7d22 290d 0a20 2020 2020 2020 2020  m)}")..         
+00028ff0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00029000: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00029010: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00029020: 2062 6174 6368 5f69 6e70 7574 2069 7320   batch_input is 
+00029030: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00029040: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00029050: 5f62 6173 6536 3428 696e 7075 745f 6461  _base64(input_da
+00029060: 7461 293a 0d0a 2020 2020 2020 2020 2020  ta):..          
+00029070: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00029080: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
+00029090: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+000290a0: 5f7d 202d 2076 6572 6966 7920 7369 676e  _} - verify sign
+000290b0: 6564 2064 6174 6120 6572 726f 723a 2074  ed data error: t
+000290c0: 6865 2069 6e70 7574 5f64 6174 6120 6d75  he input_data mu
+000290d0: 7374 2062 6520 6261 7365 3634 2065 6e63  st be base64 enc
+000290e0: 6f64 6564 2229 0d0a 2020 2020 2020 2020  oded")..        
+000290f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00029100: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+00029110: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+00029120: 5b22 696e 7075 7422 5d20 3d20 696e 7075  ["input"] = inpu
+00029130: 745f 6461 7461 0d0a 2020 2020 2020 2020  t_data..        
+00029140: 2020 2020 2020 2020 6966 2073 6967 6e61          if signa
+00029150: 7475 7265 2021 3d20 2222 3a0d 0a20 2020  ture != "":..   
+00029160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029170: 2070 6179 6c6f 6164 5b22 7369 676e 6174   payload["signat
+00029180: 7572 6522 5d20 3d20 7369 676e 6174 7572  ure"] = signatur
+00029190: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+000291a0: 2020 2069 6620 686d 6163 2021 3d20 2222     if hmac != ""
+000291b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000291c0: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
+000291d0: 686d 6163 225d 203d 2068 6d61 630d 0a20  hmac"] = hmac.. 
+000291e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000291f0: 6620 636f 6e74 6578 7420 213d 2022 223a  f context != "":
+00029200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00029210: 2020 2020 2020 6966 206e 6f74 2069 735f        if not is_
+00029220: 6261 7365 3634 2863 6f6e 7465 7874 293a  base64(context):
+00029230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00029240: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00029250: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
+00029260: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00029270: 5f7d 202d 2076 6572 6966 7920 7369 676e  _} - verify sign
+00029280: 6564 2064 6174 6120 6572 726f 723a 2074  ed data error: t
+00029290: 6865 2063 6f6e 7465 7874 206d 7573 7420  he context must 
+000292a0: 6265 2062 6173 6536 3420 656e 636f 6465  be base64 encode
+000292b0: 6420 6966 2073 6574 2229 0d0a 2020 2020  d if set")..    
 000292c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000292d0: 2070 6179 6c6f 6164 5b22 636f 6e74 6578   payload["contex
-000292e0: 7422 5d20 3d20 636f 6e74 6578 740d 0a20  t"] = context.. 
-000292f0: 2020 2020 2020 2020 2020 2020 2020 200d                 .
-00029300: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00029310: 6261 7463 685f 696e 7075 7420 6973 206e  batch_input is n
-00029320: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00029330: 2020 2020 2020 2020 2020 6966 2072 6566            if ref
-00029340: 6572 656e 6365 2021 3d20 2222 3a0d 0a20  erence != "":.. 
-00029350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029360: 2020 2070 6179 6c6f 6164 5b22 7265 6665     payload["refe
-00029370: 7265 6e63 6522 5d20 3d20 7265 6665 7265  rence"] = refere
-00029380: 6e63 650d 0a20 2020 2020 2020 2020 2020  nce..           
-00029390: 2020 2020 2070 6179 6c6f 6164 5b22 6261       payload["ba
-000293a0: 7463 685f 696e 7075 7422 5d20 3d20 6261  tch_input"] = ba
-000293b0: 7463 685f 696e 7075 740d 0a20 2020 2020  tch_input..     
-000293c0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-000293d0: 2020 2020 2020 2020 2069 6620 7072 6568           if preh
-000293e0: 6173 6865 643a 0d0a 2020 2020 2020 2020  ashed:..        
-000293f0: 2020 2020 2020 2020 7061 796c 6f61 645b          payload[
-00029400: 2270 7265 6861 7368 6564 225d 203d 2070  "prehashed"] = p
-00029410: 7265 6861 7368 6564 0d0a 2020 2020 2020  rehashed..      
-00029420: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00029430: 2020 2020 6966 2073 6967 6e61 7475 7265      if signature
-00029440: 5f61 6c67 6f72 6974 686d 2021 3d20 2222  _algorithm != ""
-00029450: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00029460: 2020 2069 6620 7369 676e 6174 7572 655f     if signature_
-00029470: 616c 676f 7269 7468 6d20 6e6f 7420 696e  algorithm not in
-00029480: 205b 2270 7373 222c 2022 706b 6373 3176   ["pss", "pkcs1v
-00029490: 3135 225d 3a0d 0a20 2020 2020 2020 2020  15"]:..         
-000294a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000294b0: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
-000294c0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-000294d0: 5f5f 7d20 2d20 7665 7269 6679 2073 6967  __} - verify sig
-000294e0: 6e65 6420 6461 7461 2065 7272 6f72 3a20  ned data error: 
-000294f0: 7369 676e 6174 7572 655f 616c 676f 7269  signature_algori
-00029500: 7468 6d20 6d75 7374 2062 6520 6f6e 6520  thm must be one 
-00029510: 6f66 3a20 220d 0a20 2020 2020 2020 2020  of: "..         
-00029520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029530: 2020 2020 2020 2020 2020 2020 2066 2270               f"p
-00029540: 7373 2c20 706b 6373 3176 3135 2229 0d0a  ss, pkcs1v15")..
+000292d0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+000292e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000292f0: 2020 2020 2070 6179 6c6f 6164 5b22 636f       payload["co
+00029300: 6e74 6578 7422 5d20 3d20 636f 6e74 6578  ntext"] = contex
+00029310: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00029320: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00029330: 2069 6620 6261 7463 685f 696e 7075 7420   if batch_input 
+00029340: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00029350: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00029360: 2072 6566 6572 656e 6365 2021 3d20 2222   reference != ""
+00029370: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00029380: 2020 2020 2020 2070 6179 6c6f 6164 5b22         payload["
+00029390: 7265 6665 7265 6e63 6522 5d20 3d20 7265  reference"] = re
+000293a0: 6665 7265 6e63 650d 0a20 2020 2020 2020  ference..       
+000293b0: 2020 2020 2020 2020 2070 6179 6c6f 6164           payload
+000293c0: 5b22 6261 7463 685f 696e 7075 7422 5d20  ["batch_input"] 
+000293d0: 3d20 6261 7463 685f 696e 7075 740d 0a20  = batch_input.. 
+000293e0: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+000293f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00029400: 7072 6568 6173 6865 643a 0d0a 2020 2020  prehashed:..    
+00029410: 2020 2020 2020 2020 2020 2020 7061 796c              payl
+00029420: 6f61 645b 2270 7265 6861 7368 6564 225d  oad["prehashed"]
+00029430: 203d 2070 7265 6861 7368 6564 0d0a 2020   = prehashed..  
+00029440: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00029450: 2020 2020 2020 2020 6966 2073 6967 6e61          if signa
+00029460: 7475 7265 5f61 6c67 6f72 6974 686d 2021  ture_algorithm !
+00029470: 3d20 2222 3a0d 0a20 2020 2020 2020 2020  = "":..         
+00029480: 2020 2020 2020 2069 6620 7369 676e 6174         if signat
+00029490: 7572 655f 616c 676f 7269 7468 6d20 6e6f  ure_algorithm no
+000294a0: 7420 696e 205b 2270 7373 222c 2022 706b  t in ["pss", "pk
+000294b0: 6373 3176 3135 225d 3a0d 0a20 2020 2020  cs1v15"]:..     
+000294c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000294d0: 656c 662e 6c6f 6767 6572 2e65 7272 6f72  elf.logger.error
+000294e0: 2866 227b 5f5f 636c 6173 735f 5f2e 5f5f  (f"{__class__.__
+000294f0: 6e61 6d65 5f5f 7d20 2d20 7665 7269 6679  name__} - verify
+00029500: 2073 6967 6e65 6420 6461 7461 2065 7272   signed data err
+00029510: 6f72 3a20 7369 676e 6174 7572 655f 616c  or: signature_al
+00029520: 676f 7269 7468 6d20 6d75 7374 2062 6520  gorithm must be 
+00029530: 6f6e 6520 6f66 3a20 220d 0a20 2020 2020  one of: "..     
+00029540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00029550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029560: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-00029570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029580: 2070 6179 6c6f 6164 5b22 7369 676e 6174   payload["signat
-00029590: 7572 655f 616c 676f 7269 7468 6d22 5d20  ure_algorithm"] 
-000295a0: 3d20 7369 676e 6174 7572 655f 616c 676f  = signature_algo
-000295b0: 7269 7468 6d0d 0a20 2020 2020 2020 2020  rithm..         
-000295c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000295d0: 2020 2020 2069 6620 6d61 7273 6861 6c69       if marshali
-000295e0: 6e67 5f61 6c67 6f72 6974 686d 2021 3d20  ng_algorithm != 
-000295f0: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
-00029600: 2020 2020 2069 6620 6d61 7273 6861 6c69       if marshali
-00029610: 6e67 5f61 6c67 6f72 6974 686d 206e 6f74  ng_algorithm not
-00029620: 2069 6e20 5b22 6173 6e31 222c 2022 6a77   in ["asn1", "jw
-00029630: 7322 5d3a 0d0a 2020 2020 2020 2020 2020  s"]:..          
-00029640: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00029650: 6f67 6765 722e 6572 726f 7228 6622 7b5f  ogger.error(f"{_
-00029660: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00029670: 5f7d 202d 2076 6572 6966 7920 7369 676e  _} - verify sign
-00029680: 6564 2064 6174 6120 6572 726f 723a 206d  ed data error: m
-00029690: 6172 7368 616c 696e 675f 616c 676f 7269  arshaling_algori
-000296a0: 7468 6d20 6d75 7374 2062 6520 6f6e 6520  thm must be one 
-000296b0: 6f66 3a20 220d 0a20 2020 2020 2020 2020  of: "..         
-000296c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000296d0: 2020 2020 2020 2020 2020 2020 2066 2270               f"p
-000296e0: 7361 736e 3173 2c20 6a77 7322 290d 0a20  sasn1s, jws").. 
+00029560: 2066 2270 7373 2c20 706b 6373 3176 3135   f"pss, pkcs1v15
+00029570: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00029580: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00029590: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+000295a0: 2020 2020 2070 6179 6c6f 6164 5b22 7369       payload["si
+000295b0: 676e 6174 7572 655f 616c 676f 7269 7468  gnature_algorith
+000295c0: 6d22 5d20 3d20 7369 676e 6174 7572 655f  m"] = signature_
+000295d0: 616c 676f 7269 7468 6d0d 0a20 2020 2020  algorithm..     
+000295e0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+000295f0: 2020 2020 2020 2020 2069 6620 6d61 7273           if mars
+00029600: 6861 6c69 6e67 5f61 6c67 6f72 6974 686d  haling_algorithm
+00029610: 2021 3d20 2222 3a0d 0a20 2020 2020 2020   != "":..       
+00029620: 2020 2020 2020 2020 2069 6620 6d61 7273           if mars
+00029630: 6861 6c69 6e67 5f61 6c67 6f72 6974 686d  haling_algorithm
+00029640: 206e 6f74 2069 6e20 5b22 6173 6e31 222c   not in ["asn1",
+00029650: 2022 6a77 7322 5d3a 0d0a 2020 2020 2020   "jws"]:..      
+00029660: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00029670: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00029680: 6622 7b5f 5f63 6c61 7373 5f5f 2e5f 5f6e  f"{__class__.__n
+00029690: 616d 655f 5f7d 202d 2076 6572 6966 7920  ame__} - verify 
+000296a0: 7369 676e 6564 2064 6174 6120 6572 726f  signed data erro
+000296b0: 723a 206d 6172 7368 616c 696e 675f 616c  r: marshaling_al
+000296c0: 676f 7269 7468 6d20 6d75 7374 2062 6520  gorithm must be 
+000296d0: 6f6e 6520 6f66 3a20 220d 0a20 2020 2020  one of: "..     
+000296e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000296f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029700: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00029710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029720: 7061 796c 6f61 645b 226d 6172 7368 616c  payload["marshal
-00029730: 696e 675f 616c 676f 7269 7468 6d22 5d20  ing_algorithm"] 
-00029740: 3d20 6d61 7273 6861 6c69 6e67 5f61 6c67  = marshaling_alg
-00029750: 6f72 6974 686d 0d0a 2020 2020 2020 2020  orithm..        
-00029760: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00029770: 2020 2020 2020 6966 2073 616c 745f 6c65        if salt_le
-00029780: 6e67 7468 2021 3d20 2222 3a0d 0a20 2020  ngth != "":..   
-00029790: 2020 2020 2020 2020 2020 2020 2070 6179               pay
-000297a0: 6c6f 6164 5b22 7361 6c74 5f6c 656e 6774  load["salt_lengt
-000297b0: 6822 5d20 3d20 7361 6c74 5f6c 656e 6774  h"] = salt_lengt
-000297c0: 680d 0a20 2020 2020 2020 2020 2020 2020  h..             
-000297d0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-000297e0: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
-000297f0: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
-00029800: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00029810: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-00029820: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-00029830: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-00029840: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-00029850: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
-00029860: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
-00029870: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
-00029880: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
-00029890: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
-000298a0: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
-000298b0: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
-000298c0: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
-000298d0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000298e0: 203d 2072 6571 7565 7374 732e 706f 7374   = requests.post
-000298f0: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
-00029900: 7468 7d2f 7665 7269 6679 2f7b 6e61 6d65  th}/verify/{name
-00029910: 7d2f 7b68 6173 685f 616c 676f 7269 7468  }/{hash_algorith
-00029920: 6d7d 222c 200d 0a20 2020 2020 2020 2020  m}", ..         
-00029930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029940: 2020 2020 2020 2068 6561 6465 7273 3d7b         headers={
-00029950: 2258 2d56 6175 6c74 2d54 6f6b 656e 223a  "X-Vault-Token":
-00029960: 2074 6f6b 656e 7d2c 200d 0a20 2020 2020   token}, ..     
-00029970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029980: 2020 2020 2020 2020 2020 2064 6174 613d             data=
-00029990: 6a73 6f6e 2e64 756d 7073 2870 6179 6c6f  json.dumps(paylo
-000299a0: 6164 2929 0d0a 2020 2020 2020 2020 2020  ad))..          
-000299b0: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
-000299c0: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
-000299d0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
-000299e0: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
-000299f0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00029a00: 6573 2e6a 736f 6e28 295b 2264 6174 6122  es.json()["data"
-00029a10: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-00029a20: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00029a30: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-00029a40: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
-00029a50: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00029a60: 5f2c 2072 6573 2c20 2276 6572 6966 7920  _, res, "verify 
-00029a70: 7369 676e 6564 2064 6174 6120 6572 726f  signed data erro
-00029a80: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
-00029a90: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00029aa0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-00029ab0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00029ac0: 6f6e 650d 0a0d 0a20 2020 2023 2054 4f44  one....    # TOD
-00029ad0: 4f3a 2077 6169 7420 666f 7220 7465 7374  O: wait for test
-00029ae0: 696e 670d 0a20 2020 2064 6566 2062 6163  ing..    def bac
-00029af0: 6b75 705f 6b65 7928 7365 6c66 2c20 6d6f  kup_key(self, mo
-00029b00: 756e 745f 7061 7468 3a20 7374 722c 206e  unt_path: str, n
-00029b10: 616d 653a 2073 7472 293a 0d0a 2020 2020  ame: str):..    
-00029b20: 2020 2020 2222 2272 6574 7572 6e20 6120      """return a 
-00029b30: 706c 6169 6e74 6578 7420 6261 636b 7570  plaintext backup
-00029b40: 206f 6620 6120 6e61 6d65 6420 6b65 790d   of a named key.
-00029b50: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00029b60: 2020 2054 6865 2062 6163 6b75 7020 636f     The backup co
-00029b70: 6e74 6169 6e73 2061 6c6c 2074 6865 2063  ntains all the c
-00029b80: 6f6e 6669 6775 7261 7469 6f6e 2064 6174  onfiguration dat
-00029b90: 6120 616e 6420 6b65 7973 206f 6620 616c  a and keys of al
-00029ba0: 6c20 7468 6520 7665 7273 696f 6e73 2061  l the versions a
-00029bb0: 6c6f 6e67 2077 6974 6820 7468 6520 484d  long with the HM
-00029bc0: 4143 206b 6579 2e20 0d0a 2020 2020 2020  AC key. ..      
-00029bd0: 2020 5468 6520 7265 7370 6f6e 7365 2066    The response f
-00029be0: 726f 6d20 7468 6973 2065 6e64 706f 696e  rom this endpoin
-00029bf0: 7420 6361 6e20 6265 2075 7365 6420 7769  t can be used wi
-00029c00: 7468 2074 6865 2060 2f72 6573 746f 7265  th the `/restore
-00029c10: 6020 656e 6470 6f69 6e74 2074 6f20 7265  ` endpoint to re
-00029c20: 7374 6f72 6520 7468 6520 6b65 792e 0d0a  store the key...
-00029c30: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00029c40: 2020 5265 6665 7220 746f 2068 7474 7073    Refer to https
-00029c50: 3a2f 2f64 6576 656c 6f70 6572 2e68 6173  ://developer.has
-00029c60: 6869 636f 7270 2e63 6f6d 2f76 6175 6c74  hicorp.com/vault
-00029c70: 2f61 7069 2d64 6f63 732f 7365 6372 6574  /api-docs/secret
-00029c80: 2f74 7261 6e73 6974 2362 6163 6b75 702d  /transit#backup-
-00029c90: 6b65 7920 666f 7220 6d6f 7265 2064 6574  key for more det
-00029ca0: 6169 6c73 2e0d 0a0d 0a20 2020 2020 2020  ails.....       
-00029cb0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00029cc0: 2020 2020 6d6f 756e 745f 7061 7468 2028      mount_path (
-00029cd0: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-00029ce0: 2020 6e61 6d65 2028 7374 7229 3a20 4e61    name (str): Na
-00029cf0: 6d65 206f 6620 7468 6520 6b65 790d 0a0d  me of the key...
-00029d00: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00029d10: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00029d20: 6963 7420 6f72 204e 6f6e 653a 2072 6574  ict or None: ret
-00029d30: 7572 6e20 7468 6520 6261 636b 7570 2069  urn the backup i
-00029d40: 6e20 6469 6374 2069 6620 7375 6363 6573  n dict if succes
-00029d50: 732c 206f 7468 6572 7769 7365 2072 6574  s, otherwise ret
-00029d60: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
-00029d70: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-00029d80: 6620 7365 6c66 2e69 735f 6175 7468 3a0d  f self.is_auth:.
-00029d90: 0a20 2020 2020 2020 2020 2020 2075 726c  .            url
-00029da0: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
-00029db0: 6578 7428 7365 6c66 2e75 726c 2c20 6b65  ext(self.url, ke
-00029dc0: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
-00029dd0: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
-00029de0: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
-00029df0: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
-00029e00: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
-00029e10: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
-00029e20: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
-00029e30: 7428 7365 6c66 2e74 6f6b 656e 2c20 6b65  t(self.token, ke
-00029e40: 793d 7261 6e64 6f6d 5f68 6578 2873 656c  y=random_hex(sel
-00029e50: 662e 5f6b 6579 5f6c 656e 2c20 7365 6c66  f._key_len, self
-00029e60: 2e5f 7365 6564 2a32 292c 2069 763d 7261  ._seed*2), iv=ra
-00029e70: 6e64 6f6d 5f68 6578 2831 362c 2073 656c  ndom_hex(16, sel
-00029e80: 662e 5f73 6565 642a 3329 290d 0a20 2020  f._seed*3))..   
-00029e90: 2020 2020 2020 2020 2072 6573 203d 2072           res = r
-00029ea0: 6571 7565 7374 732e 6765 7428 7572 6c2b  equests.get(url+
-00029eb0: 6622 7b6d 6f75 6e74 5f70 6174 687d 2f62  f"{mount_path}/b
-00029ec0: 6163 6b75 702f 7b6e 616d 657d 222c 2068  ackup/{name}", h
-00029ed0: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
-00029ee0: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d29  -Token": token})
-00029ef0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00029f00: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-00029f10: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
-00029f20: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
-00029f30: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
-00029f40: 2020 2020 7265 7475 726e 2072 6573 2e6a      return res.j
-00029f50: 736f 6e28 295b 2264 6174 6122 5d0d 0a20  son()["data"].. 
-00029f60: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00029f70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029f80: 2020 7365 6c66 2e5f 6c6f 675f 6572 726f    self._log_erro
-00029f90: 725f 7265 7370 6f6e 7365 285f 5f63 6c61  r_response(__cla
-00029fa0: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
-00029fb0: 6573 2c20 2262 6163 6b75 7020 6b65 7920  es, "backup key 
-00029fc0: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
-00029fd0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00029fe0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00029ff0: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
-0002a000: 726e 204e 6f6e 650d 0a0d 0a20 2020 2023  rn None....    #
-0002a010: 2054 4f44 4f3a 2077 6169 7420 666f 7220   TODO: wait for 
-0002a020: 7465 7374 696e 670d 0a20 2020 2064 6566  testing..    def
-0002a030: 2072 6573 746f 7265 5f6b 6579 2873 656c   restore_key(sel
-0002a040: 662c 200d 0a20 2020 2020 2020 2020 2020  f, ..           
-0002a050: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
-0002a060: 6174 683a 2073 7472 2c20 0d0a 2020 2020  ath: str, ..    
-0002a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a080: 6261 636b 7570 3a20 7374 722c 200d 0a20  backup: str, .. 
+00029700: 2066 2270 7361 736e 3173 2c20 6a77 7322   f"psasn1s, jws"
+00029710: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00029720: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00029730: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00029740: 2020 2020 7061 796c 6f61 645b 226d 6172      payload["mar
+00029750: 7368 616c 696e 675f 616c 676f 7269 7468  shaling_algorith
+00029760: 6d22 5d20 3d20 6d61 7273 6861 6c69 6e67  m"] = marshaling
+00029770: 5f61 6c67 6f72 6974 686d 0d0a 2020 2020  _algorithm..    
+00029780: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00029790: 2020 2020 2020 2020 2020 6966 2073 616c            if sal
+000297a0: 745f 6c65 6e67 7468 2021 3d20 2222 3a0d  t_length != "":.
+000297b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000297c0: 2070 6179 6c6f 6164 5b22 7361 6c74 5f6c   payload["salt_l
+000297d0: 656e 6774 6822 5d20 3d20 7361 6c74 5f6c  ength"] = salt_l
+000297e0: 656e 6774 680d 0a20 2020 2020 2020 2020  ength..         
+000297f0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00029800: 2020 2020 2075 726c 203d 2061 6573 5f64       url = aes_d
+00029810: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
+00029820: 2e75 726c 2c20 6b65 793d 7261 6e64 6f6d  .url, key=random
+00029830: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+00029840: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+00029850: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+00029860: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+00029870: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00029880: 2074 6f6b 656e 203d 2061 6573 5f64 6563   token = aes_dec
+00029890: 7279 7074 5f74 6578 7428 7365 6c66 2e74  rypt_text(self.t
+000298a0: 6f6b 656e 2c20 6b65 793d 7261 6e64 6f6d  oken, key=random
+000298b0: 5f68 6578 2873 656c 662e 5f6b 6579 5f6c  _hex(self._key_l
+000298c0: 656e 2c20 7365 6c66 2e5f 7365 6564 2a32  en, self._seed*2
+000298d0: 292c 2069 763d 7261 6e64 6f6d 5f68 6578  ), iv=random_hex
+000298e0: 2831 362c 2073 656c 662e 5f73 6565 642a  (16, self._seed*
+000298f0: 3329 290d 0a20 2020 2020 2020 2020 2020  3))..           
+00029900: 2072 6573 203d 2072 6571 7565 7374 732e   res = requests.
+00029910: 706f 7374 2875 726c 2b66 227b 6d6f 756e  post(url+f"{moun
+00029920: 745f 7061 7468 7d2f 7665 7269 6679 2f7b  t_path}/verify/{
+00029930: 6e61 6d65 7d2f 7b68 6173 685f 616c 676f  name}/{hash_algo
+00029940: 7269 7468 6d7d 222c 200d 0a20 2020 2020  rithm}", ..     
+00029950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029960: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00029970: 7273 3d7b 2258 2d56 6175 6c74 2d54 6f6b  rs={"X-Vault-Tok
+00029980: 656e 223a 2074 6f6b 656e 7d2c 200d 0a20  en": token}, .. 
+00029990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000299a0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000299b0: 6174 613d 6a73 6f6e 2e64 756d 7073 2870  ata=json.dumps(p
+000299c0: 6179 6c6f 6164 2929 0d0a 2020 2020 2020  ayload))..      
+000299d0: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
+000299e0: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
+000299f0: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
+00029a00: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
+00029a10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00029a20: 726e 2072 6573 2e6a 736f 6e28 295b 2264  rn res.json()["d
+00029a30: 6174 6122 5d0d 0a20 2020 2020 2020 2020  ata"]..         
+00029a40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00029a50: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00029a60: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
+00029a70: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
+00029a80: 616d 655f 5f2c 2072 6573 2c20 2276 6572  ame__, res, "ver
+00029a90: 6966 7920 7369 676e 6564 2064 6174 6120  ify signed data 
+00029aa0: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
+00029ab0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00029ac0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00029ad0: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
+00029ae0: 726e 204e 6f6e 650d 0a0d 0a20 2020 2023  rn None....    #
+00029af0: 2054 4f44 4f3a 2077 6169 7420 666f 7220   TODO: wait for 
+00029b00: 7465 7374 696e 670d 0a20 2020 2064 6566  testing..    def
+00029b10: 2062 6163 6b75 705f 6b65 7928 7365 6c66   backup_key(self
+00029b20: 2c20 6d6f 756e 745f 7061 7468 3a20 7374  , mount_path: st
+00029b30: 722c 206e 616d 653a 2073 7472 293a 0d0a  r, name: str):..
+00029b40: 2020 2020 2020 2020 2222 2272 6574 7572          """retur
+00029b50: 6e20 6120 706c 6169 6e74 6578 7420 6261  n a plaintext ba
+00029b60: 636b 7570 206f 6620 6120 6e61 6d65 6420  ckup of a named 
+00029b70: 6b65 790d 0a20 2020 2020 2020 200d 0a20  key..        .. 
+00029b80: 2020 2020 2020 2054 6865 2062 6163 6b75         The backu
+00029b90: 7020 636f 6e74 6169 6e73 2061 6c6c 2074  p contains all t
+00029ba0: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
+00029bb0: 2064 6174 6120 616e 6420 6b65 7973 206f   data and keys o
+00029bc0: 6620 616c 6c20 7468 6520 7665 7273 696f  f all the versio
+00029bd0: 6e73 2061 6c6f 6e67 2077 6974 6820 7468  ns along with th
+00029be0: 6520 484d 4143 206b 6579 2e20 0d0a 2020  e HMAC key. ..  
+00029bf0: 2020 2020 2020 5468 6520 7265 7370 6f6e        The respon
+00029c00: 7365 2066 726f 6d20 7468 6973 2065 6e64  se from this end
+00029c10: 706f 696e 7420 6361 6e20 6265 2075 7365  point can be use
+00029c20: 6420 7769 7468 2074 6865 2060 2f72 6573  d with the `/res
+00029c30: 746f 7265 6020 656e 6470 6f69 6e74 2074  tore` endpoint t
+00029c40: 6f20 7265 7374 6f72 6520 7468 6520 6b65  o restore the ke
+00029c50: 792e 0d0a 2020 2020 2020 2020 0d0a 2020  y...        ..  
+00029c60: 2020 2020 2020 5265 6665 7220 746f 2068        Refer to h
+00029c70: 7474 7073 3a2f 2f64 6576 656c 6f70 6572  ttps://developer
+00029c80: 2e68 6173 6869 636f 7270 2e63 6f6d 2f76  .hashicorp.com/v
+00029c90: 6175 6c74 2f61 7069 2d64 6f63 732f 7365  ault/api-docs/se
+00029ca0: 6372 6574 2f74 7261 6e73 6974 2362 6163  cret/transit#bac
+00029cb0: 6b75 702d 6b65 7920 666f 7220 6d6f 7265  kup-key for more
+00029cc0: 2064 6574 6169 6c73 2e0d 0a0d 0a20 2020   details.....   
+00029cd0: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
+00029ce0: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
+00029cf0: 7468 2028 7374 7229 0d0a 2020 2020 2020  th (str)..      
+00029d00: 2020 2020 2020 6e61 6d65 2028 7374 7229        name (str)
+00029d10: 3a20 4e61 6d65 206f 6620 7468 6520 6b65  : Name of the ke
+00029d20: 790d 0a0d 0a20 2020 2020 2020 2052 6574  y....        Ret
+00029d30: 7572 6e73 3a0d 0a20 2020 2020 2020 2020  urns:..         
+00029d40: 2020 2064 6963 7420 6f72 204e 6f6e 653a     dict or None:
+00029d50: 2072 6574 7572 6e20 7468 6520 6261 636b   return the back
+00029d60: 7570 2069 6e20 6469 6374 2069 6620 7375  up in dict if su
+00029d70: 6363 6573 732c 206f 7468 6572 7769 7365  ccess, otherwise
+00029d80: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+00029d90: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00029da0: 2020 2069 6620 7365 6c66 2e69 735f 6175     if self.is_au
+00029db0: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
+00029dc0: 2075 726c 203d 2061 6573 5f64 6563 7279   url = aes_decry
+00029dd0: 7074 5f74 6578 7428 7365 6c66 2e75 726c  pt_text(self.url
+00029de0: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+00029df0: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+00029e00: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00029e10: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00029e20: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+00029e30: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+00029e40: 656e 203d 2061 6573 5f64 6563 7279 7074  en = aes_decrypt
+00029e50: 5f74 6578 7428 7365 6c66 2e74 6f6b 656e  _text(self.token
+00029e60: 2c20 6b65 793d 7261 6e64 6f6d 5f68 6578  , key=random_hex
+00029e70: 2873 656c 662e 5f6b 6579 5f6c 656e 2c20  (self._key_len, 
+00029e80: 7365 6c66 2e5f 7365 6564 2a32 292c 2069  self._seed*2), i
+00029e90: 763d 7261 6e64 6f6d 5f68 6578 2831 362c  v=random_hex(16,
+00029ea0: 2073 656c 662e 5f73 6565 642a 3329 290d   self._seed*3)).
+00029eb0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00029ec0: 203d 2072 6571 7565 7374 732e 6765 7428   = requests.get(
+00029ed0: 7572 6c2b 6622 7b6d 6f75 6e74 5f70 6174  url+f"{mount_pat
+00029ee0: 687d 2f62 6163 6b75 702f 7b6e 616d 657d  h}/backup/{name}
+00029ef0: 222c 2068 6561 6465 7273 3d7b 2258 2d56  ", headers={"X-V
+00029f00: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
+00029f10: 656e 7d29 0d0a 2020 2020 2020 2020 2020  en})..          
+00029f20: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
+00029f30: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
+00029f40: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+00029f50: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
+00029f60: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00029f70: 6573 2e6a 736f 6e28 295b 2264 6174 6122  es.json()["data"
+00029f80: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
+00029f90: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00029fa0: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
+00029fb0: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
+00029fc0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00029fd0: 5f2c 2072 6573 2c20 2262 6163 6b75 7020  _, res, "backup 
+00029fe0: 6b65 7920 6572 726f 7222 290d 0a20 2020  key error")..   
+00029ff0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0002a000: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+0002a010: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0002a020: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
+0002a030: 2020 2023 2054 4f44 4f3a 2077 6169 7420     # TODO: wait 
+0002a040: 666f 7220 7465 7374 696e 670d 0a20 2020  for testing..   
+0002a050: 2064 6566 2072 6573 746f 7265 5f6b 6579   def restore_key
+0002a060: 2873 656c 662c 200d 0a20 2020 2020 2020  (self, ..       
+0002a070: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
+0002a080: 6e74 5f70 6174 683a 2073 7472 2c20 0d0a  nt_path: str, ..
 0002a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0a0: 2020 206e 616d 653a 2073 7472 203d 2022     name: str = "
-0002a0b0: 222c 200d 0a20 2020 2020 2020 2020 2020  ", ..           
-0002a0c0: 2020 2020 2020 2020 2066 6f72 6365 3a20           force: 
-0002a0d0: 626f 6f6c 203d 2046 616c 7365 293a 0d0a  bool = False):..
-0002a0e0: 2020 2020 2020 2020 2222 2272 6573 746f          """resto
-0002a0f0: 7265 2074 6865 2062 6163 6b75 7020 6173  re the backup as
-0002a100: 2061 206e 616d 6564 206b 6579 0d0a 2020   a named key..  
-0002a110: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0002a120: 5468 6973 2077 696c 6c20 7265 7374 6f72  This will restor
-0002a130: 6520 7468 6520 6b65 7920 636f 6e66 6967  e the key config
-0002a140: 7572 6174 696f 6e73 2061 6e64 2061 6c6c  urations and all
-0002a150: 2074 6865 2076 6572 7369 6f6e 7320 6f66   the versions of
-0002a160: 2074 6865 206e 616d 6564 206b 6579 2061   the named key a
-0002a170: 6c6f 6e67 2077 6974 6820 484d 4143 206b  long with HMAC k
-0002a180: 6579 732e 200d 0a20 2020 2020 2020 2054  eys. ..        T
-0002a190: 6865 2069 6e70 7574 2074 6f20 7468 6973  he input to this
-0002a1a0: 2065 6e64 706f 696e 7420 7368 6f75 6c64   endpoint should
-0002a1b0: 2062 6520 7468 6520 6f75 7470 7574 206f   be the output o
-0002a1c0: 6620 602f 6261 636b 7570 6020 656e 6470  f `/backup` endp
-0002a1d0: 6f69 6e74 2e0d 0a20 2020 2020 2020 200d  oint...        .
-0002a1e0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-0002a1f0: 6f20 6874 7470 733a 2f2f 6465 7665 6c6f  o https://develo
-0002a200: 7065 722e 6861 7368 6963 6f72 702e 636f  per.hashicorp.co
-0002a210: 6d2f 7661 756c 742f 6170 692d 646f 6373  m/vault/api-docs
-0002a220: 2f73 6563 7265 742f 7472 616e 7369 7423  /secret/transit#
-0002a230: 7265 7374 6f72 652d 6b65 7920 666f 7220  restore-key for 
-0002a240: 6d6f 7265 2064 6574 6169 6c73 2e0d 0a0d  more details....
-0002a250: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
-0002a260: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-0002a270: 745f 7061 7468 2028 7374 7229 0d0a 2020  t_path (str)..  
-0002a280: 2020 2020 2020 2020 2020 6261 636b 7570            backup
-0002a290: 2028 7374 7229 3a20 4261 636b 6564 2075   (str): Backed u
-0002a2a0: 7020 6b65 7920 6461 7461 2074 6f20 6265  p key data to be
-0002a2b0: 2072 6573 746f 7265 642e 2054 6869 7320   restored. This 
-0002a2c0: 7368 6f75 6c64 2062 6520 7468 6520 6f75  should be the ou
-0002a2d0: 7470 7574 2066 726f 6d20 7468 6520 602f  tput from the `/
-0002a2e0: 6261 636b 7570 6020 656e 6470 6f69 6e74  backup` endpoint
-0002a2f0: 2e0d 0a20 2020 2020 2020 2020 2020 206e  ...            n
-0002a300: 616d 6520 2873 7472 2c20 6f70 7469 6f6e  ame (str, option
-0002a310: 616c 293a 2049 6620 7365 742c 2074 6869  al): If set, thi
-0002a320: 7320 7769 6c6c 2062 6520 7468 6520 6e61  s will be the na
-0002a330: 6d65 206f 6620 7468 6520 7265 7374 6f72  me of the restor
-0002a340: 6564 206b 6579 2e20 4465 6661 756c 7473  ed key. Defaults
-0002a350: 2074 6f20 2222 2e0d 0a20 2020 2020 2020   to ""...       
-0002a360: 2020 2020 2066 6f72 6365 2028 626f 6f6c       force (bool
-0002a370: 2c20 6f70 7469 6f6e 616c 293a 2049 6620  , optional): If 
-0002a380: 7365 742c 2066 6f72 6365 2074 6865 2072  set, force the r
-0002a390: 6573 746f 7265 2074 6f20 7072 6f63 6565  estore to procee
-0002a3a0: 6420 6576 656e 2069 6620 6120 6b65 7920  d even if a key 
-0002a3b0: 6279 2074 6869 7320 6e61 6d65 2061 6c72  by this name alr
-0002a3c0: 6561 6479 2065 7869 7374 732e 200d 0a20  eady exists. .. 
-0002a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a3f0: 2020 2044 6566 6175 6c74 7320 746f 2046     Defaults to F
-0002a400: 616c 7365 2e0d 0a0d 0a20 2020 2020 2020  alse.....       
-0002a410: 2052 6574 7572 6e73 3a0d 0a20 2020 2020   Returns:..     
-0002a420: 2020 2020 2020 2062 6f6f 6c3a 2072 6574         bool: ret
-0002a430: 7572 6e20 5472 7565 2069 6620 7375 6363  urn True if succ
-0002a440: 6573 732c 206f 7468 6572 7769 7365 2072  ess, otherwise r
-0002a450: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-0002a460: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0002a470: 2020 6966 2073 656c 662e 6973 5f61 7574    if self.is_aut
-0002a480: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-0002a490: 7061 796c 6f61 6420 3d20 6469 6374 2862  payload = dict(b
-0002a4a0: 6163 6b75 703d 6261 636b 7570 290d 0a20  ackup=backup).. 
-0002a4b0: 2020 2020 2020 2020 2020 2075 726c 203d             url =
-0002a4c0: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
-0002a4d0: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
-0002a4e0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-0002a4f0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-0002a500: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-0002a510: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-0002a520: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-0002a530: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
-0002a540: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
-0002a550: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
-0002a560: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
-0002a570: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
-0002a580: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
-0002a590: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
-0002a5a0: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
-0002a5b0: 2020 2020 2020 2075 726c 202b 3d20 6622         url += f"
-0002a5c0: 7b6d 6f75 6e74 5f70 6174 687d 2f72 6573  {mount_path}/res
-0002a5d0: 746f 7265 220d 0a0d 0a20 2020 2020 2020  tore"....       
-0002a5e0: 2020 2020 2069 6620 6e61 6d65 2021 3d20       if name != 
-0002a5f0: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
-0002a600: 2020 2020 2065 7869 7374 5f6b 6579 7320       exist_keys 
-0002a610: 3d20 7365 6c66 2e6c 6973 745f 6b65 7928  = self.list_key(
-0002a620: 6d6f 756e 745f 7061 7468 290d 0a20 2020  mount_path)..   
-0002a630: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002a640: 6e61 6d65 2069 6e20 6578 6973 745f 6b65  name in exist_ke
-0002a650: 7973 2061 6e64 206e 6f74 2066 6f72 6365  ys and not force
-0002a660: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0002a670: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-0002a680: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
-0002a690: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
-0002a6a0: 2d20 7265 7374 6f72 6520 6b65 7920 6572  - restore key er
-0002a6b0: 726f 723a 206b 6579 2027 7b6e 616d 657d  ror: key '{name}
-0002a6c0: 2720 6e6f 7420 6973 2061 6c72 6561 6479  ' not is already
-0002a6d0: 2065 7869 7374 6564 2c20 220d 0a20 2020   existed, "..   
-0002a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a700: 2020 2066 2270 6c65 6173 6520 7365 7420     f"please set 
-0002a710: 666f 7263 653d 5472 7565 2061 6e64 2074  force=True and t
-0002a720: 7279 2061 6761 696e 2229 0d0a 2020 2020  ry again")..    
-0002a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a740: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-0002a750: 2020 2020 2020 2020 2020 2020 2020 7572                ur
-0002a760: 6c20 2b3d 2066 222f 7b6e 616d 657d 220d  l += f"/{name}".
-0002a770: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-0002a780: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0002a790: 7420 666f 7263 653a 0d0a 2020 2020 2020  t force:..      
-0002a7a0: 2020 2020 2020 2020 2020 7061 796c 6f61            payloa
-0002a7b0: 645b 2266 6f72 6365 225d 203d 2066 6f72  d["force"] = for
-0002a7c0: 6365 0d0a 0d0a 2020 2020 2020 2020 2020  ce....          
-0002a7d0: 2020 7265 7320 3d20 7265 7175 6573 7473    res = requests
-0002a7e0: 2e70 6f73 7428 7572 6c2c 2068 6561 6465  .post(url, heade
-0002a7f0: 7273 3d7b 2258 2d56 6175 6c74 2d54 6f6b  rs={"X-Vault-Tok
-0002a800: 656e 223a 2074 6f6b 656e 7d2c 2064 6174  en": token}, dat
-0002a810: 613d 6a73 6f6e 2e64 756d 7073 2870 6179  a=json.dumps(pay
-0002a820: 6c6f 6164 2929 0d0a 2020 2020 2020 2020  load))..        
-0002a830: 2020 2020 6966 2072 6573 2e73 7461 7475      if res.statu
-0002a840: 735f 636f 6465 203d 3d20 3230 3020 6f72  s_code == 200 or
-0002a850: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-0002a860: 203d 3d20 3230 343a 0d0a 2020 2020 2020   == 204:..      
-0002a870: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002a880: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-0002a890: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0002a8a0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0002a8b0: 6c6f 675f 6572 726f 725f 7265 7370 6f6e  log_error_respon
-0002a8c0: 7365 285f 5f63 6c61 7373 5f5f 2e5f 5f6e  se(__class__.__n
-0002a8d0: 616d 655f 5f2c 2072 6573 2c20 2272 6573  ame__, res, "res
-0002a8e0: 746f 7265 206b 6579 2065 7272 6f72 2229  tore key error")
-0002a8f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002a900: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-0002a910: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0002a0a0: 2020 2020 6261 636b 7570 3a20 7374 722c      backup: str,
+0002a0b0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0002a0c0: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
+0002a0d0: 203d 2022 222c 200d 0a20 2020 2020 2020   = "", ..       
+0002a0e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0002a0f0: 6365 3a20 626f 6f6c 203d 2046 616c 7365  ce: bool = False
+0002a100: 293a 0d0a 2020 2020 2020 2020 2222 2272  ):..        """r
+0002a110: 6573 746f 7265 2074 6865 2062 6163 6b75  estore the backu
+0002a120: 7020 6173 2061 206e 616d 6564 206b 6579  p as a named key
+0002a130: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0002a140: 2020 2020 5468 6973 2077 696c 6c20 7265      This will re
+0002a150: 7374 6f72 6520 7468 6520 6b65 7920 636f  store the key co
+0002a160: 6e66 6967 7572 6174 696f 6e73 2061 6e64  nfigurations and
+0002a170: 2061 6c6c 2074 6865 2076 6572 7369 6f6e   all the version
+0002a180: 7320 6f66 2074 6865 206e 616d 6564 206b  s of the named k
+0002a190: 6579 2061 6c6f 6e67 2077 6974 6820 484d  ey along with HM
+0002a1a0: 4143 206b 6579 732e 200d 0a20 2020 2020  AC keys. ..     
+0002a1b0: 2020 2054 6865 2069 6e70 7574 2074 6f20     The input to 
+0002a1c0: 7468 6973 2065 6e64 706f 696e 7420 7368  this endpoint sh
+0002a1d0: 6f75 6c64 2062 6520 7468 6520 6f75 7470  ould be the outp
+0002a1e0: 7574 206f 6620 602f 6261 636b 7570 6020  ut of `/backup` 
+0002a1f0: 656e 6470 6f69 6e74 2e0d 0a20 2020 2020  endpoint...     
+0002a200: 2020 200d 0a20 2020 2020 2020 2052 6566     ..        Ref
+0002a210: 6572 2074 6f20 6874 7470 733a 2f2f 6465  er to https://de
+0002a220: 7665 6c6f 7065 722e 6861 7368 6963 6f72  veloper.hashicor
+0002a230: 702e 636f 6d2f 7661 756c 742f 6170 692d  p.com/vault/api-
+0002a240: 646f 6373 2f73 6563 7265 742f 7472 616e  docs/secret/tran
+0002a250: 7369 7423 7265 7374 6f72 652d 6b65 7920  sit#restore-key 
+0002a260: 666f 7220 6d6f 7265 2064 6574 6169 6c73  for more details
+0002a270: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+0002a280: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0002a290: 6d6f 756e 745f 7061 7468 2028 7374 7229  mount_path (str)
+0002a2a0: 0d0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
+0002a2b0: 636b 7570 2028 7374 7229 3a20 4261 636b  ckup (str): Back
+0002a2c0: 6564 2075 7020 6b65 7920 6461 7461 2074  ed up key data t
+0002a2d0: 6f20 6265 2072 6573 746f 7265 642e 2054  o be restored. T
+0002a2e0: 6869 7320 7368 6f75 6c64 2062 6520 7468  his should be th
+0002a2f0: 6520 6f75 7470 7574 2066 726f 6d20 7468  e output from th
+0002a300: 6520 602f 6261 636b 7570 6020 656e 6470  e `/backup` endp
+0002a310: 6f69 6e74 2e0d 0a20 2020 2020 2020 2020  oint...         
+0002a320: 2020 206e 616d 6520 2873 7472 2c20 6f70     name (str, op
+0002a330: 7469 6f6e 616c 293a 2049 6620 7365 742c  tional): If set,
+0002a340: 2074 6869 7320 7769 6c6c 2062 6520 7468   this will be th
+0002a350: 6520 6e61 6d65 206f 6620 7468 6520 7265  e name of the re
+0002a360: 7374 6f72 6564 206b 6579 2e20 4465 6661  stored key. Defa
+0002a370: 756c 7473 2074 6f20 2222 2e0d 0a20 2020  ults to ""...   
+0002a380: 2020 2020 2020 2020 2066 6f72 6365 2028           force (
+0002a390: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+0002a3a0: 2049 6620 7365 742c 2066 6f72 6365 2074   If set, force t
+0002a3b0: 6865 2072 6573 746f 7265 2074 6f20 7072  he restore to pr
+0002a3c0: 6f63 6565 6420 6576 656e 2069 6620 6120  oceed even if a 
+0002a3d0: 6b65 7920 6279 2074 6869 7320 6e61 6d65  key by this name
+0002a3e0: 2061 6c72 6561 6479 2065 7869 7374 732e   already exists.
+0002a3f0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0002a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a410: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+0002a420: 746f 2046 616c 7365 2e0d 0a0d 0a20 2020  to False.....   
+0002a430: 2020 2020 2052 6574 7572 6e73 3a0d 0a20       Returns:.. 
+0002a440: 2020 2020 2020 2020 2020 2062 6f6f 6c3a             bool:
+0002a450: 2072 6574 7572 6e20 5472 7565 2069 6620   return True if 
+0002a460: 7375 6363 6573 732c 206f 7468 6572 7769  success, otherwi
+0002a470: 7365 2072 6574 7572 6e20 4661 6c73 650d  se return False.
+0002a480: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0002a490: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+0002a4a0: 5f61 7574 683a 0d0a 2020 2020 2020 2020  _auth:..        
+0002a4b0: 2020 2020 7061 796c 6f61 6420 3d20 6469      payload = di
+0002a4c0: 6374 2862 6163 6b75 703d 6261 636b 7570  ct(backup=backup
+0002a4d0: 290d 0a20 2020 2020 2020 2020 2020 2075  )..            u
+0002a4e0: 726c 203d 2061 6573 5f64 6563 7279 7074  rl = aes_decrypt
+0002a4f0: 5f74 6578 7428 7365 6c66 2e75 726c 2c20  _text(self.url, 
+0002a500: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
+0002a510: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
+0002a520: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
+0002a530: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
+0002a540: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
+0002a550: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+0002a560: 203d 2061 6573 5f64 6563 7279 7074 5f74   = aes_decrypt_t
+0002a570: 6578 7428 7365 6c66 2e74 6f6b 656e 2c20  ext(self.token, 
+0002a580: 6b65 793d 7261 6e64 6f6d 5f68 6578 2873  key=random_hex(s
+0002a590: 656c 662e 5f6b 6579 5f6c 656e 2c20 7365  elf._key_len, se
+0002a5a0: 6c66 2e5f 7365 6564 2a32 292c 2069 763d  lf._seed*2), iv=
+0002a5b0: 7261 6e64 6f6d 5f68 6578 2831 362c 2073  random_hex(16, s
+0002a5c0: 656c 662e 5f73 6565 642a 3329 290d 0a20  elf._seed*3)).. 
+0002a5d0: 2020 2020 2020 2020 2020 2075 726c 202b             url +
+0002a5e0: 3d20 6622 7b6d 6f75 6e74 5f70 6174 687d  = f"{mount_path}
+0002a5f0: 2f72 6573 746f 7265 220d 0a0d 0a20 2020  /restore"....   
+0002a600: 2020 2020 2020 2020 2069 6620 6e61 6d65           if name
+0002a610: 2021 3d20 2222 3a0d 0a20 2020 2020 2020   != "":..       
+0002a620: 2020 2020 2020 2020 2065 7869 7374 5f6b           exist_k
+0002a630: 6579 7320 3d20 7365 6c66 2e6c 6973 745f  eys = self.list_
+0002a640: 6b65 7928 6d6f 756e 745f 7061 7468 290d  key(mount_path).
+0002a650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a660: 2069 6620 6e61 6d65 2069 6e20 6578 6973   if name in exis
+0002a670: 745f 6b65 7973 2061 6e64 206e 6f74 2066  t_keys and not f
+0002a680: 6f72 6365 3a0d 0a20 2020 2020 2020 2020  orce:..         
+0002a690: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002a6a0: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
+0002a6b0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0002a6c0: 5f5f 7d20 2d20 7265 7374 6f72 6520 6b65  __} - restore ke
+0002a6d0: 7920 6572 726f 723a 206b 6579 2027 7b6e  y error: key '{n
+0002a6e0: 616d 657d 2720 6e6f 7420 6973 2061 6c72  ame}' not is alr
+0002a6f0: 6561 6479 2065 7869 7374 6564 2c20 220d  eady existed, ".
+0002a700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a720: 2020 2020 2020 2066 2270 6c65 6173 6520         f"please 
+0002a730: 7365 7420 666f 7263 653d 5472 7565 2061  set force=True a
+0002a740: 6e64 2074 7279 2061 6761 696e 2229 0d0a  nd try again")..
+0002a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a760: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0002a770: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002a780: 2020 7572 6c20 2b3d 2066 222f 7b6e 616d    url += f"/{nam
+0002a790: 657d 220d 0a20 2020 2020 2020 2020 2020  e}"..           
+0002a7a0: 200d 0a20 2020 2020 2020 2020 2020 2069   ..            i
+0002a7b0: 6620 6e6f 7420 666f 7263 653a 0d0a 2020  f not force:..  
+0002a7c0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0002a7d0: 796c 6f61 645b 2266 6f72 6365 225d 203d  yload["force"] =
+0002a7e0: 2066 6f72 6365 0d0a 0d0a 2020 2020 2020   force....      
+0002a7f0: 2020 2020 2020 7265 7320 3d20 7265 7175        res = requ
+0002a800: 6573 7473 2e70 6f73 7428 7572 6c2c 2068  ests.post(url, h
+0002a810: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
+0002a820: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d2c  -Token": token},
+0002a830: 2064 6174 613d 6a73 6f6e 2e64 756d 7073   data=json.dumps
+0002a840: 2870 6179 6c6f 6164 2929 0d0a 2020 2020  (payload))..    
+0002a850: 2020 2020 2020 2020 6966 2072 6573 2e73          if res.s
+0002a860: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
+0002a870: 3020 6f72 2072 6573 2e73 7461 7475 735f  0 or res.status_
+0002a880: 636f 6465 203d 3d20 3230 343a 0d0a 2020  code == 204:..  
+0002a890: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0002a8a0: 7475 726e 2054 7275 650d 0a20 2020 2020  turn True..     
+0002a8b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0002a8c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0002a8d0: 6c66 2e5f 6c6f 675f 6572 726f 725f 7265  lf._log_error_re
+0002a8e0: 7370 6f6e 7365 285f 5f63 6c61 7373 5f5f  sponse(__class__
+0002a8f0: 2e5f 5f6e 616d 655f 5f2c 2072 6573 2c20  .__name__, res, 
+0002a900: 2272 6573 746f 7265 206b 6579 2065 7272  "restore key err
+0002a910: 6f72 2229 0d0a 2020 2020 2020 2020 2020  or")..          
 0002a920: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0002a930: 7365 0d0a 0d0a 2020 2020 2320 544f 444f  se....    # TODO
-0002a940: 3a20 7761 6974 2066 6f72 2074 6573 7469  : wait for testi
-0002a950: 6e67 0d0a 2020 2020 6465 6620 7472 696d  ng..    def trim
-0002a960: 5f6b 6579 2873 656c 662c 206d 6f75 6e74  _key(self, mount
-0002a970: 5f70 6174 683a 2073 7472 2c20 6e61 6d65  _path: str, name
-0002a980: 3a20 7374 722c 206d 696e 5f61 7661 696c  : str, min_avail
-0002a990: 6162 6c65 5f76 6572 7369 6f6e 3a20 696e  able_version: in
-0002a9a0: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-0002a9b0: 7472 696d 206f 6c64 6572 206b 6579 2076  trim older key v
-0002a9c0: 6572 7369 6f6e 7320 7365 7474 696e 6720  ersions setting 
-0002a9d0: 6120 6d69 6e69 6d75 6d20 7665 7273 696f  a minimum versio
-0002a9e0: 6e20 666f 7220 7468 6520 6b65 7972 696e  n for the keyrin
-0002a9f0: 670d 0a0d 0a20 2020 2020 2020 204f 6e63  g....        Onc
-0002aa00: 6520 7472 696d 6d65 642c 2070 7265 7669  e trimmed, previ
-0002aa10: 6f75 7320 7665 7273 696f 6e73 206f 6620  ous versions of 
-0002aa20: 7468 6520 6b65 7920 6361 6e6e 6f74 2062  the key cannot b
-0002aa30: 6520 7265 636f 7665 7265 642e 0d0a 0d0a  e recovered.....
-0002aa40: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
-0002aa50: 2068 7474 7073 3a2f 2f64 6576 656c 6f70   https://develop
-0002aa60: 6572 2e68 6173 6869 636f 7270 2e63 6f6d  er.hashicorp.com
-0002aa70: 2f76 6175 6c74 2f61 7069 2d64 6f63 732f  /vault/api-docs/
-0002aa80: 7365 6372 6574 2f74 7261 6e73 6974 2374  secret/transit#t
-0002aa90: 7269 6d2d 6b65 7920 666f 7220 6d6f 7265  rim-key for more
-0002aaa0: 2064 6574 6169 6c73 2e0d 0a0d 0a20 2020   details.....   
-0002aab0: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
-0002aac0: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
-0002aad0: 7468 2028 7374 7229 0d0a 2020 2020 2020  th (str)..      
-0002aae0: 2020 2020 2020 6e61 6d65 2028 7374 7229        name (str)
-0002aaf0: 3a20 4e61 6d65 206f 6620 7468 6520 6b65  : Name of the ke
-0002ab00: 790d 0a20 2020 2020 2020 2020 2020 206d  y..            m
-0002ab10: 696e 5f61 7661 696c 6162 6c65 5f76 6572  in_available_ver
-0002ab20: 7369 6f6e 2028 696e 7429 3a20 5468 6520  sion (int): The 
-0002ab30: 6d69 6e69 6d75 6d20 6176 6169 6c61 626c  minimum availabl
-0002ab40: 6520 7665 7273 696f 6e20 666f 7220 7468  e version for th
-0002ab50: 6520 6b65 7920 7269 6e67 2e20 416c 6c20  e key ring. All 
-0002ab60: 7665 7273 696f 6e73 200d 0a20 2020 2020  versions ..     
-0002ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ab90: 2020 2020 6265 666f 7265 2074 6869 7320      before this 
-0002aba0: 7665 7273 696f 6e20 7769 6c6c 2062 6520  version will be 
-0002abb0: 7065 726d 616e 656e 746c 7920 6465 6c65  permanently dele
-0002abc0: 7465 642e 2054 6869 7320 7661 6c75 6520  ted. This value 
-0002abd0: 6361 6e20 0d0a 2020 2020 2020 2020 2020  can ..          
-0002abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002abf0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0002ac00: 7420 6d6f 7374 2062 6520 6571 7561 6c20  t most be equal 
-0002ac10: 746f 2074 6865 206c 6573 7365 7220 6f66  to the lesser of
-0002ac20: 2060 6d69 6e5f 6465 6372 7970 7469 6f6e   `min_decryption
-0002ac30: 5f76 6572 7369 6f6e 6020 616e 6420 0d0a  _version` and ..
-0002ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ac60: 2020 2020 2020 2020 2060 6d69 6e5f 656e           `min_en
-0002ac70: 6372 7970 7469 6f6e 5f76 6572 7369 6f6e  cryption_version
-0002ac80: 602e 2054 6869 7320 6973 206e 6f74 2061  `. This is not a
-0002ac90: 6c6c 6f77 6564 2074 6f20 6265 2073 6574  llowed to be set
-0002aca0: 2077 6865 6e20 6569 7468 6572 200d 0a20   when either .. 
-0002acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002acd0: 2020 2020 2020 2020 606d 696e 5f65 6e63          `min_enc
-0002ace0: 7279 7074 696f 6e5f 7665 7273 696f 6e60  ryption_version`
-0002acf0: 206f 7220 606d 696e 5f64 6563 7279 7074   or `min_decrypt
-0002ad00: 696f 6e5f 7665 7273 696f 6e60 2069 7320  ion_version` is 
-0002ad10: 7365 7420 746f 207a 6572 6f2e 0d0a 0d0a  set to zero.....
-0002ad20: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-0002ad30: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-0002ad40: 6f6c 3a20 7265 7475 726e 2054 7275 6520  ol: return True 
-0002ad50: 6966 2073 7563 6365 7373 2c20 6f74 6865  if success, othe
-0002ad60: 7277 6973 6520 7265 7475 726e 2046 616c  rwise return Fal
-0002ad70: 7365 0d0a 2020 2020 2020 2020 2222 220d  se..        """.
-0002ad80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0002ad90: 2e69 735f 6175 7468 3a0d 0a20 2020 2020  .is_auth:..     
-0002ada0: 2020 2020 2020 206b 6579 5f69 6e66 6f20         key_info 
-0002adb0: 3d20 7365 6c66 2e72 6561 645f 6b65 7928  = self.read_key(
-0002adc0: 6d6f 756e 745f 7061 7468 2c20 6e61 6d65  mount_path, name
-0002add0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0002ade0: 6620 6b65 795f 696e 666f 2069 7320 4e6f  f key_info is No
-0002adf0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0002ae00: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0002ae10: 650d 0a20 2020 2020 2020 2020 2020 200d  e..            .
-0002ae20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002ae30: 6b65 795f 696e 666f 5b22 6d69 6e5f 6465  key_info["min_de
-0002ae40: 6372 7970 7469 6f6e 5f76 6572 7369 6f6e  cryption_version
-0002ae50: 225d 203d 3d20 3020 6f72 206b 6579 5f69  "] == 0 or key_i
-0002ae60: 6e66 6f5b 226d 696e 5f65 6e63 7279 7074  nfo["min_encrypt
-0002ae70: 696f 6e5f 7665 7273 696f 6e22 5d20 3d3d  ion_version"] ==
-0002ae80: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0002ae90: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-0002aea0: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
-0002aeb0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-0002aec0: 7472 696d 206b 6579 2065 7272 6f72 3a20  trim key error: 
-0002aed0: 646f 206e 6f74 2061 6c6c 6f77 2074 6f20  do not allow to 
-0002aee0: 7472 696d 206b 6579 2077 6865 6e20 220d  trim key when ".
-0002aef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002af10: 2020 2066 2260 6d69 6e5f 656e 6372 7970     f"`min_encryp
-0002af20: 7469 6f6e 5f76 6572 7369 6f6e 6020 6f72  tion_version` or
-0002af30: 2060 6d69 6e5f 6465 6372 7970 7469 6f6e   `min_decryption
-0002af40: 5f76 6572 7369 6f6e 6020 6973 2073 6574  _version` is set
-0002af50: 2074 6f20 7a65 726f 2229 0d0a 2020 2020   to zero")..    
-0002af60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002af70: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-0002af80: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0002af90: 2020 2020 6966 206d 696e 5f61 7661 696c      if min_avail
-0002afa0: 6162 6c65 5f76 6572 7369 6f6e 203e 206b  able_version > k
-0002afb0: 6579 5f69 6e66 6f5b 226d 696e 5f64 6563  ey_info["min_dec
-0002afc0: 7279 7074 696f 6e5f 7665 7273 696f 6e22  ryption_version"
-0002afd0: 5d20 6f72 205c 0d0a 2020 2020 2020 2020  ] or \..        
-0002afe0: 2020 2020 2020 2020 6d69 6e5f 6176 6169          min_avai
-0002aff0: 6c61 626c 655f 7665 7273 696f 6e20 3e20  lable_version > 
-0002b000: 6b65 795f 696e 666f 5b22 6d69 6e5f 656e  key_info["min_en
-0002b010: 6372 7970 7469 6f6e 5f76 6572 7369 6f6e  cryption_version
-0002b020: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
-0002b030: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-0002b040: 2e65 7272 6f72 2866 227b 5f5f 636c 6173  .error(f"{__clas
-0002b050: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20  s__.__name__} - 
-0002b060: 7472 696d 206b 6579 2065 7272 6f72 3a20  trim key error: 
-0002b070: 7468 6520 6d69 6e5f 6176 6169 6c61 626c  the min_availabl
-0002b080: 655f 7665 7273 696f 6e20 6361 6e20 6174  e_version can at
-0002b090: 206d 6f73 7420 220d 0a20 2020 2020 2020   most "..       
-0002b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b0b0: 2020 2020 2020 2020 2020 2066 2262 6520             f"be 
-0002b0c0: 6571 7561 6c20 746f 2074 6865 206c 6573  equal to the les
-0002b0d0: 7365 7220 6f66 2060 6d69 6e5f 6465 6372  ser of `min_decr
-0002b0e0: 7970 7469 6f6e 5f76 6572 7369 6f6e 6020  yption_version` 
-0002b0f0: 616e 6420 606d 696e 5f65 6e63 7279 7074  and `min_encrypt
-0002b100: 696f 6e5f 7665 7273 696f 6e60 2229 0d0a  ion_version`")..
-0002b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b120: 7265 7475 726e 2046 616c 7365 0d0a 0d0a  return False....
-0002b130: 2020 2020 2020 2020 2020 2020 7061 796c              payl
-0002b140: 6f61 6420 3d20 6469 6374 286d 696e 5f61  oad = dict(min_a
-0002b150: 7661 696c 6162 6c65 5f76 6572 7369 6f6e  vailable_version
-0002b160: 3d6d 696e 5f61 7661 696c 6162 6c65 5f76  =min_available_v
-0002b170: 6572 7369 6f6e 290d 0a0d 0a20 2020 2020  ersion)....     
-0002b180: 2020 2020 2020 2075 726c 203d 2061 6573         url = aes
-0002b190: 5f64 6563 7279 7074 5f74 6578 7428 7365  _decrypt_text(se
-0002b1a0: 6c66 2e75 726c 2c20 6b65 793d 7261 6e64  lf.url, key=rand
-0002b1b0: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-0002b1c0: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-0002b1d0: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-0002b1e0: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-0002b1f0: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-0002b200: 2020 2074 6f6b 656e 203d 2061 6573 5f64     token = aes_d
-0002b210: 6563 7279 7074 5f74 6578 7428 7365 6c66  ecrypt_text(self
-0002b220: 2e74 6f6b 656e 2c20 6b65 793d 7261 6e64  .token, key=rand
-0002b230: 6f6d 5f68 6578 2873 656c 662e 5f6b 6579  om_hex(self._key
-0002b240: 5f6c 656e 2c20 7365 6c66 2e5f 7365 6564  _len, self._seed
-0002b250: 2a32 292c 2069 763d 7261 6e64 6f6d 5f68  *2), iv=random_h
-0002b260: 6578 2831 362c 2073 656c 662e 5f73 6565  ex(16, self._see
-0002b270: 642a 3329 290d 0a20 2020 2020 2020 2020  d*3))..         
-0002b280: 2020 2072 6573 203d 2072 6571 7565 7374     res = request
-0002b290: 732e 706f 7374 2875 726c 2b66 227b 6d6f  s.post(url+f"{mo
-0002b2a0: 756e 745f 7061 7468 7d2f 6b65 7973 2f7b  unt_path}/keys/{
-0002b2b0: 6e61 6d65 7d2f 7472 696d 222c 2068 6561  name}/trim", hea
-0002b2c0: 6465 7273 3d7b 2258 2d56 6175 6c74 2d54  ders={"X-Vault-T
-0002b2d0: 6f6b 656e 223a 2074 6f6b 656e 7d2c 2064  oken": token}, d
-0002b2e0: 6174 613d 6a73 6f6e 2e64 756d 7073 2870  ata=json.dumps(p
-0002b2f0: 6179 6c6f 6164 2929 0d0a 2020 2020 2020  ayload))..      
-0002b300: 2020 2020 2020 6966 2072 6573 2e73 7461        if res.sta
-0002b310: 7475 735f 636f 6465 203d 3d20 3230 3020  tus_code == 200 
-0002b320: 6f72 2072 6573 2e73 7461 7475 735f 636f  or res.status_co
-0002b330: 6465 203d 3d20 3230 343a 0d0a 2020 2020  de == 204:..    
-0002b340: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002b350: 726e 2054 7275 650d 0a20 2020 2020 2020  rn True..       
-0002b360: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0002b370: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0002b380: 2e5f 6c6f 675f 6572 726f 725f 7265 7370  ._log_error_resp
-0002b390: 6f6e 7365 285f 5f63 6c61 7373 5f5f 2e5f  onse(__class__._
-0002b3a0: 5f6e 616d 655f 5f2c 2072 6573 2c20 2274  _name__, res, "t
-0002b3b0: 7269 6d20 6b65 7920 6572 726f 7222 290d  rim key error").
-0002b3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b3d0: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-0002b3e0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0002b3f0: 2072 6574 7572 6e20 4661 6c73 650d 0a0d   return False...
-0002b400: 0a20 2020 2023 2054 4f44 4f3a 2077 6169  .    # TODO: wai
-0002b410: 7420 666f 7220 7465 7374 696e 670d 0a20  t for testing.. 
-0002b420: 2020 2064 6566 2063 6f6e 6669 6775 7265     def configure
-0002b430: 5f63 6163 6865 2873 656c 662c 206d 6f75  _cache(self, mou
-0002b440: 6e74 5f70 6174 683a 2073 7472 2c20 7369  nt_path: str, si
-0002b450: 7a65 3a20 696e 7420 3d20 3029 3a0d 0a20  ze: int = 0):.. 
-0002b460: 2020 2020 2020 2022 2222 636f 6e66 6967         """config
-0002b470: 7572 6520 7468 6520 7472 616e 7369 7420  ure the transit 
-0002b480: 656e 6769 6e65 2773 2063 6163 6865 0d0a  engine's cache..
-0002b490: 0d0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
-0002b4a0: 746f 2068 7474 7073 3a2f 2f64 6576 656c  to https://devel
-0002b4b0: 6f70 6572 2e68 6173 6869 636f 7270 2e63  oper.hashicorp.c
-0002b4c0: 6f6d 2f76 6175 6c74 2f61 7069 2d64 6f63  om/vault/api-doc
-0002b4d0: 732f 7365 6372 6574 2f74 7261 6e73 6974  s/secret/transit
-0002b4e0: 2363 6f6e 6669 6775 7265 2d63 6163 6865  #configure-cache
-0002b4f0: 2066 6f72 206d 6f72 6520 6465 7461 696c   for more detail
-0002b500: 732e 0d0a 0d0a 2020 2020 2020 2020 4172  s.....        Ar
-0002b510: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-0002b520: 206d 6f75 6e74 5f70 6174 6820 2873 7472   mount_path (str
-0002b530: 293a 205f 6465 7363 7269 7074 696f 6e5f  ): _description_
-0002b540: 0d0a 2020 2020 2020 2020 2020 2020 7369  ..            si
-0002b550: 7a65 2028 696e 742c 206f 7074 696f 6e61  ze (int, optiona
-0002b560: 6c29 3a20 5370 6563 6966 6965 7320 7468  l): Specifies th
-0002b570: 6520 7369 7a65 2069 6e20 7465 726d 7320  e size in terms 
-0002b580: 6f66 206e 756d 6265 7220 6f66 2065 6e74  of number of ent
-0002b590: 7269 6573 2e20 4120 7369 7a65 206f 6620  ries. A size of 
-0002b5a0: 6030 6020 6d65 616e 7320 756e 6c69 6d69  `0` means unlimi
-0002b5b0: 7465 642e 200d 0a20 2020 2020 2020 2020  ted. ..         
-0002b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b5d0: 2020 2020 2020 2020 2041 204c 6561 7374           A Least
-0002b5e0: 2052 6563 656e 746c 7920 5573 6564 2028   Recently Used (
-0002b5f0: 4c52 5529 2063 6163 6869 6e67 2073 7472  LRU) caching str
-0002b600: 6174 6567 7920 6973 2075 7365 6420 666f  ategy is used fo
-0002b610: 7220 6120 6e6f 6e2d 7a65 726f 2063 6163  r a non-zero cac
-0002b620: 6865 2073 697a 652e 200d 0a20 2020 2020  he size. ..     
-0002b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b640: 2020 2020 2020 2020 2020 2020 204d 7573               Mus
-0002b650: 7420 6265 2030 2028 6465 6661 756c 7429  t be 0 (default)
-0002b660: 206f 7220 6120 7661 6c75 6520 6772 6561   or a value grea
-0002b670: 7465 7220 6f72 2065 7175 616c 2074 6f20  ter or equal to 
-0002b680: 3130 2028 6d69 6e69 6d75 6d20 6361 6368  10 (minimum cach
-0002b690: 6520 7369 7a65 292e 200d 0a20 2020 2020  e size). ..     
-0002b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b6b0: 2020 2020 2020 2020 2020 2020 2044 6566               Def
-0002b6c0: 6175 6c74 7320 746f 2030 2e0d 0a0d 0a20  aults to 0..... 
-0002b6d0: 2020 2020 2020 2052 6574 7572 6e73 3a0d         Returns:.
-0002b6e0: 0a20 2020 2020 2020 2020 2020 2062 6f6f  .            boo
-0002b6f0: 6c3a 2072 6574 7572 6e20 5472 7565 2069  l: return True i
-0002b700: 6620 7375 6363 6573 732c 206f 7468 6572  f success, other
-0002b710: 7769 7365 2072 6574 7572 6e20 4661 6c73  wise return Fals
-0002b720: 650d 0a20 2020 2020 2020 2022 2222 0d0a  e..        """..
-0002b730: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0002b740: 6973 5f61 7574 683a 0d0a 2020 2020 2020  is_auth:..      
-0002b750: 2020 2020 2020 6966 2073 697a 6520 213d        if size !=
-0002b760: 2030 2061 6e64 2073 697a 6520 3c20 3130   0 and size < 10
-0002b770: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0002b780: 2020 2073 656c 662e 6c6f 6767 6572 2e65     self.logger.e
-0002b790: 7272 6f72 2866 227b 5f5f 636c 6173 735f  rror(f"{__class_
-0002b7a0: 5f2e 5f5f 6e61 6d65 5f5f 7d20 2d20 636f  _.__name__} - co
-0002b7b0: 6e66 6967 7572 6520 6361 6368 6520 6572  nfigure cache er
-0002b7c0: 726f 723a 2074 6865 2073 697a 6520 6d75  ror: the size mu
-0002b7d0: 7374 2062 6520 3020 2864 6566 6175 6c74  st be 0 (default
-0002b7e0: 2920 6f72 2022 0d0a 2020 2020 2020 2020  ) or "..        
-0002b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b800: 2020 2020 2020 2020 2020 6622 6120 7661            f"a va
-0002b810: 6c75 6520 6772 6561 7465 7220 6f72 2065  lue greater or e
-0002b820: 7175 616c 2074 6f20 3130 2028 6d69 6e69  qual to 10 (mini
-0002b830: 6d75 6d20 6361 6368 6520 7369 7a65 2922  mum cache size)"
-0002b840: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0002b850: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-0002b860: 0a0d 0a20 2020 2020 2020 2020 2020 2070  ...            p
-0002b870: 6179 6c6f 6164 203d 2064 6963 7428 7369  ayload = dict(si
-0002b880: 7a65 3d73 697a 6529 0d0a 0d0a 2020 2020  ze=size)....    
-0002b890: 2020 2020 2020 2020 7572 6c20 3d20 6165          url = ae
-0002b8a0: 735f 6465 6372 7970 745f 7465 7874 2873  s_decrypt_text(s
-0002b8b0: 656c 662e 7572 6c2c 206b 6579 3d72 616e  elf.url, key=ran
-0002b8c0: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-0002b8d0: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-0002b8e0: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-0002b8f0: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-0002b900: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-0002b910: 2020 2020 746f 6b65 6e20 3d20 6165 735f      token = aes_
-0002b920: 6465 6372 7970 745f 7465 7874 2873 656c  decrypt_text(sel
-0002b930: 662e 746f 6b65 6e2c 206b 6579 3d72 616e  f.token, key=ran
-0002b940: 646f 6d5f 6865 7828 7365 6c66 2e5f 6b65  dom_hex(self._ke
-0002b950: 795f 6c65 6e2c 2073 656c 662e 5f73 6565  y_len, self._see
-0002b960: 642a 3229 2c20 6976 3d72 616e 646f 6d5f  d*2), iv=random_
-0002b970: 6865 7828 3136 2c20 7365 6c66 2e5f 7365  hex(16, self._se
-0002b980: 6564 2a33 2929 0d0a 2020 2020 2020 2020  ed*3))..        
-0002b990: 2020 2020 7265 7320 3d20 7265 7175 6573      res = reques
-0002b9a0: 7473 2e70 6f73 7428 7572 6c2b 6622 7b6d  ts.post(url+f"{m
-0002b9b0: 6f75 6e74 5f70 6174 687d 2f63 6163 6865  ount_path}/cache
-0002b9c0: 2d63 6f6e 6669 6722 2c20 6865 6164 6572  -config", header
-0002b9d0: 733d 7b22 582d 5661 756c 742d 546f 6b65  s={"X-Vault-Toke
-0002b9e0: 6e22 3a20 746f 6b65 6e7d 2c20 6461 7461  n": token}, data
-0002b9f0: 3d6a 736f 6e2e 6475 6d70 7328 7061 796c  =json.dumps(payl
-0002ba00: 6f61 6429 290d 0a20 2020 2020 2020 2020  oad))..         
-0002ba10: 2020 2069 6620 7265 732e 7374 6174 7573     if res.status
-0002ba20: 5f63 6f64 6520 3d3d 2032 3030 206f 7220  _code == 200 or 
-0002ba30: 7265 732e 7374 6174 7573 5f63 6f64 6520  res.status_code 
-0002ba40: 3d3d 2032 3034 3a0d 0a20 2020 2020 2020  == 204:..       
-0002ba50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0002ba60: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-0002ba70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0002ba80: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-0002ba90: 6f67 5f65 7272 6f72 5f72 6573 706f 6e73  og_error_respons
-0002baa0: 6528 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e(__class__.__na
-0002bab0: 6d65 5f5f 2c20 7265 732c 2022 636f 6e66  me__, res, "conf
-0002bac0: 6967 7572 6520 6361 6368 6520 6572 726f  igure cache erro
-0002bad0: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
-0002bae0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0002baf0: 650d 0a0d 0a20 2020 2020 2020 2072 6574  e....        ret
-0002bb00: 7572 6e20 4661 6c73 650d 0a0d 0a20 2020  urn False....   
-0002bb10: 2064 6566 2072 6561 645f 7472 616e 7369   def read_transi
-0002bb20: 745f 6361 6368 655f 636f 6e66 6967 2873  t_cache_config(s
-0002bb30: 656c 662c 206d 6f75 6e74 5f70 6174 683a  elf, mount_path:
-0002bb40: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
-0002bb50: 2222 2272 6561 6420 7468 6520 6361 6368  """read the cach
-0002bb60: 6520 636f 6e66 6967 206f 6620 226d 6f75  e config of "mou
-0002bb70: 6e74 5f70 6174 682f 220d 0a0d 0a20 2020  nt_path/"....   
-0002bb80: 2020 2020 2041 7267 733a 0d0a 2020 2020       Args:..    
-0002bb90: 2020 2020 2020 2020 6d6f 756e 745f 7061          mount_pa
-0002bba0: 7468 2028 7374 7229 0d0a 0d0a 2020 2020  th (str)....    
-0002bbb0: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
-0002bbc0: 2020 2020 2020 2020 2020 6469 6374 206f            dict o
-0002bbd0: 7220 4e6f 6e65 3a20 7265 7475 726e 2074  r None: return t
-0002bbe0: 6865 2063 6163 6865 2063 6f6e 6669 6720  he cache config 
-0002bbf0: 696e 2064 6963 7420 6966 2073 7563 6365  in dict if succe
-0002bc00: 7373 2c20 6f74 6865 7277 6973 6520 7265  ss, otherwise re
-0002bc10: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-0002bc20: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0002bc30: 6966 2073 656c 662e 6973 5f61 7574 683a  if self.is_auth:
-0002bc40: 0d0a 2020 2020 2020 2020 2020 2020 7572  ..            ur
-0002bc50: 6c20 3d20 6165 735f 6465 6372 7970 745f  l = aes_decrypt_
-0002bc60: 7465 7874 2873 656c 662e 7572 6c2c 206b  text(self.url, k
-0002bc70: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
-0002bc80: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
-0002bc90: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
-0002bca0: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
-0002bcb0: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
-0002bcc0: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
-0002bcd0: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
-0002bce0: 7874 2873 656c 662e 746f 6b65 6e2c 206b  xt(self.token, k
-0002bcf0: 6579 3d72 616e 646f 6d5f 6865 7828 7365  ey=random_hex(se
-0002bd00: 6c66 2e5f 6b65 795f 6c65 6e2c 2073 656c  lf._key_len, sel
-0002bd10: 662e 5f73 6565 642a 3229 2c20 6976 3d72  f._seed*2), iv=r
-0002bd20: 616e 646f 6d5f 6865 7828 3136 2c20 7365  andom_hex(16, se
-0002bd30: 6c66 2e5f 7365 6564 2a33 2929 0d0a 2020  lf._seed*3))..  
-0002bd40: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
-0002bd50: 7265 7175 6573 7473 2e67 6574 2875 726c  requests.get(url
-0002bd60: 2b66 227b 6d6f 756e 745f 7061 7468 7d2f  +f"{mount_path}/
-0002bd70: 6361 6368 652d 636f 6e66 6967 222c 2068  cache-config", h
-0002bd80: 6561 6465 7273 3d7b 2258 2d56 6175 6c74  eaders={"X-Vault
-0002bd90: 2d54 6f6b 656e 223a 2074 6f6b 656e 7d29  -Token": token})
-0002bda0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0002bdb0: 2072 6573 2e73 7461 7475 735f 636f 6465   res.status_code
-0002bdc0: 203d 3d20 3230 3020 6f72 2072 6573 2e73   == 200 or res.s
-0002bdd0: 7461 7475 735f 636f 6465 203d 3d20 3230  tatus_code == 20
-0002bde0: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
-0002bdf0: 2020 2020 7265 7475 726e 2072 6573 2e6a      return res.j
-0002be00: 736f 6e28 295b 2264 6174 6122 5d0d 0a20  son()["data"].. 
-0002be10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002be20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002be30: 2020 7365 6c66 2e5f 6c6f 675f 6572 726f    self._log_erro
-0002be40: 725f 7265 7370 6f6e 7365 285f 5f63 6c61  r_response(__cla
-0002be50: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
-0002be60: 6573 2c20 2272 6561 6420 7472 616e 7369  es, "read transi
-0002be70: 7420 6361 6368 6520 636f 6e66 6967 2065  t cache config e
-0002be80: 7272 6f72 2229 0d0a 2020 2020 2020 2020  rror")..        
-0002be90: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0002bea0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0002beb0: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
-0002bec0: 6e20 4e6f 6e65 0d0a                      n None..
+0002a930: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+0002a940: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002a950: 2046 616c 7365 0d0a 0d0a 2020 2020 2320   False....    # 
+0002a960: 544f 444f 3a20 7761 6974 2066 6f72 2074  TODO: wait for t
+0002a970: 6573 7469 6e67 0d0a 2020 2020 6465 6620  esting..    def 
+0002a980: 7472 696d 5f6b 6579 2873 656c 662c 206d  trim_key(self, m
+0002a990: 6f75 6e74 5f70 6174 683a 2073 7472 2c20  ount_path: str, 
+0002a9a0: 6e61 6d65 3a20 7374 722c 206d 696e 5f61  name: str, min_a
+0002a9b0: 7661 696c 6162 6c65 5f76 6572 7369 6f6e  vailable_version
+0002a9c0: 3a20 696e 7429 3a0d 0a20 2020 2020 2020  : int):..       
+0002a9d0: 2022 2222 7472 696d 206f 6c64 6572 206b   """trim older k
+0002a9e0: 6579 2076 6572 7369 6f6e 7320 7365 7474  ey versions sett
+0002a9f0: 696e 6720 6120 6d69 6e69 6d75 6d20 7665  ing a minimum ve
+0002aa00: 7273 696f 6e20 666f 7220 7468 6520 6b65  rsion for the ke
+0002aa10: 7972 696e 670d 0a0d 0a20 2020 2020 2020  yring....       
+0002aa20: 204f 6e63 6520 7472 696d 6d65 642c 2070   Once trimmed, p
+0002aa30: 7265 7669 6f75 7320 7665 7273 696f 6e73  revious versions
+0002aa40: 206f 6620 7468 6520 6b65 7920 6361 6e6e   of the key cann
+0002aa50: 6f74 2062 6520 7265 636f 7665 7265 642e  ot be recovered.
+0002aa60: 0d0a 0d0a 2020 2020 2020 2020 5265 6665  ....        Refe
+0002aa70: 7220 746f 2068 7474 7073 3a2f 2f64 6576  r to https://dev
+0002aa80: 656c 6f70 6572 2e68 6173 6869 636f 7270  eloper.hashicorp
+0002aa90: 2e63 6f6d 2f76 6175 6c74 2f61 7069 2d64  .com/vault/api-d
+0002aaa0: 6f63 732f 7365 6372 6574 2f74 7261 6e73  ocs/secret/trans
+0002aab0: 6974 2374 7269 6d2d 6b65 7920 666f 7220  it#trim-key for 
+0002aac0: 6d6f 7265 2064 6574 6169 6c73 2e0d 0a0d  more details....
+0002aad0: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
+0002aae0: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
+0002aaf0: 745f 7061 7468 2028 7374 7229 0d0a 2020  t_path (str)..  
+0002ab00: 2020 2020 2020 2020 2020 6e61 6d65 2028            name (
+0002ab10: 7374 7229 3a20 4e61 6d65 206f 6620 7468  str): Name of th
+0002ab20: 6520 6b65 790d 0a20 2020 2020 2020 2020  e key..         
+0002ab30: 2020 206d 696e 5f61 7661 696c 6162 6c65     min_available
+0002ab40: 5f76 6572 7369 6f6e 2028 696e 7429 3a20  _version (int): 
+0002ab50: 5468 6520 6d69 6e69 6d75 6d20 6176 6169  The minimum avai
+0002ab60: 6c61 626c 6520 7665 7273 696f 6e20 666f  lable version fo
+0002ab70: 7220 7468 6520 6b65 7920 7269 6e67 2e20  r the key ring. 
+0002ab80: 416c 6c20 7665 7273 696f 6e73 200d 0a20  All versions .. 
+0002ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002abb0: 2020 2020 2020 2020 6265 666f 7265 2074          before t
+0002abc0: 6869 7320 7665 7273 696f 6e20 7769 6c6c  his version will
+0002abd0: 2062 6520 7065 726d 616e 656e 746c 7920   be permanently 
+0002abe0: 6465 6c65 7465 642e 2054 6869 7320 7661  deleted. This va
+0002abf0: 6c75 6520 6361 6e20 0d0a 2020 2020 2020  lue can ..      
+0002ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac20: 2020 2061 7420 6d6f 7374 2062 6520 6571     at most be eq
+0002ac30: 7561 6c20 746f 2074 6865 206c 6573 7365  ual to the lesse
+0002ac40: 7220 6f66 2060 6d69 6e5f 6465 6372 7970  r of `min_decryp
+0002ac50: 7469 6f6e 5f76 6572 7369 6f6e 6020 616e  tion_version` an
+0002ac60: 6420 0d0a 2020 2020 2020 2020 2020 2020  d ..            
+0002ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac80: 2020 2020 2020 2020 2020 2020 2060 6d69               `mi
+0002ac90: 6e5f 656e 6372 7970 7469 6f6e 5f76 6572  n_encryption_ver
+0002aca0: 7369 6f6e 602e 2054 6869 7320 6973 206e  sion`. This is n
+0002acb0: 6f74 2061 6c6c 6f77 6564 2074 6f20 6265  ot allowed to be
+0002acc0: 2073 6574 2077 6865 6e20 6569 7468 6572   set when either
+0002acd0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0002ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002acf0: 2020 2020 2020 2020 2020 2020 606d 696e              `min
+0002ad00: 5f65 6e63 7279 7074 696f 6e5f 7665 7273  _encryption_vers
+0002ad10: 696f 6e60 206f 7220 606d 696e 5f64 6563  ion` or `min_dec
+0002ad20: 7279 7074 696f 6e5f 7665 7273 696f 6e60  ryption_version`
+0002ad30: 2069 7320 7365 7420 746f 207a 6572 6f2e   is set to zero.
+0002ad40: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0002ad50: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
+0002ad60: 2020 626f 6f6c 3a20 7265 7475 726e 2054    bool: return T
+0002ad70: 7275 6520 6966 2073 7563 6365 7373 2c20  rue if success, 
+0002ad80: 6f74 6865 7277 6973 6520 7265 7475 726e  otherwise return
+0002ad90: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0002ada0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+0002adb0: 7365 6c66 2e69 735f 6175 7468 3a0d 0a20  self.is_auth:.. 
+0002adc0: 2020 2020 2020 2020 2020 206b 6579 5f69             key_i
+0002add0: 6e66 6f20 3d20 7365 6c66 2e72 6561 645f  nfo = self.read_
+0002ade0: 6b65 7928 6d6f 756e 745f 7061 7468 2c20  key(mount_path, 
+0002adf0: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
+0002ae00: 2020 2069 6620 6b65 795f 696e 666f 2069     if key_info i
+0002ae10: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0002ae20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002ae30: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0002ae40: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0002ae50: 2069 6620 6b65 795f 696e 666f 5b22 6d69   if key_info["mi
+0002ae60: 6e5f 6465 6372 7970 7469 6f6e 5f76 6572  n_decryption_ver
+0002ae70: 7369 6f6e 225d 203d 3d20 3020 6f72 206b  sion"] == 0 or k
+0002ae80: 6579 5f69 6e66 6f5b 226d 696e 5f65 6e63  ey_info["min_enc
+0002ae90: 7279 7074 696f 6e5f 7665 7273 696f 6e22  ryption_version"
+0002aea0: 5d20 3d3d 2030 3a0d 0a20 2020 2020 2020  ] == 0:..       
+0002aeb0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0002aec0: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+0002aed0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0002aee0: 7d20 2d20 7472 696d 206b 6579 2065 7272  } - trim key err
+0002aef0: 6f72 3a20 646f 206e 6f74 2061 6c6c 6f77  or: do not allow
+0002af00: 2074 6f20 7472 696d 206b 6579 2077 6865   to trim key whe
+0002af10: 6e20 220d 0a20 2020 2020 2020 2020 2020  n "..           
+0002af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002af30: 2020 2020 2020 2066 2260 6d69 6e5f 656e         f"`min_en
+0002af40: 6372 7970 7469 6f6e 5f76 6572 7369 6f6e  cryption_version
+0002af50: 6020 6f72 2060 6d69 6e5f 6465 6372 7970  ` or `min_decryp
+0002af60: 7469 6f6e 5f76 6572 7369 6f6e 6020 6973  tion_version` is
+0002af70: 2073 6574 2074 6f20 7a65 726f 2229 0d0a   set to zero")..
+0002af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002af90: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+0002afa0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0002afb0: 2020 2020 2020 2020 6966 206d 696e 5f61          if min_a
+0002afc0: 7661 696c 6162 6c65 5f76 6572 7369 6f6e  vailable_version
+0002afd0: 203e 206b 6579 5f69 6e66 6f5b 226d 696e   > key_info["min
+0002afe0: 5f64 6563 7279 7074 696f 6e5f 7665 7273  _decryption_vers
+0002aff0: 696f 6e22 5d20 6f72 205c 0d0a 2020 2020  ion"] or \..    
+0002b000: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+0002b010: 6176 6169 6c61 626c 655f 7665 7273 696f  available_versio
+0002b020: 6e20 3e20 6b65 795f 696e 666f 5b22 6d69  n > key_info["mi
+0002b030: 6e5f 656e 6372 7970 7469 6f6e 5f76 6572  n_encryption_ver
+0002b040: 7369 6f6e 225d 3a0d 0a20 2020 2020 2020  sion"]:..       
+0002b050: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0002b060: 6767 6572 2e65 7272 6f72 2866 227b 5f5f  gger.error(f"{__
+0002b070: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0002b080: 7d20 2d20 7472 696d 206b 6579 2065 7272  } - trim key err
+0002b090: 6f72 3a20 7468 6520 6d69 6e5f 6176 6169  or: the min_avai
+0002b0a0: 6c61 626c 655f 7665 7273 696f 6e20 6361  lable_version ca
+0002b0b0: 6e20 6174 206d 6f73 7420 220d 0a20 2020  n at most "..   
+0002b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b0d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002b0e0: 2262 6520 6571 7561 6c20 746f 2074 6865  "be equal to the
+0002b0f0: 206c 6573 7365 7220 6f66 2060 6d69 6e5f   lesser of `min_
+0002b100: 6465 6372 7970 7469 6f6e 5f76 6572 7369  decryption_versi
+0002b110: 6f6e 6020 616e 6420 606d 696e 5f65 6e63  on` and `min_enc
+0002b120: 7279 7074 696f 6e5f 7665 7273 696f 6e60  ryption_version`
+0002b130: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0002b140: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0002b150: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0002b160: 7061 796c 6f61 6420 3d20 6469 6374 286d  payload = dict(m
+0002b170: 696e 5f61 7661 696c 6162 6c65 5f76 6572  in_available_ver
+0002b180: 7369 6f6e 3d6d 696e 5f61 7661 696c 6162  sion=min_availab
+0002b190: 6c65 5f76 6572 7369 6f6e 290d 0a0d 0a20  le_version).... 
+0002b1a0: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+0002b1b0: 2061 6573 5f64 6563 7279 7074 5f74 6578   aes_decrypt_tex
+0002b1c0: 7428 7365 6c66 2e75 726c 2c20 6b65 793d  t(self.url, key=
+0002b1d0: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+0002b1e0: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+0002b1f0: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+0002b200: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+0002b210: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+0002b220: 2020 2020 2020 2074 6f6b 656e 203d 2061         token = a
+0002b230: 6573 5f64 6563 7279 7074 5f74 6578 7428  es_decrypt_text(
+0002b240: 7365 6c66 2e74 6f6b 656e 2c20 6b65 793d  self.token, key=
+0002b250: 7261 6e64 6f6d 5f68 6578 2873 656c 662e  random_hex(self.
+0002b260: 5f6b 6579 5f6c 656e 2c20 7365 6c66 2e5f  _key_len, self._
+0002b270: 7365 6564 2a32 292c 2069 763d 7261 6e64  seed*2), iv=rand
+0002b280: 6f6d 5f68 6578 2831 362c 2073 656c 662e  om_hex(16, self.
+0002b290: 5f73 6565 642a 3329 290d 0a20 2020 2020  _seed*3))..     
+0002b2a0: 2020 2020 2020 2072 6573 203d 2072 6571         res = req
+0002b2b0: 7565 7374 732e 706f 7374 2875 726c 2b66  uests.post(url+f
+0002b2c0: 227b 6d6f 756e 745f 7061 7468 7d2f 6b65  "{mount_path}/ke
+0002b2d0: 7973 2f7b 6e61 6d65 7d2f 7472 696d 222c  ys/{name}/trim",
+0002b2e0: 2068 6561 6465 7273 3d7b 2258 2d56 6175   headers={"X-Vau
+0002b2f0: 6c74 2d54 6f6b 656e 223a 2074 6f6b 656e  lt-Token": token
+0002b300: 7d2c 2064 6174 613d 6a73 6f6e 2e64 756d  }, data=json.dum
+0002b310: 7073 2870 6179 6c6f 6164 2929 0d0a 2020  ps(payload))..  
+0002b320: 2020 2020 2020 2020 2020 6966 2072 6573            if res
+0002b330: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
+0002b340: 3230 3020 6f72 2072 6573 2e73 7461 7475  200 or res.statu
+0002b350: 735f 636f 6465 203d 3d20 3230 343a 0d0a  s_code == 204:..
+0002b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b370: 7265 7475 726e 2054 7275 650d 0a20 2020  return True..   
+0002b380: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0002b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b3a0: 7365 6c66 2e5f 6c6f 675f 6572 726f 725f  self._log_error_
+0002b3b0: 7265 7370 6f6e 7365 285f 5f63 6c61 7373  response(__class
+0002b3c0: 5f5f 2e5f 5f6e 616d 655f 5f2c 2072 6573  __.__name__, res
+0002b3d0: 2c20 2274 7269 6d20 6b65 7920 6572 726f  , "trim key erro
+0002b3e0: 7222 290d 0a20 2020 2020 2020 2020 2020  r")..           
+0002b3f0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0002b400: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
+0002b410: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0002b420: 650d 0a0d 0a20 2020 2023 2054 4f44 4f3a  e....    # TODO:
+0002b430: 2077 6169 7420 666f 7220 7465 7374 696e   wait for testin
+0002b440: 670d 0a20 2020 2064 6566 2063 6f6e 6669  g..    def confi
+0002b450: 6775 7265 5f63 6163 6865 2873 656c 662c  gure_cache(self,
+0002b460: 206d 6f75 6e74 5f70 6174 683a 2073 7472   mount_path: str
+0002b470: 2c20 7369 7a65 3a20 696e 7420 3d20 3029  , size: int = 0)
+0002b480: 3a0d 0a20 2020 2020 2020 2022 2222 636f  :..        """co
+0002b490: 6e66 6967 7572 6520 7468 6520 7472 616e  nfigure the tran
+0002b4a0: 7369 7420 656e 6769 6e65 2773 2063 6163  sit engine's cac
+0002b4b0: 6865 0d0a 0d0a 2020 2020 2020 2020 5265  he....        Re
+0002b4c0: 6665 7220 746f 2068 7474 7073 3a2f 2f64  fer to https://d
+0002b4d0: 6576 656c 6f70 6572 2e68 6173 6869 636f  eveloper.hashico
+0002b4e0: 7270 2e63 6f6d 2f76 6175 6c74 2f61 7069  rp.com/vault/api
+0002b4f0: 2d64 6f63 732f 7365 6372 6574 2f74 7261  -docs/secret/tra
+0002b500: 6e73 6974 2363 6f6e 6669 6775 7265 2d63  nsit#configure-c
+0002b510: 6163 6865 2066 6f72 206d 6f72 6520 6465  ache for more de
+0002b520: 7461 696c 732e 0d0a 0d0a 2020 2020 2020  tails.....      
+0002b530: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
+0002b540: 2020 2020 206d 6f75 6e74 5f70 6174 6820       mount_path 
+0002b550: 2873 7472 293a 205f 6465 7363 7269 7074  (str): _descript
+0002b560: 696f 6e5f 0d0a 2020 2020 2020 2020 2020  ion_..          
+0002b570: 2020 7369 7a65 2028 696e 742c 206f 7074    size (int, opt
+0002b580: 696f 6e61 6c29 3a20 5370 6563 6966 6965  ional): Specifie
+0002b590: 7320 7468 6520 7369 7a65 2069 6e20 7465  s the size in te
+0002b5a0: 726d 7320 6f66 206e 756d 6265 7220 6f66  rms of number of
+0002b5b0: 2065 6e74 7269 6573 2e20 4120 7369 7a65   entries. A size
+0002b5c0: 206f 6620 6030 6020 6d65 616e 7320 756e   of `0` means un
+0002b5d0: 6c69 6d69 7465 642e 200d 0a20 2020 2020  limited. ..     
+0002b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5f0: 2020 2020 2020 2020 2020 2020 2041 204c               A L
+0002b600: 6561 7374 2052 6563 656e 746c 7920 5573  east Recently Us
+0002b610: 6564 2028 4c52 5529 2063 6163 6869 6e67  ed (LRU) caching
+0002b620: 2073 7472 6174 6567 7920 6973 2075 7365   strategy is use
+0002b630: 6420 666f 7220 6120 6e6f 6e2d 7a65 726f  d for a non-zero
+0002b640: 2063 6163 6865 2073 697a 652e 200d 0a20   cache size. .. 
+0002b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b670: 204d 7573 7420 6265 2030 2028 6465 6661   Must be 0 (defa
+0002b680: 756c 7429 206f 7220 6120 7661 6c75 6520  ult) or a value 
+0002b690: 6772 6561 7465 7220 6f72 2065 7175 616c  greater or equal
+0002b6a0: 2074 6f20 3130 2028 6d69 6e69 6d75 6d20   to 10 (minimum 
+0002b6b0: 6361 6368 6520 7369 7a65 292e 200d 0a20  cache size). .. 
+0002b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b6e0: 2044 6566 6175 6c74 7320 746f 2030 2e0d   Defaults to 0..
+0002b6f0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+0002b700: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+0002b710: 2062 6f6f 6c3a 2072 6574 7572 6e20 5472   bool: return Tr
+0002b720: 7565 2069 6620 7375 6363 6573 732c 206f  ue if success, o
+0002b730: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
+0002b740: 4661 6c73 650d 0a20 2020 2020 2020 2022  False..        "
+0002b750: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0002b760: 656c 662e 6973 5f61 7574 683a 0d0a 2020  elf.is_auth:..  
+0002b770: 2020 2020 2020 2020 2020 6966 2073 697a            if siz
+0002b780: 6520 213d 2030 2061 6e64 2073 697a 6520  e != 0 and size 
+0002b790: 3c20 3130 3a0d 0a20 2020 2020 2020 2020  < 10:..         
+0002b7a0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+0002b7b0: 6572 2e65 7272 6f72 2866 227b 5f5f 636c  er.error(f"{__cl
+0002b7c0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+0002b7d0: 2d20 636f 6e66 6967 7572 6520 6361 6368  - configure cach
+0002b7e0: 6520 6572 726f 723a 2074 6865 2073 697a  e error: the siz
+0002b7f0: 6520 6d75 7374 2062 6520 3020 2864 6566  e must be 0 (def
+0002b800: 6175 6c74 2920 6f72 2022 0d0a 2020 2020  ault) or "..    
+0002b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b820: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0002b830: 6120 7661 6c75 6520 6772 6561 7465 7220  a value greater 
+0002b840: 6f72 2065 7175 616c 2074 6f20 3130 2028  or equal to 10 (
+0002b850: 6d69 6e69 6d75 6d20 6361 6368 6520 7369  minimum cache si
+0002b860: 7a65 2922 290d 0a20 2020 2020 2020 2020  ze)")..         
+0002b870: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0002b880: 6c73 650d 0a0d 0a20 2020 2020 2020 2020  lse....         
+0002b890: 2020 2070 6179 6c6f 6164 203d 2064 6963     payload = dic
+0002b8a0: 7428 7369 7a65 3d73 697a 6529 0d0a 0d0a  t(size=size)....
+0002b8b0: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+0002b8c0: 3d20 6165 735f 6465 6372 7970 745f 7465  = aes_decrypt_te
+0002b8d0: 7874 2873 656c 662e 7572 6c2c 206b 6579  xt(self.url, key
+0002b8e0: 3d72 616e 646f 6d5f 6865 7828 7365 6c66  =random_hex(self
+0002b8f0: 2e5f 6b65 795f 6c65 6e2c 2073 656c 662e  ._key_len, self.
+0002b900: 5f73 6565 642a 3229 2c20 6976 3d72 616e  _seed*2), iv=ran
+0002b910: 646f 6d5f 6865 7828 3136 2c20 7365 6c66  dom_hex(16, self
+0002b920: 2e5f 7365 6564 2a33 2929 0d0a 2020 2020  ._seed*3))..    
+0002b930: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+0002b940: 6165 735f 6465 6372 7970 745f 7465 7874  aes_decrypt_text
+0002b950: 2873 656c 662e 746f 6b65 6e2c 206b 6579  (self.token, key
+0002b960: 3d72 616e 646f 6d5f 6865 7828 7365 6c66  =random_hex(self
+0002b970: 2e5f 6b65 795f 6c65 6e2c 2073 656c 662e  ._key_len, self.
+0002b980: 5f73 6565 642a 3229 2c20 6976 3d72 616e  _seed*2), iv=ran
+0002b990: 646f 6d5f 6865 7828 3136 2c20 7365 6c66  dom_hex(16, self
+0002b9a0: 2e5f 7365 6564 2a33 2929 0d0a 2020 2020  ._seed*3))..    
+0002b9b0: 2020 2020 2020 2020 7265 7320 3d20 7265          res = re
+0002b9c0: 7175 6573 7473 2e70 6f73 7428 7572 6c2b  quests.post(url+
+0002b9d0: 6622 7b6d 6f75 6e74 5f70 6174 687d 2f63  f"{mount_path}/c
+0002b9e0: 6163 6865 2d63 6f6e 6669 6722 2c20 6865  ache-config", he
+0002b9f0: 6164 6572 733d 7b22 582d 5661 756c 742d  aders={"X-Vault-
+0002ba00: 546f 6b65 6e22 3a20 746f 6b65 6e7d 2c20  Token": token}, 
+0002ba10: 6461 7461 3d6a 736f 6e2e 6475 6d70 7328  data=json.dumps(
+0002ba20: 7061 796c 6f61 6429 290d 0a20 2020 2020  payload))..     
+0002ba30: 2020 2020 2020 2069 6620 7265 732e 7374         if res.st
+0002ba40: 6174 7573 5f63 6f64 6520 3d3d 2032 3030  atus_code == 200
+0002ba50: 206f 7220 7265 732e 7374 6174 7573 5f63   or res.status_c
+0002ba60: 6f64 6520 3d3d 2032 3034 3a0d 0a20 2020  ode == 204:..   
+0002ba70: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0002ba80: 7572 6e20 5472 7565 0d0a 2020 2020 2020  urn True..      
+0002ba90: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0002baa0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002bab0: 662e 5f6c 6f67 5f65 7272 6f72 5f72 6573  f._log_error_res
+0002bac0: 706f 6e73 6528 5f5f 636c 6173 735f 5f2e  ponse(__class__.
+0002bad0: 5f5f 6e61 6d65 5f5f 2c20 7265 732c 2022  __name__, res, "
+0002bae0: 636f 6e66 6967 7572 6520 6361 6368 6520  configure cache 
+0002baf0: 6572 726f 7222 290d 0a20 2020 2020 2020  error")..       
+0002bb00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002bb10: 4661 6c73 650d 0a0d 0a20 2020 2020 2020  False....       
+0002bb20: 2072 6574 7572 6e20 4661 6c73 650d 0a0d   return False...
+0002bb30: 0a20 2020 2064 6566 2072 6561 645f 7472  .    def read_tr
+0002bb40: 616e 7369 745f 6361 6368 655f 636f 6e66  ansit_cache_conf
+0002bb50: 6967 2873 656c 662c 206d 6f75 6e74 5f70  ig(self, mount_p
+0002bb60: 6174 683a 2073 7472 293a 0d0a 2020 2020  ath: str):..    
+0002bb70: 2020 2020 2222 2272 6561 6420 7468 6520      """read the 
+0002bb80: 6361 6368 6520 636f 6e66 6967 206f 6620  cache config of 
+0002bb90: 226d 6f75 6e74 5f70 6174 682f 220d 0a0d  "mount_path/"...
+0002bba0: 0a20 2020 2020 2020 2041 7267 733a 0d0a  .        Args:..
+0002bbb0: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
+0002bbc0: 745f 7061 7468 2028 7374 7229 0d0a 0d0a  t_path (str)....
+0002bbd0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+0002bbe0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0002bbf0: 6374 206f 7220 4e6f 6e65 3a20 7265 7475  ct or None: retu
+0002bc00: 726e 2074 6865 2063 6163 6865 2063 6f6e  rn the cache con
+0002bc10: 6669 6720 696e 2064 6963 7420 6966 2073  fig in dict if s
+0002bc20: 7563 6365 7373 2c20 6f74 6865 7277 6973  uccess, otherwis
+0002bc30: 6520 7265 7475 726e 204e 6f6e 650d 0a20  e return None.. 
+0002bc40: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0002bc50: 2020 2020 6966 2073 656c 662e 6973 5f61      if self.is_a
+0002bc60: 7574 683a 0d0a 2020 2020 2020 2020 2020  uth:..          
+0002bc70: 2020 7572 6c20 3d20 6165 735f 6465 6372    url = aes_decr
+0002bc80: 7970 745f 7465 7874 2873 656c 662e 7572  ypt_text(self.ur
+0002bc90: 6c2c 206b 6579 3d72 616e 646f 6d5f 6865  l, key=random_he
+0002bca0: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+0002bcb0: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+0002bcc0: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+0002bcd0: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+0002bce0: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+0002bcf0: 6b65 6e20 3d20 6165 735f 6465 6372 7970  ken = aes_decryp
+0002bd00: 745f 7465 7874 2873 656c 662e 746f 6b65  t_text(self.toke
+0002bd10: 6e2c 206b 6579 3d72 616e 646f 6d5f 6865  n, key=random_he
+0002bd20: 7828 7365 6c66 2e5f 6b65 795f 6c65 6e2c  x(self._key_len,
+0002bd30: 2073 656c 662e 5f73 6565 642a 3229 2c20   self._seed*2), 
+0002bd40: 6976 3d72 616e 646f 6d5f 6865 7828 3136  iv=random_hex(16
+0002bd50: 2c20 7365 6c66 2e5f 7365 6564 2a33 2929  , self._seed*3))
+0002bd60: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0002bd70: 7320 3d20 7265 7175 6573 7473 2e67 6574  s = requests.get
+0002bd80: 2875 726c 2b66 227b 6d6f 756e 745f 7061  (url+f"{mount_pa
+0002bd90: 7468 7d2f 6361 6368 652d 636f 6e66 6967  th}/cache-config
+0002bda0: 222c 2068 6561 6465 7273 3d7b 2258 2d56  ", headers={"X-V
+0002bdb0: 6175 6c74 2d54 6f6b 656e 223a 2074 6f6b  ault-Token": tok
+0002bdc0: 656e 7d29 0d0a 2020 2020 2020 2020 2020  en})..          
+0002bdd0: 2020 6966 2072 6573 2e73 7461 7475 735f    if res.status_
+0002bde0: 636f 6465 203d 3d20 3230 3020 6f72 2072  code == 200 or r
+0002bdf0: 6573 2e73 7461 7475 735f 636f 6465 203d  es.status_code =
+0002be00: 3d20 3230 343a 0d0a 2020 2020 2020 2020  = 204:..        
+0002be10: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0002be20: 6573 2e6a 736f 6e28 295b 2264 6174 6122  es.json()["data"
+0002be30: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
+0002be40: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0002be50: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
+0002be60: 6572 726f 725f 7265 7370 6f6e 7365 285f  error_response(_
+0002be70: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+0002be80: 5f2c 2072 6573 2c20 2272 6561 6420 7472  _, res, "read tr
+0002be90: 616e 7369 7420 6361 6368 6520 636f 6e66  ansit cache conf
+0002bea0: 6967 2065 7272 6f72 2229 0d0a 2020 2020  ig error")..    
+0002beb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002bec0: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+0002bed0: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+0002bee0: 6574 7572 6e20 4e6f 6e65 0d0a            eturn None..
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase.egg-info/PKG-INFO` & `mlcbase-1.2.0a2/src/mlcbase.egg-info/PKG-INFO`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mlcbase
-Version: 1.2.0a1
+Version: 1.2.0a2
 Summary: The base module of all MuLingCloud modules and applications.
 Author-email: Weiming Chen <wm_chen@yeah.net>, Yuanshuang Sun <sunsun5544@126.com>
 License:                                  Apache License
                                    Version 2.0, January 2004
                                 https://www.apache.org/licenses/
         
            TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
@@ -201,15 +201,15 @@
         
            Unless required by applicable law or agreed to in writing, software
            distributed under the License is distributed on an "AS IS" BASIS,
            WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
            See the License for the specific language governing permissions and
            limitations under the License.
 Project-URL: Homepage, https://www.mulingcloud.com
-Project-URL: Repository, https://github.com/wmchen/mlcbase.git
+Project-URL: Repository, https://github.com/mulingcloud/mlcbase.git
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: POSIX :: Linux
 Classifier: Operating System :: MacOS
 Classifier: Programming Language :: Python
 Requires-Python: >=3.7
 Description-Content-Type: text/markdown
 License-File: LICENSE
@@ -249,57 +249,61 @@
 Supported platforms:
 
 - ðŸ˜„ Windows (Python 3.6+)
 - ðŸ˜„ Linux (Python 3.7+)
 - MacOS (untested, maybe. I don't have a MacOS machineðŸ˜«. Anyone can help me?)
 
 <details open>
-<summary>Features (v1.2.0a1)</summary>
+<summary>Features (v1.2.0a2)</summary>
+
+- $\color{red}{\textbf{new }}$ **Register**
+
+    We define a `Registry` to register modules, which allow you to use the module by a config file.
 
 - **Config Dictionary**
 
     We define a `ConfigDict` for more convenience usage. It is a type of dictionary inherited from `dict`. It has all the features of `dict` while including other more convenient features.
 
-- $\color{blue}{\textbf{update }}$ **Logger**
+- **Logger**
 
     We build a `Logger` for more convenience logging management. Actually, this is a slightly improvement based on [loguru](https://github.com/Delgan/loguru). Refer to [pylog](https://github.com/wmchen/pylog) for more information.
 
-- $\color{blue}{\textbf{update }}$ **Runtime Analysis**
+- **Runtime Analysis**
 
     We offer a simple way to evaluate functions in the Python project. All you need is to wrap the target function by a decorator.
 
-- $\color{blue}{\textbf{update }}$ **File Operations**
+- **File Operations**
 
     We offer various features to make file operations easier. Besides, we offer a simple way to load and save JSON, YAML, and XML files.
 
-- $\color{red}{\textbf{new }}$ **Image IO**
+- **Image IO**
 
     We offer a simple way to load and save images.
 
-- $\color{red}{\textbf{new }}$ **One-Time Password**
+- **One-Time Password**
 
     We support two methods for OTP: Time-based One-Time Password (TOTP) and HMAC-based One-Time Password (HOTP).
 
-- $\color{blue}{\textbf{update }}$ **Encryption and Decryption**
+- **Encryption and Decryption**
 
     We offer various methods to encrypt and decrypt or verify text, files and passwords including RSA, AES and Hash.
 
-- $\color{blue}{\textbf{update }}$ **Database**
+- **Database**
 
     We offer a simple way to operate the database. Supported database backend: MySQL, SQLite.
 
 - **Remote Connection**
 
     We support SSH and SFTP for remote connection.
 
-- $\color{blue}{\textbf{update }}$ **Email**
+- **Email**
 
     We offer a simple API to send email. Currently only supports SMTP (with SSL) server.
 
-- $\color{red}{\textbf{BREAKING CHANGE }}$ **HashiCorp Vault**
+- **HashiCorp Vault**
 
     We offer several APIs to operate [HashiCorp/Vault](https://developer.hashicorp.com/vault) through HTTP requests. Supported authorization methods: token, username & password. Supported secret engines: KV v1, KV v2, TOTP, Transit.
 
 </details>
 
 ## Installation
 
@@ -341,10 +345,10 @@
 
 ## License
 
 This project is released under the [Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0).
 
 ## Repository
 
-- Github Repository: https://github.com/wmchen/mlcbase
+- Github Repository: https://github.com/mulingcloud/mlcbase
 - GitLab Repository: https://gitlab.com/wm-chen/mlcbase
 - Gitee Repository: https://gitee.com/wm-chen/mlcbase
```

### Comparing `mlcbase-1.2.0a1/src/mlcbase.egg-info/SOURCES.txt` & `mlcbase-1.2.0a2/src/mlcbase.egg-info/SOURCES.txt`

 * *Files 5% similar despite different names*

```diff
@@ -11,14 +11,15 @@
 src/mlcbase/entrypt_rsa.py
 src/mlcbase/file.py
 src/mlcbase/image_io.py
 src/mlcbase/loading.py
 src/mlcbase/logger.py
 src/mlcbase/misc.py
 src/mlcbase/otp.py
+src/mlcbase/register.py
 src/mlcbase/remote_connect.py
 src/mlcbase/timer.py
 src/mlcbase/vault.py
 src/mlcbase.egg-info/PKG-INFO
 src/mlcbase.egg-info/SOURCES.txt
 src/mlcbase.egg-info/dependency_links.txt
 src/mlcbase.egg-info/requires.txt
```

